!function(e){"use strict";function t(e){if("string"!=typeof e)throw Error("Expected language code as string value")}class a{constructor(e,t){this.channel=e,this.messageWindow=t,this.DEFAULT_REQUEST_TIMEOUT=2e4,this.REQUEST_TIMEOUT_INTERVAL=500,this.idSequence=0,this.requests={},this.requestTimeoutWatcher=null,this.handleMessage=e=>{try{this.isValidResponse(e.data)&&this.handleResponse(e.data.message)}catch(t){console.debug(`Unable to handle queue response (channel: ${this.channel})`,e,t)}}}listen(){this.setRequestTimeoutWatcher(),this.messageWindow.addEventListener("message",this.handleMessage)}disconnect(){this.cleanRequestTimeoutWatcher(),this.messageWindow.removeEventListener("message",this.handleMessage)}send(e,t,a={timeout:this.DEFAULT_REQUEST_TIMEOUT}){const n=this.nextRequestId();this.requests[n]={id:n,callback:t,timestamp:(new Date).getTime(),timeout:a.timeout,data:e},this.messageWindow.postMessage({channel:this.channel,message:{requestId:n,data:e}},"*")}isValidResponse(e){return e.channel===this.channel&&e.message&&e.message.hasOwnProperty("requestId")&&e.message.hasOwnProperty("data")&&e.message.data.hasOwnProperty("status")}handleResponse(e){const t=e,n=this.requests[t.requestId];if(n)switch(delete this.requests[t.requestId],t.data.status){case a.STATUS_SUCCESS:n.callback({status:"success",result:t.data.result});break;case a.STATUS_ERROR:n.callback({status:"error",cause:t.data.cause})}}cleanRequestTimeoutWatcher(){this.requestTimeoutWatcher&&window.clearInterval(this.requestTimeoutWatcher)}setRequestTimeoutWatcher(){this.requestTimeoutWatcher=window.setInterval((()=>{this.removeExpiredRequests()}),this.REQUEST_TIMEOUT_INTERVAL)}removeExpiredRequests(){const e=(e,t)=>void 0!==e&&e.timestamp&&t-e.timestamp>e.timeout,t=(new Date).getTime();for(const a in this.requests)if(this.requests.hasOwnProperty(a)){const n=this.requests[a];e(n,t)&&(delete this.requests[a],n.callback({status:"timeout"}))}}nextRequestId(){return this.idSequence===Number.MAX_VALUE&&(this.idSequence=0),this.idSequence++}}a.STATUS_SUCCESS="success",a.STATUS_ERROR="error",a.STATUS_TIMEOUT="timeout";var n;!function(e){e.LoadScripts="load_scripts",e.LoadStoredState="load_stored_state",e.JourneyPlayerStart="player_init",e.EvaluateAutoplayRules="evaluate_autoplay_rules",e.EvaluateJourneyVisibilityRules="evaluate_journey_visiblity_rules",e.ShowNextStep="show_next_step",e.FindNextVisibleStep="find_next_visible_step",e.LoadLauncher="load_launcher",e.EvaluateTips="evaluate_tips",e.LoadData="load_data",e.ParseTipLanguages="parse_tip_languages",e.EvaluateTipsIncrement="evaluate_tips_increment"}(n||(n={}));const s="newired-cross-domain-storage-iframe",r="newired-iframe",o="newired-portal",i=function(e){try{return e.name===s||e.name===r||e.name===o}catch(e){return!0}}(window)?window:function(){const e=r;let t=document.getElementById(e);if(t||(t=document.createElement("iframe"),t.setAttribute("id",e),t.style.display="none",t.style.visibility="hidden",document.body.appendChild(t)),!t.contentWindow)throw new Error(`Browsing context of "${e}" window is discarded.`);return t.contentWindow}();Function.prototype.safeBind=i.Function.prototype.bind,Function.prototype.safeApply=i.Function.prototype.apply,String.prototype.safeTrim=i.String.prototype.trim;i.Set.bind(window),i.setTimeout.bind(window),i.setInterval.bind(window),i.clearTimeout.bind(window),i.clearInterval.bind(window);var u,l={push:function(e,t){i.Array.prototype.push.call(e,t)},pushApply:function(e,t){i.Array.prototype.push.apply(e,t)},unique:function(e){return i.Array.from(new Set(e))}};!function(e){e.Never="Never",e.Year="Year",e.Day="Day"}(u||(u={}));const c="NW_",g="NW_global_";class d{static createCookie(e,t,a){const n=this.createCookieExpirationEntry(a);document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}${n}; path=/`}static createCookieExpirationEntry(e){const t=this.calculateExpirationDate(e);return t?`; expires=${t.toUTCString()}`:""}static calculateExpirationDate(e){const t=new Date;if(!e)return t.setMinutes(t.getMinutes()+20),t;switch(e){case u.Never:t.setFullYear(t.getFullYear()+10);break;case u.Year:t.setFullYear(t.getFullYear()+1);break;case u.Day:t.setDate(t.getDate()+1);break;default:t.setTime(t.getTime()+e)}return t}static readStorageItem(e){const t=localStorage.getItem(e);if(!t)return null;const a=JSON.parse(t);return Date.now()>a.expiration?(localStorage.removeItem(e),null):decodeURIComponent(a.value)}static readCookie(e){try{const t=encodeURIComponent(e)+"=",a=document.cookie.split(";");for(let e=0;e<a.length;e++){let n=a[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}return null}catch(e){return null}}static eraseCookie(e){try{document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}catch(e){}}static existsKey(e){return null!=this.getValue(e)}static createStorageItem(e,t,a){const n={value:encodeURIComponent(t),expiration:this.calculateExpirationDate(a).getTime()};localStorage.setItem(e,JSON.stringify(n))}static storeValue(e,t,a){this.useHtml5Storage()?this.createStorageItem(c+e,t,a):this.createCookie(c+e,t,a)}static getValue(e){return this.useHtml5Storage()?this.readStorageItem(c+e):this.readCookie(c+e)}static getValues(e){const t={};return e.forEach((e=>{t[e]=this.getValue(e)})),t}static removeValue(e){this.useHtml5Storage()?localStorage.removeItem(c+e):this.eraseCookie(c+e)}static removeValues(e){e.forEach((e=>{this.removeValue(e)}))}static storeGlobalValue(e,t,a,n){this.useHtml5Storage(n)?this.createStorageItem(g+e,t,a):this.createCookie(g+e,t,a)}static getGlobalValue(e,t){return this.useHtml5Storage(t)?this.readStorageItem(g+e):this.readCookie(g+e)}static getGlobalValues(e,t){const a={};return e.forEach((e=>{a[e]=this.getGlobalValue(e,t)})),a}static removeGlobalValue(e,t){this.useHtml5Storage(t)?localStorage.removeItem(g+e):this.eraseCookie(g+e)}static removeGlobalValues(e,t){e.forEach((e=>{this.removeGlobalValue(e,t)}))}static clean(){this.getStoredKeys().forEach((e=>{localStorage.removeItem(e)}))}static getStoredKeys(){let e=0,t=null;const a=[];for(;t=localStorage.key(e++);)t.startsWith(c)&&l.push(a,t);return a}}function p(e){if(null==e)return null;if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}const t=Array.isArray(e)?[]:{};for(const a in e)if(e.hasOwnProperty(a)){const n=e[a];t[a]="object"==typeof n?p(n):n}return t}d.useHtml5Storage=function(e){return"Cookies"!==e};const h={translateTexts:!0,editorMetadata:!1,overlayLanguage:"en_US",applicationLanguage:"en_US"},m=["translateTexts","editorMetadata","overlayLanguage","applicationLanguage","customProperties"];function y(e,t,a){const n=function(e){return{translateTexts:!0,editorMetadata:!1,overlayLanguage:e.defaultOverlayLanguage,applicationLanguage:e.defaultApplicationLanguage}}(e),s=w(function(){const e=d.getValue("overlayLanguage"),t=d.getValue("applicationLanguage"),a={};e&&(a.overlayLanguage=e);t&&(a.applicationLanguage=t);return a}(),w(t,w(function(e){const t={};e.overlayLanguage&&(t.overlayLanguage=e.overlayLanguage);e.applicationLanguage&&(t.applicationLanguage=e.applicationLanguage);return t}(e),w(n,p(h)))));return a?w(a,s):s}function w(e,t){for(const a in e){const n=e[a];-1!==m.indexOf(a)?t[a]=n:console.debug(`Invalid context property "${a}" with value "${n}". Skipped from merging.`)}return t}let v={languages:{defaultRuntimeOverlayLanguage:"en_US",defaultRuntimeApplicationLanguage:"en_US",browserOverlayLanguage:"en_US",browserApplicationLanguage:"en_US",overlayLanguages:["en_US"],applicationLanguages:["en_US"]}};function f(e){return y({defaultOverlayLanguage:v.languages.defaultRuntimeOverlayLanguage,defaultApplicationLanguage:v.languages.defaultRuntimeApplicationLanguage,overlayLanguage:v.languages.browserOverlayLanguage,applicationLanguage:v.languages.browserApplicationLanguage},"function"==typeof window.decorateContext?window.decorateContext():{},e)}class S extends Error{constructor(){super("Not implemented yet. Planned in future releases.")}}const L=new a("newired-api-request",window);function T(e){return new Promise(((t,n)=>{L.send(e,(e=>{switch(console.debug("[api]: Got API response: ",e),e.status){case a.STATUS_TIMEOUT:n("Request timed out.");break;case a.STATUS_ERROR:n(e.cause);break;case a.STATUS_SUCCESS:t(e.result)}}))}))}L.listen();class b extends class{}{constructor(e){super(),this.context=e}getTips(){throw new S}getTipByName(e){throw new S}getTipById(e){throw new S}show(e,t){throw new S}hide(e){throw new S}disableTip(e){throw new S}enableTip(e){throw new S}disableTips(){throw new S}enableTips(){throw new S}}class x extends class{getRunningJourney(){return T({operation:"journeys.getRunningJourney",parameters:{context:f()}})}}{constructor(e){super(),this.context=e}getContext(e){return new x(f(e))}getVisibleJourneys(){return T({operation:"journeys.getVisibleJourneys",parameters:{context:f(this.context)}})}getJourneys(){return T({operation:"journeys.getJourneys",parameters:{context:f(this.context)}})}getJourneysByName(e){return T({operation:"journeys.getJourneysByName",parameters:{context:f(this.context),name:e}})}getJourneyById(e){return T({operation:"journeys.getJourneyById",parameters:{context:f(this.context),id:e}})}start(e,t=0){return T({operation:"journeys.start",parameters:{context:f(this.context),id:e,stepIndex:t}})}stop(e){return T({operation:"journeys.stop",parameters:{context:f(this.context),id:e}})}}class E extends class{isOverlayEnabled(){return T({operation:"isOverlayEnabled"})}disableOverlay(){return T({operation:"disableOverlay"})}enableOverlay(){return T({operation:"enableOverlay"})}isLauncherPanelVisible(){return T({operation:"isLauncherPanelVisible"})}showLauncherPanel(){return T({operation:"showLauncherPanel"})}hideLauncherPanel(){return T({operation:"hideLauncherPanel"})}isLauncherVisible(){return T({operation:"isLauncherVisible"})}setLauncherVisibility(e){return function(e){if("boolean"!=typeof e)throw Error("Expected boolean value")}(e),T({operation:"setLauncherVisibility",parameters:{flag:e}}).then()}getOverlayLanguages(){return v.languages.overlayLanguages}getApplicationLanguages(){return v.languages.overlayLanguages}setUserOverlayLanguage(e){return t(e),T({operation:"setUserOverlayLanguage",parameters:{context:f(),language:e}})}setUserApplicationLanguage(e){return t(e),T({operation:"setUserApplicationLanguage",parameters:{context:f(),language:e}})}}{constructor(e){super(),this.context=e,this.journeys=new x(this.context),this.tips=new b(this.context)}getContext(e){return new E(f(e))}getOverlayLanguage(){return f(this.context).overlayLanguage}setOverlayLanguage(e){return new E(function(e,t){const a=f(t);-1!==v.languages.overlayLanguages.indexOf(e)?a.overlayLanguage=e:console.error(`Attempt to set invalid overlay language ${e}. Permitted languages are`,v.languages.overlayLanguages);return a}(e,this.context))}getApplicationLanguage(){return f(this.context).applicationLanguage}setApplicationLanguage(e){return new E(function(e,t){const a=f(t);-1!==v.languages.applicationLanguages.indexOf(e)?a.applicationLanguage=e:console.error(`Attempt to set invalid application language ${e}. Permitted languages are`,v.languages.applicationLanguages);return a}(e,this.context))}}window.newired=new E;new class{constructor(e,t,a){this.channel=e,this.messageWindow=t,this.responseCallback=a,this.handleMessage=e=>{if(this.isValidApiRequest(e.data)){const t=e.data.message;try{this.responseCallback(t.data,(e=>{this.sendResponse(t.requestId,e)}),(e=>{this.sendError(t.requestId,e)}))}catch(t){console.error(`Error while processing response (channel: ${this.channel}).`,e.data,t)}}}}listen(){this.messageWindow.addEventListener("message",this.handleMessage)}disconnect(){this.messageWindow.removeEventListener("message",this.handleMessage)}isValidApiRequest(e){try{return e&&e.channel&&e.channel===this.channel&&e.message&&e.message.data&&e.message.data.operation}catch(e){return!1}}sendResponse(e,t){this.messageWindow.postMessage({channel:this.channel,message:{requestId:e,data:{status:"success",result:t}}},"*")}sendError(e,t){this.messageWindow.postMessage({channel:this.channel,message:{requestId:e,data:{status:"error",cause:t}}},"*")}}("newired-to-facade-request",window,((e,t,a)=>{switch(e.operation){case"isFacadeReady":v=e.parameters.data,t(f());break;case"onOverlayReady":"function"==typeof window.onNewiredReady&&window.onNewiredReady(),t();break;case"getContext":t(f(e.parameters.context));break;case"setData":v=e.parameters,t(!0)}})).listen(),e.NWAPIContextual=E,Object.defineProperty(e,"__esModule",{value:!0})}({});