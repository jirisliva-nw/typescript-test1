!function(){"use strict";function e(e,t,n,i,r){const s=e.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=n,s.media="all",i&&(s.id=i),r&&(s.onload=()=>{r()},s.onerror=()=>{r(n)}),t.appendChild(s)}function t(e,t,n,i){const r=e.createElement("script");r.type="text/javascript",r.src=t,i&&(r.onload=()=>{i()},r.onerror=()=>{i(t)}),n&&(r.id=n),e.body.appendChild(r)}(function(){var e={custom:1,failed:2},t=e,n=window.Document.prototype.createElement,i=window.Document.prototype.createElementNS,r=window.Document.prototype.importNode,s=window.Document.prototype.prepend,o=window.Document.prototype.append,a=window.DocumentFragment.prototype.prepend,l=window.DocumentFragment.prototype.append,u=window.Node.prototype.cloneNode,c=window.Node.prototype.appendChild,h=window.Node.prototype.insertBefore,d=window.Node.prototype.removeChild,p=window.Node.prototype.replaceChild,g=Object.getOwnPropertyDescriptor(window.Node.prototype,"textContent"),m=window.Element.prototype.attachShadow,f=Object.getOwnPropertyDescriptor(window.Element.prototype,"innerHTML"),b=window.Element.prototype.getAttribute,w=window.Element.prototype.setAttribute,y=window.Element.prototype.removeAttribute,v=window.Element.prototype.getAttributeNS,E=window.Element.prototype.setAttributeNS,T=window.Element.prototype.removeAttributeNS,C=window.Element.prototype.insertAdjacentElement,S=window.Element.prototype.insertAdjacentHTML,I=window.Element.prototype.prepend,x=window.Element.prototype.append,L=window.Element.prototype.before,k=window.Element.prototype.after,D=window.Element.prototype.replaceWith,P=window.Element.prototype.remove,N=window.HTMLElement,A=Object.getOwnPropertyDescriptor(window.HTMLElement.prototype,"innerHTML"),O=window.HTMLElement.prototype.insertAdjacentElement,M=window.HTMLElement.prototype.insertAdjacentHTML,_=new Set;function R(e){var t=_.has(e),n=/^[a-z][.0-9_a-z]*-[-.0-9_a-z]*$/.test(e);return!t&&n}["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"].forEach((function(e){return _.add(e)}));var B=document.contains?document.contains.bind(document):document.documentElement.contains.bind(document.documentElement);function F(e){var t=e.isConnected;if(void 0!==t)return t;if(B(e))return!0;for(var n=e;n&&!(n.__CE_isImportDocument||n instanceof Document);)n=n.parentNode||(window.ShadowRoot&&n instanceof ShadowRoot?n.host:void 0);return!(!n||!(n.__CE_isImportDocument||n instanceof Document))}function U(e){var t=e.children;if(t)return Array.prototype.slice.call(t);for(var n=[],i=e.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&n.push(i);return n}function W(e,t){for(var n=t;n&&n!==e&&!n.nextSibling;)n=n.parentNode;return n&&n!==e?n.nextSibling:null}function J(e,t){return t.firstChild?t.firstChild:W(e,t)}function H(e,t,n){for(var i=e;i;){if(i.nodeType===Node.ELEMENT_NODE){var r=i;t(r);var s=r.localName;if("link"===s&&"import"===r.getAttribute("rel")){var o=r.import;if(void 0===n&&(n=new Set),o instanceof Node&&!n.has(o)){n.add(o);for(var a=o.firstChild;a;a=a.nextSibling)H(a,t,n)}i=W(e,r);continue}if("template"===s){i=W(e,r);continue}var l=r.__CE_shadowRoot;if(l)for(var u=l.firstChild;u;u=u.nextSibling)H(u,t,n)}i=J(e,i)}}var q="http://www.w3.org/1999/xhtml",j=function(e){this._patchesNode=[],this._patchesElement=[],this._hasPatches=!1,this.shadyDomFastWalk=e.shadyDomFastWalk,this.useDocumentConstructionObserver=!e.noDocumentConstructionObserver};j.prototype.forEachElement=function(e,t,n){var i=window.ShadyDom;if(this.shadyDomFastWalk&&i&&i.inUse){if(e.nodeType===Node.ELEMENT_NODE)t(e);if(e.querySelectorAll)for(var r=i.nativeMethods.querySelectorAll.call(e,"*"),s=0;s<r.length;s++)t(r[s])}else H(e,t,n)},j.prototype.addNodePatch=function(e){this._hasPatches=!0,this._patchesNode.push(e)},j.prototype.addElementPatch=function(e){this._hasPatches=!0,this._patchesElement.push(e)},j.prototype.patchTree=function(e){var t=this;this._hasPatches&&this.forEachElement(e,(function(e){return t.patchElement(e)}))},j.prototype.patchNode=function(e){if(this._hasPatches&&!e.__CE_patched){e.__CE_patched=!0;for(var t=0;t<this._patchesNode.length;t++)this._patchesNode[t](e)}},j.prototype.patchElement=function(e){if(this._hasPatches&&!e.__CE_patched){e.__CE_patched=!0;for(var t=0;t<this._patchesNode.length;t++)this._patchesNode[t](e);for(var n=0;n<this._patchesElement.length;n++)this._patchesElement[n](e)}},j.prototype.connectTree=function(t){var n=[];this.forEachElement(t,(function(e){return n.push(e)}));for(var i=0;i<n.length;i++){var r=n[i];r.__CE_state===e.custom?this.connectedCallback(r):this.upgradeReaction(r)}},j.prototype.disconnectTree=function(t){var n=[];this.forEachElement(t,(function(e){return n.push(e)}));for(var i=0;i<n.length;i++){var r=n[i];r.__CE_state===e.custom&&this.disconnectedCallback(r)}},j.prototype.patchAndUpgradeTree=function(e,t){var n=this,i=(t=void 0===t?{}:t).visitedImports,r=t.upgrade||function(e){return n.upgradeReaction(e)},s=[];this.forEachElement(e,(function(e){if(n._hasPatches&&n.patchElement(e),"link"===e.localName&&"import"===e.getAttribute("rel")){var t=e,o=t.import;o instanceof Node&&(o.__CE_isImportDocument=!0,o.__CE_registry=document.__CE_registry),o&&"complete"===o.readyState?o.__CE_documentLoadHandled=!0:e.addEventListener("load",(function(){var e=t.import;if(!e.__CE_documentLoadHandled){e.__CE_documentLoadHandled=!0;var s=new Set;i&&(i.forEach((function(e){return s.add(e)})),s.delete(e)),n.patchAndUpgradeTree(e,{visitedImports:s,upgrade:r})}}))}else s.push(e)}),i);for(var o=0;o<s.length;o++)r(s[o])},j.prototype.upgradeReaction=function(e){try{var t=this._lookupACustomElementDefinition(e.ownerDocument,e.localName);t&&this._upgradeAnElement(e,t)}catch(e){this.reportTheException(e)}},j.prototype._upgradeAnElement=function(t,n){if(void 0===t.__CE_state){n.constructionStack.push(t);try{try{if(new n.constructorFunction!==t)throw new Error("The custom element constructor did not produce the element being upgraded.")}finally{n.constructionStack.pop()}}catch(n){throw t.__CE_state=e.failed,n}if(t.__CE_state=e.custom,t.__CE_definition=n,n.attributeChangedCallback&&t.hasAttributes())for(var i=n.observedAttributes,r=0;r<i.length;r++){var s=i[r],o=t.getAttribute(s);null!==o&&this.attributeChangedCallback(t,s,null,o,null)}F(t)&&this.connectedCallback(t)}},j.prototype.connectedCallback=function(e){var t=e.__CE_definition;if(t.connectedCallback)try{t.connectedCallback.call(e)}catch(e){this.reportTheException(e)}},j.prototype.disconnectedCallback=function(e){var t=e.__CE_definition;if(t.disconnectedCallback)try{t.disconnectedCallback.call(e)}catch(e){this.reportTheException(e)}},j.prototype.attributeChangedCallback=function(e,t,n,i,r){var s=e.__CE_definition;if(s.attributeChangedCallback&&s.observedAttributes.indexOf(t)>-1)try{s.attributeChangedCallback.call(e,t,n,i,r)}catch(e){this.reportTheException(e)}},j.prototype._lookupACustomElementDefinition=function(e,t){var n=e.__CE_registry;if(n&&(e.defaultView||e.__CE_isImportDocument))return n.internal_localNameToDefinition(t)},j.prototype.createAnElement=function(t,r,s){var o=t.__CE_registry;if(o&&(null===s||s===q)){var a=o.internal_localNameToDefinition(r);if(a)try{var l=new a.constructorFunction;if(void 0===l.__CE_state||void 0===l.__CE_definition)throw new Error("Failed to construct '"+r+"': The returned value was not constructed with the HTMLElement constructor.");if(l.namespaceURI!==q)throw new Error("Failed to construct '"+r+"': The constructed element's namespace must be the HTML namespace.");if(l.hasAttributes())throw new Error("Failed to construct '"+r+"': The constructed element must not have any attributes.");if(null!==l.firstChild)throw new Error("Failed to construct '"+r+"': The constructed element must not have any children.");if(null!==l.parentNode)throw new Error("Failed to construct '"+r+"': The constructed element must not have a parent node.");if(l.ownerDocument!==t)throw new Error("Failed to construct '"+r+"': The constructed element's owner document is incorrect.");if(l.localName!==r)throw new Error("Failed to construct '"+r+"': The constructed element's local name is incorrect.");return l}catch(o){this.reportTheException(o);var u=null===s?n.call(t,r):i.call(t,s,r);return Object.setPrototypeOf(u,HTMLUnknownElement.prototype),u.__CE_state=e.failed,u.__CE_definition=void 0,this.patchElement(u),u}}var c=null===s?n.call(t,r):i.call(t,s,r);return this.patchElement(c),c},j.prototype.reportTheException=function(e){var t=e.message,n=e.sourceURL||e.fileName||"",i=e.line||e.lineNumber||0,r=e.column||e.columnNumber||0,s=void 0;void 0===ErrorEvent.prototype.initErrorEvent?s=new ErrorEvent("error",{cancelable:!0,message:t,filename:n,lineno:i,colno:r,error:e}):((s=document.createEvent("ErrorEvent")).initErrorEvent("error",!1,!0,t,n,i),s.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{configurable:!0,get:function(){return!0}})}),void 0===s.error&&Object.defineProperty(s,"error",{configurable:!0,enumerable:!0,get:function(){return e}}),window.dispatchEvent(s),s.defaultPrevented||console.error(e)};var z=function(){var e=this;this._value=void 0,this._promise=new Promise((function(t){e._resolve=t}))};z.prototype.resolve=function(e){if(this._value)throw new Error("Already resolved.");this._value=e,this._resolve(e)},z.prototype.toPromise=function(){return this._promise};var $=function(e,t){this._observer=void 0,this._internals=e,this._document=t,this._internals.patchAndUpgradeTree(this._document),"loading"===this._document.readyState&&(this._observer=new MutationObserver(this._handleMutations.bind(this)),this._observer.observe(this._document,{childList:!0,subtree:!0}))};$.prototype.disconnect=function(){this._observer&&this._observer.disconnect()},$.prototype._handleMutations=function(e){var t=this._document.readyState;"interactive"!==t&&"complete"!==t||this.disconnect();for(var n=0;n<e.length;n++)for(var i=e[n].addedNodes,r=0;r<i.length;r++){var s=i[r];this._internals.patchAndUpgradeTree(s)}};var V=function(e){this._localNameToConstructorGetter=new Map,this._localNameToDefinition=new Map,this._constructorToDefinition=new Map,this._elementDefinitionIsRunning=!1,this._whenDefinedDeferred=new Map,this._flushCallback=function(e){return e()},this._flushPending=!1,this._unflushedLocalNames=[],this._internals=e,this._documentConstructionObserver=e.useDocumentConstructionObserver?new $(e,document):void 0};V.prototype.polyfillDefineLazy=function(e,t){var n=this;if(!(t instanceof Function))throw new TypeError("Custom element constructor getters must be functions.");this.internal_assertCanDefineLocalName(e),this._localNameToConstructorGetter.set(e,t),this._unflushedLocalNames.push(e),this._flushPending||(this._flushPending=!0,this._flushCallback((function(){return n._flush()})))},V.prototype.define=function(e,t){var n=this;if(!(t instanceof Function))throw new TypeError("Custom element constructors must be functions.");this.internal_assertCanDefineLocalName(e),this.internal_reifyDefinition(e,t),this._unflushedLocalNames.push(e),this._flushPending||(this._flushPending=!0,this._flushCallback((function(){return n._flush()})))},V.prototype.internal_assertCanDefineLocalName=function(e){if(!R(e))throw new SyntaxError("The element name '"+e+"' is not valid.");if(this.internal_localNameToDefinition(e))throw new Error("A custom element with name '"+e+"' has already been defined.");if(this._elementDefinitionIsRunning)throw new Error("A custom element is already being defined.")},V.prototype.internal_reifyDefinition=function(e,t){var n,i,r,s,o;this._elementDefinitionIsRunning=!0;try{var a=t.prototype;if(!(a instanceof Object))throw new TypeError("The custom element constructor's prototype is not an object.");var l=function(e){var t=a[e];if(void 0!==t&&!(t instanceof Function))throw new Error("The '"+e+"' callback must be a function.");return t};n=l("connectedCallback"),i=l("disconnectedCallback"),r=l("adoptedCallback"),o=(s=l("attributeChangedCallback"))&&t.observedAttributes||[]}finally{this._elementDefinitionIsRunning=!1}var u={localName:e,constructorFunction:t,connectedCallback:n,disconnectedCallback:i,adoptedCallback:r,attributeChangedCallback:s,observedAttributes:o,constructionStack:[]};return this._localNameToDefinition.set(e,u),this._constructorToDefinition.set(u.constructorFunction,u),u},V.prototype.upgrade=function(e){this._internals.patchAndUpgradeTree(e)},V.prototype._flush=function(){var e=this;if(!1!==this._flushPending){this._flushPending=!1;for(var t=[],n=this._unflushedLocalNames,i=new Map,r=0;r<n.length;r++)i.set(n[r],[]);this._internals.patchAndUpgradeTree(document,{upgrade:function(n){if(void 0===n.__CE_state){var r=n.localName,s=i.get(r);s?s.push(n):e._localNameToDefinition.has(r)&&t.push(n)}}});for(var s=0;s<t.length;s++)this._internals.upgradeReaction(t[s]);for(var o=0;o<n.length;o++){for(var a=n[o],l=i.get(a),u=0;u<l.length;u++)this._internals.upgradeReaction(l[u]);var c=this._whenDefinedDeferred.get(a);c&&c.resolve(void 0)}n.length=0}},V.prototype.get=function(e){var t=this.internal_localNameToDefinition(e);if(t)return t.constructorFunction},V.prototype.whenDefined=function(e){if(!R(e))return Promise.reject(new SyntaxError("'"+e+"' is not a valid custom element name."));var t=this._whenDefinedDeferred.get(e);if(t)return t.toPromise();var n=new z;this._whenDefinedDeferred.set(e,n);var i=this._localNameToDefinition.has(e)||this._localNameToConstructorGetter.has(e),r=-1===this._unflushedLocalNames.indexOf(e);return i&&r&&n.resolve(void 0),n.toPromise()},V.prototype.polyfillWrapFlushCallback=function(e){this._documentConstructionObserver&&this._documentConstructionObserver.disconnect();var t=this._flushCallback;this._flushCallback=function(n){return e((function(){return t(n)}))}},V.prototype.internal_localNameToDefinition=function(e){var t=this._localNameToDefinition.get(e);if(t)return t;var n=this._localNameToConstructorGetter.get(e);if(n){this._localNameToConstructorGetter.delete(e);try{return this.internal_reifyDefinition(e,n())}catch(e){this._internals.reportTheException(e)}}},V.prototype.internal_constructorToDefinition=function(e){return this._constructorToDefinition.get(e)},window.CustomElementRegistry=V,V.prototype.define=V.prototype.define,V.prototype.upgrade=V.prototype.upgrade,V.prototype.get=V.prototype.get,V.prototype.whenDefined=V.prototype.whenDefined,V.prototype.polyfillDefineLazy=V.prototype.polyfillDefineLazy,V.prototype.polyfillWrapFlushCallback=V.prototype.polyfillWrapFlushCallback;var G=function(e,t,n){function i(t){return function(n){for(var i=[],r=0;r<arguments.length;++r)i[r-0]=arguments[r];for(var s=i,o=[],a=[],l=0;l<s.length;l++){var u=s[l];if(u instanceof Element&&F(u)&&a.push(u),u instanceof DocumentFragment)for(var c=u.firstChild;c;c=c.nextSibling)o.push(c);else o.push(u)}t.apply(this,s);for(var h=0;h<a.length;h++)e.disconnectTree(a[h]);if(F(this))for(var d=0;d<o.length;d++){var p=o[d];p instanceof Element&&e.connectTree(p)}}}void 0!==n.prepend&&(t.prepend=i(n.prepend)),void 0!==n.append&&(t.append=i(n.append))},X=function(e){function n(n,i){Object.defineProperty(n,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(n){var r=this,s=F(this),o=void 0;if(s&&(o=[],e.forEachElement(this,(function(e){e!==r&&o.push(e)}))),i.set.call(this,n),o)for(var a=0;a<o.length;a++){var l=o[a];l.__CE_state===t.custom&&e.disconnectedCallback(l)}return this.ownerDocument.__CE_registry?e.patchAndUpgradeTree(this):e.patchTree(this),n}})}function r(t,n){t.insertAdjacentElement=function(t,i){var r=F(i),s=n.call(this,t,i);return r&&e.disconnectTree(i),F(s)&&e.connectTree(i),s}}function s(t,n){function i(t,n){for(var i=[],r=t;r!==n;r=r.nextSibling)i.push(r);for(var s=0;s<i.length;s++)e.patchAndUpgradeTree(i[s])}t.insertAdjacentHTML=function(e,t){var r=e.toLowerCase();if("beforebegin"===r){var s=this.previousSibling;n.call(this,r,t),i(s||this.parentNode.firstChild,this)}else if("afterbegin"===r){var o=this.firstChild;n.call(this,r,t),i(this.firstChild,o)}else if("beforeend"===r){var a=this.lastChild;n.call(this,r,t),i(a||this.firstChild,null)}else{if("afterend"!==r)throw new SyntaxError("The value provided ("+String(r)+") is not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.");var l=this.nextSibling;n.call(this,r,t),i(this.nextSibling,l)}}}m&&(Element.prototype.attachShadow=function(t){var n=m.call(this,t);return e.patchNode(n),this.__CE_shadowRoot=n,n}),f&&f.get?n(Element.prototype,f):A&&A.get?n(HTMLElement.prototype,A):e.addElementPatch((function(e){n(e,{enumerable:!0,configurable:!0,get:function(){return u.call(this,!0).innerHTML},set:function(e){var t="template"===this.localName,n=t?this.content:this,r=i.call(document,this.namespaceURI,this.localName);for(r.innerHTML=e;n.childNodes.length>0;)d.call(n,n.childNodes[0]);for(var s=t?r.content:r;s.childNodes.length>0;)c.call(n,s.childNodes[0])}})})),Element.prototype.setAttribute=function(n,i){if(this.__CE_state!==t.custom)return w.call(this,n,i);var r=b.call(this,n);w.call(this,n,i),i=b.call(this,n),e.attributeChangedCallback(this,n,r,i,null)},Element.prototype.setAttributeNS=function(n,i,r){if(this.__CE_state!==t.custom)return E.call(this,n,i,r);var s=v.call(this,n,i);E.call(this,n,i,r),r=v.call(this,n,i),e.attributeChangedCallback(this,i,s,r,n)},Element.prototype.removeAttribute=function(n){if(this.__CE_state!==t.custom)return y.call(this,n);var i=b.call(this,n);y.call(this,n),null!==i&&e.attributeChangedCallback(this,n,i,null,null)},Element.prototype.removeAttributeNS=function(n,i){if(this.__CE_state!==t.custom)return T.call(this,n,i);var r=v.call(this,n,i);T.call(this,n,i);var s=v.call(this,n,i);r!==s&&e.attributeChangedCallback(this,i,r,s,n)},O?r(HTMLElement.prototype,O):C&&r(Element.prototype,C),M?s(HTMLElement.prototype,M):S&&s(Element.prototype,S),G(e,Element.prototype,{prepend:I,append:x}),function(e,t,n){function i(t){return function(n){for(var i=[],r=0;r<arguments.length;++r)i[r-0]=arguments[r];for(var s=i,o=[],a=[],l=0;l<s.length;l++){var u=s[l];if(u instanceof Element&&F(u)&&a.push(u),u instanceof DocumentFragment)for(var c=u.firstChild;c;c=c.nextSibling)o.push(c);else o.push(u)}t.apply(this,s);for(var h=0;h<a.length;h++)e.disconnectTree(a[h]);if(F(this))for(var d=0;d<o.length;d++){var p=o[d];p instanceof Element&&e.connectTree(p)}}}void 0!==n.before&&(t.before=i(n.before)),void 0!==n.after&&(t.after=i(n.after)),void 0!==n.replaceWith&&(t.replaceWith=function(t){for(var i=[],r=0;r<arguments.length;++r)i[r-0]=arguments[r];for(var s=i,o=[],a=[],l=0;l<s.length;l++){var u=s[l];if(u instanceof Element&&F(u)&&a.push(u),u instanceof DocumentFragment)for(var c=u.firstChild;c;c=c.nextSibling)o.push(c);else o.push(u)}var h=F(this);n.replaceWith.apply(this,s);for(var d=0;d<a.length;d++)e.disconnectTree(a[d]);if(h){e.disconnectTree(this);for(var p=0;p<o.length;p++){var g=o[p];g instanceof Element&&e.connectTree(g)}}}),void 0!==n.remove&&(t.remove=function(){var t=F(this);n.remove.call(this),t&&e.disconnectTree(this)})}(e,Element.prototype,{before:L,after:k,replaceWith:D,remove:P})},Y={},Q=window.customElements;function K(){var e=!!(null==Q?void 0:Q.noDocumentConstructionObserver),i=!!(null==Q?void 0:Q.shadyDomFastWalk),m=new j({noDocumentConstructionObserver:e,shadyDomFastWalk:i});!function(e){var i=function(){var i=this.constructor,r=document.__CE_registry.internal_constructorToDefinition(i);if(!r)throw new Error("Failed to construct a custom element: The constructor was not registered with `customElements`.");var s=r.constructionStack;if(0===s.length){var o=n.call(document,r.localName);return Object.setPrototypeOf(o,i.prototype),o.__CE_state=t.custom,o.__CE_definition=r,e.patchElement(o),o}var a=s.length-1,l=s[a];if(l===Y){var u=r.localName;throw new Error("Failed to construct '"+u+"': This element was already constructed.")}var c=l;return s[a]=Y,Object.setPrototypeOf(c,i.prototype),e.patchElement(c),c};i.prototype=N.prototype,Object.defineProperty(HTMLElement.prototype,"constructor",{writable:!0,configurable:!0,enumerable:!1,value:i}),window.HTMLElement=i}(m),function(e){Document.prototype.createElement=function(t){return e.createAnElement(this,t,null)},Document.prototype.importNode=function(t,n){var i=r.call(this,t,!!n);return this.__CE_registry?e.patchAndUpgradeTree(i):e.patchTree(i),i},Document.prototype.createElementNS=function(t,n){return e.createAnElement(this,n,t)},G(e,Document.prototype,{prepend:s,append:o})}(m),function(e){G(e,DocumentFragment.prototype,{prepend:a,append:l})}(m),function(e){function t(t,n){Object.defineProperty(t,"textContent",{enumerable:n.enumerable,configurable:!0,get:n.get,set:function(t){if(this.nodeType!==Node.TEXT_NODE){var i=void 0;if(this.firstChild){var r=this.childNodes,s=r.length;if(s>0&&F(this)){i=new Array(s);for(var o=0;o<s;o++)i[o]=r[o]}}if(n.set.call(this,t),i)for(var a=0;a<i.length;a++)e.disconnectTree(i[a])}else n.set.call(this,t)}})}Node.prototype.insertBefore=function(t,n){if(t instanceof DocumentFragment){var i=U(t),r=h.call(this,t,n);if(F(this))for(var s=0;s<i.length;s++)e.connectTree(i[s]);return r}var o=t instanceof Element&&F(t),a=h.call(this,t,n);return o&&e.disconnectTree(t),F(this)&&e.connectTree(t),a},Node.prototype.appendChild=function(t){if(t instanceof DocumentFragment){var n=U(t),i=c.call(this,t);if(F(this))for(var r=0;r<n.length;r++)e.connectTree(n[r]);return i}var s=t instanceof Element&&F(t),o=c.call(this,t);return s&&e.disconnectTree(t),F(this)&&e.connectTree(t),o},Node.prototype.cloneNode=function(t){var n=u.call(this,!!t);return this.ownerDocument.__CE_registry?e.patchAndUpgradeTree(n):e.patchTree(n),n},Node.prototype.removeChild=function(t){var n=t instanceof Element&&F(t),i=d.call(this,t);return n&&e.disconnectTree(t),i},Node.prototype.replaceChild=function(t,n){if(t instanceof DocumentFragment){var i=U(t),r=p.call(this,t,n);if(F(this)){e.disconnectTree(n);for(var s=0;s<i.length;s++)e.connectTree(i[s])}return r}var o=t instanceof Element&&F(t),a=p.call(this,t,n),l=F(this);return l&&e.disconnectTree(n),o&&e.disconnectTree(t),l&&e.connectTree(t),a},g&&g.get?t(Node.prototype,g):e.addNodePatch((function(e){t(e,{enumerable:!0,configurable:!0,get:function(){for(var e=[],t=this.firstChild;t;t=t.nextSibling)t.nodeType!==Node.COMMENT_NODE&&e.push(t.textContent);return e.join("")},set:function(e){for(;this.firstChild;)d.call(this,this.firstChild);null!=e&&""!==e&&c.call(this,document.createTextNode(e))}})}))}(m),X(m);var f=new V(m);document.__CE_registry=f,Object.defineProperty(window,"customElements",{configurable:!0,enumerable:!0,value:f})}Q&&!Q.forcePolyfill&&"function"==typeof Q.define&&"function"==typeof Q.get||K(),window.__CE_installPolyfill=K}).call(self);class n{}n.MAX_ZINDEX=2147483647,n.LAUNCHER_THEME_STYLE_ID="newired-launcher-theme-style",n.PIXEL_OFFSCREEN="-9999px";const i=function(e,t){if(window.Elm&&window.Elm.Launcher)return console.log("Launcher script (Elm) already loaded the page. Skip loading."),window.Elm;try{return new Function(`return (function(targetWindow) {\n\n        var requestAnimationFrame = targetWindow.requestAnimationFrame;\n        var cancelAnimationFrame = targetWindow.cancelAnimationFrame;\n        \n        ${e}\n        \n        return this.Elm;\n    })(this)`).call(t)}catch(e){return console.warn("Failed to load Launcher script (Elm).",e),null}};let r,s=[],o=!1;function a(e){r=e}function l(e,t){if(!o)throw Error("Texts are not initialized!");const n=u(e,r);if(null!==n)return n;console.log("Missing translation - lang: "+r+", key: "+e);const i=u(e,t);if(i)return i;console.log("Missing default translation - lang: "+t+", key: "+e);const s=u(e,"en_US");return s||(console.error("Missing english translation - key: "+e),e)}function u(e,t){const n=s.filter((e=>e.language===t));return n.length?n[0].translations[e]:null}const c="newired-cross-domain-storage-iframe",h="newired-iframe",d="newired-portal",p=function(e){try{return e.name===c||e.name===h||e.name===d}catch(e){return!0}}(window)?window:function(){const e=h;let t=document.getElementById(e);if(t||(t=document.createElement("iframe"),t.setAttribute("id",e),t.style.display="none",t.style.visibility="hidden",document.body.appendChild(t)),!t.contentWindow)throw new Error(`Browsing context of "${e}" window is discarded.`);return t.contentWindow}();function g(e){if(e&&"object"==typeof e){e.toJSON&&(e.toJSON=function(){return e});for(const t in e)e[t]=g(e[t])}return e}Function.prototype.safeBind=p.Function.prototype.bind,Function.prototype.safeApply=p.Function.prototype.apply,String.prototype.safeTrim=p.String.prototype.trim;var m,f,b={Set:p.Set.bind(window),setTimeout:p.setTimeout.bind(window),setInterval:p.setInterval.bind(window),clearTimeout:p.clearTimeout.bind(window),clearInterval:p.clearInterval.bind(window),scrollTo:(e,t,n)=>p.scrollTo.call(e,t,n),JSON:{stringify:function(e,t,n){return p.Prototype&&(e=g(e)),JSON.stringify(e,t,n)},stringifyPretty:function(e){return p.Prototype&&(e=g(e)),JSON.stringify(e,null,"  ")}},array:{push:function(e,t){p.Array.prototype.push.call(e,t)},pushApply:function(e,t){p.Array.prototype.push.apply(e,t)},unique:function(e){return p.Array.from(new Set(e))}}};!function(e){e.Success="success",e.SystemError="systemError",e.ApplicationError="applicationError"}(m||(m={}));class w{constructor(){this.REQUEST_TIMEOUT=3e4,this.idSequence=0,this.requests={},this.requestTimeoutWatcher=null,this.setRequestTimeoutWatcher()}static send(e,t){null===w.instance&&(w.instance=new w),w.instance.sendMessage(e,t)}static receive(e){null===w.instance&&(w.instance=new w),w.instance.handleMessage(e)}handleMessage(e){try{const t=JSON.parse(e),n=this.requests[t.requestId];if(n)switch(delete this.requests[t.requestId],t.status){case m.Success:n.callback({kind:"success",data:t.data});break;case m.SystemError:n.callback({kind:"systemError",cause:t.data});break;case m.ApplicationError:n.callback({kind:"applicationError",cause:t.data})}}catch(t){console.error(`Unable to handle Editor response "${e}".`,t)}}sendMessage(e,t){const n=this.nextRequestId();this.requests[n]={id:n,callback:t,timestamp:(new Date).getTime(),data:e};const i={requestId:n,data:e};window.sendIPCMessage("ipc-request",b.JSON.stringify(i))}setRequestTimeoutWatcher(){this.requestTimeoutWatcher=b.setInterval((()=>{this.removeTooOldRequests()}),1e3)}removeTooOldRequests(){const e=(e,t)=>void 0!==e&&e.timestamp&&t-e.timestamp>this.REQUEST_TIMEOUT,t=(new Date).getTime();for(const n in this.requests)if(this.requests.hasOwnProperty(n)){const i=this.requests[n];e(i,t)&&(delete this.requests[n],i.callback({kind:"systemError",cause:`Editor request ${n} timed out. (request: ${i.data})`}))}}nextRequestId(){return this.idSequence===Number.MAX_VALUE&&(this.idSequence=0),this.idSequence++}}w.instance=null,function(e){e.LoadScripts="load_scripts",e.LoadStoredState="load_stored_state",e.JourneyPlayerStart="player_init",e.EvaluateAutoplayRules="evaluate_autoplay_rules",e.EvaluateJourneyVisibilityRules="evaluate_journey_visiblity_rules",e.ShowNextStep="show_next_step",e.FindNextVisibleStep="find_next_visible_step",e.LoadLauncher="load_launcher",e.EvaluateTips="evaluate_tips",e.LoadData="load_data",e.ParseTipLanguages="parse_tip_languages",e.EvaluateTipsIncrement="evaluate_tips_increment"}(f||(f={}));let y=!1;function v(e){y=e}function E(e){if(y)try{window.performance.mark(e+"_start")}catch(e){console.warn(e)}}function T(e){if(y)try{window.performance.mark(e+"_end"),window.performance.measure(e,e+"_start",e+"_end")}catch(e){console.warn(e)}}let C=0;function S(e,t){if(y)try{if(C>0)return;window.performance.clearMeasures(e),window.performance.clearMarks(e+"_start"),window.performance.clearMarks(e+"_step_start"),window.performance.clearMarks(e+"_step_end"),window.performance.clearMarks(e+"_end"),C=t,window.performance.mark(e+"_start"),window.performance.mark(e+"_step_start")}catch(e){console.warn(e)}}function I(e){if(y)try{window.performance.mark(e+"_step_end"),window.performance.measure(`${e}_step_${C}`,e+"_step_start",e+"_step_end"),0==--C?(window.performance.mark(e+"_end"),window.performance.measure(e,e+"_start",e+"_end")):window.performance.mark(e+"_step_start")}catch(e){console.warn(e)}}function x(e){const t=window.performance.getEntriesByName(e);return t.length?t[0].duration:0}var L;!function(e){e.Never="Never",e.Year="Year",e.Day="Day"}(L||(L={}));const k="NW_",D="NW_global_";class P{static createCookie(e,t,n){const i=this.createCookieExpirationEntry(n);document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}${i}; path=/`}static createCookieExpirationEntry(e){const t=this.calculateExpirationDate(e);return t?`; expires=${t.toUTCString()}`:""}static calculateExpirationDate(e){const t=new Date;if(!e)return t.setMinutes(t.getMinutes()+20),t;switch(e){case L.Never:t.setFullYear(t.getFullYear()+10);break;case L.Year:t.setFullYear(t.getFullYear()+1);break;case L.Day:t.setDate(t.getDate()+1);break;default:t.setTime(t.getTime()+e)}return t}static readStorageItem(e){const t=localStorage.getItem(e);if(!t)return null;const n=JSON.parse(t);return Date.now()>n.expiration?(localStorage.removeItem(e),null):decodeURIComponent(n.value)}static readCookie(e){try{const t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}return null}catch(e){return null}}static eraseCookie(e){try{document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}catch(e){}}static existsKey(e){return null!=this.getValue(e)}static createStorageItem(e,t,n){const i={value:encodeURIComponent(t),expiration:this.calculateExpirationDate(n).getTime()};localStorage.setItem(e,JSON.stringify(i))}static storeValue(e,t,n){this.useHtml5Storage()?this.createStorageItem(k+e,t,n):this.createCookie(k+e,t,n)}static getValue(e){return this.useHtml5Storage()?this.readStorageItem(k+e):this.readCookie(k+e)}static getValues(e){const t={};return e.forEach((e=>{t[e]=this.getValue(e)})),t}static removeValue(e){this.useHtml5Storage()?localStorage.removeItem(k+e):this.eraseCookie(k+e)}static removeValues(e){e.forEach((e=>{this.removeValue(e)}))}static storeGlobalValue(e,t,n,i){this.useHtml5Storage(i)?this.createStorageItem(D+e,t,n):this.createCookie(D+e,t,n)}static getGlobalValue(e,t){return this.useHtml5Storage(t)?this.readStorageItem(D+e):this.readCookie(D+e)}static getGlobalValues(e,t){const n={};return e.forEach((e=>{n[e]=this.getGlobalValue(e,t)})),n}static removeGlobalValue(e,t){this.useHtml5Storage(t)?localStorage.removeItem(D+e):this.eraseCookie(D+e)}static removeGlobalValues(e,t){e.forEach((e=>{this.removeGlobalValue(e,t)}))}static clean(){this.getStoredKeys().forEach((e=>{localStorage.removeItem(e)}))}static getStoredKeys(){let e=0,t=null;const n=[];for(;t=localStorage.key(e++);)t.startsWith(k)&&b.array.push(n,t);return n}}P.useHtml5Storage=function(e){return"Cookies"!==e};const N=c;class A{constructor(e){this.globalStorageUrl=e,this.logContext="[GlobalStorage]["+location.host+"] ",this.storageReadyWarningTimeout=2e3,this.storageReadyErrorTimeout=3e3,this.requestTimeout=2e3,this.requestId=0,this.iframe=null,this.iframeReady=!1,this.queue=[],this.requests={},this.disabled=!1,this.timestampsWatcher=null,this.isDisabled=()=>this.disabled}init(){if(this.onGlobalStorageOrigin())console.debug(`${this.logContext}Runs on cross-domain storage URL. IFrame initialization skipped.`);else if(M(window))console.debug(`${this.logContext}Runs inside storage IFrame. IFrame initialization skipped.`);else if(null!==this.globalStorageUrl){console.debug(`${this.logContext}Initialized cross-domain storage IFrame with URL: ${this.globalStorageUrl}`);try{if(!this.iframe){if(!window.localStorage)return void console.error(`${this.logContext} Unsupported browser. Can not setup cross-domain storage.`);this.iframe=document.createElement("iframe"),this.iframe.id=N,this.iframe.name=N,this.iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;",document.body.appendChild(this.iframe),window.addEventListener("message",(e=>{this.handleMessage(e)}),!1)}this.iframe.src=this.globalStorageUrl}catch(e){console.debug("Creation cross-domain storage iframe failed.",e)}this.setTimestampWatcher(),b.setTimeout((()=>{this.iframeReady||console.warn(`${this.logContext}Newired global storage on "${this.globalStorageUrl}" still not ready.`)}),this.storageReadyWarningTimeout),b.setTimeout((()=>{this.iframeReady||(console.error(`${this.logContext}Newired global storage on "${this.globalStorageUrl}" still not ready. Cross-domain journeys will not work.`),this.dispose())}),this.storageReadyErrorTimeout)}else console.debug(`${this.logContext}No cross-domain storage URL. IFrame initialization skipped.`)}dispose(){this.shutdownQueue(),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null)}requestValue(e,t,n){if(null===this.globalStorageUrl||this.isDisabled())t&&t("Can not requestValue on disabled storage",e,null);else if(this.onGlobalStorageOrigin())t(null,e,P.getGlobalValue(e,n));else{const i={request:{operation:"get-value",key:e,storageType:n,id:this.nextRequestId()},callback:t,timestamp:(new Date).getTime()};this.enqueueRequest(i)}}requestValues(e,t,n){if(null===this.globalStorageUrl)t&&t("Can not requestValue on disabled storage",e);else if(this.onGlobalStorageOrigin())t(null,e,P.getGlobalValues(e));else{const i={request:{operation:"get-values",keys:e,storageType:n,id:this.nextRequestId()},callback:t,timestamp:(new Date).getTime()};this.enqueueRequest(i)}}storeValue(e,t,n,i){if(null!==this.globalStorageUrl)if(this.onGlobalStorageOrigin())P.storeGlobalValue(e,t,n,i);else{const r={request:{operation:"store-value",key:e,value:t,id:this.nextRequestId(),expiration:n,storageType:i}};this.enqueueRequest(r)}}removeValues(e,t){if(null!==this.globalStorageUrl)if(this.onGlobalStorageOrigin())P.removeGlobalValues(e,t);else{const n={request:{operation:"remove-values",keys:e,storageType:t,id:this.nextRequestId()}};this.enqueueRequest(n)}}clean(){if(null!==this.globalStorageUrl)if(this.onGlobalStorageOrigin())P.clean();else{const e={request:{operation:"clean-storage",id:this.nextRequestId()}};this.enqueueRequest(e)}}enqueueRequest(e){this.isDisabled()||(this.iframeReady?this.sendRequest(e):b.array.push(this.queue,e),this.iframe||this.init())}sendRequest(e){e.callback&&(this.requests[e.request.id]=e),null!==this.iframe&&null!==this.iframe.contentWindow?this.iframe.contentWindow.postMessage(b.JSON.stringify(e.request),this.globalStorageUrl):console.debug(`${this.logContext}Global storage iframe unloaded. Request ignored.`)}iframeLoaded(){for(this.iframeReady=!0;this.queue.length>0;){const e=this.queue.shift();this.sendRequest(e)}}shutdownQueue(){this.disabled=!0;if(this.queue.length>0)for(let t=0,n=this.queue.length;t<n;t++){const n=this.queue[t];(e=n).hasOwnProperty("callback")&&e.callback&&e.callback("Global storage disabled.")}var e;this.queue=[],this.requests={},this.disposeTimestampWatcher()}nextRequestId(){return this.requestId===Number.MAX_VALUE&&(this.requestId=0),this.requestId++}disposeTimestampWatcher(){this.timestampsWatcher&&clearInterval(this.timestampsWatcher)}setTimestampWatcher(){const e=(e,t)=>void 0!==e&&e.timestamp&&t-e.timestamp>this.requestTimeout,t=e=>{e.callback&&e.callback(`Request timed out (${this.requestTimeout} ms), Global storage page: ${this.globalStorageUrl}`)},n=()=>{const n=(new Date).getTime();for(const i in this.requests)if(this.requests.hasOwnProperty(i)){const r=this.requests[i];e(r,n)&&(delete this.requests[i],t(r))}},i=()=>{const n=(new Date).getTime(),i=[];for(;this.queue.length>0;){const r=this.queue.shift();e(r,n)?t(r):b.array.push(i,r)}this.queue=i};this.timestampsWatcher=window.setInterval((()=>{n(),i()}),1e3)}onGlobalStorageOrigin(){const e=document.createElement("a");return e.href=this.globalStorageUrl,e.origin===window.origin}handleMessage(e){if(O(e.origin)===O(this.globalStorageUrl))try{const t=JSON.parse(e.data),n=this.requests[t.id];delete this.requests[t.id],"response-get-value"===t.operation?n&&n.callback&&n.callback(null,t.key,t.value):"response-get-values"===t.operation?n&&n.callback&&n.callback(null,t.keys,t.values):"storage-ready"===t.operation&&(console.debug(`${this.logContext}Global storage ready (requests in queue: ${this.queue.length})`),this.iframeLoaded())}catch(e){}}}function O(e){const t=document.createElement("a");return t.href=e,t.hostname}function M(e){try{return e.self!==e.top&&e.name===N}catch(e){return!0}}const _="[Storage]["+location.host+"] ";let R=null;const B=`${_} Is not initialized yet.`;let F=!1,U=!1;const W=function(e){return P.existsKey(e)},J=function(e,t,n){P.storeValue(e,t,n)},H=function(e){return P.getValue(e)},q=function(e){P.removeValues(e)};const j=function(e){console.error(B),e&&e(B)},z=function(e,t,n,i){V()?j():R.storeValue(e,t,n,i)},$=function(e,t){V()?j():R.removeValues(e,t)},V=()=>null==R||R.isDisabled(),G=function(){const e=P.getValue("feedback");return null!=e?JSON.parse(e):{journeys:[]}},X=function(e){const t=JSON.parse(P.getValue("persistence")||"{}");return t&&t.hasOwnProperty(e)?t[e]:null},Y=function(e){const t=JSON.parse(P.getValue("persistence")||"{}");t[e]=(t[e]||0)+1,P.storeValue("persistence",b.JSON.stringify(t))};class Q{static deregisterListeners(){window.removeEventListener("message",Q.handleRequest,!1)}}function K(){const e=window.targetDocument.documentElement.lang;return re(navigator.languages?[...navigator.languages,e]:[e],ne())}function Z(){const e=H("applicationLanguage");if(e)return e;return re([window.targetDocument.documentElement.lang],ie())}let ee,te;function ne(){const e=window.newired._internal.data;var t,n;return ee=ee||(t=e.getJourneys(),n=e.getTips(),b.array.unique([...ae(t),...le(n)])),ee}function ie(){const e=window.newired._internal.data;var t,n;return te=te||(t=e.getJourneys(),n=e.getTips(),b.array.unique([...se(t),...oe(n)])),te}function re(e,t){for(let n=0;n<e.length;n++){const i=e[n].replace("-","_");for(let e=0;e<t.length;e++){const n=t[e];if(n.substr(0,i.length)===i)return n}}return null}function se(e){try{let t=[];return e.guides.forEach((e=>{e.steps.forEach((e=>{if(e.elementTexts){const n=ue(e.elementTexts);t=t.concat(n)}}))})),t.filter(ce)}catch(e){return console.error("Unable to parse Journeys application languages",e),[]}}function oe(e){try{let t=[];return e.tips.forEach((e=>{if(e.elementTexts){const n=ue(e.elementTexts);t=t.concat(n)}})),t.filter(ce)}catch(e){return console.error("Unable to parse Tips application languages",e),[]}}function ae(e){try{let t=[];return e.guides.forEach((e=>{const n=ue(e.name);t=t.concat(n)})),t.filter(ce)}catch(e){return console.error("Unable to parse Journeys Overlay languages",e),[]}}function le(e){E(f.ParseTipLanguages);try{let t=[];e.tips.forEach((e=>{const n=ue(e.name);t=t.concat(n)}));const n=t.filter(ce);return T(f.ParseTipLanguages),n}catch(e){return console.error("Unable to parse Tips Overlay languages",e),T(f.ParseTipLanguages),[]}}function ue(e){return e.map((e=>e.language))}function ce(e,t,n){return n.indexOf(e)===t}var he,de,pe,ge,me,fe,be,we;Q.handleRequest=e=>{e.origin;try{const t=JSON.parse(e.data);if("get-value"===t.operation){const n=P.getGlobalValue(t.key,t.storageType);e.source.postMessage(b.JSON.stringify({operation:"response-get-value",id:t.id,key:t.key,value:n}),e.origin)}else if("get-values"===t.operation){const n=P.getGlobalValues(t.keys,t.storageType);e.source.postMessage(b.JSON.stringify({operation:"response-get-values",id:t.id,keys:t.keys,values:n,toJSON(){return this}}),e.origin)}else"remove-values"===t.operation?P.removeGlobalValues(t.keys,t.storageType):"store-value"===t.operation?P.storeGlobalValue(t.key,t.value,t.expiration,t.storageType):"clean-storage"===t.operation&&P.clean()}catch(e){console.error(e)}},Q.registerListeners=function(){window.addEventListener("message",Q.handleRequest,!1),window.parent.postMessage(b.JSON.stringify({operation:"storage-ready"}),"*"),console.debug(`${_}Cross-Domain Storage Stub ready.`)},function(e){e.None="AnimationNone",e.FadeIn="AnimationFadeIn",e.BounceTo="AnimationBounceTo"}(he||(he={})),function(e){e.Never="Never",e.Optional="Optional",e.Mandatory="Mandatory"}(de||(de={})),function(e){e.FeedbackDropOff="FeedbackDropOff",e.FeedbackFinish="FeedbackFinish"}(pe||(pe={})),function(e){e.StopJourney="StopJourney",e.PlayJourney="PlayJourney",e.JumpToStep="JumpToStep"}(ge||(ge={}));class ye{constructor(e,t,n,i){this.rules=e,this.message=t,this.journeyId=n,this.stepId=i,this.messageShown=!1}}class ve{constructor(e,t,n,i){this.rules=e,this.message=t,this.endWithFeedback=n,this.endStepNotReached=i,this.messageShown=!1}}class Ee{constructor(e,t,n){this.rules=e,this.message=t,this.stepId=n,this.messageShown=!1}}!function(e){e.AutoplayLaunch="autoplay",e.LinkLaunch="link",e.UserLaunch="userAction",e.JourneyLinkLaunch="journeyLink",e.APILaunch="apiLaunch"}(me||(me={}));class Te{constructor(e=!1){this.ctrlKey=e}}class Ce{}class Se{}!function(e){e.Start="Start",e.Success="Success",e.Error="Error",e.DropOff="DropOff"}(fe||(fe={})),function(e){e.Start="Start",e.Success="Success",e.Error="Error",e.DropOff="DropOff"}(be||(be={})),function(e){e.Next="NEXT",e.Click="ON_CLICK",e.ValueChange="ON_VALUE_CHANGE",e.Editing="ON_EDITING",e.Hover="ON_HOVER",e.Multiple="MULTIPLE",e.Timing="TIMING",e.PageRefresh="ON_PAGE_REFRESH"}(we||(we={}));const Ie=we.Next;var xe,Le,ke,De,Pe,Ne,Ae,Oe;function Me(e,t=null){const n={method:"GET",headers:{}};return t&&(n.headers["nw-auth"]=t),fetch(e,n).then((t=>{if(!t.ok)throw new Error(`Unable to fetch ${e}.`);return t.text()}))}function _e(e,t=null){const n={method:"GET",headers:{}};return t&&(n.headers["nw-auth"]=t),fetch(e,n).then((t=>{if(!t.ok)throw new Error(`Unable to fetch ${e}.`);return t.json()}))}function Re(e){const t=window.targetWindow.getComputedStyle(window.nwApp).getPropertyValue(e).safeTrim();return t.endsWith("px")?Number(t.substring(0,t.indexOf("px"))):Number(t)}function Be(e){if(void 0===e&&(e=window),e.hasOwnProperty("nwApp"))return e;if(e.hasOwnProperty("newiredRootWindow"))return e.newiredRootWindow;if(e.parent!=e)return Be(e.parent);throw new Error("Unable to get Newired root window.")}function Fe(){return Be(window).newired._internal.data}function Ue(e,t,n){const i=function(e){return e?`${Fe().deliveryResource("")}themes/${e}/fonts/`:`${Fe().deliveryResource("")}fonts/`}(n);return`<style id="${t}">${e=e?e.replace(/..\/fonts\//gi,i):""}</style>`}!function(e){e.WINDOW="Window",e.DOMAIN="Domain",e.GLOBAL="Global"}(xe||(xe={})),function(e){e.Bubble="Bubble",e.Modal="Modal",e.Panel="Panel"}(Le||(Le={})),function(e){e.AnimationNone="AnimationType",e.AnimationBounceTo="AnimationBounceTo",e.AnimationFadeIn="AnimationFadeIn"}(ke||(ke={})),function(e){e.Next="NEXT",e.Click="CLICK",e.Timing="TIMING",e.Multiple="MULTIPLE",e.Editing="EDITING",e.Hover="HOVER",e.ValueChange="VALUE_CHANGE",e.PageRefresh="PAGE_REFRESH"}(De||(De={})),function(e){e.Top="TOP",e.Right="RIGHT",e.Bottom="BOTTOM",e.Left="LEFT",e.TopLeft="TOP_LEFT",e.TopRight="TOP_RIGHT",e.BottomLeft="BOTTOM_LEFT",e.BottomRight="BOTTOM_RIGHT"}(Pe||(Pe={})),function(e){e.Draft="DRAFT",e.Ready="READY"}(Ne||(Ne={})),function(e){e.Snippet="snippet",e.Editor="editor"}(Ae||(Ae={})),function(e){e.NONE="NONE",e.CAJA="CAJA"}(Oe||(Oe={}));let We=Oe.NONE;var Je={escape:function(e){return e.replace(/[&<>"']/g,(function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}}))},unescape:function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`").replace(/&#32;/g," ").replace(/&#33;/g,"!").replace(/&#64;/g,"@").replace(/&#36;/g,"$").replace(/&#37;/g,"%").replace(/&#40;/g,"(").replace(/&#41;/g,")").replace(/&#61;/g,"=").replace(/&#43;/g,"+").replace(/&#123;/g,"{").replace(/&#125;/g,"}").replace(/&#91;/g,"[").replace(/&#93;/g,"]")},sanitize:function(e){return function(e){switch(We){case Oe.NONE:return e;case Oe.CAJA:return window.html_sanitize(e);default:throw new Error("Not implemented")}}(e)},innerText:function(e){const t=document.createElement("div");return t.insertAdjacentHTML("afterbegin",e),t.innerText}};const He=function(e){if(window.isRunningInEditor)return;console.debug("[Report]["+e.kind+":"+e.operation+"]",e);const t=new CustomEvent("nw-journey",{detail:e});window.targetWindow.dispatchEvent(t)},qe=function(e){switch(e){case fe.Start:return"start";case fe.Success:return"finish";case fe.Error:return"fail";case fe.DropOff:return"skip"}},je=function(e){switch(e){case be.Start:return"start";case be.Success:return"finish";case be.Error:return"fail";case be.DropOff:return"skip"}},ze=function(e){He({siteId:e.siteId,journeyId:e.journeyId,journeyIdent:e.reportInstanceId,title:Je.unescape(e.journeyName),journeyLaunchKind:e.launchKind,operation:qe(e.eventType),kind:"journey"})},$e=function(e,t){He({siteId:e,operation:t,kind:"launcher"})},Ve=function(e){He(e)};class Ge{constructor(e,t,n,i,r,s,o){this.siteId=e,this.journeyId=t,this.journeyInstanceId=n,this.reportInstanceId=i,this.eventType=r,this.journeyName=s,this.launchKind=o}}class Xe{constructor(e,t,n,i,r,s){this.siteId=e,this.journeyId=t,this.journeyInstanceId=n,this.reportInstanceId=i,this.eventType=r,this.step=s}}function Ye(e){try{const t=e.textContent?e.textContent.trim():"";return t.length>500?null:t}catch(e){return null}}function Qe(e){return Ye(e)&&function(e){try{const t=function(e){const t=e.childNodes;let n="";for(let e=0;e<t.length;e++){const i=t[e];i.nodeType===Node.TEXT_NODE&&i.textContent&&""!==i.textContent.trim()&&(n+=i.textContent)}return n=n.trim(),""===n?null:n}(e);return t===e.textContent.safeTrim()}catch(e){return!1}}(e)||!1}function Ke(e){const t=e.getAttribute("type");return"submit"===t||"reset"===t||"button"===t}var Ze,et;function tt(e){return null===e?"":e+"px"}function nt(e){return e?e.endsWith("px")?Number(e.substring(0,e.lastIndexOf("px"))):Number(e):null}function it(e,t){return function(e,t){return t.ownerDocument.defaultView||e}(e,t).getComputedStyle(t)}!function(e){e.content="content",e.title="title",e.placeholder="placeholder"}(Ze||(Ze={})),function(e){e.Hard="Hard",e.Soft="Soft"}(et||(et={}));class rt{static hasSameText(e,t,n){const i=e.document.querySelectorAll(t),r=[];for(let e=0;e<i.length;e++){const t=i[e];n===Ye(t)&&r.push(t)}return r}static findElementsWithText(e,t){return rt.hasSameText(e,"*:not([id^=newired]):not([class^=NW-])",t)}static decomposeClassAttributeValue(e,t){const n=e.trim().split(/\s+/g),i=[];for(const e of n)e.length&&i.push(t?t(e):e);return i}static normalizeAttributeValue(e){return escape(e.replace(/: +/g,":"))}}class st{constructor(e,t){this.matcherId=e,this.elements=t}}class ot{constructor(e,t){this.matcherId=e,this.error=t}}class at{constructor(e,t,n){this.matcherId=e,this.element=t,this.weight=n}}class lt{constructor(){}static find(e,t){return e.document.querySelectorAll(t)}static toArray(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t}static getElementCount(e){return e instanceof st?e.elements.length:0}validate(e){return null}}class ut extends lt{constructor(e){super(),this.identikit=e,this.description=null}getId(){return ut.matcherId}evaluate(e,t){if(t.elementDescription)try{this.description=JSON.parse(t.elementDescription);const n=t.matcherOptions.attributesSelector&&t.matcherOptions.attributesClassSelector?et.Hard:et.Soft,i=ut.toArray(ut.find(e,this.description.tagname)),r=ut.filterAttributesByCategory(this.description.attributes,et.Hard,n!==et.Hard);return r.length>0?new st(ut.matcherId,ut.evaluateHardAttributes(i,r)):new st(ut.matcherId,i)}catch(e){return console.warn("Unable to parse element description.",t.elementDescription),new ot(ut.matcherId,e.toString())}return new st(ut.matcherId,[])}evaluateSoft(e){if(this.identikit.elementDescription){this.description=JSON.parse(this.identikit.elementDescription);const t=this.identikit.matcherOptions.attributesSelector&&this.identikit.matcherOptions.attributesClassSelector?et.Hard:et.Soft;return ut.evaluateElementsBySoftAttributes(this.description,e,t!=et.Soft)}return[]}static evaluateElementsBySoftAttributes(e,t,n=!1){const i=ut.filterAttributesByCategory(e.attributes,et.Soft,n);return ut.evaluateSoftAttributes(t,i)}static toSoftMatchedElements(e){const t=[];for(let n=0;n<e.length;n++)t.push(new at(ut.matcherId,e[n],1));return t}static attributesMatch(e,t){if(0===t.length)return!1;for(let n=0;n<t.length;n++){if(!ut.attributeMatch(e,t[n]))return!1}return!0}static attributeMatch(e,t){const n=e.attributes,i=t.name,r=t.value;if(n.hasOwnProperty(i)){const e=n.getNamedItem(i);if(e){if("style"===i)return this.matchStyle(e.value,r);if("class"===i)return this.matchClass(e.value,r);if(-1!==rt.normalizeAttributeValue(e.value).lastIndexOf(r))return!0}}return!1}static matchClass(e,t){const n=rt.decomposeClassAttributeValue(e),i=rt.decomposeClassAttributeValue(t);for(const e of n)if(-1!==i.indexOf(e))return!0;return!1}static matchStyle(e,t){const[n,i]=this.parseStyle(e),[r,s]=this.parseStyle(unescape(t));if(n!==r)return!1;for(const e in s){if(!i.hasOwnProperty(e))return!1;{const t=i[e];if(s[e]!==t)return!1}}return!0}static parseStyle(e){const t={},n=e.split(";"),i=n.length;for(let e=0;e<i;e++){const i=n[e].split(":");1===i.length?t[i[0].trim()]="":2===i.length&&(t[i[0].trim()]=i[1].trim())}return[i,t]}static collectHardMatchingElements(e,t){if(0==t.length)return e;const n=[];for(let i=0;i<e.length;i++){const r=e[i];ut.attributesMatch(r,t)&&n.push(r)}return n}static filterAttributesByCategory(e,t,n){const i=[];if(e)for(let r=0;r<e.length;r++){const s=e[r];"class"===s.name&&n||t===s.category&&i.push(s)}return i}isCriterionEnabled(e){if(!e.matcherOptions.attributesSelector)return!1;try{return JSON.parse(e.elementDescription),!0}catch(e){}return!1}}ut.matcherId="attributesSelector",ut.evaluateHardAttributes=function(e,t){return ut.collectHardMatchingElements(e,t)},ut.evaluateSoftAttributes=function(e,t){if(0===t.length)return ut.toSoftMatchedElements(e);const n=[],i=t.filter((e=>"class"===e.name)),r=t.filter((e=>"class"!==e.name));for(let t=0;t<e.length;t++){const s=e[t];let o=0;i.every((e=>ut.attributeMatch(s,e)))&&o++,r.forEach((e=>{ut.attributeMatch(s,e)&&o++})),o>0&&n.push(new at(ut.matcherId,s,o))}return n};class ct extends lt{getId(){return ct.matcherId}evaluate(e,t){return ct.evaluateId(e,t.id)}evaluateSoft(e){return ct.elementsToSoft(ct.matcherId,e,0)}static evaluateId(e,t){const n="[id='"+t+"']";try{const t=ct.find(e,n);return new st(ct.matcherId,ct.toArray(t))}catch(e){return console.warn("Id evaluation failed.",e),new ot(ct.matcherId,e.toString())}}static elementsToSoft(e,t,n){const i=[];for(let r=0;r<t.length;r++)i.push(new at(e,t[r],n));return i}isCriterionEnabled(e){return!!(e.matcherOptions.elementId&&e.id&&e.id.length>0&&"null"!==e.id)}}ct.matcherId="elementId";class ht{static processHardMatch(e,t,n){if(!ht.isHardCriterionEnabled(n,t))return[[],[]];const i=[],r=[];for(let s=0;s<n.length;s++){const o=n[s];if(ht.isCriterionEnabled(n,t,o.getId())){const a=n[s].evaluate(e,t);a instanceof st?0===a.elements.length?r.push(new ot(o.getId(),"Element not found")):i.push(a):r.push(a)}}return[i,r]}static processSoftMatch(e,t){let n=[];const i=[];for(let r=0;r<e.length;r++){const s=e[r].evaluateSoft(t);s instanceof ot?i.push(s):n=n.concat(s)}return[n,i]}static isCriterionEnabled(e,t,n){if(!t.matcherOptions[n])return!1;for(let i=0;i<e.length;i++){const r=e[i];if(r.getId()===n)return r.isCriterionEnabled(t)}return!1}static isHardCriterionEnabled(e,t){for(let n=0;n<e.length;n++){if(e[n].isCriterionEnabled(t))return!0}return!1}static evaluateIntersection(e){const t=e.length;if(0==t)return[];let n=e[0].elements;if(1===t)return n;for(let i=1;i<t;i++)n=ht.intersectionFoundElements(n,e[i].elements);return n}static intersectionFoundElements(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i];this.containsElement(r,t)&&n.push(r)}return n}static containsElement(e,t){for(let n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}static softWithMaxWeight(e){const t=[],n=[];let i=0;for(let r=0;r<e.length;r++){const s=e[r],o=s.element,a=s.weight,l=t.indexOf(o);if(-1===l)t.push(o),n.push(a),i<a&&(i=a);else{const e=a+n[l];n.splice(l,1,e),i<e&&(i=e)}}const r=[];for(let e=0;e<n.length;e++)n[e]===i&&r.push(t[e]);return r}}class dt extends lt{constructor(e,t){super(),this.win=e,this.identikit=t}getId(){return dt.matcherId}validate(e){const t=this.evaluate(this.win,e);return t instanceof ot?t:null}evaluate(e,t){try{return new st(dt.matcherId,dt.evaluateCssSelector(e,this.identikit.cssSelector))}catch(e){return new ot(dt.matcherId,e.toString())}}evaluateSoft(e){const t=dt.evaluateSoftCssSelector(this.win,this.identikit.cssSelector);if(t instanceof st){const n=e.length>0?ht.evaluateIntersection([new st(this.getId(),e),t]):t.elements;return ct.elementsToSoft(dt.matcherId,n,1)}return t}static evaluateSoftCssSelector(e,t){try{let n=[];const i=t?t.split(">"):[];let r="";for(let t=i.length-1;t>=0;t--){r=i[t];const s=this.evaluateCssSelector(e,r);if(1===s.length)return new st(dt.matcherId,s);if(0===s.length)return new st(dt.matcherId,n);n=s,r=i[t]+">"+r}return new st(dt.matcherId,n)}catch(e){return console.warn("CSS evaluation failed.",e),new ot(dt.matcherId,e.toString())}}static evaluateCssSelector(e,t){const n=this.find(e,t);return dt.toArray(n)}isCriterionEnabled(e){return!(!e.matcherOptions.cssSelector||!e.cssSelector)}}dt.matcherId="cssSelector";class pt extends lt{constructor(){super(...arguments),this.textElement=null,this.foundTexts=new st(pt.matcherId,[])}getId(){return pt.matcherId}evaluate(e,t){return this.textElement=t.textElement,this.textElement&&(this.foundTexts=pt.evaluateText(e,this.textElement)),this.foundTexts}evaluateSoft(e){if(this.textElement&&this.foundTexts instanceof st)try{const e=pt.evaluateIndexedText(this.foundTexts.elements,this.textElement);if(null!==e)return[new at(pt.matcherId,e,1)]}catch(e){return new ot(pt.matcherId,e.toString())}return[]}static evaluateText(e,t){try{const n=JSON.parse(t),i=n.hasOwnProperty("index");return new st(pt.matcherId,pt.searchText(e,n.text,i))}catch(e){return console.warn("Text evaluation failed.",e,t),new ot(pt.matcherId,e.toString())}}static evaluateIndexedText(e,t){try{const n=JSON.parse(t),i=n.hasOwnProperty("index")?n.index:n.textIndex,r=pt.filterElementsByText(e,n.text);return r.length>i?r[i]:null}catch(e){return console.warn("Indexed text evaluation failed.",e),null}}static searchText(e,t,n){return pt.searchElementsByText(e,"*:not([id^=newired]):not([class^=NW-])",t,n)}static searchElementsByText(e,t,n,i){const r=e.document.querySelectorAll(t);return i?pt.filterElementsByText(lt.toArray(r),n):rt.findElementsWithText(e,n)}static filterElementsByText(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],s=Ye(r);s&&t===s&&n.push(r)}return n}isCriterionEnabled(e){return!!(e.matcherOptions.textSelector&&e.textElement&&e.textElement.length>0)}}pt.matcherId="textSelector";class gt extends lt{constructor(e,t){super(),this.win=e,this.identikit=t}getId(){return gt.matcherId}evaluate(e,t){return gt.evaluateXpath(e,this.identikit.xpath)}evaluateSoft(e){const t=gt.evaluateXpath(this.win,this.identikit.xpath);if(t instanceof st){const n=e.length>0?ht.evaluateIntersection([new st(this.getId(),e),t]):t.elements;return ct.elementsToSoft(gt.matcherId,n,1)}return t}static evaluateXpath(e,t){try{const n=this.normalizeXpath(t),i=gt.find(e,n);return new st(gt.matcherId,gt.toArray(i))}catch(e){return new ot(gt.matcherId,e.toString())}}static normalizeXpath(e){return e.substr(1).replace(/\//g," > ").replace(/\[(\d+)\]/g,(function(e,t){return":nth-of-type("+t+")"}))}isCriterionEnabled(e){return!(!e.matcherOptions.xpathSelector||!e.xpath)}}gt.matcherId="xpathSelector";const mt={elementId:!1,cssSelector:!1,xpathSelector:!1,attributesSelector:!1,textSelector:!1,attributesClassSelector:!1};function ft(e,t,n){const i=n||t.getBoundingClientRect();return 0===i.top&&0===i.right&&0===i.bottom&&0===i.left&&0===i.width&&0===i.height||!function(e,t){const n=t;if(void 0!==n.style){const i=""===n.style.display&&""===n.style.visibility&&""===n.style.zIndex?it(e,t):n.style;return"none"!==i.display&&"hidden"!==i.visibility&&"-1"!==i.zIndex}return!0}(e,t)}function bt(e,t){return[new ct,new ut(t),new pt,new gt(e,t),new dt(e,t)]}function wt(e,t){const n=[],i=t.path;let r=e;if(void 0!==i&&i)for(let e=0;e<i.length;e++){const t=i[e];t.matcherOptions=t.matcherOptions||mt;const s=yt(r,t);if(!s||!s.contentWindow)break;r=s.contentWindow,n.push(s)}const s=yt(r,t);return null===s||ft(r,s)?null:{path:n,element:s}}function yt(e,t){const n=bt(e,t);if(ht.isHardCriterionEnabled(n,t)){const[i,r]=ht.processHardMatch(e,t,n);if(r.length>0)return null;const s=ht.evaluateIntersection(i);if(0===s.length)return null;if(1===s.length)return s[0];{const[t,i]=ht.processSoftMatch(n,s),r=vt(e,t);return r||Et(e,s)}}{const[t,i]=ht.processSoftMatch(n,[]);return vt(e,t)}}function vt(e,t){const n=ht.softWithMaxWeight(t);return n.length>0?Et(e,n):null}function Et(e,t){for(let n=0;n<t.length;n++){const i=t[n];if(!ft(e,i))return i}return null}class Tt{constructor(e,t){this.matcherId=e,this.elements=t}}class Ct{constructor(e,t,n){this.score=e,this.matched=t,this.errors=n}}class St{constructor(e){this.configuration=e,this.intervalSize=1/e.scoreSize,this.zeroScore=this.normalizeScore(0),this.oneDotScore=this.normalizeScore(.2),this.twoDotScore=this.normalizeScore(.4),this.fullScore=this.normalizeScore(1)}static default(){return new St({scoreSize:St.maxScore})}calculate(e,t,n){return St.scoreInternalResultToResult(this.calcFcn(e,t,n))}calcFcn(e,t,n){const i=this.getValidationErrors(e,n);if(null===t||!t.ownerDocument.defaultView)return new Ct(0,[],i);const r=t.ownerDocument.defaultView,s=bt(r,n);if(ht.isHardCriterionEnabled(s,n)){const[e,t]=ht.processHardMatch(r,n,s),o=ht.evaluateIntersection(e),[a,l]=ht.processSoftMatch(s,o),u=[],c=i.concat(l).concat(t);return 1===o.length?new Ct(this.fullScore,e,c):o.length>1?new Ct(this.calculateSoftMatcherScore(a),u,c):new Ct(this.zeroScore,u,c)}{const[e,t]=ht.processSoftMatch(s,[]),n=i.concat(t);return new Ct(this.calculateSoftMatcherScore(e),St.toMatchResult(e),n)}}calculateSoftMatcherScore(e){const t=ht.softWithMaxWeight(e);return 1===t.length?this.twoDotScore:t.length>1?this.oneDotScore:this.zeroScore}normalizeScore(e){return Math.abs(Math.round(e/this.intervalSize-.5))}static calculateScore(e,t,n){return St.default().calculate(e,t,n)}static toMatchResult(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];b.array.push(t,new st(i.matcherId,[i.element]))}return t}static mergeElements(e,t){const n=new Set;function i(e){for(let t=0;t<e.length;t++)n.add(e[t])}return i(e),i(t),Array.from(n)}static scoreInternalResultToResult(e){const t=e.matched,n=[];for(let e=0;e<t.length;e++){const i=t[e],r=i.elements,s=[];for(let e=0;e<r.length;e++)b.array.push(s,this.createDescription(r[e]));b.array.push(n,new Tt(i.matcherId,s))}return{score:e.score,matched:n,errors:e.errors}}static createDescription(e){const t=e.tagName.toLowerCase(),n=e.attributes,i=[];for(let e=0;e<n.length;e++){const t=n.item(e);null!==t&&b.array.push(i,{name:t.name,value:t.value})}const r={tagname:t,attributes:i};return b.JSON.stringify(b.JSON.stringify(r))}getValidationErrors(e,t){const n=bt(e,t),i=[];for(let e=0;e<n.length;e++){const r=n[e].validate(t);null!==r&&b.array.push(i,r)}return i}}var It,xt,Lt,kt,Dt,Pt;function Nt(e,t){return!!Mt(e,t)}function At(e,t){if(null==t)throw new Ot(e);const n=Mt(e,t);if(n)return n.value;throw new Ot(e)}St.maxScore=5,function(e){e.content="content",e.title="title",e.placeholder="placeholder"}(It||(It={})),function(e){e.MissingTranslation="MissingTranslation"}(xt||(xt={}));class Ot extends Error{constructor(e){super("Missing translation for language: "+e),Error.captureStackTrace&&Error.captureStackTrace(this,Ot),this.name=xt.MissingTranslation}}function Mt(e,t){return t.filter((t=>t.language===e))[0]}class _t{constructor(e){this.win=e,this.element=null,this.scrollHandler=()=>{this.boxes.bottom.style.width="0px",this.boxes.top.style.width="0px",this.boxes.right.style.width="0px",this.boxes.left.style.width="0px",this.show()},this.resizeHandler=()=>{this.resetDimension(),this.show()},this.registerEvents=()=>{this.win.addEventListener("scroll",this.scrollHandler),this.win.addEventListener("resize",this.resizeHandler)},this.deregisterEvents=()=>{this.win.removeEventListener("scroll",this.scrollHandler),this.win.removeEventListener("resize",this.resizeHandler)},this.resetDimension(),this.initContainer()}setTarget(e){this.element=e}resize(){this.boxes.bottom.style.width="0px",this.boxes.top.style.width="0px",this.boxes.right.style.width="0px",this.boxes.left.style.width="0px",this.resetDimension(),this.show()}initContainer(){this.container=this.win.document.createElement("nw-spotlight"),this.container.id=_t.ID,window.nwApp.appendChild(this.container)}resetDimension(){const e=this.win.document;this.viewportHeight=Math.max(e.documentElement.clientHeight,this.win.innerHeight||0),this.viewportWidth=Math.max(e.documentElement.clientWidth,this.win.innerWidth||0)}remove(){const e=this.container.parentNode;e&&e.removeChild(this.container),this.deregisterEvents()}initBoxes(){if(this.boxes)return;const e=()=>{const e=this.win.document.createElement("iframe");return e.classList.add(_t.Class),e.classList.add(_t.BubbleClass),e.style.position="fixed",e.onload=()=>{e.contentDocument&&(e.contentDocument.body.style.margin="0px")},this.container.appendChild(e),e};this.boxes={top:e(),bottom:e(),left:e(),right:e()},this.registerEvents()}show(){const e=this.element;if(!e)return this.container.classList.add(_t.Class),void this.container.classList.add(_t.ModalClass);this.container.classList.remove(_t.Class),this.container.classList.remove(_t.ModalClass),this.initBoxes();const t=_t.Padding,n=2*t,i=e.getBoundingClientRect(),r=this.boxes,s=e=>Math.max(0,e);i.top<=0?(r.top.style.top=_t.zeroPx,r.top.style.left=_t.zeroPx,r.top.style.height=_t.zeroPx,r.top.style.width=_t.zeroPx):(r.top.style.top=_t.zeroPx,r.top.style.left=_t.zeroPx,r.top.style.height=_t.toStringDim(i.top-t),r.top.style.width=_t.toStringDim(this.viewportWidth-_t.scrollbarIssueReduction)),i.bottom>this.viewportHeight?(r.bottom.style.top=_t.zeroPx,r.bottom.style.left=_t.zeroPx,r.bottom.style.height=_t.zeroPx,r.bottom.style.width=_t.zeroPx):i.bottom<=0?(r.bottom.style.top=_t.zeroPx,r.bottom.style.left=_t.zeroPx,r.bottom.style.height=_t.toStringDim(s(this.viewportHeight)),r.bottom.style.width=_t.toStringDim(s(this.viewportWidth-_t.scrollbarIssueReduction))):(r.bottom.style.top=_t.toStringDim(i.top+i.height+t),r.bottom.style.left=_t.zeroPx,r.bottom.style.height=_t.toStringDim(s(this.viewportHeight-(i.top+i.height)-t)),r.bottom.style.width=_t.toStringDim(s(this.viewportWidth-_t.scrollbarIssueReduction)));const o=i.top<=0&&i.bottom<=0||i.top>this.viewportHeight&&i.bottom>this.viewportHeight,a=(i.top>0?i.top:0)-t,l=s((i.top>0?i.height:i.top+i.height)+n);o||i.left<=0?(r.left.style.top=_t.zeroPx,r.left.style.left=_t.zeroPx,r.left.style.height=_t.zeroPx,r.left.style.width=_t.zeroPx):i.left>this.viewportWidth?(r.left.style.top=_t.toStringDim(a),r.left.style.left=_t.zeroPx,r.left.style.height=_t.toStringDim(l),r.left.style.width=_t.toStringDim(s(this.viewportWidth-t-_t.scrollbarIssueReduction))):(r.left.style.top=_t.toStringDim(a),r.left.style.left=_t.zeroPx,r.left.style.height=_t.toStringDim(l),r.left.style.width=_t.toStringDim(s(i.left-t-_t.scrollbarIssueReduction))),o||i.right>=this.viewportWidth?(r.right.style.top=_t.zeroPx,r.right.style.left=_t.zeroPx,r.right.style.height=_t.zeroPx,r.right.style.width=_t.zeroPx):i.right<0?(r.right.style.top=_t.toStringDim(a),r.right.style.left=_t.zeroPx,r.right.style.height=_t.toStringDim(l),r.right.style.width=_t.toStringDim(s(this.viewportWidth-1))):(r.right.style.top=_t.toStringDim(a),r.right.style.left=_t.toStringDim(i.right+t),r.right.style.height=_t.toStringDim(l),r.right.style.width=_t.toStringDim(s(this.viewportWidth-i.right-t-_t.scrollbarIssueReduction)))}}function Rt(e){return e&&e.nodeType===Node.ELEMENT_NODE}function Bt(e){return function(e){return Ft(e,"newired")}(e)||function(e){return Ut(e,"newired")}(e)||Wt(e)||function(e){return"NW-WRAPPER"===e.nodeName}(e)||function(e){return e.nodeType===Node.ELEMENT_NODE&&e.nodeName.toLowerCase().startsWith("nw-")}(e)}function Ft(e,t){if(Rt(e)){const n=e.getAttribute("id");if(n&&n.substr(0,t.length)===t)return!0}return!1}function Ut(e,t){return!!e.parentElement&&Ft(e.parentElement,t)}function Wt(e){return Ft(e,_t.ID)||Ut(e,_t.ID)}function Jt(e){if(null==e)return null;if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}const t=Array.isArray(e)?[]:{};for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];t[n]="object"==typeof i?Jt(i):i}return t}function Ht(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];qt(t,i)&&t.push(i)}return t}function qt(e,t){return-1===e.indexOf(t)}_t.Padding=5,_t.ID="newired-journey-spotlightID",_t.Class="newired-journey-spotlight",_t.BubbleClass="newired-journey-spotlight-bubble",_t.ModalClass="newired-journey-spotlight-modal",_t.toStringDim=e=>e.toString()+"px",_t.scrollbarIssueReduction=1,_t.zeroPx=_t.toStringDim(0);class jt{constructor(e,t){this.targetWindow=e,this.subscriber=t,this.subscribers=[],this.subscribers.push(t),this.observer=this.createObserver()}subscribe(e){this.subscribers.push(e)}createObserver(){const e=new MutationObserver(this.mutationHandler(this));return e.observe(this.targetWindow.document,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeFilter:["style","class"],attributeOldValue:!0}),e}mutationHandler(e){return function(t){0!=e.interestingNodes(t).length&&e.subscribers.forEach((e=>{e.domChanged()}))}}interestingNodes(e){let t=[];for(let n=0;n<e.length;n++){const i=e[n];"childList"==i.type&&(t=t.concat(this.filterNodes(i.addedNodes)));const r=i.target;"attributes"!=i.type||1!==r.nodeType||Bt(i.target)||ft(this.targetWindow,r)||b.array.push(t,i.target)}return Ht(t)}filterNodes(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n],r=i;if(!r.isContentEditable){const e=r.muteDomChange;void 0!==e&&!1!==e||Bt(i)||b.array.push(t,i)}}return t}}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
function zt(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}!function(e){e.DialogEditing="DialogEditing",e.InlineEditing="InlineEditing",e.NoEditing="NoEditing"}(Lt||(Lt={})),function(e){e.TopCenter="TOP",e.BottomCenter="BOTTOM",e.LeftMiddle="LEFT",e.CenterMiddle="CENTER_MIDDLE",e.RightMiddle="RIGHT",e.TopRight="TOP_RIGHT",e.TopLeft="TOP_LEFT",e.BottomRight="BOTTOM_RIGHT",e.BottomLeft="BOTTOM_LEFT"}(kt||(kt={})),function(e){e.Never="NEVER",e.OnlyOnce="ONLY_ONCE",e.Everytime="EVERYTIME"}(Dt||(Dt={})),function(e){e.TipBubble="TipBubble",e.TipIcon="TipIcon",e.TipIconInserted="TipIconInserted"}(Pt||(Pt={}));class $t{static getActualZIndex(e,t){let n=0,i=it(e,t),r=t.parentNode;for(;r&&r.nodeType;){if(r.nodeType===Node.ELEMENT_NODE){const t=it(e,r);if(this.isStackingContext(t,i)&&i.zIndex){const e=parseInt(i.zIndex);isNaN(e)||(n=e)}i=t}r=r.parentNode}return n+1}static isStackingContext(e,t){if(("absolute"===t.position||"relative"===t.position)&&"auto"!==t.zIndex)return!0;if("fixed"===t.position||"sticky"===t.position)return!0;if(("flex"===e.display||"grid"===e.display)&&"auto"!==t.zIndex)return!0;if(t.opacity){const e=parseInt(t.opacity);if(!isNaN(e)&&e<1)return!0}return"none"!==t.transform||"none"!==t.filter||"none"!==t.perspective||"none"!==t.clipPath||"none"!==t.mask||"none"!==t.maskImage||("flex"===e.display||"grid"===e.display)&&"auto"!==t.zIndex}}function Vt(e){const t=e.document.body,n=e.document.documentElement;return Math.max(t.scrollWidth,n.scrollWidth,t.offsetWidth,n.offsetWidth,t.clientWidth,n.clientWidth)}function Gt(e){const t=e.document.body,n=e.document.documentElement;return Math.max(t.scrollHeight,n.scrollHeight,t.offsetHeight,n.offsetHeight,t.clientHeight,n.clientHeight)}function Xt(e){const t=e.document.body,n=e.document.documentElement;return e.pageYOffset||n.scrollTop||t.scrollTop}function Yt(e){const t=e.document.body,n=e.document.documentElement;return e.pageXOffset||n.scrollLeft||t.scrollLeft}function Qt(e){return"relative"==e.body.style.position}function Kt(e,t){const n=e.document,i=n.body,r=n.documentElement;let s,o,a=0,l=0;Qt(n)?(s=i.getBoundingClientRect().top,o=i.getBoundingClientRect().left):(a=Xt(n.defaultView||e),l=Yt(n.defaultView||e),s=r.clientTop||i.clientTop,o=r.clientLeft||i.clientLeft);const u=t.top+a-s,c=t.left+l-o,h=t.right+l-o,d=t.bottom+a-s;return{type:"DocumentRect",top:Math.round(u),left:Math.round(c),right:Math.round(h),bottom:Math.round(d),width:Math.round(h)-Math.round(c),height:Math.round(d)-Math.round(u)}}function Zt(e,t){for(;null!=t&&void 0!==t.parentElement&&t.parentElement&&t.parentElement.tagName;){const n=t.parentElement;if(n&&Rt(n)&&nn(e,n))return n;const i=tn(t);if(null!==i)return i;t=n}return e}function en(e,t){for(;null!==t&&t.parentElement;){const n=t.parentElement;if(Rt(n)&&nn(e,n))return n;const i=tn(t);if(null!==i)return i;t=n}return null}function tn(e){return function(e){return e&&"BODY"===e.tagName}(e)?function(e){const t=function(e){const t=e.ownerDocument;return t?t.defaultView:null}(e);return t?t.frameElement:null}(e):null}function nn(e,t){const n=t.tagName.toUpperCase();if("BODY"===n||"HTML"===n)return!1;const i=it(e,t),r=i.overflowX,s=i.overflowY;return("scroll"===s||"auto"===s)&&t.clientHeight<t.scrollHeight||("scroll"===r||"auto"===r)&&t.clientWidth<t.scrollWidth}function rn(e){return function(e){return e!=e.top}(e)?{width:e.innerWidth||0,height:e.innerHeight||0}:{width:e.document.documentElement.clientWidth||e.innerWidth||0,height:e.document.documentElement.clientHeight||e.innerHeight||0}}function sn(e){return{width:Vt(e),height:Gt(e)}}const on={top:16,left:16,right:16,bottom:16};function an(e,t){e.style.width=tt(t.width),e.style.height=tt(t.height),e.style.top=tt(t.top),e.style.left=tt(t.left),e.style.bottom=tt(t.bottom),e.style.right=tt(t.right)}function ln(e,t,n,i){const r=t.path?t.path.length:null;if(r){const e=t.path[r-1].contentWindow;if(e)return e.document.elementFromPoint(n,i)}return function(e,t,n){let i=e.document.elementFromPoint(t,n);if(i&&Wt(i)){const r=i,s=r.style.width,o=r.style.height;r.style.width="0",r.style.height="0",i=e.document.elementFromPoint(t,n),r.style.width=s,r.style.height=o}return i}(e,n,i)}function un(e,t,n,i){try{const r=ln(e,t,n,i);if(null===r)return!1;if(Bt(r))return!0;return t.element.contains(r)}catch(e){return!1}}function cn(e,t,n,i){return un(e,t,n.left-i,n.top-i)||un(e,t,n.right+i,n.top-i)||un(e,t,n.right+i,n.bottom+i)||un(e,t,n.left-i,n.bottom+i)||un(e,t,n.left+n.width/2,n.top+n.height/2)}function hn(e,t){const n=function(e){return{width:Math.max(e.document.documentElement.clientWidth,e.innerWidth||0),height:Math.max(e.document.documentElement.clientHeight,e.innerHeight||0)}}(e);return!(t.right<0||t.bottom<0||t.left>n.width||t.top>n.height)}function dn(e,t,n){let i=function(e){return{top:e.top,left:e.left,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}(n);return"[object HTMLIFrameElement]"===t.toString()&&(i=function(e,t){const n=t.getBoundingClientRect();return e.top+=n.top,e.left+=n.left,e}(i,t)),hn(e,i)?function(e){const t=e.toString();return e instanceof window.constructor||"[object global]"===t||"[object Window]"===t}(t)?{isVisible:!0,scrollElement:t}:null:{isVisible:!1,scrollElement:t}}function pn(e,t,n){try{const i=Zt(e,t.element),r=n||t.element.getBoundingClientRect(),s=dn(e,i,r),o=-1;return s?{isVisible:s.isVisible&&cn(e,t,r,o),scrollElement:i}:{isVisible:cn(e,t,r,o),scrollElement:i}}catch(e){return{isVisible:!1,scrollElement:void 0}}}const gn="[ElementMonitor] ";class mn{constructor(){this.listeners=[],this.paused=!1,this.recalculate=e=>{throw"Not supported. Implemented by lower prototype object in hierarchy."}}addAndRegisterEventListener(e,t,n,i){n.addEventListener(e,t,i),b.array.push(this.listeners,{element:n,listener:t,event:e,options:i})}removeListeners(){for(let e=0;e<this.listeners.length;e++){const t=this.listeners[e];try{t.element.removeEventListener(t.event,t.listener,t.options)}catch(e){}}this.listeners=[]}static isValueEqual(e,t,n){return Math.abs(e-t)<=n}static isPositionEqual(e,t){if(!e)return!!t;if(!t)return!0;return mn.isValueEqual(e.left,t.left,1)&&mn.isValueEqual(e.top,t.top,1)&&mn.isValueEqual(e.width,t.width,1)&&mn.isValueEqual(e.height,t.height,1)}dispose(){this.removeListeners()}pause(){this.paused=!0}continue(){this.paused=!1}}let fn=null;function bn(){const e=window.crypto||window.msCrypto||{getRandomValues:function(e){for(let t=0;t<e.length;t++)e[t]=Math.floor(256*Math.random());return e}};return(1e7.toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function wn(e,t){if(!t)return!0;return yn(En(t).host)===yn(e.host)}function yn(e){const t=e.indexOf(":");return t>0&&(e=e.substr(0,t)),e}const vn=function(e){const t=En(e);return(t.host+t.pathname).toLowerCase()},En=function(e){if(fn=fn||document.getElementById("newired-link-placeholder"),(t=fn)&&"A"===t.tagName)return fn.href=e,fn;{const t=document.createElement("a");return t.href=e,t}var t};function Tn(e,t){const n=En(e);return`${t.protocol}//${t.host}${n.pathname}${n.search}${n.hash}`}class Cn{constructor(e){this.method=e,this._uuid=bn()}get uuid(){return this._uuid}}class Sn{constructor(e){this.win=e,this.interval=300,this.contexts=[],this.invokeAll=()=>{this.win.document&&this.win.document.body&&this.contexts.forEach((e=>{e.method()}))},this.addMethod=e=>{const t=new Cn(e);return b.array.push(this.contexts,t),t.uuid},this.removeMethod=e=>{const t=this.getIndexOfContext(e);-1!==t?this.contexts.splice(t,1):console.error("Missing subscribed method context. Nothing was removed.",e)},this.getIndexOfContext=e=>{for(let t=0;t<this.contexts.length;t++)if(this.contexts[t].uuid===e)return t;return-1},b.setInterval(this.invokeAll,this.interval)}static getInstance(e){return Sn.instance||(Sn.instance=new Sn(e)),Sn.instance}}class In extends mn{constructor(e,t,n,i,r,s,o,a=!0,l=["scroll","resize"]){super(),this.targetWindow=e,this.elementIdentity=t,this.bubbleIndex=n,this.elementContext=i,this.onVisibilityChange=r,this.onPositionChange=s,this.onElementLost=o,this.requiredEvents=l,this._elementIsVisible=!1,this.recalculateInvoker=null,this.scrollListener=()=>{this.recalculate(!0)},this.resizeListener=()=>{this.recalculate(!0)},this.registerRecalculateInvoker=()=>{null===this.recalculateInvoker&&(this.recalculateInvoker=Sn.getInstance(this.targetWindow).addMethod(this.recalculate.safeBind(this,!1)))},this.deregisterRecalculateInvoker=()=>{this.recalculateInvoker&&(Sn.getInstance(this.targetWindow).removeMethod(this.recalculateInvoker),this.recalculateInvoker=null)},this.recalculate=e=>{try{if(this.paused)return;const t=this.elementContext.element;if(!In.isDefined(t))return;if(this.wrongElement(t))return void this.onElementLost(this.bubbleIndex);const n=t.getBoundingClientRect();if(function(e,t,n){const i=t.path?t.path.length:null;if(i&&ft(e,t.path[i-1]))return!0;return ft(e,t.element,n)}(this.targetWindow,this.elementContext,n))return void this.onElementLost(this.bubbleIndex);const i=this.checkElementPositionChanged(n),r=this.checkDocumentDimensionChanged();(r||i||e)&&this.onPositionChange(this.bubbleIndex,i||r);const s=this.checkElementVisibilityChanged(this.elementContext,n);s&&this.onVisibilityChange(this.bubbleIndex,this._elementIsVisible),s&&this.elementIsVisible&&!i&&this.onPositionChange(this.bubbleIndex,!0)}catch(e){console.error(`${gn}recalculate`,e),this.dispose()}},this.checkElementVisibilityChanged=(e,t)=>{const n=pn(this.targetWindow,e,t).isVisible,i=n!=this._elementIsVisible;return this._elementIsVisible=n,i},this.checkElementPositionChanged=e=>{const t=In.getCurrentScrollPosition(this.targetWindow,this.elementContext.path,e),n=$t.getActualZIndex(this.targetWindow,this.elementContext.element),i=this.elementZIndex!==n,r=!mn.isPositionEqual(this._elementBounds,t)||i;return r&&(this._elementBounds=t,this.elementZIndex=n),r},this.checkDocumentDimensionChanged=()=>{const e=sn(this.targetWindow),t=this._documentDimension.width!=e.width||this._documentDimension.height!=e.height;return this._documentDimension=e,t};const u=i.element,c=u.getBoundingClientRect();this._documentDimension=sn(e),this.elementZIndex=$t.getActualZIndex(e,u),this._elementIsVisible=pn(this.targetWindow,this.elementContext,c).isVisible,this._elementBounds=In.getCurrentScrollPosition(e,this.elementContext.path,c),u.setAttribute("newired-tag",""),this.registerEvents(i),a&&this.registerRecalculateInvoker()}get elementIsVisible(){return this._elementIsVisible}get elementBounds(){return this._elementBounds}get documentDimension(){return this._documentDimension}registerEvents(e){this.requiredEvents.forEach((t=>{switch(t){case"scroll":{const t=Zt(this.targetWindow,e.element);this.addAndRegisterEventListener("scroll",this.scrollListener,t,{passive:!0}),this.registerIFrameScrollEvent(e.path,t);break}case"resize":this.addAndRegisterEventListener("newired-resize",this.resizeListener,window,{passive:!0})}}))}registerIFrameScrollEvent(e,t){for(let n=0;n<e.length;n++){const i=e[n].contentDocument;i&&i!=t&&this.addAndRegisterEventListener("scroll",this.scrollListener,i)}}dispose(){if(this.deregisterRecalculateInvoker(),super.dispose(),this.elementContext)try{this.elementContext.element.removeAttribute(this.elementIdentity),this.elementContext.element.removeAttribute("newired-tag")}catch(e){}}static getCurrentScrollPosition(e,t,n){const i=Kt(e,n);for(let e=0;e<t.length;e++){const n=t[e].contentWindow;n&&(i.top+=n.scrollY+n.pageYOffset,i.left+=n.scrollX+n.pageXOffset)}return i}wrongElement(e){try{return!e.hasAttribute(this.elementIdentity)}catch(e){return console.error(`${gn}`,e),!0}}static isDefined(e){return e&&void 0!==e}}class xn{constructor(){this.map={},this.addEventListener=(e,t,n,i)=>{this.map[t]={eventHandler:n,target:e},e.addEventListener(t.split(".")[0],this.map[t].eventHandler,i)},this.removeEventListener=(e,t,n)=>{this.map.hasOwnProperty(t)&&(this.map[t].target.removeEventListener(t.split(".")[0],this.map[t].eventHandler,n),delete this.map[t])},this.disposeAll=e=>{for(const t in this.map)this.removeEventListener(this.map[t].target,t,e)},this.dispose=(e,t)=>{for(const n in this.map)this.map.hasOwnProperty(n)&&this.map[n].target===e&&this.removeEventListener(e,n,t)}}}function Ln(e){return{width:e.document.body.scrollWidth,height:e.document.body.scrollHeight}}function kn(e,t){e.style.width=tt(t.width),e.style.height=tt(t.height)}function Dn(e){return e.querySelector("nw-bubble")}var Pn={setResizeMonitor:function(e,t){const n=function(){const e=document.createElement("iframe");return e.className="nw-resize-monitor-frame",e.tabIndex=1,e.scrolling="no",e.style.border="solid 0",e.style.overflow="hidden",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="0",e.style.bottom="0",e.style.width="100%",e.style.height="100%",e.style.zIndex="-1",e.style.margin="0",e.style.padding="0",e}();if(e.contentDocument){e.contentDocument.body.appendChild(n);const i=n.contentWindow;if(i){!function(e){let t=!1;e.addEventListener("resize",(function(){t||(t=!0,(window.targetWindow||e).requestAnimationFrame((function(){e.dispatchEvent(new CustomEvent("newired-resize")),t=!1})))}))}(i),i.addEventListener("newired-resize",(function(){const n=Ln(i);kn(e,n),t(n)}));const n=Ln(i);kn(e,n)}}return n},setWidth:function(e,t){t.contentDocument&&(e.style.width=Math.min(t.contentDocument.body.scrollWidth,Vt(window.targetWindow))+"px")},setHeight:function(e,t){t.contentDocument&&(e.style.height=t.contentDocument.body.scrollHeight+"px")},getBubbleElement:function(e){const t=e.contentDocument;return t?Dn(t):null},queryBubbleElement:Dn};const Nn=b.JSON.stringify({left:-9999,top:-9999,width:0,height:0,right:-9999,bottom:-9999}),An=function(){return JSON.parse(Nn)};function On(){return JSON.parse(b.JSON.stringify({bounds:An(),arrowBounds:null,isFlipped:!1,zIndex:0}))}class Mn{static calculateBoundsInfo(e,t,n,i,r,s,o,a=!1,l=!1,u=0){if(!Rt(s))return null;if(!pn(e,{element:t,path:n}).isVisible)return this.offScreenBounds();const c=r,h=Kt(e,t.getBoundingClientRect());let d=Mn.calculateNWElementRect(e,c,h,n,i);Mn.adjustOffset(u,c,d);const p=function(e,t,n,i=0,r=0){switch(e){case kt.TopCenter:if(t.top<0)return t.top+=t.height+i,t.bottom+=t.height+i,t;break;case kt.BottomCenter:if(t.bottom>n.height)return t.top-=t.height+i,t.bottom-=t.height+i,t;break;case kt.LeftMiddle:if(t.left<0)return t.left+=t.width+r,t.right+=t.width+r,t;break;case kt.RightMiddle:if(t.right>n.width)return t.left-=t.width+r,t.right-=t.width+r,t}return null}(c,d,o,a?t.offsetHeight:0,a?t.offsetWidth:0),g=!!p;g&&p&&(d=p);const m=Mn.adjustOffsetOutOfBounds(e,d,h,c,g,s,l,o);return d.top=m.offset.top,d.left=m.offset.left,d.width=m.offset.right-m.offset.left,d.right=m.offset.right,d.bottom=m.offset.top+d.height,{bounds:d,isFlipped:g,arrowBounds:m.arrowBounds}}static offScreenBounds(){return{bounds:An(),isFlipped:!1,arrowBounds:null}}static adjustOffset(e,t,n){if(e)switch(t){case kt.TopCenter:n.top-=e;break;case kt.BottomCenter:n.top+=e;break;case kt.LeftMiddle:n.left-=e;break;case kt.RightMiddle:n.left+=e}}static copyElementOffset(e){return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}static adjustOffsetOutOfBounds(e,t,n,i,r,s,o,a){const l=this.copyElementOffset(t),u=this.adjustBubbleBounds(e,t,n,t.height,t.width,a);let c=null;return!r&&this.elementOffsetEquals(l,u)||o||(c=Mn.calculateArrowOffset(u,n,t.height,t.width,i,s,r)),{offset:u,arrowBounds:c}}static elementOffsetEquals(e,t){return e.left==t.left&&e.right==t.right&&e.top==t.top&&e.bottom==t.bottom}static adjustBubbleBounds(e,t,n,i,r,s){const o=Mn.adjustOffsetTopOutOfBounds(e,t),a=Mn.adjustOffsetLeftOutOfBounds(o),l=Mn.adjustOffsetRightOutOfBounds(a,n,r,s);return Mn.adjustOffsetBottomOutOfBounds(l,n,i,s)}static adjustOffsetTopOutOfBounds(e,t){const n=this.copyElementOffset(t);if(Qt(e.document))return n;const i=t.top<0&&t.bottom>0;return n.top=i?0:t.top,n}static adjustOffsetLeftOutOfBounds(e){const t=this.copyElementOffset(e),n=e.left<0&&e.right>0;return t.left=n?0:e.left,t}static adjustOffsetRightOutOfBounds(e,t,n,i){const r=this.copyElementOffset(e),s=i.width;if(e.left+n>s&&t.left<s){const t=s-(e.left+n);r.left+=t-1}return r.left<0&&(r.left=0,r.right=n,r.right>s&&(r.right=s)),r}static adjustOffsetBottomOutOfBounds(e,t,n,i){const r=this.copyElementOffset(e),s=i.height;if(e.top+n>s&&t.top<s){const t=s-(e.top+n);r.top+=t}return r}static calculateArrowOffset(e,t,n,i,r,s,o){const a=s.contentWindow;if(!a)return console.debug("Missing bubble frame window. Can not calculate arrow offset."),null;const l=a.document,u=Pn.queryBubbleElement(l);if(!u)return console.debug("Missing bubble content. Can not calculate arrow offset."),null;const c=l.querySelector("nw-bubble-arrow");if(!c)return console.debug("Missing bubble arrow. Can not calculate arrow offset."),null;const h={type:"DocumentRect",top:0,left:0,width:0,height:0,right:0,bottom:0},d=a.getComputedStyle(l.body),p=a.getComputedStyle(u),g=this.getArrowOffsetByBubbleFrameSpacing(d,p);let m;switch(r){case kt.TopCenter:return m=o?this.adjustArrowBottom(h,e,t):this.adjustArrowTop(h,e,t,n),m.left-=g.left,this.restrictArrowHorizontally(d,p,c,i,m,r);case kt.LeftMiddle:return m=o?this.adjustArrowRight(h,e,t):this.adjustArrowLeft(h,e,t),m.top-=g.top,this.restrictArrowVertically(d,p,c,n,m,r);case kt.BottomCenter:return m=o?this.adjustArrowTop(h,e,t,n):this.adjustArrowBottom(h,e,t),m.left-=g.left,this.restrictArrowHorizontally(d,p,c,i,m,r);case kt.RightMiddle:return m=o?this.adjustArrowLeft(h,e,t):this.adjustArrowRight(h,e,t),m.top-=g.top,this.restrictArrowVertically(d,p,c,n,m,r)}return h}static restrictArrowVertically(e,t,n,i,r,s){const o=e.paddingTop||"0",a=e.paddingBottom||"0",l=i-(parseFloat(o)+parseFloat(a)),u=n.offsetHeight/2;let c,h;return"LEFT"===s.toUpperCase()?(c=parseFloat(t.borderTopRightRadius||"0"),h=parseFloat(t.borderBottomRightRadius||"0")):(c=parseFloat(t.borderTopLeftRadius||"0"),h=parseFloat(t.borderBottomLeftRadius||"0")),r.top<u+c&&(r.top=u+c),r.top+u>l-h&&(r.top=l-h-u),r}static restrictArrowHorizontally(e,t,n,i,r,s){const o=e.paddingLeft||"0",a=e.paddingRight||"0",l=i-(parseFloat(o)+parseFloat(a)),u=n.offsetWidth/2;let c,h;return"TOP"===s.toUpperCase()?(c=parseFloat(t.borderBottomLeftRadius||"0"),h=parseFloat(t.borderBottomRightRadius||"0")):(c=parseFloat(t.borderTopLeftRadius||"0"),h=parseFloat(t.borderTopRightRadius||"0")),r.left<u+c&&(r.left=u+c),r.left+u>l-h&&(r.left=l-h-u),r}static getArrowOffsetByBubbleFrameSpacing(e,t){const n=e.borderTopWidth?parseFloat(e.borderTopWidth):0,i=(e.paddingTop?parseFloat(e.paddingTop):0)+n+(e.marginTop?parseFloat(e.marginTop):0),r=e.borderLeftWidth?parseFloat(e.borderLeftWidth):0,s=(e.paddingLeft?parseFloat(e.paddingLeft):0)+r+(e.marginLeft?parseFloat(e.marginLeft):0);return{top:i+((t.borderTopWidth?parseFloat(t.borderTopWidth):0)+(t.marginTop?parseFloat(t.marginTop):0)),left:s+((t.borderLeftWidth?parseFloat(t.borderLeftWidth):0)+(t.marginLeft?parseFloat(t.marginLeft):0))}}static copyArrowBounds(e){return{type:"DocumentRect",top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height}}static adjustArrowTop(e,t,n,i){const r=this.copyArrowBounds(e);return r.top=i-1,r.left=0===t.left?n.left+n.width/2:n.left-t.left+n.width/2,r}static adjustArrowBottom(e,t,n){const i=this.copyArrowBounds(e);return i.top=-12,i.left=0===t.left?n.left+n.width/2:n.left-t.left+n.width/2,i}static adjustArrowLeft(e,t,n){const i=this.copyArrowBounds(e);return i.top=0===t.top?n.top+n.height/2:n.top-t.top+n.height/2,i.left=0,i}static adjustArrowRight(e,t,n){const i=this.copyArrowBounds(e);return i.top=0===t.top?n.top+n.height/2:n.top-t.top+n.height/2,i.left=-11,i}static calculateNWElementRect(e,t,n,i,r){const s=Mn.calculateIFrameOffset(i),o=function(e){let t=0;e.borderTop&&(t=parseInt(e.borderTop));let n=0;return e.borderLeft&&(n=parseInt(e.borderLeft)),{top:t,left:n}}(e.getComputedStyle(e.document.body)),a=Mn.calculateOffsetByAlign(t,n,r),l=s.top+o.top,u=s.left+o.left;return{type:"DocumentRect",top:a.top+l,left:a.left+u,right:a.right+u,bottom:a.bottom+l,width:r.width,height:r.height}}static calculateOffsetByAlign(e,t,n){const i={top:0,left:0,right:0,bottom:0},r=n.width,s=n.height;switch(e){case kt.CenterMiddle:case kt.TopLeft:case kt.TopRight:case kt.BottomLeft:case kt.BottomRight:throw new Error("Not implemented");case kt.TopCenter:return i.top=t.top-s,i.left=t.left+t.width/2-r/2,i.bottom=t.top,i.right=i.left+r,i;case kt.BottomCenter:return i.top=t.bottom,i.left=t.left+t.width/2-r/2,i.bottom=i.top+s,i.right=i.left+r,i;case kt.LeftMiddle:return i.top=t.top+t.height/2-s/2,i.left=t.left-r,i.bottom=i.top+s,i.right=t.left,i;case kt.RightMiddle:return i.top=t.top+t.height/2-s/2,i.left=t.right,i.bottom=i.top+s,i.right=i.left+r,i}}static calculateIFrameOffset(e){let t={top:0,left:0};for(let n=0;n<e.length;n++){const i=e[n].getBoundingClientRect();t={top:t.top+i.top,left:t.left+i.left}}return t}}class _n{constructor(e,t){this.parent=e,this.onClick=t,this.element=this.create(),this.parent.appendChild(this.element)}create(){const e=document.createElement("nw-close");return e.onclick=e=>(this.onClick(),e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,!1),e}hide(){this.element.style.visibility="hidden"}show(){this.element.style.visibility="visible"}remove(){this.parent&&this.parent.removeChild(this.element)}}function Rn(e){return"string"==typeof e?Fn(e):e}function Bn(e){return Fn(e).width}function Fn(e){switch(e){case Jn.Small:return{width:Re("--nw-bubble-size-small-width"),height:Re("--nw-bubble-size-small-height")};case Jn.Medium:return{width:Re("--nw-bubble-size-medium-width"),height:Re("--nw-bubble-size-medium-height")};case Jn.Large:return{width:Re("--nw-bubble-size-large-width"),height:Re("--nw-bubble-size-large-height")};case Jn.ExtraLarge:return{width:Re("--nw-bubble-size-extralarge-width"),height:Re("--nw-bubble-size-extralarge-height")};case Jn.Auto:throw new Error(`Not a predefined size ${Jn.Auto}!`)}}function Un(e){switch(e){case kt.TopLeft:case kt.BottomLeft:return{top:Re("--nw-panel-offset-top-left-top"),bottom:Re("--nw-panel-offset-bottom-left-bottom")};case kt.TopRight:case kt.BottomRight:default:return{top:Re("--nw-panel-offset-top-right-top"),bottom:Re("--nw-panel-offset-bottom-right-bottom")}}}function Wn(e){switch(e){case kt.TopLeft:case kt.TopRight:return{left:Re("--nw-panel-offset-top-left-left"),right:Re("--nw-panel-offset-top-right-right")};case kt.BottomLeft:case kt.BottomRight:default:return{left:Re("--nw-panel-offset-bottom-left-left"),right:Re("--nw-panel-offset-bottom-right-right")}}}var Jn;!function(e){e.Small="Small",e.Medium="Medium",e.Large="Large",e.ExtraLarge="ExtraLarge",e.Auto="Auto"}(Jn||(Jn={}));const Hn="nw-only-header",qn="nw-bubble-content",jn="nw-bubble-content-modal";class zn{constructor(e,t){this.identity=e,this.UIListener=t,this._bubbleFrame=null,this.header=null,this.closeButton=null,this.resizeMonitorElement=null,this.editorListener=null,this.arrow=null,this.inlineEditor=null,this.htmlClass=null,this.padding=on,this.autoResizeCounter=0,this.top=n.PIXEL_OFFSCREEN,this.left=n.PIXEL_OFFSCREEN}setEditorListener(e){this.editorListener=e}get bubbleFrame(){return this._bubbleFrame}removeUI(){if(this._bubbleFrame){const e=this._bubbleFrame.parentNode;e&&(this.removeInlineEditor(),e.removeChild(this._bubbleFrame),this._bubbleFrame=null,this.clear())}}static setOffScreen(e){e.style.left=n.PIXEL_OFFSCREEN,e.style.top=n.PIXEL_OFFSCREEN}setOffScreen(){this.bubbleFrame&&(this.autoResizeCounter=0,this.top=this.bubbleFrame.style.top,this.left=this.bubbleFrame.style.left,zn.setOffScreen(this.bubbleFrame))}revertOffScreen(){this.bubbleFrame&&this.top!==n.PIXEL_OFFSCREEN&&this.left!==n.PIXEL_OFFSCREEN&&(this.bubbleFrame.style.top=this.top,this.bubbleFrame.style.left=this.left)}addCloseButton(){if(this._bubbleFrame){const e=Pn.getBubbleElement(this._bubbleFrame);e&&this.createCloseButton(e,(()=>{this.removeCloseButton(),this.UIListener.onClickClose()}))}}createCloseButton(e,t){this.closeButton||(this.closeButton=new _n(e,t))}removeCloseButton(){this._bubbleFrame&&this.closeButton&&(this.closeButton.remove(),this.closeButton=null)}updateUI(e,t){const n=this._bubbleFrame;if(n&&n.contentDocument){this.autoResizeCounter=0,this.removeInlineEditor();const i=this.createUI(e,n.contentDocument);this.appendOrReplaceBubble(n.contentDocument,i),t&&t(n,i),this.registerEditing(n.contentDocument,i,e.inlineEditImmediate,e.bounds)}}updateUIAfterInlineEditChange(e,t){if(this._bubbleFrame&&this._bubbleFrame.contentDocument){this.autoResizeCounter=0;const n=this.createUI(e,this._bubbleFrame.contentDocument);this.appendOrReplaceBubble(this._bubbleFrame.contentDocument,n),this.setArrow(this._bubbleFrame,n,e),t&&t(this._bubbleFrame,n)}}clear(){this.autoResizeCounter=0,this.inlineEditor=null,this.resizeMonitorElement=null,this.closeButton=null}appendOrReplaceBubbleFrame(e,t){const n=this._bubbleFrame;this._bubbleFrame=t,n?this.replaceExisting(t,n):this.appendToContainer(e,t)}appendOrReplaceBubble(e,t){const n=Pn.queryBubbleElement(e);n?(this.inlineEditor&&this.inlineEditor.disposeEvents(),this.replaceExisting(t,n)):this.appendBubble(e,t)}appendBubble(e,t){e.body.appendChild(t)}replaceExisting(e,t){const n=t.parentNode;n&&n.replaceChild(e,t)}appendToContainer(e,t){const n=window.nwApp.querySelector(e);n&&n.appendChild(t)}createUI(e,t){const n=t.createElement("nw-bubble");return n.id=`${this.identity}-bubble`,n.tabIndex=1,n.style.outline="none",this.appendHeader(t,n,e),this.appendContent(t,n,e),this.appendFooter(t,n,e),this.addSpecialClasses(n,e),n}addSpecialClasses(e,t){this.htmlClass&&e.classList.add(this.htmlClass),!t.name&&t.content&&e.classList.add("nw-without-header"),t.bubbleSize!=Jn.Auto&&null!=t.bubbleSize||e.classList.add("nw-size-auto")}blur(e){const t=e.contentDocument;if(t&&t.activeElement)try{t.activeElement.blur()}catch(e){return}}setVisibility(e,t,n){t?this.setVisible(e,n):this.setHidden(e)}createArrow(e,t){return this.arrow=e.createElement("nw-bubble-arrow"),this.arrow.className="NW-arrow",this.setArrowPosition(this.arrow,t),this.arrow}hideArrow(){this.arrow&&(this.arrow.style.visibility="hidden")}showArrow(){this.arrow&&(this.arrow.style.visibility="visible")}resize(e){this.UIListener.onResized(e)}getFrame(){if(this._bubbleFrame&&this._bubbleFrame.contentWindow&&this._bubbleFrame.contentDocument)return this._bubbleFrame;throw new Error(`Illegal state: Missing frame: (${this._bubbleFrame})`)}computePadding(e){const t=it(window.targetWindow,e);t.paddingTop&&t.paddingLeft&&t.paddingRight&&t.paddingBottom||console.error("Padding of bubble body is not defined"),this.padding={top:parseInt(t.paddingTop,10),left:parseInt(t.paddingLeft,10),right:parseInt(t.paddingRight,10),bottom:parseInt(t.paddingBottom,10)}}getPadding(){return this.padding}getBubble(){if(this._bubbleFrame&&this._bubbleFrame.contentDocument){const e=this._bubbleFrame.contentDocument.querySelector("nw-bubble");if(e)return e}throw new Error(`Illegal state: Missing frame, or bubble: (${this._bubbleFrame})`)}getDocument(){if(this._bubbleFrame&&this._bubbleFrame.contentDocument)return this._bubbleFrame.contentDocument;throw new Error("Illegal state: Missing document in bubble frame.")}createBubbleFrame(e,t){this.removeInlineEditor(),this.clear();const n=window.targetDocument.createElement("iframe");return n.className="nw-bubble-frame",n.scrolling="no",n.id=this.identity,n.tabIndex=1,n.style.border="solid 0",n.style.position="absolute",zn.setOffScreen(n),n.style.overflow="hidden",n.style.visibility="hidden",n.onload=()=>{const i=n.contentDocument;i&&(i.body.className="nw-bubble-frame-body",i.body.style.cssFloat="left",i.body.setAttribute("data-nw-theme",e),n.contentWindow.newiredRootWindow=window,n.contentWindow.newired=window.newired,window.newired._internal.data.appendBubbleFrameResources(i),t(n),this.computePadding(i.body))},n}adjustedAlign(e,t){if(!e)return t.toLowerCase();switch(t.toUpperCase()){case"RIGHT":return"left";case"LEFT":return"right";case"TOP":return"bottom";case"BOTTOM":return"top";default:return t.toLowerCase()}}updateInlineEditor(e){this.inlineEditor&&this.inlineEditor.update(e.bounds,e.targetElementBounds,e.targetElementPath,e.align)}removeInlineEditor(){this.inlineEditor&&(this.inlineEditor.remove(),this.inlineEditor=null)}setArrow(e,t,n){if(e.contentDocument){const i=e.contentDocument.querySelector("nw-bubble-arrow");i&&(this.showArrow(),this.setArrowPosition(i,n)),t&&t.setAttribute("placement",this.adjustedAlign(n.isFlipped,n.align))}}getAlign(e){return e.getAttribute("placement")}setPosition(e,t){e.style.top=t.bounds.top+"px",e.style.left=t.bounds.left+"px",Jn.Auto===t.bubbleSize&&this.autoResizeCounter<10&&(e.style.width="100%",this.autoResizeCounter++);const n=Pn.getBubbleElement(e);n&&this.setSize(n,t),this.resizeMonitorElement&&this.resizeMonitorElement.contentDocument&&(Pn.setWidth(e,this.resizeMonitorElement),Pn.setHeight(e,this.resizeMonitorElement))}setSize(e,t){t.documentDimension&&(e.style.maxWidth=this.bubbleSizeToPxWidth(t.documentDimension.width-64)),e.style.width=this.bubbleSizeToPxWidth(t.bubbleSize),e.style.height=this.bubbleSizeToPxHeight(t.bubbleSize),e.style.minWidth=this.bubbleSizeToPxMinWidth(t.bubbleSize)}createContent(e,t){const n=e.createElement(qn);return n.className=qn,t.content&&(n.innerHTML=Je.sanitize(t.content)),n}setArrowPosition(e,t){if(e.style.top="",e.style.left="",t.arrowBounds)switch(t.align.toLowerCase()){case"right":case"left":e.style.top=t.arrowBounds.top+"px";break;case"top":case"bottom":e.style.left=t.arrowBounds.left+"px"}}appendHeader(e,t,n){!n.name&&n.content||(this.header=e.createElement("nw-bubble-header"),this.header.innerHTML=Je.escape(n.name),0==n.name.length&&(this.header.classList.add("newired-placeholder"),this.header.setAttribute("placeholder",n.namePlaceholder)),t.appendChild(this.header))}appendContent(e,t,n){const i=this.createContent(e,n);i&&t.appendChild(i)}startInlineEditor(e){this.inlineEditor&&(e?this.inlineEditor.start(!0):this.inlineEditor.startOnClick())}bubbleSizeToPxHeight(e){return""}clean(){this.inlineEditor&&this.inlineEditor.pause()}restore(){this.inlineEditor&&this.inlineEditor.resume()}}class $n{constructor(e,t){this.align=e,this.bounds=t}draw(e,t,i){const r=e.ownerDocument;if(r){const s=r.createElement("nw-bubble-drop-area");s.style.width=tt(this.bounds.width),s.style.height=tt(this.bounds.height),s.style.top=tt(this.bounds.top),s.style.bottom=tt(this.bounds.bottom),s.style.left=tt(this.bounds.left),s.style.right=tt(this.bounds.right),s.style.backgroundColor=this.background(t),s.style.borderRadius="8px",s.style.position="absolute",s.style.zIndex=t?(n.MAX_ZINDEX-1).toString():n.MAX_ZINDEX.toString(),s.ondragover=e=>{s.style.backgroundColor=this.background(t,!0),e.preventDefault()},s.ondragleave=e=>{s.style.backgroundColor=this.background(t),e.preventDefault()},s.ondrop=()=>{i(this.align)},e.appendChild(s)}}background(e,t=!1){return e?"rgba(100, 100, 100, 0.1)":t?"rgba(76, 187, 23, 0.4)":"rgba(100, 100, 100, 0.2)"}}class Vn{constructor(e,t){this.targetWindow=e,this.align=t}draw(e,t,i){const r=e.ownerDocument;if(r){const s=this.calculatePosition(),o=r.createElement("nw-bubble-drop-area");let a;an(o,s),o.style.width="50%",o.style.height="50%",o.style.boxSizing="border-box",o.style.backgroundColor=this.background(t),o.style.position="fixed",o.style.border="1px solid rgba(76, 187, 23, 0.8)",t?o.style.zIndex=(n.MAX_ZINDEX-1).toString():(o.style.zIndex=n.MAX_ZINDEX.toString(),a=this.drawArrow(r),this.setArrowColor(a,t),o.appendChild(a)),o.ondragover=e=>{o.style.backgroundColor=this.background(t,!0),this.setArrowColor(a,t,!0),e.preventDefault()},o.ondragleave=e=>{o.style.backgroundColor=this.background(t),this.setArrowColor(a,t),e.preventDefault()},o.ondrop=()=>{i(this.align)},e.appendChild(o)}}calculatePosition(){const e=rn(this.targetWindow),t={type:"ViewportRect",top:null,left:null,width:e.width/2,height:e.height/2,right:null,bottom:null};switch(this.align){case kt.TopRight:t.top=0,t.right=0;break;case kt.TopLeft:t.top=0,t.left=0;break;case kt.BottomRight:t.bottom=0,t.right=0;break;case kt.BottomLeft:t.bottom=0,t.left=0;break;default:throw new Error(`Not implemented ${this.align}.`)}return t}drawArrow(e){const t=e.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="absolute",t.setAttribute("viewBox","0 0 12 12");const n=30,i=rn(this.targetWindow),r=(i.height>i.width?i.height:i.width)/2*.1;let s;switch(t.style.width=tt(r),t.style.height=tt(r),this.align){case kt.TopRight:t.style.top=tt(n),t.style.right=tt(n),s="rotate(270 12 12)";break;case kt.TopLeft:t.style.top=tt(n),t.style.left=tt(n),s="rotate(180 12 12)";break;case kt.BottomRight:t.style.bottom=tt(n),t.style.right=tt(n),s="";break;case kt.BottomLeft:t.style.bottom=tt(n),t.style.left=tt(n),s="rotate(90 12 12)";break;default:throw new Error(`Not implemented ${this.align}.`)}return t.innerHTML=`            \n                <path d="M18,7a1,1,0,0,0-2,0v7.59L7.71,6.29A1,1,0,0,0,6.29,7.71L14.59,16H7a1,1,0,0,0,0,2H17a1,1,0,0,0,.38-.08,1,1,0,0,0,.54-.54A1,1,0,0,0,18,17Z"\n                    transform="translate(-6 -6) ${s}"/>            `,t}setArrowColor(e,t,n=!1){e&&(e.style.fill=t?"":n?"rgb(218,241,208, 0.7)":"rgba(147, 214, 116, 0.7)")}background(e,t=!1){return e?"rgba(100, 100, 100, 0.1)":t?"rgba(76, 187, 23, 0.4)":"rgba(100, 100, 100, 0.2)"}}class Gn{constructor(e,t,n,i,r,s,o){this.targetWindow=e,this.dropPositions=t,this.onDragEnded=n,this.onDragStarted=i,this.getParent=r,this.getAlign=s,this.bubbleUI=o,this.dropAreas=[],this.curtain=null,this.eventMap=new xn,this.dropAlign=this.getAlign(),this.dragElementPadding=this.bubbleUI.getPadding(),this.cleanDropAreas=()=>{const e=this.getParent();if(e.ownerDocument){const t=window.nwApp.querySelector("nw-align-editor-curtain");t&&e.removeChild(t);window.nwApp.querySelectorAll("nw-bubble-drop-area").forEach((function(t){e.removeChild(t)}))}},this.initializeDragAndDrop()}update(e,t,n){switch(n.type){case"ViewportRect":this.dropAreas=this.createViewportDropAreas();break;case"DocumentRect":this.dropAreas=this.createDocumentDropAreas(e,t,n)}}get dragElement(){return this.bubbleUI.getDocument().body}initializeDragAndDrop(){this.dragElement.setAttribute("draggable","true"),this.dragElement.style.cursor="move",this.eventMap.addEventListener(this.dragElement,"dragstart",(e=>{e.dataTransfer.dropEffect="move",this.onDragStarted(),this.bubbleUI.hideArrow(),b.setTimeout((()=>{this.drawAreas(),this.bubbleUI.showArrow()}))})),this.eventMap.addEventListener(this.dragElement,"dragend",(()=>{this.onDragEnded(this.dropAlign),this.cleanDropAreas()}))}dispose(){this.dragElement.setAttribute("draggable","false"),this.dragElement.style.cursor="default",this.eventMap.disposeAll()}drawAreas(){const e=this.getParent();this.curtain=this.drawCurtain(e),this.dropAreas.forEach((t=>{t.draw(e,this.getAlign()===t.align,(e=>{this.dropAlign=e}))}))}drawCurtain(e){const t=e.ownerDocument;if(t){const i=t.createElement("nw-align-editor-curtain");return i.style.position="fixed",i.style.zIndex=(n.MAX_ZINDEX-1).toString(),i.style.width="100%",i.style.height="100%",i.style.top=tt(0),i.style.left=tt(0),i.style.backgroundColor="rgba(0, 0, 0, 0)",e.appendChild(i),this.curtain}return null}createDocumentDropAreas(e,t,n){const i=[],r=sn(this.targetWindow),s=Mn.calculateNWElementRect(this.targetWindow,kt.TopCenter,t,e,n);s.top>=0&&b.array.push(i,new $n(kt.TopCenter,this.removePadding(s)));const o=Mn.calculateNWElementRect(this.targetWindow,kt.RightMiddle,t,e,n);o.right<=r.width&&b.array.push(i,new $n(kt.RightMiddle,this.removePadding(o)));const a=Mn.calculateNWElementRect(this.targetWindow,kt.BottomCenter,t,e,n);a.bottom<=r.height&&b.array.push(i,new $n(kt.BottomCenter,this.removePadding(a)));const l=Mn.calculateNWElementRect(this.targetWindow,kt.LeftMiddle,t,e,n);return l.left>=0&&b.array.push(i,new $n(kt.LeftMiddle,this.removePadding(l))),i}createViewportDropAreas(){const e=[];return this.dropPositions.forEach((t=>{b.array.push(e,new Vn(this.targetWindow,t))})),e}removePadding(e){const t=this.dragElementPadding;return e.width-=t.left+t.right,e.height-=t.top+t.bottom,e.top+=t.top,e.left+=t.left,e}}class Xn{constructor(e,t){this.parentDoc=e,this.onLoad=t,this.frame=null,this.createFrame(e,t)}get element(){return this.frame}dispose(){if(this.frame){const e=this.frame.parentElement;e&&(e.removeChild(this.frame),console.log("wrapper frame removed from: ",e))}}createFrame(n,i){if(!this.frame){const r=n.createElement("iframe");r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.backgroundColor="transparent",r.style.zIndex="2147483647",r.id="newired-semantic-wrapper",r.onload=()=>{if(r.contentDocument){let n=0;const s=3,o=()=>{++n===s&&(n=0,r.contentDocument&&i(r.contentDocument))};e(r.contentDocument,r.contentDocument.head,Fe().editorResource("semantic/semantic.css"),"nw-link-semantic-css",o),t(r.contentDocument,Fe().editorResource("jquery-3.5.1.min.js"),"nw-script-jquery",o),t(r.contentDocument,Fe().editorResource("semantic/semantic.min.js"),"nw-script-semantic",o),r.contentDocument.body.style.backgroundColor="transparent"}},this.frame=r}}}class Yn{constructor(e,t){this.parentDoc=e,this.options=t,this.wrapper=new Xn(e,(e=>{this.createUI(e)}))}get element(){return this.wrapper.element}dispose(){this.wrapper&&this.wrapper.dispose()}createUI(e){const t=e.createElement("div");t.innerHTML=`\n                <div class="ui tiny modal">\n                    <div class="header">${this.options.title}</div>\n                    <div class="content">\n                        <p>${this.options.content}</p>\n                    </div>\n                    <div class="actions">\n                    </div>\n                </div>`,e.body.appendChild(t);const n=t.querySelector(".actions");if(null!==this.options.onConfirm&&this.options.confirmText){const t=e.createElement("div");t.classList.add("ui","approve","button"),t.innerText=this.options.confirmText,n&&n.appendChild(t)}if(null!==this.options.onCancel&&this.options.cancelText){const t=e.createElement("div");t.classList.add("ui","cancel","button","negative"),t.innerText=this.options.cancelText,n&&n.appendChild(t)}e.listener={onCancel:()=>{this.options.onCancel()},onConfirm:()=>{this.options.onConfirm()}};const i=e.createElement("script");i.innerText="\n                $('.ui.tiny.modal').modal({\n                    dimmerSettings: { opacity: 0 },\n                    closable: false,\n                    onDeny: function() {\n                      document.listener.onCancel();\n                    },\n                    onApprove: function() {\n                      document.listener.onConfirm();\n                    }\n                }).modal('show')",e.body.appendChild(i)}}class Qn{constructor(e,t){this.parentDoc=e,this.options=t,this.keydownHandler=e=>{"Escape"===e.code&&(this.options.onCancel(),this.removeKeydownListener())},this.removeKeydownListener=()=>{this.element&&this.element.removeEventListener("keydown",this.keydownHandler)},this.wrapper=new Xn(e,(e=>{this.createUI(e)}))}get element(){return this.wrapper.element}createUI(e){const t=e.createElement("div");t.insertAdjacentHTML("afterbegin",`\n            <div class="ui tiny modal" id="modal-transition">\n                <i class="close icon" style="top:0.453125rem;right:0"></i>\n                    <div class="header">Change transition for this step</div>\n                    <div class="content">\n                        <p>\n                            <span id="label" tabindex="0" style="outline: none">Trigger next step:</span>\n                            <a><i id="externalHelp" class="icon question circle outline tooltip"\n                                data-external-link="editor/step-transition" \n                                data-content="The Step Transition options enable you to specify what needs to happen in order for the end user to go to the next Step of the Journey." \n                                style="cursor: pointer"></i></a>\n                            <div class="ui vertical menu" style="width: 100%" id="menu-transition">\n                                ${this.htmlOptions()}\n                            </div>\n                        </p>\n                    </div>\n               </div>`),e.body.appendChild(t),Qn.appendStyle(e,"\n                .menu a.item .tooltip {\n                    display: none;\n                }\n                .menu a.item:hover .tooltip {\n                    display: inline-block; \n                }\n        "),Qn.appendScript(e,"\n                $('#modal-transition')\n                    .modal({\n                        dimmerSettings: { opacity: 0.5 },\n                        closable: false,\n                        onHide: function() {\n                            document.listener.onCancel();\n                        }\n                    }).\n                    modal('show');\n                \n                $('.menu a.item').on('click', function() {\n                    document.listener.onSelected($(this).data().value);\n                });\n                \n                $('.tooltip').on('click', function(event) {\n                    window.top.openExternal('https://lnk.newired.com/' + $(this).data().externalLink);\n                    event.preventDefault();\n                    event.stopPropagation();\n                });\n                \n                $('.tooltip').popup();\n            "),e.listener={onSelected:e=>{this.options.onSelection(e)},onCancel:()=>{this.options.onCancel()}},e.addEventListener("keydown",this.keydownHandler)}static appendStyle(e,t){const n=e.createElement("style");n.innerHTML=t,e.body.appendChild(n)}static appendScript(e,t){const n=e.createElement("script");n.innerText=t,e.body.appendChild(n)}htmlOptions(){const e={};return e[we.Click]=this.menuItem(we.Click,'<i class="icon mouse pointer"></i> Click',"editor/step-transition-click","When a Step is associated with a link or a button, this option moves the Journey to the next \n            Step when the end user clicks on the element."),e[we.Next]=this.menuItem(we.Next,'<i class="icon step forward"></i> "Next" button click',"editor/step-transition-button-click","This option causes a button labeled Next to appear in the Step bubble when the end user accesses\n            that Step during a Journey. The user needs to click on the button to move to the next Step."),e[we.Editing]=this.menuItem(we.Editing,'<i class="icon edit"></i> Edit input',"editor/step-transition-click-editing","To be used for input fields (e.g. the username or password field) or text boxes. \n            The Journey displays the next Step when the end user types into the input field or text box."),e[we.ValueChange]=this.menuItem(we.ValueChange,'<i class="icon toggle on"></i> Value change',"editor/step-transition-change-value","To be used for dropdown menus. When a value is selected from the list, the Journey moves to the next Step."),e[we.Hover]=this.menuItem(we.Hover,'<i class="icon hand pointer outline"></i> Hover',"editor/step-transition-hover","The Journey moves to the next Step when the end user hovers the mouse pointer over the selected page element."),e[we.Multiple]=this.menuItem(we.Multiple,'<i class="icon comments outline"></i> Multiple',"editor/step-transition-multiple","The current Step should appear together with the following one, and the engagement method used\n            in this case will be the one selected on the next Step"),e[we.Timing]=this.menuItem(we.Timing,'<i class="icon wait outline"></i> Timing',"editor/step-transition-timing","The Journey moves onto the next Step after a specified amount of time."),e[we.PageRefresh]=this.menuItem(we.PageRefresh,'<i class="icon refresh"></i> URL change',"editor/step-transition-url-change","The Journey moves onto the next Step when the URL changes."),this.options.transitions.map((t=>e[t])).join("\n")}menuItem(e,t,n,i){return`<a class="item ${e==this.options.selected?"active":""}" data-value="${e}">\n                <i class="tooltip icon question circle outline" style="color: #4183c4" data-external-link="${n}" data-content="${i}" data-position="bottom right"></i>\n                <span>${t}</span>\n            </a>`}}class Kn{}Kn.defaultColor="#3D4DB7",Kn.defaultSize="16",Kn.get=(e,t,n)=>{switch(e.toLowerCase()){case"help":return Kn.helpCircle(t,n);case"navigation":return Kn.compass(t,n);case"idea":return Kn.info(t,n);case"favorite":return Kn.star(t,n);case"note":return Kn.messageSquare(t,n);case"alert":return Kn.alertTriangle(t,n);case"edit":return Kn.edit(t,n);case"plus":return Kn.plus(t,n);default:return Kn.helpCircle(t,n)}},Kn.helpCircle=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    color="${t}"\n                    viewBox="0 0 24 24"\n                    fill="none"\n                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-help-circle">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>\n                    <line x1="12" y1="17" x2="12" y2="17"></line>\n                </svg>\n                `,Kn.compass=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    color="${t}"\n                    viewBox="0 0 24 24"\n                    fill="none"\n                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-compass">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>\n                </svg>\n                `,Kn.info=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    color="${t}"\n                    viewBox="0 0 24 24"\n                    fill="none"\n                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-info">\n                    <circle cx="12" cy="12" r="10"></circle>\n                    <line x1="12" y1="16" x2="12" y2="12"></line>\n                    <line x1="12" y1="8" x2="12" y2="8"></line>\n                </svg>\n                `,Kn.star=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    color="${t}"\n                    viewBox="0 0 24 24"\n                    fill="none"\n                    stroke="currentColor"\n                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-star">\n                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">\n                    </polygon>\n                </svg>\n                `,Kn.messageSquare=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    color="${t}"\n                    viewBox="0 0 24 24"\n                    fill="none"\n                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-message-square">\n                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n                </svg>\n                `,Kn.alertTriangle=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    color="${t}"\n                    viewBox="0 0 24 24"\n                    fill="none"\n                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-alert-triangle">\n                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                    <line x1="12" y1="9" x2="12" y2="13"></line>\n                    <line x1="12" y1="17" x2="12" y2="17"></line>\n                </svg>\n                `,Kn.edit=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg" \n                    width="${e}"\n                    height="${e}"\n                    color="${t}" \n                    viewBox="0 0 24 24" \n                    fill="none"\n                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"\n                    class="feather feather-edit">\n                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n                </svg>\n                `,Kn.plus=(e,t)=>`\n                <svg xmlns="http://www.w3.org/2000/svg"\n                    width="${e}"\n                    height="${e}"\n                    viewBox="0 0 8 8"\n                    fill="${t}"\n                >\n                    <circle cx="4" cy="4" r="4"/>                \n                    <circle cx="4" cy="4" r="3.6"/>\n                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4 2.18182C4.20083 2.18182 4.36364 2.28358 4.36364 2.4091V5.59091C4.36364 5.71643 4.20083 5.81819 4 5.81819C3.79917 5.81819 3.63637 5.71643 3.63637 5.59091V2.4091C3.63637 2.28358 3.79917 2.18182 4 2.18182Z"/>\n                    <path fill-rule="evenodd" clip-rule="evenodd" d="M2.18182 4C2.18182 3.79917 2.28358 3.63637 2.4091 3.63637H5.59091C5.71643 3.63637 5.81819 3.79917 5.81819 4C5.81819 4.20083 5.71643 4.36364 5.59091 4.36364H2.4091C2.28358 4.36364 2.18182 4.20083 2.18182 4Z"/>\n                </svg>`;const Zn="nw-resize-dragger";var ei,ti,ni,ii,ri,si,oi,ai,li,ui,ci,hi,di,pi;!function(e){e.TwoDirectional="TWO_DIRECTIONAL",e.FourDirectional="FOUR_DIRECTIONAL"}(ei||(ei={})),function(e){e.North="NORTH",e.West="WEST",e.East="EAST",e.South="SOUTH",e.NorthWest="NORTH_WEST",e.NorthEast="NORTH_EAST",e.SouthWest="SOUTH_WEST",e.SouthEast="SOUTH_EAST"}(ti||(ti={}));class gi{constructor(e,t,n,i,r,s){this.targetWindow=e,this.align=t,this.onResizeStarted=n,this.onResize=i,this.onResizeEnded=r,this.bubbleUI=s,this.resizers=[],this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.startPadding=on,this.dragging=!1,this.update=e=>{e===this.align?this.updateResizers():(this.align=e,this.dispose(),this.createResizers(e))},this.disableDraggers=e=>{this.resizers.forEach((t=>{t.dragger.style.display=e?"none":"flex"}))},this.showResizers=e=>{this.resizers.forEach((t=>{this.showDragger(t.dragger,t.direction,e(t))}))},this.startViewportDimension=rn(e),this.createResizers(t),this.registerResizeElementEvents()}dispose(){this.removeResizers(),this.clear()}setSuppressors(e){e.forEach((e=>{e.addEventListener("mouseenter",(()=>{this.disableDraggers(!0)})),e.addEventListener("mouseleave",(()=>{this.disableDraggers(!1)}))}))}get resizeElement(){return this.bubbleUI.getFrame()}get resizeElementPadding(){return this.bubbleUI.getPadding()}get nwSteps(){return window.nwApp.querySelector("nw-steps")}getResizeElementRect(){const e=this.resizeElement,t=this.resizeElementPadding,n=it(this.targetWindow,e),i={type:"ViewportRect",top:e.style.top?parseInt(e.style.top,10)+t.top+parseInt(n.marginTop||"0",10):null,left:e.style.left?parseInt(e.style.left,10)+t.left+parseInt(n.marginLeft||"0",10):null,width:parseInt(e.style.width||"0",10)-t.left-t.right,height:parseInt(e.style.height||"0",10)-t.top-t.bottom,right:e.style.right?parseInt(e.style.right,10)+t.right+parseInt(n.marginRight||"0",10):null,bottom:e.style.bottom?parseInt(e.style.bottom,10)+t.bottom+parseInt(n.marginBottom||"0",10):null};if(null===i.top&&null===i.left&&null===i.bottom&&null===i.right)throw new Error(`Invalid resize element bounds ${JSON.stringify(i)}.`);return i}calculateDraggerRect(e){const t=this.getResizeElementRect(),n=10,i=12,r=-6;switch(e){case ti.NorthEast:return{type:"ViewportRect",top:null===t.top?null:t.top,bottom:null===t.bottom?null:t.bottom+t.height+r,right:null===t.right?null:t.right,left:null===t.left?null:t.left+t.width+r,width:i,height:i};case ti.SouthWest:return{type:"ViewportRect",top:null===t.top?null:t.top+t.height+r,bottom:null===t.bottom?null:t.bottom,right:null===t.right?null:t.right+t.width+r,left:null===t.left?null:t.left,width:i,height:i};case ti.NorthWest:return{type:"ViewportRect",top:null===t.top?null:t.top,bottom:null===t.bottom?null:t.bottom+t.height+r,right:null===t.right?null:t.right+t.width+r,left:null===t.left?null:t.left,width:i,height:i};case ti.SouthEast:return{type:"ViewportRect",top:null===t.top?null:t.top+t.height+r,bottom:null===t.bottom?null:t.bottom,right:null===t.right?null:t.right,left:null===t.left?null:t.left+t.width+r,width:i,height:i};case ti.North:return{type:"ViewportRect",top:null===t.top?null:t.top+2,bottom:null===t.bottom?null:t.bottom+t.height-2,right:null===t.right?null:t.right+n,left:null===t.left?null:t.left+n,width:t.width-20,height:4};case ti.West:return{type:"ViewportRect",top:null===t.top?null:t.top+n,bottom:null===t.bottom?null:t.bottom+n,right:null===t.right?null:t.right+t.width-2,left:null===t.left?null:t.left+2,width:4,height:t.height-20};case ti.East:return{type:"ViewportRect",top:null===t.top?null:t.top+n,bottom:null===t.bottom?null:t.bottom+n,right:null===t.right?null:t.right+2,left:null===t.left?null:t.left+t.width-2,width:4,height:t.height-20};case ti.South:return{type:"ViewportRect",top:null===t.top?null:t.top+t.height-2,bottom:null===t.bottom?null:t.bottom+2,right:null===t.right?null:t.right+n,left:null===t.left?null:t.left+n,width:t.width-20,height:4}}}registerResizeElementEvents(){const e=this.resizeElement.contentDocument.body;e.addEventListener("mouseenter",(()=>{this.showResizers((e=>mi(e.direction)===ei.FourDirectional))})),e.addEventListener("mouseleave",(()=>{this.showResizers((()=>!1))}))}updateResizers(){this.resizers.forEach((e=>{this.updateDraggerRect(e.direction,e.dragger)}))}createResizers(e){switch(e){case kt.TopCenter:case kt.BottomCenter:case kt.LeftMiddle:case kt.CenterMiddle:case kt.RightMiddle:throw new Error(`Not implemented align: ${e}`);case kt.TopRight:this.createTwoDirectionalResizer(ti.West),this.createTwoDirectionalResizer(ti.South),this.createFourDirectionalResizer(ti.SouthWest);break;case kt.TopLeft:this.createTwoDirectionalResizer(ti.East),this.createTwoDirectionalResizer(ti.South),this.createFourDirectionalResizer(ti.SouthEast);break;case kt.BottomRight:this.createTwoDirectionalResizer(ti.West),this.createTwoDirectionalResizer(ti.North),this.createFourDirectionalResizer(ti.NorthWest);break;case kt.BottomLeft:this.createTwoDirectionalResizer(ti.North),this.createTwoDirectionalResizer(ti.East),this.createFourDirectionalResizer(ti.NorthEast)}}createResizer(e,t,n,i){const r=t=>{this.onResize(this.calculateDimension(e,t.clientX,t.clientY))},s=n=>{this.resizeElement.style.pointerEvents="auto";const o=this.targetWindow.document;o.removeEventListener("pointermove",r,!0),o.removeEventListener("pointerup",s,!0);const a=this.roundDimension(this.calculateDimension(e,n.clientX,n.clientY));this.onResizeEnded(n.clientX!==this.startX||n.clientY!==this.startY?a:null),this.clear(),i(),t.releasePointerCapture(n.pointerId)};t.addEventListener("pointerdown",(e=>{t.setPointerCapture(e.pointerId);const i=this.getResizeElementRect();this.onResizeStarted(),this.resizeElement.style.pointerEvents="none",this.startWidth=i.width,this.startHeight=i.height,this.startX=e.clientX,this.startY=e.clientY,this.startViewportDimension=rn(this.targetWindow),this.startPadding=this.resizeElementPadding,this.dragging=!0;const o=this.targetWindow.document;o.addEventListener("pointermove",r,!0),o.addEventListener("pointerup",s,!0),e.preventDefault(),n()})),this.nwSteps.appendChild(t),b.array.push(this.resizers,{direction:e,dragger:t})}roundDimension(e){return{width:Math.floor(e.width),height:Math.floor(e.height)}}checkMaxWidth(e,t,n){return e+n>t?t-n:e}checkMaxHeight(e,t,n){return e+n>t?t-n:e}updateDraggerRect(e,t){an(t,this.calculateDraggerRect(e))}createFourDirectionalResizer(e){const t=this.targetWindow.document.createElement(Zn);t.style.position="fixed",t.style.display="flex",t.style.opacity="0",t.style.transition="opacity 0.2s linear",t.style.zIndex=n.MAX_ZINDEX.toString(),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="white" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="6" cy="6" r="5"></circle>\n            </svg>',t.style.cursor=this.getDraggerCursor(e),this.registerDraggerEvents(t),this.updateDraggerRect(e,t),this.createResizer(e,t,(()=>{}),(()=>{}))}createTwoDirectionalResizer(e){const t=this.targetWindow.document.createElement(Zn);t.style.position="fixed",t.style.zIndex=n.MAX_ZINDEX.toString(),t.style.cursor=this.getDraggerCursor(e),t.style.background="none",t.style.border="none",this.updateDraggerRect(e,t),this.createResizer(e,t,(()=>{}),(()=>{}))}registerDraggerEvents(e){e.addEventListener("mouseenter",(()=>{this.showResizers((t=>t.dragger===e))})),e.addEventListener("mouseleave",(()=>{this.showResizers((()=>!1))}))}showDragger(e,t,n){mi(t)===ei.FourDirectional&&(n||this.dragging?e.style.opacity="1":e.style.opacity="0")}getDraggerCursor(e){switch(e){case ti.NorthWest:case ti.SouthEast:return"nwse-resize";case ti.NorthEast:case ti.SouthWest:return"nesw-resize";case ti.North:case ti.South:return"ns-resize";case ti.West:case ti.East:return"ew-resize"}}calculateDimension(e,t,n){const i=this.startY+this.startHeight-n,r=this.startHeight-this.startY+n,s=this.startX+this.startWidth-t,o=this.startWidth-this.startX+t,a=this.startPadding.right+this.startPadding.left,l=this.startPadding.top+this.startPadding.bottom,u=it(this.targetWindow,this.resizeElement),c=a+(parseInt(u.marginRight||"0",10)+parseInt(u.marginLeft||"0",10)),h=l+(parseInt(u.marginTop||"0",10)+parseInt(u.marginBottom||"0",10));switch(e){case ti.NorthEast:return{width:this.checkMaxWidth(o,this.startViewportDimension.width,c),height:this.checkMaxHeight(i,this.startViewportDimension.height,h)};case ti.NorthWest:return{width:this.checkMaxWidth(s,this.startViewportDimension.width,c),height:this.checkMaxHeight(i,this.startViewportDimension.height,h)};case ti.SouthEast:return{width:this.checkMaxWidth(o,this.startViewportDimension.width,c),height:this.checkMaxHeight(r,this.startViewportDimension.height,h)};case ti.SouthWest:return{width:this.checkMaxWidth(s,this.startViewportDimension.width,c),height:this.checkMaxHeight(r,this.startViewportDimension.height,h)};case ti.North:return{width:this.startWidth,height:this.checkMaxHeight(i,this.startViewportDimension.height,h)};case ti.South:return{width:this.startWidth,height:this.checkMaxHeight(r,this.startViewportDimension.height,h)};case ti.West:return{width:this.checkMaxWidth(s,this.startViewportDimension.width,c),height:this.startHeight};case ti.East:return{width:this.checkMaxWidth(o,this.startViewportDimension.width,c),height:this.startHeight}}}removeResizers(){let e;for(;e=this.resizers.pop();)e.dragger.remove()}clear(){this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.dragging=!1}}function mi(e){switch(e){case ti.North:case ti.West:case ti.East:case ti.South:return ei.TwoDirectional;case ti.NorthWest:case ti.NorthEast:case ti.SouthWest:case ti.SouthEast:return ei.FourDirectional}}class fi{constructor(e,t,n,i,r){this.targetWindow=e,this.options=t,this.bubbleUI=n,this.editorListener=i,this.bounds=r,this.maxTitleLength=1024,this.maxContentLength=4096,this.eventMap=new xn,this.curtain=null,this.alignEditor=null,this.resizeEditor=null,this.toolbarEditButton=null,this.addContentButton=null,this.showControls=!1,this.addEventListener=(e,t,n,i)=>{const r=e.tagName;this.eventMap.removeEventListener(e,t+"."+r,i),this.eventMap.addEventListener(e,t+"."+r,n,i)};const s=t.dropPositions;s&&s.length&&(this.alignEditor=this.createAlignEditor(s)),this.createInlineResizeEditor(),this.enableContentEditable(),this.addResources(),this.registerFrameBodyHover(),this.wrapJourneyActions(),this.bubbleObserver=this.createBubbleObserver()}bubbleReplaced(){this.enableContentEditable(),this.registerHeaderFocusOut(),this.registerHeaderPaste(),this.registerContentPaste(),this.registerHeaderOnEnter(),this.wrapJourneyActions(),this.registerHeaderClickToStart(),this.registerContentClickToStart()}createBubbleObserver(){const e=new MutationObserver((e=>{let t=!1;e.forEach((e=>{e.addedNodes.forEach((e=>{"NW-BUBBLE"==e.tagName&&(t=!0)}))})),t&&this.bubbleReplaced()}));return e.observe(this.frameDocument,{subtree:!0,childList:!0,characterData:!1,attributes:!1}),e}get nwDimmer(){const e=window.nwApp.querySelector("nw-dimmer");if(!e)throw new Error("Dimmer container node not found");return e}get nwAlignEditor(){const e=window.nwApp.querySelector("nw-align-editor");if(!e)throw new Error("Align Editor's container node not found");return e}get frameDocument(){return this.bubbleUI.getDocument()}get bubble(){return this.bubbleUI.getBubble()}get header(){return this.bubbleUI.getBubble().querySelector("nw-bubble-header")}get content(){return this.bubbleUI.getBubble().querySelector("nw-bubble-content")}get headerText(){return this.header?this.header.innerText:""}set headerText(e){this.header&&(this.header.innerText=e||"")}get contentHTML(){if(this.content){const t=this.content.cloneNode(!0);return(e=fi.clearPollutedContent(t)).querySelectorAll("micro-app").forEach((e=>{e.removeAttribute("id"),bi(e)})),bi(e),e.innerHTML}var e;return""}set contentHTML(e){this.content&&(this.content.innerHTML=e)}get placeholder(){return this.editorListener.getPlaceholder()}remove(){this.alignEditor&&(this.alignEditor.dispose(),this.alignEditor=null),this.removeInlineResizeEditor(),this.eventMap.disposeAll(),this.disableContentEditable(),this.disposeCurtain(),this.disposeInlineEditorElements(),this.disposeSemanticWrappers(),this.disposeBubbleObserver()}updateAndStop(){this.updateTexts(((e,t)=>{this.headerText=t||"",e?this.showErrorDialog({error:e,onConfirm:()=>{},onCancel:()=>{this.headerText=t||"",this.stop((()=>{}))}}):this.stop((()=>{}))}))}stop(e){this.disposeCurtain(),this.disposeInlineEditorElements(),this.startOnClick(),this.editorListener.onEditingOver((()=>{this.editorListener.onEditEnded(e)}),null)}start(e=!1){this.registerHeaderFocusOut(),this.registerContentFocusOut(),this.registerHeaderPaste(),this.registerContentPaste(),this.registerHeaderOnEnter(),this.createCurtain(),this.editorListener.onEditing(),e&&this.resolveFocus()}startOnClick(){this.registerHeaderClickToStart(),this.registerContentClickToStart()}get isCallout(){switch(this.editorListener.getAlign()){case kt.TopCenter:case kt.BottomCenter:case kt.LeftMiddle:case kt.RightMiddle:return!0;default:return!1}}updateTexts(e){this.isCallout?this.updateContentAndThenTitle(this.headerText,this.contentHTML,e):this.updateTitleAndThenContent(this.headerText,this.contentHTML,e)}updateContentAndThenTitle(e,t,n){const i=null!=this.header;this.editorListener.onContentChanged(t,((t,r)=>{t?n(t,e,r):this.updateTitle(e,((e,t)=>{n(e,t,r)}),i)}))}updateTitleAndThenContent(e,t,n){const i=null!=this.header;this.editorListener.onTitleChanged(e,((e,i)=>{e?n(e,i,t):this.updateContent(t,((e,t)=>{n(e,i,t)}))}),i)}updateTitle(e,t,n){this.editorListener.onTitleChanged(e,((e,n)=>{t(e,n)}),n)}updateContent(e,t){this.editorListener.onContentChanged(e,((e,n)=>{t(e,n)}))}resolveFocus(){this.header?this.setFocus(this.header):this.setFocus(this.content)}setCaretAtEnd(e){const t=this.frameDocument.createRange();t.selectNodeContents(e),t.collapse(!1);const n=this.frameDocument.getSelection();n&&(n.removeAllRanges(),n.addRange(t))}setFocus(e){e&&b.setTimeout((()=>{this.setCaretAtEnd(e),e.focus()}))}disableContentEditable(){this.header&&(this.header.removeAttribute("contenteditable"),this.header.removeAttribute("placeholder"),this.header.classList.remove("newired-placeholder"),this.header.style.cursor="default")}enableContentEditable(){this.header&&(this.header.setAttribute("contenteditable","true"),this.header.setAttribute("placeholder",this.placeholder),this.header.classList.add("newired-placeholder"),this.header.style.cursor="text",this.addEventListener(this.header,"input",(e=>{this.setToolbarEditButtonSize()}))),this.content&&(this.content.setAttribute("contenteditable","true"),fi.preventUnwantedEditing(this.content),0==this.content.innerHTML.length&&this.content.insertAdjacentHTML("afterbegin","<p><br/></p>"),this.content.style.cursor="text",this.addEventListener(this.content,"input",(e=>{this.setToolbarEditButtonSize()})),this.registerHandleContentOnKeyUp(this.content)),this.bubble&&this.registerUndo(this.bubble),this.frameDocument.execCommand("defaultParagraphSeparator",!1,"p")}update(e,t,n,i){this.bounds=e,this.alignEditor&&t&&n&&this.alignEditor.update(n,t,e),this.resizeEditor&&this.resizeEditor.update(i)}registerHeaderClickToStart(){this.header&&this.addEventListener(this.header,"click",(e=>{this.start(),e.stopImmediatePropagation(),e.preventDefault()}),{once:!0})}registerContentClickToStart(){this.content&&this.addEventListener(this.content,"click",(e=>{var t;this.content&&((t=e.target)&&void 0!==t.nodeType&&t.nodeType===Node.ELEMENT_NODE)&&(function(e,t){const n=t.querySelectorAll("micro-app");return Array.prototype.slice.apply(n).some((t=>t.contains(e)))}(e.target,this.content)||!this.content.contains(e.target))?this.registerContentClickToStart():this.start()}),{once:!0})}registerFrameBodyHover(){this.addEventListener(this.frameDocument.body,"mouseenter",(e=>{this.showControls=!0,this.createAndShowInlineEditorElements()})),this.addEventListener(this.frameDocument.body,"mouseleave",(e=>{this.showControls=!1,this.disposeInlineEditorElements()}))}editEndedAfterRaceConditionState(){try{return this.bubble,!1}catch(e){return this.editorListener.onEditEnded((()=>{})),!0}}registerHeaderFocusOut(){this.header&&this.addEventListener(this.header,"focusout",(e=>{e.relatedTarget||this.updateTexts(((e,t,n)=>{this.editEndedAfterRaceConditionState()||e&&this.showErrorDialog({error:e,onConfirm:()=>{this.setFocus(this.header)},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}})}))}))}registerContentFocusOut(){this.content&&this.addEventListener(this.content,"focusout",(e=>{e.relatedTarget||this.updateTexts(((e,t,n)=>{this.editEndedAfterRaceConditionState()||e&&this.showErrorDialog({error:e,onConfirm:()=>{this.setFocus(this.content)},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}})}))}))}registerHeaderPaste(){this.header&&this.addEventListener(this.header,"paste",(e=>{const t=e;if(t.preventDefault(),t.clipboardData){const e=t.clipboardData.getData("text/plain");fi.insertTextTo(this.frameDocument,e,this.headerText,this.maxTitleLength)}}))}registerContentPaste(){this.content&&this.addEventListener(this.content,"paste",(e=>{const t=e;if(t.preventDefault(),t.clipboardData){const e=t.clipboardData.getData("text/plain");fi.insertTextTo(this.frameDocument,e,this.contentHTML,this.maxContentLength)}}))}static insertTextTo(e,t,n,i){const r=e.getSelection(),s=r?r.toString():"",o=t.substr(0,Math.max(0,Math.min(i-n.length+s.length,t.length)));e.execCommand("insertText",!1,o)}registerUndo(e){this.addEventListener(e,"keydown",(e=>{const t=e,n=t.code;!t.ctrlKey&&!t.metaKey||t.shiftKey||"KeyZ"!=n||this.frameDocument&&this.frameDocument.execCommand("undo"),(t.ctrlKey||t.metaKey)&&t.shiftKey&&"KeyZ"==n&&this.frameDocument&&this.frameDocument.execCommand("redo")}))}registerHandleContentOnKeyUp(e){this.addEventListener(e,"keyup",(e=>{const t=e;"Backspace"===t.code&&0==this.contentHTML.length&&(this.header?this.updateContentAndThenTitle(this.headerText,"",((e,t,n)=>{e?this.showErrorDialog({error:e,onConfirm:()=>{this.setFocus(this.content)},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}}):this.appendBottomToolbar()})):(t.preventDefault(),t.stopPropagation(),this.contentHTML="<p><br/></p>"))}))}registerHeaderOnEnter(){this.header&&this.addEventListener(this.header,"keydown",(e=>{const t=e.code;this.headerText.length>=this.maxTitleLength&&!["Backspace","Delete","ArrowLeft","ArrowRight"].includes(t)?e.preventDefault():"Enter"!==t&&"NumpadEnter"!==t||(e.preventDefault(),this.header&&this.header.blur(),this.updateAndStop())}))}showErrorMessage(e){const t=Be().document,n=new Yn(t,{title:"Unable to save changes",content:e,confirmText:"Dismiss",cancelText:null,onConfirm:()=>{this.disposeSemanticWrappers()},onCancel:()=>{this.disposeSemanticWrappers()}});this.insertMessageBox(n)}showErrorDialog(e){const t=Be().document,n=new Yn(t,{title:"Unable to save changes",content:e.error,confirmText:"Continue with editing",cancelText:"Dismiss changes",onConfirm:()=>{this.disposeSemanticWrappers(),e.onConfirm()},onCancel:()=>{this.disposeSemanticWrappers(),e.onCancel()}});this.insertMessageBox(n)}insertMessageBox(e){e.element&&window.nwApp.appendChild(e.element)}disposeSemanticWrappers(){const e=window.nwApp.querySelectorAll("#newired-semantic-wrapper");for(let t=0;t<e.length;t++){const n=e[t];window.nwApp.removeChild(n)}}createCurtain(){this.curtain||(this.curtain=this.getOrCreateCurtain(),this.addEventListener(this.curtain,"click",(e=>{this.updateAndStop()}),{once:!0}))}getOrCreateCurtain(){let e=window.nwApp.querySelector("nw-inline-curtain");return e||(e=this.options.dropPositions?this.createBubbleCurtain():this.createModalCurtain()),e}static setCurtainStyles(e,t){t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height=sn(e).height.toString()+"px",t.style.display="block",t.style.outline="none",t.style.border="0",t.style.backgroundColor="#8888883d",t.tabIndex=0,t.id="newired-inline-curtain"}createBubbleCurtain(){const e=Be().document.createElement("nw-inline-curtain");return fi.setCurtainStyles(this.targetWindow,e),e.style.zIndex=n.MAX_ZINDEX.toString(),this.nwDimmer.appendChild(e),e}createModalCurtain(){const e=this.frameDocument.createElement("nw-inline-curtain");return fi.setCurtainStyles(this.targetWindow,e),e.style.height="100%",e.style.position="fixed",this.frameDocument.body.insertBefore(e,this.bubble),e}disposeCurtain(){if(this.curtain){const e=this.curtain.parentElement;e&&e.removeChild(this.curtain),this.curtain=null}}wrapJourneyActions(){const e=this.bubble.querySelectorAll("nw-button, nw-close, nw-feedback, nw-link, newired-journey-link");for(let t=0;t<e.length;t++){const n=e[t],i=n.onclick;n.onclick=e=>{e.preventDefault(),e.stopPropagation(),this.updateTexts((t=>{t?this.showErrorDialog({error:t,onConfirm:()=>{},onCancel:()=>{i&&i.call(window,e)}}):this.stop((()=>{i&&i.call(window,e)}))}))}}}createInlineResizeEditor(){this.options.resizable&&(this.resizeEditor=this.createResizeEditor(this.editorListener.getAlign()))}createResizeEditor(e){return new gi(this.targetWindow,e,(()=>this.editorListener.onEditing()),(e=>this.bubbleUI.resize(e)),(e=>{e?this.editorListener.onDimensionChanged(e,(e=>{e&&this.showErrorMessage(e),this.editorListener.onEditingOver((()=>{}),e)})):this.editorListener.onEditingOver((()=>{}),null)}),this.bubbleUI)}createAlignEditor(e){return new Gn(this.targetWindow,e,(e=>{this.editorListener.onAlignChanged(e,(e=>{e&&this.showErrorMessage(e),this.editorListener.onEditingOver((()=>{}),null)}))}),(()=>{this.editorListener.onEditing(),this.updateTexts(((e,t,n)=>{this.editEndedAfterRaceConditionState()||e&&this.showErrorDialog({error:e,onConfirm:()=>{this.setFocus(this.content)},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}})}))}),(()=>this.nwAlignEditor),(()=>this.editorListener.getAlign()),this.bubbleUI)}createShadowBox(){let e=this.frameDocument.querySelector("nw-bubble-shadowbox");return e||(e=this.frameDocument.createElement("nw-bubble-shadowbox")),e}pause(){var e;null===(e=this.resizeEditor)||void 0===e||e.dispose(),this.disposeInlineEditorElements(),this.disposeCurtain()}resume(){this.showControls&&this.createAndShowInlineEditorElements(),this.createInlineResizeEditor()}createAndShowInlineEditorElements(){if(!this.frameDocument.querySelector("nw-inline-editor")){const e=this.frameDocument.createElement("nw-inline-editor");e.style.display="none";const t=this.createToolbar(),n=this.createShadowBox();if(!this.options.dropPositions&&(e.className="modal",this.bounds)){const e=4,i=1,r=this.getRealDimension();n.style.width=r.width+e+i+"px",n.style.height=r.height+e+i+"px",t.style.transform=`translate(-50%, -${.3*r.height}px)`}e.appendChild(t),e.appendChild(n),this.frameDocument.body.appendChild(e),this.appendBottomToolbar(),this.resizeEditor&&this.resizeEditor.setSuppressors([t])}}getRealDimension(){return{width:nt(this.bubbleUI.getBubble().style.width)||this.bounds.width,height:nt(this.bubbleUI.getBubble().style.height)||this.bounds.height}}disposeEvents(){this.header&&this.eventMap.dispose(this.header)}disposeInlineEditorElements(){const e=this.frameDocument.body.querySelector("nw-inline-editor");e&&(this.frameDocument.body.removeChild(e),this.toolbarEditButton=null)}appendBottomToolbar(){const e=this.frameDocument.body.querySelector("nw-inline-editor");if(e&&!this.content){const t=this.createBottomToolbar();e.appendChild(t)}}createToolbar(){let e=this.frameDocument.querySelector("nw-inline-toolbar-container");if(!e){const t=this.frameDocument,n=t.createElement("nw-toolbar");n.id="nw-inline-toolbar";const i=t.createElement("nw-toolbar-inner");if(this.toolbarEditButton=this.createToolbarEditButton(),i.appendChild(this.toolbarEditButton),this.setToolbarEditButtonSize(),this.alignEditor){const e=this.createToolbarDragger();i.appendChild(e)}else{const e=this.createToolbarPipeIcon();i.appendChild(e)}const r=this.options.transitions;if(r&&r.length){const e=this.getCurrentTransitionName(),t=this.createToolbarTransitionButton(e,"nw-inline-toolbar-transition",r);i.appendChild(t)}n.appendChild(i),e=this.frameDocument.createElement("nw-inline-toolbar-container"),e.appendChild(n)}return e}createBottomToolbar(){let e=this.frameDocument.querySelector("nw-inline-plus-button-container");return e||(e=this.frameDocument.createElement("nw-inline-plus-button-container"),this.addContentButton=this.createAddContentButton(),e.appendChild(this.addContentButton)),e}createToolbarEditButton(){const e=this.frameDocument.createElement("nw-toolbar-button");return e.id="nw-inline-toolbar-edit",e.className="edit",e.innerHTML=`\n                <span class="icon">\n                    ${Kn.get("edit",16,"#fff")}\n                </span>\n                <span class="text">Edit</span>`,e.onclick=()=>{this.updateTexts(((e,t,n)=>{e?this.showErrorDialog({error:e,onConfirm:()=>{},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}}):this.editorListener.openEditDialog(!0)}))},e}onContentAdded(){this.setFocus(this.content);const e=this.frameDocument.querySelector(" nw-inline-plus-button-container");e&&(e.remove(),this.addContentButton=null)}createAddContentButton(){const e=this.frameDocument.createElement("nw-toolbar-add-content-button");return e.id="nw-inline-toolbar-add-content-button",e.innerHTML=Kn.get("plus",20,"#fff"),e.onclick=()=>{const e=""==this.headerText?this.placeholder:this.headerText;this.updateTitleAndThenContent(e,"<p><br/></p>",((e,t,n)=>{e?this.showErrorDialog({error:e,onConfirm:()=>{this.setFocus(this.content)},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}}):this.onContentAdded()}))},e}setToolbarEditButtonSize(){const e=null!=this.editorListener.getTransitionType()?200:130;this.toolbarEditButton&&(this.bubble.offsetWidth>e?this.toolbarEditButton.classList.remove("only-icon"):this.toolbarEditButton.classList.add("only-icon"))}createToolbarDragger(){const e=this.frameDocument.createElement("nw-toolbar-dragger");return e.innerHTML="\n                <nw-toolbar-dragger-dots>\n                    <nw-toolbar-dragger-dot></nw-toolbar-dragger-dot>\n                    <nw-toolbar-dragger-dot></nw-toolbar-dragger-dot>\n                    <nw-toolbar-dragger-dot></nw-toolbar-dragger-dot>\n                </nw-toolbar-dragger-dots>\n                <nw-toolbar-dragger-dots>\n                    <nw-toolbar-dragger-dot></nw-toolbar-dragger-dot>\n                    <nw-toolbar-dragger-dot></nw-toolbar-dragger-dot>\n                    <nw-toolbar-dragger-dot></nw-toolbar-dragger-dot>\n                </nw-toolbar-dragger-dots>\n                ",e}createToolbarPipeIcon(){const e=this.frameDocument.createElement("nw-pipe");return e.innerHTML='\n                <svg width="1" height="16" viewBox="0 0 1 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <line x1="0.75" y1="12" x2="0.75" stroke="white" stroke-width="0.5"/>\n                </svg>\n                ',e}createToolbarTransitionButton(e,t,n){const i=this.frameDocument.createElement("nw-toolbar-button");return i.id=t,i.innerHTML=`<span class="text">${e}</span>`,i.onclick=()=>{this.updateTexts(((e,t,i)=>{e?this.showErrorDialog({error:e,onConfirm:()=>{},onCancel:()=>{this.headerText=t||"",this.contentHTML=i||"",this.stop((()=>{}))}}):this.showTransitionDropdown(n)}))},i}showTransitionDropdown(e){this.start();const t=Be().document,n=this.getCurrentTransition(),i=this.headerText===this.placeholder||""===this.headerText,r=new Qn(t,{transitions:e,selected:n,onSelection:e=>{this.start();const t=fi.getDefaultTimer(e);this.editorListener.onTransitionChanged(e,t,((e,t)=>{e||this.updateToolbar(),n!==t&&i&&(this.headerText=this.placeholder,this.updateContentAndThenTitle(this.headerText,this.contentHTML,((e,t,n)=>{e?this.showErrorDialog({error:e,onConfirm:()=>{this.setFocus(this.header)},onCancel:()=>{this.headerText=t||"",this.contentHTML=n||"",this.stop((()=>{}))}}):this.resolveFocus()})))})),this.disposeSemanticWrappers()},onCancel:()=>{this.disposeSemanticWrappers()}});this.insertTransitionDropdown(r)}insertTransitionDropdown(e){e.element&&window.nwApp.appendChild(e.element)}getCurrentTransition(){let e=this.editorListener.getTransitionType();return e||(e=Ie),e}getCurrentTransitionName(){let e=this.editorListener.getTransitionType();return e||(e=Ie),fi.stepTransitionLabel(e)}static stepTransitionLabel(e){switch(e){case we.Next:return"Next Button";case we.Click:return"Click";case we.Editing:return"Edit Input";case we.ValueChange:return"Value change";case we.Hover:return"Hover";case we.Multiple:return"Multiple";case we.Timing:return"Timing";case we.PageRefresh:return"URL change"}}updateToolbar(){const e=this.frameDocument.querySelector("#nw-inline-toolbar-transition .text");e&&(e.innerText=this.getCurrentTransitionName())}addResources(){window.newired._internal.data.appendInlineEditorResources(this.frameDocument)}static clearPollutedContent(e){return fi.clearDisabledEditable(e,"div.player"),fi.clearDisabledEditable(e,"micro-app"),fi.clearDisabledEditable(e,"newired-journey-link"),fi.clearDisabledEditable(e,"a"),e}static clearDisabledEditable(e,t){e.querySelectorAll(t).forEach((e=>{e.removeAttribute("contenteditable")}))}static preventUnwantedEditing(e){fi.disableEditable(e,"div.player"),fi.disableEditable(e,"micro-app"),fi.disableEditable(e,"newired-journey-link"),fi.disableEditable(e,"a")}static disableEditable(e,t){e.querySelectorAll(t).forEach((e=>{e.setAttribute("contenteditable","false")}))}disposeBubbleObserver(){this.bubbleObserver.disconnect()}static getDefaultTimer(e){const t=Be().newired._internal.data.getJourneysSettings().stepTransitionSettings.timerDefaults;switch(e){case we.Click:return Number(t.click);case we.Editing:return Number(t.input);case we.ValueChange:return Number(t.valueChange);case we.Hover:return Number(t.hover);case we.Multiple:return Number(t.multiple);case we.Timing:return Number(t.timing);default:return 0}}removeInlineResizeEditor(){this.resizeEditor&&(this.resizeEditor.dispose(),this.resizeEditor=null)}}function bi(e){e.querySelectorAll(".micro-app-container").forEach((e=>{e.remove()})),e.querySelectorAll(".micro-app-placeholder-style").forEach((e=>{e.remove()}))}function wi(e){return JSON.parse(e)}class yi extends zn{constructor(e,t){super(e,t)}renderUI(e){const t=this.createBubbleFrame(e.theme,(t=>{if(t.contentDocument){const n=this.createUI(e,t.contentDocument);this.appendBubble(t.contentDocument,n),this.registerEditing(t.contentDocument,n,e.inlineEditImmediate,e.bounds),this.resizeMonitorElement=Pn.setResizeMonitor(t,this.UIListener.onResized),this.setArrow(t,n,e),this.setPosition(t,e),this.setVisibility(t,e.visible,e.zIndex),this.UIListener.onRendered()}else this.UIListener.onRenderingFailed("Unable to render bubble: Missing bubble iframe.")}));this.appendOrReplaceBubbleFrame("nw-tips",t)}updateUI(e){super.updateUI(e,((t,n)=>{this.updatePosition(e)}))}updatePosition(e){this._bubbleFrame&&(this.setPosition(this._bubbleFrame,e),this.setVisibility(this._bubbleFrame,e.visible,e.zIndex),this.setArrow(this._bubbleFrame,Pn.getBubbleElement(this._bubbleFrame),e),this.setCloseButton(e),this.updateInlineEditor(e))}show(e=0){this.bubbleFrame&&this.setVisible(this.bubbleFrame,e)}hide(){this.bubbleFrame&&(this.setHidden(this.bubbleFrame),this.blur(this.bubbleFrame))}toggleSticky(e){if(this.bubbleFrame){const t=Pn.getBubbleElement(this.bubbleFrame);t&&yi.toggleStickyBubble(t),this.removeCloseButton(),e&&this.addCloseButton()}}setCloseButton(e){e.withCloseButton&&(this.removeCloseButton(),this.addCloseButton())}createContent(e,t){return t.content?super.createContent(e,t):null}registerEditing(e,t,n,i){window.isRunningInEditor&&this.editorListener&&(this.registerInlineEditor(e,t,this.editorListener,i),this.startInlineEditor(n))}hasFooter(e){return!1}appendFooter(e,t,n){}addSpecialClasses(e,t){super.addSpecialClasses(e,t),t.content||e.classList.add(Hn)}setPosition(e,t){super.setPosition(e,t),e.style.zIndex=t.zIndex.toString()}setVisible(e,t){e.style.visibility="visible",e.style.opacity="1",e.style.zIndex=t.toString(),e.style.transition="visibility 0.3s, opacity 0.3s ease-in-out"}setHidden(e){e.style.visibility="hidden",e.style.opacity="0",e.style.zIndex="-1",e.style.transition="visibility 0.3s, opacity 0.3s ease-in-out, z-index 0.3s"}createUI(e,t){const n=super.createUI(e,t);return n.appendChild(this.createArrow(t,e)),e.withCloseButton&&this.createCloseButton(n,(()=>{this.removeCloseButton(),this.UIListener.onClickClose()})),this.setSize(n,e),n}bubbleSizeToPxWidth(e){switch(e){case Jn.Small:return"240px";case Jn.Medium:return"290px";case Jn.Large:return"420px";case Jn.ExtraLarge:return"510px";case Jn.Auto:case null:return"auto";default:return isNaN(e)?"auto":e+"px"}}bubbleSizeToPxMinWidth(e){switch(e){case Jn.Auto:case null:return"96px";default:return this.bubbleSizeToPxWidth(Jn.Small)}}registerInlineEditor(e,t,n,i){null==this.inlineEditor&&this._bubbleFrame&&this._bubbleFrame.contentDocument&&(this.inlineEditor=new fi(window.targetWindow,{dropPositions:[kt.TopCenter,kt.BottomCenter,kt.LeftMiddle,kt.RightMiddle],resizable:!1},this,n,i))}static toggleStickyBubble(e){e.classList.toggle("NW-sticky")}}function vi(e,t,n){if(!t||!t.length)return e;const i=t.filter((e=>e.language===n&&e.kind===It.content));return i&&i.length>0?function(e,t){if(e&&t.textElement&&t.textElement.length>0)try{const n=JSON.parse(t.textElement);n.text=e.value,t.textElement=b.JSON.stringify(n)}catch(e){console.warn("Application text translation apply failed.",t.textElement,e)}return t}(i[0],e):e}!function(e){e.StepEntity="StepEntity",e.TipEntity="TipEntity"}(ni||(ni={})),function(e){e.EntityName="EntityName",e.EntityContent="EntityContent",e.EntityAlign="EntityAlign",e.EntityStepTransition="EntityStepTransition",e.EntityDimension="EntityDimension"}(ii||(ii={}));class Ei{constructor(e){this.subscribers=[],this.monitor=e=>{const t=Ei.getInterestingElements(e);0!=t.length&&this.subscribers.forEach((e=>{e.domChanged(t)}))};new MutationObserver(this.monitor).observe(e.document,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeFilter:["style","class"],attributeOldValue:!0})}static getInstance(e){return Ei.instance||(Ei.instance=new Ei(e)),Ei.instance}addSubscriber(e){this.subscribers.push(e)}static addSubscriber(e,t){this.getInstance(e).addSubscriber(t)}static getInterestingElements(e){let t=[];for(let n=0;n<e.length;n++){const i=e[n];t=t.concat(Ei.evaluateChildListMutation(i)),t=t.concat(Ei.evaluateAttributeMutation(i))}return Ht(t)}static evaluateChildListMutation(e){let t=[];return"childList"==e.type&&(t=t.concat(Ei.filterNodes(e.addedNodes)),t=t.concat(Ei.filterNodes(e.removedNodes))),t}static evaluateAttributeMutation(e){const t=[],n=e.target;return"attributes"!=e.type||1!==n.nodeType||Bt(e.target)||t.push(e.target),t}static filterNodes(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n],r=i;if(!r.isContentEditable){const e=r.muteDomChange;i.nodeType!==Node.ELEMENT_NODE||e||Bt(i)||t.push(i)}}return t}}class Ti{constructor(e){this.targetWindow=e,this.subscribers=[],this.href=window.targetWindow.location.href,Sn.getInstance(e).addMethod((()=>this.monitor()))}static getInstance(e){return Ti.instance||(Ti.instance=new Ti(e)),Ti.instance}addSubscriber(e){this.subscribers.push(e)}static addSubscriber(e,t){this.getInstance(e).addSubscriber(t)}monitor(){const e=window.targetWindow.location.href;e!==this.href&&(console.debug(`____URL CHANGED____ old: "${this.href}" , new: "${e}".`),this.href=e,this.subscribers.forEach((e=>{e.urlChanged()})))}}class Ci{constructor(e){this.targetWindow=e,this.subscribers=[],this.language=window.navigator.language,Sn.getInstance(e).addMethod((()=>this.monitor()))}static getInstance(e){return Ci.instance||(Ci.instance=new Ci(e)),Ci.instance}addSubscriber(e){this.subscribers.push(e)}static addSubscriber(e,t){this.getInstance(e).addSubscriber(t)}monitor(){const e=window.navigator.language;e!==this.language&&(console.debug(`____LANGUAGE CHANGED____ old: "${this.language}" , new: "${e}".`),this.language=e,this.subscribers.forEach((e=>{e.languageChanged()})))}}class Si{constructor(e){this.win=e,this.observers=[],this.eventMap=new xn}removeSubscriber(e){this.observers.forEach((t=>{const n=t.subscribers.indexOf(e);n>-1&&(t.subscribers.splice(n,1),0===t.subscribers.length&&this.unregisterElementChangeEvent(t))})),this.observers=this.observers.filter((e=>e.subscribers.length>0))}indexOfObserver(e,t){for(let n=0;n<e.length;n++)if(e[n].element===t)return n;return-1}unregisterElementChangeEvent(e){this.eventMap.removeEventListener(e.element,"change."+e.id)}registerElementChangeEvent(e){this.eventMap.addEventListener(e.element,"change."+e.id,(t=>{e.subscribers.forEach((e=>{e.onChange()}))}))}registerElementObserver(e,t){const n=this.indexOfObserver(this.observers,t);if(-1===n){const n={id:bn(),element:t,subscribers:[e]};this.observers.push(n),this.registerElementChangeEvent(n)}else this.observers[n].subscribers.push(e)}addSubscriber(e){const t=wt(this.win,e.parameter);t?this.registerElementObserver(e,t.element):console.debug("ElementsMonitor: Element not found for subscriber",e)}}!function(e){e.Content="Content",e.Element="Element",e.Url="Url",e.BrowserLanguage="BrowserLanguage"}(ri||(ri={}));class Ii{constructor(e){this.targetWindow=e,this.subscribers=[],Ei.addSubscriber(e,this),Ti.addSubscriber(e,this),Ci.addSubscriber(e,this),this.elementsMonitor=new Si(e)}static getInstance(e){return Ii.instance||(Ii.instance=new Ii(e)),Ii.instance}registerSubscriberWithIdentikit(e){xi(e.parameter)&&this.elementsMonitor.addSubscriber(e)}addSubscriber(e){if(!qt(this.subscribers,e))throw new Error(`Subscriber already registered [${b.JSON.stringify(e)}].`);e.type!==ri.Content&&e.type!==ri.Element||this.registerSubscriberWithIdentikit(e),this.subscribers.push(e)}removeSubscriber(e){const t=this.subscribers.indexOf(e);if(-1===t)throw new Error(`Subscriber not found [${b.JSON.stringify(this.subscribers)}].`);e.type!==ri.Content&&e.type!==ri.Element||this.elementsMonitor.removeSubscriber(e),this.subscribers.splice(t,1)}static addSubscriber(e,t){this.getInstance(e).addSubscriber(t)}static removeSubscriber(e){this.instance.removeSubscriber(e)}matchMutationsToElement(e,t){const n=e.parameter;if(xi(n))return;const i=wt(this.targetWindow,n);if(!i)return void e.onChange();const r=i.element;for(const n of t)if(n===r||n.contains(r))return void e.onChange();console.debug("____DOM CHANGED____  unrelated mutations",t,i)}domChanged(e){this.subscribers.forEach((t=>{switch(t.type){case ri.Element:case ri.Content:this.matchMutationsToElement(t,e)}}))}urlChanged(){this.subscribers.filter((e=>e.type===ri.Url)).forEach((e=>{e.onChange()}))}languageChanged(){this.subscribers.filter((e=>e.type===ri.BrowserLanguage)).forEach((e=>{e.onChange()}))}}function xi(e){let t;return e.elementDescription&&(t=JSON.parse(e.elementDescription).tagname.toUpperCase()),"INPUT"===t||"SELECT"===t||"TEXTAREA"===t}function Li(e,t){return t.Or&&e in t.Or||t.And&&e in t.And}function ki(e){for(const t in oi)if(Li(t,e))return!0;return!1}function Di(e){for(const t in ai)if(Li(t,e))return!0;return!1}function Pi(e){for(const t in li)if(Li(t,e))return!0;return!1}function Ni(e){return ki(e)?5:Di(e)?4:Ai(e)?3:Oi(e)?2:Pi(e)?1:-1}function Ai(e){for(const t in ui)if(Li(t,e))return!0;return!1}function Oi(e){for(const t in ci)if(Li(t,e))return!0;return!1}function Mi(e){if(ki(e)||Di(e)){return function(e){const t=Object.keys(e);if(t&&1===t.length)return JSON.parse(e[t[0]]);throw new Error(`Invalid rule operator: ${JSON.stringify(e)}. Identikit can not be parsed`)}(e.And?e.And:e.Or)}if(Oi(e)){return function(e){const t=Object.keys(e);if(t&&1===t.length)return e[t[0]];throw new Error(`Invalid rule operator: ${JSON.stringify(e)}. Custom property can not be parsed.`)}(e.And?e.And:e.Or)}return null}function _i(e){const t=JSON.parse(e);return console.assert(Fi(t)||Bi(t),`Invalid rules. Must be either And or Or group rule. Rules: ${e}.`),t}function Ri(e){const t=function(e){for(const t in oi)if(Li(t,e))return t;return null}(e)||function(e){for(const t in ci)if(Li(t,e))return t;return null}(e);if(t)return t;throw new Error(`Invalid / Not implemented rule ${e}. No match for operator key.`)}function Bi(e){let t;return t="string"==typeof e?_i(e):e,t.every((e=>void 0!==e.Or))}function Fi(e){let t;return t="string"==typeof e?_i(e):e,t.every((e=>void 0!==e.And))}!function(e){e.And="And",e.Or="Or"}(si||(si={})),function(e){e.TextContentEquals="TextContentEquals",e.TextContentNotEquals="TextContentNotEquals",e.TextContentContains="TextContentContains",e.TextContentNotContains="TextContentNotContains",e.TextContentStartsWith="TextContentStartsWith",e.TextContentEndsWith="TextContentEndsWith",e.TextContentNotStartsWith="TextContentNotStartsWith",e.TextContentNotEndsWith="TextContentNotEndsWith",e.TextContentPattern="TextContentPattern",e.TextInsensitiveContentEquals="TextInsensitiveContentEquals",e.TextInsensitiveContentNotEquals="TextInsensitiveContentNotEquals",e.TextInsensitiveContentContains="TextInsensitiveContentContains",e.TextInsensitiveContentNotContains="TextInsensitiveContentNotContains",e.TextInsensitiveContentStartsWith="TextInsensitiveContentStartsWith",e.TextInsensitiveContentEndsWith="TextInsensitiveContentEndsWith",e.TextInsensitiveContentNotStartsWith="TextInsensitiveContentNotStartsWith",e.TextInsensitiveContentNotEndsWith="TextInsensitiveContentNotEndsWith",e.TextInsensitiveContentPattern="TextInsensitiveContentPattern",e.DecimalContentGreater="DecimalContentGreater",e.DecimalContentGreaterOrEqual="DecimalContentGreaterOrEqual",e.DecimalContentLess="DecimalContentLess",e.DecimalContentLessOrEqual="DecimalContentLessOrEqual",e.DecimalContentEquals="DecimalContentEquals",e.DecimalContentNotEquals="DecimalContentNotEquals",e.IntegerContentGreater="IntegerContentGreater",e.IntegerContentGreaterOrEqual="IntegerContentGreaterOrEqual",e.IntegerContentLess="IntegerContentLess",e.IntegerContentLessOrEqual="IntegerContentLessOrEqual",e.IntegerContentEquals="IntegerContentEquals",e.IntegerContentNotEquals="IntegerContentNotEquals",e.CheckboxContentIsChecked="CheckboxContentIsChecked",e.CheckboxContentIsUnChecked="CheckboxContentIsUnChecked",e.DateContentEquals="DateContentEquals",e.DateContentNotEquals="DateContentNotEquals",e.DateContentBefore="DateContentBefore",e.DateContentAfter="DateContentAfter",e.DateContentXDaysBeforeNow="DateContentXDaysBeforeNow",e.DateContentXDaysAfterNow="DateContentXDaysAfterNow",e.DateTimeContentEquals="DateTimeContentEquals",e.DateTimeContentNotEquals="DateTimeContentNotEquals",e.DateTimeContentBefore="DateTimeContentBefore",e.DateTimeContentAfter="DateTimeContentAfter",e.DateTimeContentXDaysBeforeNow="DateTimeContentXDaysBeforeNow",e.DateTimeContentXDaysAfterNow="DateTimeContentXDaysAfterNow",e.TimeContentEquals="TimeContentEquals",e.TimeContentNotEquals="TimeContentNotEquals",e.TimeContentBefore="TimeContentBefore",e.TimeContentAfter="TimeContentAfter"}(oi||(oi={})),function(e){e.ElementIsPresent="ElementIsPresent",e.ElementIsNotPresent="ElementIsNotPresent",e.ElementIsEnabled="ElementIsEnabled",e.ElementIsDisabled="ElementIsDisabled",e.ElementHasOptions="ElementHasOptions",e.ElementHasNotOptions="ElementHasNotOptions"}(ai||(ai={})),function(e){e.UrlEquals="UrlEquals",e.UrlNotEquals="UrlNotEquals",e.UrlContains="UrlContains",e.UrlNotContains="UrlNotContains"}(li||(li={})),function(e){e.LanguageCodeIs="LanguageCodeIs",e.LanguageCodeIsNot="LanguageCodeIsNot"}(ui||(ui={})),function(e){e.CustomPropertyEquals="CustomPropertyEquals",e.CustomPropertyNotEquals="CustomPropertyNotEquals",e.CustomPropertyContains="CustomPropertyContains",e.CustomPropertyNotContains="CustomPropertyNotContains"}(ci||(ci={}));class Ui{constructor(e,t,n,i){this.type=e,this.targetWindow=t,this._parameter=n,this.onRuleChanged=i}subscribe(){Ii.addSubscriber(this.targetWindow,this)}unsubscribe(){Ii.removeSubscriber(this)}get parameter(){return this._parameter}onChange(){this.onRuleChanged()}}function Wi(e,t,n){const i=_i(t),r=[];return i.forEach((t=>{Oi(t)||r.push(new Ui(function(e){if(ki(e))return ri.Content;if(Di(e))return ri.Element;if(Pi(e))return ri.Url;if(Ai(e))return ri.BrowserLanguage;throw new Error(`Invalid rule operator: ${e}.`)}(t),e,Mi(t),n))})),r}class Ji{constructor(e,t,n){this.onRuleChanged=n,this.subscribers=Wi(e,t,n)}stop(){this.subscribers.forEach((e=>{e.unsubscribe()}))}start(){this.subscribers.forEach((e=>{e.subscribe()}))}}!function(e){e.Button="Button",e.Text="Text",e.Image="Image",e.Checkbox="Checkbox",e.RadioButton="RadioButton",e.Link="Link",e.Dropdown="Dropdown",e.Element="Element",e.Video="Video",e.Table="Table",e.TableCell="TableCell",e.TableHeader="TableHeader",e.TableRow="TableRow",e.Header="Header"}(hi||(hi={})),function(e){e.Submit="submit",e.Button="button",e.Radio="radio",e.Checkbox="checkbox",e.Number="number",e.Text="text"}(di||(di={}));class Hi{constructor(e){this.result=Hi.defaultElementInfo,this.element=e,this.tag=this.element.tagName.toLowerCase(),this.nodeType=e.nodeType}static fromElement(e){return new Hi(e).create()}create(){return 1===this.nodeType&&this.prepareElementInfo(),this.result}prepareElementInfo(){this.prepareElementType(),this.prepareInfo(),this.prepareHardAttributes()}set type(e){this.result.type=e}set text(e){this.result.info.text=e}set checked(e){this.result.info.checked=e}set selected(e){this.result.info.selected=e}set selectedLabel(e){this.result.info.selectedLabel=e}set options(e){this.result.info.options=e}set disabled(e){this.result.info.disabled=e}set hardAttributes(e){this.result.hardAttributes=e}prepareHardAttributes(){this.hardAttributes=["class","tabindex","title"].concat(this.getElementSpecificHardAttributes())}getElementSpecificHardAttributes(){switch(this.tag.toLowerCase()){case"form":return["action"];case"blockquote":case"del":case"ins":case"q":return["cite"];case"applet":return["code","object"];case"label":case"output":return["for","form"];case"button":return["form","value"];case"meter":case"select":return["form"];case"textarea":return["form","name"];case"input":return Ke(this.element)?["form","formaction","src","name","type","value"]:["form","formaction","src","name","type"];case"fieldset":return["form","name"];case"a":case"area":case"base":case"link":return["href"];case"param":return["name"];case"audio":case"embed":case"iframe":case"script":case"track":case"video":return["src"];case"img":return["src","alt"];case"source":return["src","srcset"];default:return[]}}prepareInputInfo(){const e=this.element;switch(e.type.toLowerCase()){case di.Radio:case di.Checkbox:this.checked=e.checked;break;case di.Submit:case di.Button:case di.Number:case di.Text:default:this.text=e.value}}prepareDropdownInfo(){const e=this.element,t=Array.from(e.options).map((function(e){return e.label}));this.selected=e.value,this.selectedLabel=e.options[e.options.selectedIndex].label,this.options=t}prepareInfo(){switch(this.disabled=!!this.element.getAttribute("disabled"),this.tag){case pi.Input:this.prepareInputInfo();break;case pi.Select:this.prepareDropdownInfo();break;default:this.text=Ye(this.element)}}prepareElementType(){switch(this.tag){case pi.Button:this.type=hi.Button;break;case pi.Input:switch(this.element.type.toLowerCase()){case di.Submit:case di.Button:this.type=hi.Button;break;case di.Radio:this.type=hi.RadioButton;break;case di.Number:case di.Text:default:this.type=hi.Element}break;case pi.H1:case pi.H2:case pi.H3:case pi.H4:case pi.H5:case pi.H6:this.type=hi.Header;break;case pi.P:case pi.B:case pi.Label:case pi.TextArea:case pi.Abbr:case pi.Acronym:case pi.Bdi:case pi.Bdo:case pi.Big:case pi.Blockquote:case pi.Caption:case pi.Center:case pi.Cite:case pi.Code:case pi.Data:case pi.Dt:case pi.Dd:case pi.Df:case pi.Del:case pi.Em:case pi.FigCaption:case pi.Font:case pi.I:case pi.Ins:case pi.Kbd:case pi.Legend:case pi.Li:case pi.Mark:case pi.NoFrame:case pi.NoScript:case pi.Output:case pi.Pre:case pi.Q:case pi.S:case pi.Samp:case pi.Small:case pi.Strike:case pi.Strong:case pi.Sub:case pi.Summary:case pi.Sup:case pi.Title:case pi.TT:case pi.U:case pi.Var:case pi.Wbr:case pi.Div:case pi.Span:case pi.Article:case pi.Aside:case pi.Body:case pi.Footer:case pi.Head:case pi.Header:case pi.Main:case pi.Nav:case pi.Ol:case pi.Section:case pi.TBody:case pi.TFoot:case pi.Ul:this.type=Qe(this.element)?hi.Text:hi.Element;break;case pi.A:this.type=hi.Link;break;case pi.Select:this.type=hi.Dropdown;break;case pi.Img:this.type=hi.Image;break;case pi.Video:this.type=hi.Video;break;case pi.Tr:this.type=hi.TableRow;break;case pi.Th:this.type=hi.TableHeader;break;case pi.Td:this.type=hi.TableCell;break;case pi.Table:this.type=hi.Table;break;default:this.type=hi.Text}}}function qi(e,t,n,i){zi(e,t,((t,r)=>{n(null!==t&&i(t,e.conditionValue),r)}))}function ji(e){const t=Hi.fromElement(e);return"Dropdown"===t.type?t.info.selectedLabel||"":t.info.text||""}function zi(e,t,n){try{const i={xpathSelector:!1,elementId:!0,cssSelector:!1,attributesSelector:!0,attributesClassSelector:!0};e.hasOwnProperty("matcherOptions")||(e.matcherOptions=i);let r=0;const s=Math.floor(t.searchTime/t.searchRetryInterval),o=()=>{const i=wt(t.targetWindow,e);i?n(i.element,t):r++<s?b.setTimeout((()=>{t.searchTime-=t.searchRetryInterval,o()}),t.searchRetryInterval):n(null,t)};o()}catch(e){console.warn("Error during find element in page. ",e),n(null,t)}}function $i(e){return{targetWindow:e,searchTime:0,searchRetryInterval:1}}function Vi(e,t,n){const i=n.searchAttempts*n.searchRepeatInterval;return{targetWindow:e,searchTime:Gi(t)?i+1e3*n.extraWait:i,searchRetryInterval:n.searchRepeatInterval}}function Gi(e){for(const t of e){const e=_i(t.rules);for(const t of e){const e=Mi(t);if(e)return!!(e.path&&e.path.length>0)}}return!1}function Xi(e){return"INPUT"===e.tagName.toUpperCase()}function Yi(e){return e?e.toUpperCase():""}function Qi(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?n===t:n.toUpperCase()===Yi(t)}))}function Ki(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?n!==t:n.toUpperCase()!==Yi(t)}))}function Zi(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?-1!==n.indexOf(t):-1!==n.toUpperCase().indexOf(Yi(t))}))}function er(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?-1==n.indexOf(t):-1==n.toUpperCase().indexOf(Yi(t))}))}function tr(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?n.startsWith(t):n.toUpperCase().startsWith(Yi(t))}))}function nr(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?!n.startsWith(t):!n.toUpperCase().startsWith(Yi(t))}))}function ir(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?n.endsWith(t):n.toUpperCase().endsWith(Yi(t))}))}function rr(e,t,n,i=!0){qi(e,t,n,(function(e,t){const n=ji(e);return i?!n.endsWith(t):!n.toUpperCase().endsWith(Yi(t))}))}function sr(e,t,n,i=!0){qi(e,t,n,(function(e,t){let n;n=i?new RegExp(t):new RegExp(t,"i");const r=ji(e);return n.test(r)}))}function or(e,t,n,i){if(e){if(i&&(e=e.replace(/\s/g,"")),t&&(","===n&&-1!==e.indexOf(".")||","!==n&&"."!==n))return NaN;t&&","===n&&(e=e.replace(n,"."));if(RegExp(/^-?(0|[1-9]\d*)?(\.\d+)?(e-?(0|[1-9]\d*))?$/i).test(e)&&!isNaN(Number(e)))return t?parseFloat(e):parseInt(e)}return NaN}function ar(e,t,n,i){const r=function(e){if(Xi(e)){return e.valueAsNumber}return NaN}(e);if(isNaN(r)){return or(ji(e),t,n,i)}return r}function lr(e,t,n,i,r,s){const o=ar(i,e,t,n),a=or(r,e,".",!1);return!isNaN(o)&&!isNaN(a)&&s(o,a)}function ur(e,t,n,i,r,s){qi(e,t,s,(function(e,t){return lr(n,i,r,e,t,((e,t)=>e===t))}))}function cr(e,t,n,i,r,s){qi(e,t,s,(function(e,t){return lr(n,i,r,e,t,((e,t)=>e!==t))}))}function hr(e,t,n,i,r,s){qi(e,t,s,(function(e,t){return lr(n,i,r,e,t,((e,t)=>e>t))}))}function dr(e,t,n,i,r,s){qi(e,t,s,(function(e,t){return lr(n,i,r,e,t,((e,t)=>e>=t))}))}function pr(e,t,n,i,r,s){qi(e,t,s,(function(e,t){return lr(n,i,r,e,t,((e,t)=>e<t))}))}function gr(e,t,n,i,r,s){qi(e,t,s,(function(e,t){return lr(n,i,r,e,t,((e,t)=>e<=t))}))}function mr(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function fr(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function br(e){fr(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function wr(e,t){fr(2,arguments);var n=br(e),i=mr(t);return isNaN(i)?new Date(NaN):i?(n.setDate(n.getDate()+i),n):n}function yr(e,t){fr(2,arguments);var n=br(e),i=mr(t);if(isNaN(i))return new Date(NaN);if(!i)return n;var r=n.getDate(),s=new Date(n.getTime());s.setMonth(n.getMonth()+i+1,0);var o=s.getDate();return r>=o?s:(n.setFullYear(s.getFullYear(),s.getMonth(),r),n)}function vr(e,t){if(fr(2,arguments),!t||"object"!=typeof t)return new Date(NaN);var n="years"in t?mr(t.years):0,i="months"in t?mr(t.months):0,r="weeks"in t?mr(t.weeks):0,s="days"in t?mr(t.days):0,o="hours"in t?mr(t.hours):0,a="minutes"in t?mr(t.minutes):0,l="seconds"in t?mr(t.seconds):0,u=br(e),c=i||n?yr(u,i+12*n):u,h=s||r?wr(c,s+7*r):c,d=a+60*o,p=l+60*d,g=1e3*p,m=new Date(h.getTime()+g);return m}function Er(e,t){fr(2,arguments);var n=br(e).getTime(),i=mr(t);return new Date(n+i)}function Tr(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Cr(e){fr(1,arguments);var t=br(e);return!isNaN(t)}Hi.defaultElementInfo={type:hi.Element,info:{disabled:!1,text:null},hardAttributes:[]},function(e){e.Button="button",e.Input="input",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.P="p",e.B="b",e.Label="label",e.TextArea="textarea",e.Abbr="abbr",e.Acronym="acronym",e.Bdi="bdi",e.Bdo="bdo",e.Big="big",e.Blockquote="blockquote",e.Caption="caption",e.Center="center",e.Cite="cite",e.Code="code",e.Data="data",e.Dt="dt",e.Dd="dd",e.Df="df",e.Del="del",e.Em="em",e.FigCaption="figcaption",e.Font="font",e.I="i",e.Ins="ins",e.Kbd="kbd",e.Legend="legend",e.Li="li",e.Mark="mark",e.NoFrame="noframe",e.NoScript="noscript",e.Output="output",e.Pre="pre",e.Q="q",e.S="s",e.Samp="samp",e.Small="small",e.Strike="strike",e.Strong="strong",e.Sub="sub",e.Summary="summary",e.Sup="sup",e.Title="title",e.TT="tt",e.U="u",e.Var="var",e.Wbr="wbr",e.A="a",e.Select="select",e.Div="div",e.Span="span",e.Article="article",e.Aside="aside",e.Body="body",e.Footer="footer",e.Head="head",e.Header="header",e.Main="main",e.Nav="nav",e.Ol="ol",e.Section="section",e.TBody="tbody",e.TFoot="tfoot",e.Ul="ul",e.Img="img",e.Video="video",e.Tr="tr",e.Th="th",e.Td="td",e.Table="table"}(pi||(pi={}));var Sr={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Ir(e){return function(t){var n=t||{},i=n.width?String(n.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}var xr={date:Ir({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Ir({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Ir({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Lr={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function kr(e){return function(t,n){var i,r=n||{};if("formatting"===(r.context?String(r.context):"standalone")&&e.formattingValues){var s=e.defaultFormattingWidth||e.defaultWidth,o=r.width?String(r.width):s;i=e.formattingValues[o]||e.formattingValues[s]}else{var a=e.defaultWidth,l=r.width?String(r.width):e.defaultWidth;i=e.values[l]||e.values[a]}return i[e.argumentCallback?e.argumentCallback(t):t]}}function Dr(e){return function(t,n){var i=String(t),r=n||{},s=r.width,o=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],a=i.match(o);if(!a)return null;var l,u=a[0],c=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth];return l="[object Array]"===Object.prototype.toString.call(c)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(c,(function(e){return e.test(u)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(c,(function(e){return e.test(u)})),l=e.valueCallback?e.valueCallback(l):l,{value:l=r.valueCallback?r.valueCallback(l):l,rest:i.slice(u.length)}}}var Pr,Nr={code:"en-US",formatDistance:function(e,t,n){var i;return n=n||{},i="string"==typeof Sr[e]?Sr[e]:1===t?Sr[e].one:Sr[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+i:i+" ago":i},formatLong:xr,formatRelative:function(e,t,n,i){return Lr[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:kr({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:kr({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:kr({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:kr({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:kr({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Pr={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),i=t||{},r=n.match(Pr.matchPattern);if(!r)return null;var s=r[0],o=n.match(Pr.parsePattern);if(!o)return null;var a=Pr.valueCallback?Pr.valueCallback(o[0]):o[0];return{value:a=i.valueCallback?i.valueCallback(a):a,rest:n.slice(s.length)}}),era:Dr({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Dr({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Dr({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Dr({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Dr({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ar(e,t){fr(2,arguments);var n=mr(t);return Er(e,-n)}function Or(e,t){for(var n=e<0?"-":"",i=Math.abs(e).toString();i.length<t;)i="0"+i;return n+i}var Mr=function(e,t){var n=e.getUTCFullYear(),i=n>0?n:1-n;return Or("yy"===t?i%100:i,t.length)},_r=function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):Or(n+1,2)},Rr=function(e,t){return Or(e.getUTCDate(),t.length)},Br=function(e,t){return Or(e.getUTCHours()%12||12,t.length)},Fr=function(e,t){return Or(e.getUTCHours(),t.length)},Ur=function(e,t){return Or(e.getUTCMinutes(),t.length)},Wr=function(e,t){return Or(e.getUTCSeconds(),t.length)},Jr=function(e,t){var n=t.length,i=e.getUTCMilliseconds();return Or(Math.floor(i*Math.pow(10,n-3)),t.length)},Hr=864e5;function qr(e){fr(1,arguments);var t=1,n=br(e),i=n.getUTCDay(),r=(i<t?7:0)+i-t;return n.setUTCDate(n.getUTCDate()-r),n.setUTCHours(0,0,0,0),n}function jr(e){fr(1,arguments);var t=br(e),n=t.getUTCFullYear(),i=new Date(0);i.setUTCFullYear(n+1,0,4),i.setUTCHours(0,0,0,0);var r=qr(i),s=new Date(0);s.setUTCFullYear(n,0,4),s.setUTCHours(0,0,0,0);var o=qr(s);return t.getTime()>=r.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function zr(e){fr(1,arguments);var t=jr(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var i=qr(n);return i}var $r=6048e5;function Vr(e){fr(1,arguments);var t=br(e),n=qr(t).getTime()-zr(t).getTime();return Math.round(n/$r)+1}function Gr(e,t){fr(1,arguments);var n=t||{},i=n.locale,r=i&&i.options&&i.options.weekStartsOn,s=null==r?0:mr(r),o=null==n.weekStartsOn?s:mr(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var a=br(e),l=a.getUTCDay(),u=(l<o?7:0)+l-o;return a.setUTCDate(a.getUTCDate()-u),a.setUTCHours(0,0,0,0),a}function Xr(e,t){fr(1,arguments);var n=br(e,t),i=n.getUTCFullYear(),r=t||{},s=r.locale,o=s&&s.options&&s.options.firstWeekContainsDate,a=null==o?1:mr(o),l=null==r.firstWeekContainsDate?a:mr(r.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=new Date(0);u.setUTCFullYear(i+1,0,l),u.setUTCHours(0,0,0,0);var c=Gr(u,t),h=new Date(0);h.setUTCFullYear(i,0,l),h.setUTCHours(0,0,0,0);var d=Gr(h,t);return n.getTime()>=c.getTime()?i+1:n.getTime()>=d.getTime()?i:i-1}function Yr(e,t){fr(1,arguments);var n=t||{},i=n.locale,r=i&&i.options&&i.options.firstWeekContainsDate,s=null==r?1:mr(r),o=null==n.firstWeekContainsDate?s:mr(n.firstWeekContainsDate),a=Xr(e,t),l=new Date(0);l.setUTCFullYear(a,0,o),l.setUTCHours(0,0,0,0);var u=Gr(l,t);return u}var Qr=6048e5;function Kr(e,t){fr(1,arguments);var n=br(e),i=Gr(n,t).getTime()-Yr(n,t).getTime();return Math.round(i/Qr)+1}var Zr="midnight",es="noon",ts="morning",ns="afternoon",is="evening",rs="night",ss={G:function(e,t,n){var i=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(i,{width:"abbreviated"});case"GGGGG":return n.era(i,{width:"narrow"});case"GGGG":default:return n.era(i,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var i=e.getUTCFullYear(),r=i>0?i:1-i;return n.ordinalNumber(r,{unit:"year"})}return Mr(e,t)},Y:function(e,t,n,i){var r=Xr(e,i),s=r>0?r:1-r;return"YY"===t?Or(s%100,2):"Yo"===t?n.ordinalNumber(s,{unit:"year"}):Or(s,t.length)},R:function(e,t){return Or(jr(e),t.length)},u:function(e,t){return Or(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(i);case"QQ":return Or(i,2);case"Qo":return n.ordinalNumber(i,{unit:"quarter"});case"QQQ":return n.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(i,{width:"wide",context:"formatting"})}},q:function(e,t,n){var i=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(i);case"qq":return Or(i,2);case"qo":return n.ordinalNumber(i,{unit:"quarter"});case"qqq":return n.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(i,{width:"wide",context:"standalone"})}},M:function(e,t,n){var i=e.getUTCMonth();switch(t){case"M":case"MM":return _r(e,t);case"Mo":return n.ordinalNumber(i+1,{unit:"month"});case"MMM":return n.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(i,{width:"wide",context:"formatting"})}},L:function(e,t,n){var i=e.getUTCMonth();switch(t){case"L":return String(i+1);case"LL":return Or(i+1,2);case"Lo":return n.ordinalNumber(i+1,{unit:"month"});case"LLL":return n.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(i,{width:"wide",context:"standalone"})}},w:function(e,t,n,i){var r=Kr(e,i);return"wo"===t?n.ordinalNumber(r,{unit:"week"}):Or(r,t.length)},I:function(e,t,n){var i=Vr(e);return"Io"===t?n.ordinalNumber(i,{unit:"week"}):Or(i,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):Rr(e,t)},D:function(e,t,n){var i=function(e){fr(1,arguments);var t=br(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var i=t.getTime(),r=n-i;return Math.floor(r/Hr)+1}(e);return"Do"===t?n.ordinalNumber(i,{unit:"dayOfYear"}):Or(i,t.length)},E:function(e,t,n){var i=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(i,{width:"short",context:"formatting"});case"EEEE":default:return n.day(i,{width:"wide",context:"formatting"})}},e:function(e,t,n,i){var r=e.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return Or(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"});case"eeee":default:return n.day(r,{width:"wide",context:"formatting"})}},c:function(e,t,n,i){var r=e.getUTCDay(),s=(r-i.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return Or(s,t.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"});case"cccc":default:return n.day(r,{width:"wide",context:"standalone"})}},i:function(e,t,n){var i=e.getUTCDay(),r=0===i?7:i;switch(t){case"i":return String(r);case"ii":return Or(r,t.length);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return n.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(i,{width:"short",context:"formatting"});case"iiii":default:return n.day(i,{width:"wide",context:"formatting"})}},a:function(e,t,n){var i=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var i,r=e.getUTCHours();switch(i=12===r?es:0===r?Zr:r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){var i,r=e.getUTCHours();switch(i=r>=17?is:r>=12?ns:r>=4?ts:rs,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var i=e.getUTCHours()%12;return 0===i&&(i=12),n.ordinalNumber(i,{unit:"hour"})}return Br(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Fr(e,t)},K:function(e,t,n){var i=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(i,{unit:"hour"}):Or(i,t.length)},k:function(e,t,n){var i=e.getUTCHours();return 0===i&&(i=24),"ko"===t?n.ordinalNumber(i,{unit:"hour"}):Or(i,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Ur(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Wr(e,t)},S:function(e,t){return Jr(e,t)},X:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return as(r);case"XXXX":case"XX":return ls(r);case"XXXXX":case"XXX":default:return ls(r,":")}},x:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"x":return as(r);case"xxxx":case"xx":return ls(r);case"xxxxx":case"xxx":default:return ls(r,":")}},O:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+os(r,":");case"OOOO":default:return"GMT"+ls(r,":")}},z:function(e,t,n,i){var r=(i._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+os(r,":");case"zzzz":default:return"GMT"+ls(r,":")}},t:function(e,t,n,i){var r=i._originalDate||e;return Or(Math.floor(r.getTime()/1e3),t.length)},T:function(e,t,n,i){return Or((i._originalDate||e).getTime(),t.length)}};function os(e,t){var n=e>0?"-":"+",i=Math.abs(e),r=Math.floor(i/60),s=i%60;if(0===s)return n+String(r);var o=t||"";return n+String(r)+o+Or(s,2)}function as(e,t){return e%60==0?(e>0?"-":"+")+Or(Math.abs(e)/60,2):ls(e,t)}function ls(e,t){var n=t||"",i=e>0?"-":"+",r=Math.abs(e);return i+Or(Math.floor(r/60),2)+n+Or(r%60,2)}function us(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}}function cs(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}}var hs={p:cs,P:function(e,t){var n,i=e.match(/(P+)(p+)?/),r=i[1],s=i[2];if(!s)return us(e,t);switch(r){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;case"PPPP":default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",us(r,t)).replace("{{time}}",cs(s,t))}},ds=["D","DD"],ps=["YY","YYYY"];function gs(e){return-1!==ds.indexOf(e)}function ms(e){return-1!==ps.indexOf(e)}function fs(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://git.io/fxCyr"))}var bs=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ws=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ys=/^'([^]*?)'?$/,vs=/''/g,Es=/[a-zA-Z]/;function Ts(e,t,n){fr(2,arguments);var i=String(t),r=n||{},s=r.locale||Nr,o=s.options&&s.options.firstWeekContainsDate,a=null==o?1:mr(o),l=null==r.firstWeekContainsDate?a:mr(r.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=s.options&&s.options.weekStartsOn,c=null==u?0:mr(u),h=null==r.weekStartsOn?c:mr(r.weekStartsOn);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!s.localize)throw new RangeError("locale must contain localize property");if(!s.formatLong)throw new RangeError("locale must contain formatLong property");var d=br(e);if(!Cr(d))throw new RangeError("Invalid time value");var p=Tr(d),g=Ar(d,p),m={firstWeekContainsDate:l,weekStartsOn:h,locale:s,_originalDate:d},f=i.match(ws).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,hs[t])(e,s.formatLong,m):e})).join("").match(bs).map((function(n){if("''"===n)return"'";var i=n[0];if("'"===i)return Cs(n);var o=ss[i];if(o)return!r.useAdditionalWeekYearTokens&&ms(n)&&fs(n,t,e),!r.useAdditionalDayOfYearTokens&&gs(n)&&fs(n,t,e),o(g,n,s.localize,m);if(i.match(Es))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return n})).join("");return f}function Cs(e){return e.match(ys)[1].replace(vs,"'")}function Ss(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function Is(e){fr(1,arguments);var t=br(e),n=t.getFullYear(),i=t.getMonth(),r=new Date(0);return r.setFullYear(n,i+1,0),r.setHours(0,0,0,0),r.getDate()}function xs(e,t){fr(2,arguments);var n=br(e),i=br(t);return n.getTime()>i.getTime()}function Ls(e,t){fr(2,arguments);var n=br(e),i=br(t);return n.getTime()<i.getTime()}function ks(e,t){fr(2,arguments);var n=br(e),i=br(t);return n.getTime()===i.getTime()}function Ds(e,t,n){fr(2,arguments);var i=n||{},r=i.locale,s=r&&r.options&&r.options.weekStartsOn,o=null==s?0:mr(s),a=null==i.weekStartsOn?o:mr(i.weekStartsOn);if(!(a>=0&&a<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var l=br(e),u=mr(t),c=l.getUTCDay(),h=u%7,d=(h+7)%7,p=(d<a?7:0)+u-c;return l.setUTCDate(l.getUTCDate()+p),l}var Ps=/^(1[0-2]|0?\d)/,Ns=/^(3[0-1]|[0-2]?\d)/,As=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,Os=/^(5[0-3]|[0-4]?\d)/,Ms=/^(2[0-3]|[0-1]?\d)/,_s=/^(2[0-4]|[0-1]?\d)/,Rs=/^(1[0-1]|0?\d)/,Bs=/^(1[0-2]|0?\d)/,Fs=/^[0-5]?\d/,Us=/^[0-5]?\d/,Ws=/^\d/,Js=/^\d{1,2}/,Hs=/^\d{1,3}/,qs=/^\d{1,4}/,js=/^-?\d+/,zs=/^-?\d/,$s=/^-?\d{1,2}/,Vs=/^-?\d{1,3}/,Gs=/^-?\d{1,4}/,Xs=/^([+-])(\d{2})(\d{2})?|Z/,Ys=/^([+-])(\d{2})(\d{2})|Z/,Qs=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,Ks=/^([+-])(\d{2}):(\d{2})|Z/,Zs=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function eo(e,t,n){var i=t.match(e);if(!i)return null;var r=parseInt(i[0],10);return{value:n?n(r):r,rest:t.slice(i[0].length)}}function to(e,t){var n=t.match(e);return n?"Z"===n[0]?{value:0,rest:t.slice(1)}:{value:("+"===n[1]?1:-1)*(36e5*(n[2]?parseInt(n[2],10):0)+6e4*(n[3]?parseInt(n[3],10):0)+1e3*(n[5]?parseInt(n[5],10):0)),rest:t.slice(n[0].length)}:null}function no(e,t){return eo(js,e,t)}function io(e,t,n){switch(e){case 1:return eo(Ws,t,n);case 2:return eo(Js,t,n);case 3:return eo(Hs,t,n);case 4:return eo(qs,t,n);default:return eo(new RegExp("^\\d{1,"+e+"}"),t,n)}}function ro(e,t,n){switch(e){case 1:return eo(zs,t,n);case 2:return eo($s,t,n);case 3:return eo(Vs,t,n);case 4:return eo(Gs,t,n);default:return eo(new RegExp("^-?\\d{1,"+e+"}"),t,n)}}function so(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function oo(e,t){var n,i=t>0,r=i?t:1-t;if(r<=50)n=e||100;else{var s=r+50;n=e+100*Math.floor(s/100)-(e>=s%100?100:0)}return i?n:1-n}var ao=[31,28,31,30,31,30,31,31,30,31,30,31],lo=[31,29,31,30,31,30,31,31,30,31,30,31];function uo(e){return e%400==0||e%4==0&&e%100!=0}var co,ho,po={G:{priority:140,parse:function(e,t,n,i){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});case"GGGG":default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}},set:function(e,t,n,i){return t.era=n,e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["R","u","t","T"]},y:{priority:130,parse:function(e,t,n,i){var r=function(e){return{year:e,isTwoDigitYear:"yy"===t}};switch(t){case"y":return io(4,e,r);case"yo":return n.ordinalNumber(e,{unit:"year",valueCallback:r});default:return io(t.length,e,r)}},validate:function(e,t,n){return t.isTwoDigitYear||t.year>0},set:function(e,t,n,i){var r=e.getUTCFullYear();if(n.isTwoDigitYear){var s=oo(n.year,r);return e.setUTCFullYear(s,0,1),e.setUTCHours(0,0,0,0),e}var o="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(o,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","u","w","I","i","e","c","t","T"]},Y:{priority:130,parse:function(e,t,n,i){var r=function(e){return{year:e,isTwoDigitYear:"YY"===t}};switch(t){case"Y":return io(4,e,r);case"Yo":return n.ordinalNumber(e,{unit:"year",valueCallback:r});default:return io(t.length,e,r)}},validate:function(e,t,n){return t.isTwoDigitYear||t.year>0},set:function(e,t,n,i){var r=Xr(e,i);if(n.isTwoDigitYear){var s=oo(n.year,r);return e.setUTCFullYear(s,0,i.firstWeekContainsDate),e.setUTCHours(0,0,0,0),Gr(e,i)}var o="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(o,0,i.firstWeekContainsDate),e.setUTCHours(0,0,0,0),Gr(e,i)},incompatibleTokens:["y","R","u","Q","q","M","L","I","d","D","i","t","T"]},R:{priority:130,parse:function(e,t,n,i){return ro("R"===t?4:t.length,e)},set:function(e,t,n,i){var r=new Date(0);return r.setUTCFullYear(n,0,4),r.setUTCHours(0,0,0,0),qr(r)},incompatibleTokens:["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]},u:{priority:130,parse:function(e,t,n,i){return ro("u"===t?4:t.length,e)},set:function(e,t,n,i){return e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["G","y","Y","R","w","I","i","e","c","t","T"]},Q:{priority:120,parse:function(e,t,n,i){switch(t){case"Q":case"QQ":return io(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=1&&t<=4},set:function(e,t,n,i){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]},q:{priority:120,parse:function(e,t,n,i){switch(t){case"q":case"qq":return io(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,n){return t>=1&&t<=4},set:function(e,t,n,i){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]},M:{priority:110,parse:function(e,t,n,i){var r=function(e){return e-1};switch(t){case"M":return eo(Ps,e,r);case"MM":return io(2,e,r);case"Mo":return n.ordinalNumber(e,{unit:"month",valueCallback:r});case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=0&&t<=11},set:function(e,t,n,i){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]},L:{priority:110,parse:function(e,t,n,i){var r=function(e){return e-1};switch(t){case"L":return eo(Ps,e,r);case"LL":return io(2,e,r);case"Lo":return n.ordinalNumber(e,{unit:"month",valueCallback:r});case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,n){return t>=0&&t<=11},set:function(e,t,n,i){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]},w:{priority:100,parse:function(e,t,n,i){switch(t){case"w":return eo(Os,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=53},set:function(e,t,n,i){return Gr(function(e,t,n){fr(2,arguments);var i=br(e),r=mr(t),s=Kr(i,n)-r;return i.setUTCDate(i.getUTCDate()-7*s),i}(e,n,i),i)},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","i","t","T"]},I:{priority:100,parse:function(e,t,n,i){switch(t){case"I":return eo(Os,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=53},set:function(e,t,n,i){return qr(function(e,t){fr(2,arguments);var n=br(e),i=mr(t),r=Vr(n)-i;return n.setUTCDate(n.getUTCDate()-7*r),n}(e,n,i),i)},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]},d:{priority:90,subPriority:1,parse:function(e,t,n,i){switch(t){case"d":return eo(Ns,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return io(t.length,e)}},validate:function(e,t,n){var i=uo(e.getUTCFullYear()),r=e.getUTCMonth();return i?t>=1&&t<=lo[r]:t>=1&&t<=ao[r]},set:function(e,t,n,i){return e.setUTCDate(n),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","w","I","D","i","e","c","t","T"]},D:{priority:90,subPriority:1,parse:function(e,t,n,i){switch(t){case"D":case"DD":return eo(As,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return io(t.length,e)}},validate:function(e,t,n){return uo(e.getUTCFullYear())?t>=1&&t<=366:t>=1&&t<=365},set:function(e,t,n,i){return e.setUTCMonth(0,n),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]},E:{priority:90,parse:function(e,t,n,i){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=0&&t<=6},set:function(e,t,n,i){return(e=Ds(e,n,i)).setUTCHours(0,0,0,0),e},incompatibleTokens:["D","i","e","c","t","T"]},e:{priority:90,parse:function(e,t,n,i){var r=function(e){var t=7*Math.floor((e-1)/7);return(e+i.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return io(t.length,e,r);case"eo":return n.ordinalNumber(e,{unit:"day",valueCallback:r});case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=0&&t<=6},set:function(e,t,n,i){return(e=Ds(e,n,i)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]},c:{priority:90,parse:function(e,t,n,i){var r=function(e){var t=7*Math.floor((e-1)/7);return(e+i.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return io(t.length,e,r);case"co":return n.ordinalNumber(e,{unit:"day",valueCallback:r});case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,n){return t>=0&&t<=6},set:function(e,t,n,i){return(e=Ds(e,n,i)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]},i:{priority:90,parse:function(e,t,n,i){var r=function(e){return 0===e?7:e};switch(t){case"i":case"ii":return io(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return n.day(e,{width:"abbreviated",context:"formatting",valueCallback:r})||n.day(e,{width:"short",context:"formatting",valueCallback:r})||n.day(e,{width:"narrow",context:"formatting",valueCallback:r});case"iiiii":return n.day(e,{width:"narrow",context:"formatting",valueCallback:r});case"iiiiii":return n.day(e,{width:"short",context:"formatting",valueCallback:r})||n.day(e,{width:"narrow",context:"formatting",valueCallback:r});case"iiii":default:return n.day(e,{width:"wide",context:"formatting",valueCallback:r})||n.day(e,{width:"abbreviated",context:"formatting",valueCallback:r})||n.day(e,{width:"short",context:"formatting",valueCallback:r})||n.day(e,{width:"narrow",context:"formatting",valueCallback:r})}},validate:function(e,t,n){return t>=1&&t<=7},set:function(e,t,n,i){return(e=function(e,t){fr(2,arguments);var n=mr(t);n%7==0&&(n-=7);var i=1,r=br(e),s=r.getUTCDay(),o=((n%7+7)%7<i?7:0)+n-s;return r.setUTCDate(r.getUTCDate()+o),r}(e,n,i)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]},a:{priority:80,parse:function(e,t,n,i){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,n,i){return e.setUTCHours(so(n),0,0,0),e},incompatibleTokens:["b","B","H","K","k","t","T"]},b:{priority:80,parse:function(e,t,n,i){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,n,i){return e.setUTCHours(so(n),0,0,0),e},incompatibleTokens:["a","B","H","K","k","t","T"]},B:{priority:80,parse:function(e,t,n,i){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,n,i){return e.setUTCHours(so(n),0,0,0),e},incompatibleTokens:["a","b","t","T"]},h:{priority:70,parse:function(e,t,n,i){switch(t){case"h":return eo(Bs,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=12},set:function(e,t,n,i){var r=e.getUTCHours()>=12;return r&&n<12?e.setUTCHours(n+12,0,0,0):r||12!==n?e.setUTCHours(n,0,0,0):e.setUTCHours(0,0,0,0),e},incompatibleTokens:["H","K","k","t","T"]},H:{priority:70,parse:function(e,t,n,i){switch(t){case"H":return eo(Ms,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=23},set:function(e,t,n,i){return e.setUTCHours(n,0,0,0),e},incompatibleTokens:["a","b","h","K","k","t","T"]},K:{priority:70,parse:function(e,t,n,i){switch(t){case"K":return eo(Rs,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=11},set:function(e,t,n,i){return e.getUTCHours()>=12&&n<12?e.setUTCHours(n+12,0,0,0):e.setUTCHours(n,0,0,0),e},incompatibleTokens:["a","b","h","H","k","t","T"]},k:{priority:70,parse:function(e,t,n,i){switch(t){case"k":return eo(_s,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=24},set:function(e,t,n,i){var r=n<=24?n%24:n;return e.setUTCHours(r,0,0,0),e},incompatibleTokens:["a","b","h","H","K","t","T"]},m:{priority:60,parse:function(e,t,n,i){switch(t){case"m":return eo(Fs,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=59},set:function(e,t,n,i){return e.setUTCMinutes(n,0,0),e},incompatibleTokens:["t","T"]},s:{priority:50,parse:function(e,t,n,i){switch(t){case"s":return eo(Us,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return io(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=59},set:function(e,t,n,i){return e.setUTCSeconds(n,0),e},incompatibleTokens:["t","T"]},S:{priority:30,parse:function(e,t,n,i){return io(t.length,e,(function(e){return Math.floor(e*Math.pow(10,3-t.length))}))},set:function(e,t,n,i){return e.setUTCMilliseconds(n),e},incompatibleTokens:["t","T"]},X:{priority:10,parse:function(e,t,n,i){switch(t){case"X":return to(Xs,e);case"XX":return to(Ys,e);case"XXXX":return to(Qs,e);case"XXXXX":return to(Zs,e);case"XXX":default:return to(Ks,e)}},set:function(e,t,n,i){return t.timestampIsSet?e:new Date(e.getTime()-n)},incompatibleTokens:["t","T","x"]},x:{priority:10,parse:function(e,t,n,i){switch(t){case"x":return to(Xs,e);case"xx":return to(Ys,e);case"xxxx":return to(Qs,e);case"xxxxx":return to(Zs,e);case"xxx":default:return to(Ks,e)}},set:function(e,t,n,i){return t.timestampIsSet?e:new Date(e.getTime()-n)},incompatibleTokens:["t","T","X"]},t:{priority:40,parse:function(e,t,n,i){return no(e)},set:function(e,t,n,i){return[new Date(1e3*n),{timestampIsSet:!0}]},incompatibleTokens:"*"},T:{priority:20,parse:function(e,t,n,i){return no(e)},set:function(e,t,n,i){return[new Date(n),{timestampIsSet:!0}]},incompatibleTokens:"*"}},go=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,mo=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,fo=/^'([^]*?)'?$/,bo=/''/g,wo=/\S/,yo=/[a-zA-Z]/;function vo(e,t,n,i){fr(3,arguments);var r=String(e),s=String(t),o=i||{},a=o.locale||Nr;if(!a.match)throw new RangeError("locale must contain match property");var l=a.options&&a.options.firstWeekContainsDate,u=null==l?1:mr(l),c=null==o.firstWeekContainsDate?u:mr(o.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var h=a.options&&a.options.weekStartsOn,d=null==h?0:mr(h),p=null==o.weekStartsOn?d:mr(o.weekStartsOn);if(!(p>=0&&p<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===s)return""===r?br(n):new Date(NaN);var g,m={firstWeekContainsDate:c,weekStartsOn:p,locale:a},f=[{priority:10,subPriority:-1,set:Eo,index:0}],b=s.match(mo).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,hs[t])(e,a.formatLong,m):e})).join("").match(go),w=[];for(g=0;g<b.length;g++){var y=b[g];!o.useAdditionalWeekYearTokens&&ms(y)&&fs(y,s,e),!o.useAdditionalDayOfYearTokens&&gs(y)&&fs(y,s,e);var v=y[0],E=po[v];if(E){var T=E.incompatibleTokens;if(Array.isArray(T)){for(var C=void 0,S=0;S<w.length;S++){var I=w[S].token;if(-1!==T.indexOf(I)||I===v){C=w[S];break}}if(C)throw new RangeError("The format string mustn't contain `".concat(C.fullToken,"` and `").concat(y,"` at the same time"))}else if("*"===E.incompatibleTokens&&w.length)throw new RangeError("The format string mustn't contain `".concat(y,"` and any other token at the same time"));w.push({token:v,fullToken:y});var x=E.parse(r,y,a.match,m);if(!x)return new Date(NaN);f.push({priority:E.priority,subPriority:E.subPriority||0,set:E.set,validate:E.validate,value:x.value,index:f.length}),r=x.rest}else{if(v.match(yo))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");if("''"===y?y="'":"'"===v&&(y=To(y)),0!==r.indexOf(y))return new Date(NaN);r=r.slice(y.length)}}if(r.length>0&&wo.test(r))return new Date(NaN);var L=f.map((function(e){return e.priority})).sort((function(e,t){return t-e})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return f.filter((function(t){return t.priority===e})).sort((function(e,t){return t.subPriority-e.subPriority}))})).map((function(e){return e[0]})),k=br(n);if(isNaN(k))return new Date(NaN);var D=Ar(k,Tr(k)),P={};for(g=0;g<L.length;g++){var N=L[g];if(N.validate&&!N.validate(D,N.value,m))return new Date(NaN);var A=N.set(D,P,N.value,m);A[0]?(D=A[0],Ss(P,A[1])):D=A}return D}function Eo(e,t){if(t.timestampIsSet)return e;var n=new Date(0);return n.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),n.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),n}function To(e){return e.match(fo)[1].replace(bo,"'")}function Co(e,t){fr(2,arguments);var n=br(e),i=mr(t),r=n.getFullYear(),s=n.getDate(),o=new Date(0);o.setFullYear(r,i,15),o.setHours(0,0,0,0);var a=Is(o);return n.setMonth(i,Math.min(s,a)),n}function So(e,t){if(fr(2,arguments),"object"!=typeof t||null===t)throw new RangeError("values parameter must be an object");var n=br(e);return isNaN(n.getTime())?new Date(NaN):(null!=t.year&&n.setFullYear(t.year),null!=t.month&&(n=Co(n,t.month)),null!=t.date&&n.setDate(mr(t.date)),null!=t.hours&&n.setHours(mr(t.hours)),null!=t.minutes&&n.setMinutes(mr(t.minutes)),null!=t.seconds&&n.setSeconds(mr(t.seconds)),null!=t.milliseconds&&n.setMilliseconds(mr(t.milliseconds)),n)}function Io(e,t,n,i,r){try{const s=function(e,t){try{const n=new Date,i=JSON.parse(t);switch(e){case co.Date:return So(n,{year:i.year,month:i.month-1,date:i.day,hours:0,minutes:0,seconds:0,milliseconds:0});case co.DateTime:case co.Time:return So(n,{year:i.year,month:i.month-1,date:i.day,hours:i.hour,minutes:i.minutes,seconds:i.seconds,milliseconds:0});default:return null}}catch(e){return null}}(e,i);if(Ao(s))return!1;const o=Oo(t,n,s);return!Ao(o)&&r(o,s)}catch(e){return!1}}function xo(e,t,n,i,r){qi(e,t,r,(function(e,t){return Io(n,e,i,t,((e,t)=>ks(e,t)))}))}function Lo(e,t,n,i,r){qi(e,t,r,(function(e,t){return Io(n,e,i,t,((e,t)=>!ks(e,t)))}))}function ko(e,t,n,i,r){qi(e,t,r,(function(e,t){return Io(n,e,i,t,((e,t)=>Ls(e,t)))}))}function Do(e,t,n,i,r){qi(e,t,r,(function(e,t){return Io(n,e,i,t,((e,t)=>xs(e,t)))}))}function Po(e,t,n,i,r){qi(e,t,r,(function(e,t){if(!t||""===t)return!1;try{const n=Date.now(),r=vo(Ts(n,i),i,n),s=vr(r,{days:parseInt(t)}),o=Oo(e,i,r);return!Ao(o)&&!Ao(s)&&Ls(o,s)}catch(e){return!1}}))}function No(e,t,n,i,r){qi(e,t,r,(function(e,t){if(!t||""===t)return!1;try{const n=Date.now(),r=vo(Ts(n,i),i,n),s=vr(r,{days:parseInt(t)}),o=Oo(e,i,r);return!Ao(o)&&!Ao(s)&&xs(o,s)}catch(e){return!1}}))}function Ao(e){return null===e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime())}function Oo(e,t,n){const i=function(e,t){try{if(Xi(e)){const n=e.valueAsDate;if(n){return vo(Ts(n,t),t,n)}}return null}catch(e){return null}}(e,t);if(null==i){return vo(ji(e),t,n)}return i}function Mo(e,t,n,i){const r=Mi(e);if(r)switch(Ri(e)){case oi.TextContentEquals:Qi(r,t,i);break;case oi.TextContentNotEquals:Ki(r,t,i);break;case oi.TextContentContains:Zi(r,t,i);break;case oi.TextContentNotContains:er(r,t,i);break;case oi.TextContentStartsWith:tr(r,t,i);break;case oi.TextContentEndsWith:ir(r,t,i);break;case oi.TextContentNotStartsWith:nr(r,t,i);break;case oi.TextContentNotEndsWith:rr(r,t,i);break;case oi.TextContentPattern:sr(r,t,i);break;case oi.TextInsensitiveContentEquals:Qi(r,t,i,!1);break;case oi.TextInsensitiveContentNotEquals:Ki(r,t,i,!1);break;case oi.TextInsensitiveContentContains:Zi(r,t,i,!1);break;case oi.TextInsensitiveContentNotContains:er(r,t,i,!1);break;case oi.TextInsensitiveContentStartsWith:tr(r,t,i,!1);break;case oi.TextInsensitiveContentEndsWith:ir(r,t,i,!1);break;case oi.TextInsensitiveContentNotStartsWith:nr(r,t,i,!1);break;case oi.TextInsensitiveContentNotEndsWith:rr(r,t,i,!1);break;case oi.TextInsensitiveContentPattern:sr(r,t,i,!1);break;case oi.DecimalContentGreater:hr(r,t,!0,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.DecimalContentGreaterOrEqual:dr(r,t,!0,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.DecimalContentLess:pr(r,t,!0,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.DecimalContentLessOrEqual:gr(r,t,!0,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.DecimalContentEquals:ur(r,t,!0,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.DecimalContentNotEquals:cr(r,t,!0,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.IntegerContentGreater:hr(r,t,!1,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.IntegerContentGreaterOrEqual:dr(r,t,!1,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.IntegerContentLess:pr(r,t,!1,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.IntegerContentLessOrEqual:gr(r,t,!1,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.IntegerContentEquals:ur(r,t,!1,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.IntegerContentNotEquals:cr(r,t,!1,n.decimalSeparator,n.withGroupSeparator,i);break;case oi.DateContentEquals:xo(r,t,co.Date,n.dateFormat,i);break;case oi.DateContentNotEquals:Lo(r,t,co.Date,n.dateFormat,i);break;case oi.DateContentBefore:ko(r,t,co.Date,n.dateFormat,i);break;case oi.DateContentAfter:Do(r,t,co.Date,n.dateFormat,i);break;case oi.DateContentXDaysBeforeNow:Po(r,t,co.Date,n.dateFormat,i);break;case oi.DateContentXDaysAfterNow:No(r,t,co.Date,n.dateFormat,i);break;case oi.DateTimeContentEquals:xo(r,t,co.DateTime,n.dateTimeFormat,i);break;case oi.DateTimeContentNotEquals:Lo(r,t,co.DateTime,n.dateTimeFormat,i);break;case oi.DateTimeContentBefore:ko(r,t,co.DateTime,n.dateTimeFormat,i);break;case oi.DateTimeContentAfter:Do(r,t,co.DateTime,n.dateTimeFormat,i);break;case oi.DateTimeContentXDaysBeforeNow:Po(r,t,co.DateTime,n.dateTimeFormat,i);break;case oi.DateTimeContentXDaysAfterNow:No(r,t,co.DateTime,n.dateTimeFormat,i);break;case oi.TimeContentEquals:xo(r,t,co.Time,n.timeFormat,i);break;case oi.TimeContentNotEquals:Lo(r,t,co.Time,n.timeFormat,i);break;case oi.TimeContentBefore:ko(r,t,co.Time,n.timeFormat,i);break;case oi.TimeContentAfter:Do(r,t,co.Time,n.timeFormat,i);break;case oi.CheckboxContentIsChecked:!function(e,t,n){zi(e,t,((e,t)=>{if(null!==e){const i=Hi.fromElement(e);n(i.info.checked||!1,t)}else n(!1,t)}))}(r,t,i);break;case oi.CheckboxContentIsUnChecked:!function(e,t,n){zi(e,t,((e,t)=>{if(null!==e){const i=Hi.fromElement(e);n(!i.info.checked,t)}else n(!1,t)}))}(r,t,i)}else console.error("Invalid Content Rule: missing identikit",e),i(!1,t)}function _o(e,t){if(!function(e){if(Array.isArray(e.customProperties)){for(const t of e.customProperties)t.hasOwnProperty("name")&&t.hasOwnProperty("value")&&"string"==typeof t.value||console.debug('Invalid context: object in array must have the property "name" & "value" where the type of value is string only. Invalid property:',t);return!0}if("object"==typeof e.customProperties&&null!==e.customProperties)return!0;return console.debug("Custom properties are not defined in Newired Context",e),!1}(t))return!1;const n=Mi(e);if(!n)return!1;const i=function(e,t){if(Array.isArray(t)){const n=t.find((t=>t.name===e));if(n)return n.value}else if("object"==typeof t&&t.hasOwnProperty(e))return t[e];return null}(n.name,t.customProperties);if(!i)return!1;switch(Ri(e)){case ci.CustomPropertyEquals:return i===n.value;case ci.CustomPropertyNotEquals:return i!==n.value;case ci.CustomPropertyContains:return-1!==i.indexOf(n.value);case ci.CustomPropertyNotContains:return-1===i.indexOf(n.value)}}function Ro(e,t,n,i,r){if(t){const s=$i(e);Bo(JSON.parse(t),s,n.contentRuleSettings,i,r)}else r(!0)}function Bo(e,t,n,i,r){if(0===e.length)r(!0,t);else{const s=(e,t,n,r,o)=>{const a=e.shift();a?Fo(a,t,n,i,((i,l)=>{a.hasOwnProperty("And")?s(e,l,n,r,o&&i):a.hasOwnProperty("Or")?i?r(!0,t):s(e,l,n,r,!1):(console.warn("Invalid rule with invalid logical operator",a),r(!1,t))})):r(o,t)},o=e[0].hasOwnProperty("And");s(Jt(function(e){return e.sort(((e,t)=>{const n=Ni(e),i=Ni(t);return n<i?-1:n>i?1:0})),e}(e)),t,n,r,o)}}function Fo(e,t,n,i,r){if(ki(e))Mo(e,t,n,r);else if(Oi(e)){const n=_o(e,i);r(n,t)}else{const n=function(e){try{return e.hasOwnProperty("And")?Wo(e.And):e.hasOwnProperty("Or")?Wo(e.Or):(console.warn(`Unknown operator ${b.JSON.stringify(e)}.`),null)}catch(e){return console.warn("Unable to parse Rule.",e),null}}(e),i=window.targetWindow.location.href;if(n)switch(n.type){case"UrlEquals":r(i.toLowerCase()===n.pattern.toLowerCase(),t);break;case"UrlNotEquals":r(i.toLowerCase()!==n.pattern.toLowerCase(),t);break;case"UrlContains":r(i.toLowerCase().indexOf(n.pattern.toLowerCase())>=0,t);break;case"UrlNotContains":r(i.toLowerCase().indexOf(n.pattern.toLowerCase())<0,t);break;case"ElementIsPresent":zi(n.data,t,((e,t)=>{r(null!==e,t)}));break;case"ElementIsNotPresent":zi(n.data,t,((e,t)=>{r(null===e,t)}));break;case"ElementIsEnabled":zi(n.data,t,((e,t)=>{if(null!==e){const n=Hi.fromElement(e);r(!n.info.disabled,t)}else r(!1,t)}));break;case"ElementIsDisabled":zi(n.data,t,((e,t)=>{if(null!==e){const n=Hi.fromElement(e);r(n.info.disabled,t)}else r(!1,t)}));break;case"ElementHasOptions":zi(n.data,t,((e,t)=>{if(null!==e){const i=Hi.fromElement(e),s=n.data.conditionValue.split(",").map((e=>e.safeTrim())).filter((e=>e.safeTrim().length>0)),o=(i.info.options||[]).every((e=>-1!==s.indexOf(e)));r(o,t)}else r(!1,t)}));break;case"ElementHasNotOptions":zi(n.data,t,((e,t)=>{if(null!==e){const i=Hi.fromElement(e).info.options||[],s=n.data.conditionValue.split(",").every((e=>""===e.safeTrim()||-1===i.indexOf(e.safeTrim())));r(s,t)}else r(!1,t)}));break;case"LanguageCodeIs":if(Uo()===n.code)return void r(!0,t);r(!1,t);break;case"LanguageCodeIsNot":if(Uo()!==n.code)return void r(!0,t);r(!1,t);break;case"Script":r((n.script,!1),t)}}}function Uo(){return(navigator.language||navigator.userLanguage).substr(0,2).toLowerCase()}function Wo(e){if(e.hasOwnProperty("UrlEquals"))return{type:"UrlEquals",subType:"url",pattern:e.UrlEquals};if(e.hasOwnProperty("UrlNotEquals"))return{type:"UrlNotEquals",subType:"url",pattern:e.UrlNotEquals};if(e.hasOwnProperty("UrlContains"))return{type:"UrlContains",subType:"url",pattern:e.UrlContains};if(e.hasOwnProperty("UrlNotContains"))return{type:"UrlNotContains",subType:"url",pattern:e.UrlNotContains};if(e.hasOwnProperty("ElementIsPresent"))return{type:"ElementIsPresent",subType:"element",data:JSON.parse(e.ElementIsPresent)};if(e.hasOwnProperty("ElementIsNotPresent"))return{type:"ElementIsNotPresent",subType:"element",data:JSON.parse(e.ElementIsNotPresent)};if(e.hasOwnProperty("ElementIsEnabled"))return{type:"ElementIsEnabled",subType:"element",data:JSON.parse(e.ElementIsEnabled)};if(e.hasOwnProperty("ElementIsDisabled"))return{type:"ElementIsDisabled",subType:"element",data:JSON.parse(e.ElementIsDisabled)};if(e.hasOwnProperty("ElementHasOptions"))return{type:"ElementHasOptions",subType:"element",data:JSON.parse(e.ElementHasOptions)};if(e.hasOwnProperty("ElementHasNotOptions"))return{type:"ElementHasNotOptions",subType:"element",data:JSON.parse(e.ElementHasNotOptions)};if(e.hasOwnProperty("Script"))return{type:"Script",subType:"script",script:JSON.parse(e.Script)};if(e.hasOwnProperty("LanguageCodeIs"))return{type:"LanguageCodeIs",subType:"language",code:e.LanguageCodeIs};if(e.hasOwnProperty("LanguageCodeIsNot"))return{type:"LanguageCodeIsNot",subType:"language",code:e.LanguageCodeIsNot};if(e.hasOwnProperty("TextContentEquals"))return{type:"TextContentEquals",subType:"content",data:JSON.parse(e.TextContentEquals)};if(e.hasOwnProperty("TextContentNotEquals"))return{type:"TextContentNotEquals",subType:"content",data:JSON.parse(e.TextContentNotEquals)};if(e.hasOwnProperty("TextContentContains"))return{type:"TextContentContains",subType:"content",data:JSON.parse(e.TextContentContains)};if(e.hasOwnProperty("TextContentNotContains"))return{type:"TextContentNotContains",subType:"content",data:JSON.parse(e.TextContentNotContains)};if(e.hasOwnProperty("TextContentStartsWith"))return{type:"TextContentStartsWith",subType:"content",data:JSON.parse(e.TextContentStartsWith)};if(e.hasOwnProperty("TextContentEndsWith"))return{type:"TextContentEndsWith",subType:"content",data:JSON.parse(e.TextContentEndsWith)};if(e.hasOwnProperty("TextContentNotStartsWith"))return{type:"TextContentNotStartsWith",subType:"content",data:JSON.parse(e.TextContentNotStartsWith)};if(e.hasOwnProperty("TextContentNotEndsWith"))return{type:"TextContentNotEndsWith",subType:"content",data:JSON.parse(e.TextContentNotEndsWith)};if(e.hasOwnProperty("TextContentPattern"))return{type:"TextContentPattern",subType:"content",data:JSON.parse(e.TextContentPattern)};if(e.hasOwnProperty("TextInsensitiveContentEquals"))return{type:"TextInsensitiveContentEquals",subType:"content",data:JSON.parse(e.TextInsensitiveContentEquals)};if(e.hasOwnProperty("TextInsensitiveContentNotEquals"))return{type:"TextInsensitiveContentNotEquals",subType:"content",data:JSON.parse(e.TextInsensitiveContentNotEquals)};if(e.hasOwnProperty("TextInsensitiveContentContains"))return{type:"TextInsensitiveContentContains",subType:"content",data:JSON.parse(e.TextInsensitiveContentContains)};if(e.hasOwnProperty("TextInsensitiveContentNotContains"))return{type:"TextInsensitiveContentNotContains",subType:"content",data:JSON.parse(e.TextInsensitiveContentNotContains)};if(e.hasOwnProperty("TextInsensitiveContentStartsWith"))return{type:"TextInsensitiveContentStartsWith",subType:"content",data:JSON.parse(e.TextInsensitiveContentStartsWith)};if(e.hasOwnProperty("TextInsensitiveContentEndsWith"))return{type:"TextInsensitiveContentEndsWith",subType:"content",data:JSON.parse(e.TextInsensitiveContentEndsWith)};if(e.hasOwnProperty("TextInsensitiveContentNotStartsWith"))return{type:"TextInsensitiveContentNotStartsWith",subType:"content",data:JSON.parse(e.TextInsensitiveContentNotStartsWith)};if(e.hasOwnProperty("TextInsensitiveContentNotEndsWith"))return{type:"TextInsensitiveContentNotEndsWith",subType:"content",data:JSON.parse(e.TextInsensitiveContentNotEndsWith)};if(e.hasOwnProperty("TextInsensitiveContentPattern"))return{type:"TextInsensitiveContentPattern",subType:"content",data:JSON.parse(e.TextInsensitiveContentPattern)};if(e.hasOwnProperty("DecimalContentGreater"))return{type:"DecimalContentGreater",subType:"content",data:JSON.parse(e.DecimalContentGreater)};if(e.hasOwnProperty("DecimalContentGreaterOrEqual"))return{type:"DecimalContentGreaterOrEqual",subType:"content",data:JSON.parse(e.DecimalContentGreaterOrEqual)};if(e.hasOwnProperty("DecimalContentLess"))return{type:"DecimalContentLess",subType:"content",data:JSON.parse(e.DecimalContentLess)};if(e.hasOwnProperty("DecimalContentLessOrEqual"))return{type:"DecimalContentLessOrEqual",subType:"content",data:JSON.parse(e.DecimalContentLessOrEqual)};if(e.hasOwnProperty("DecimalContentEquals"))return{type:"DecimalContentEquals",subType:"content",data:JSON.parse(e.DecimalContentEquals)};if(e.hasOwnProperty("DecimalContentNotEquals"))return{type:"DecimalContentNotEquals",subType:"content",data:JSON.parse(e.DecimalContentNotEquals)};if(e.hasOwnProperty("IntegerContentGreater"))return{type:"IntegerContentGreater",subType:"content",data:JSON.parse(e.IntegerContentGreater)};if(e.hasOwnProperty("IntegerContentGreaterOrEqual"))return{type:"IntegerContentGreaterOrEqual",subType:"content",data:JSON.parse(e.IntegerContentGreaterOrEqual)};if(e.hasOwnProperty("IntegerContentLess"))return{type:"IntegerContentLess",subType:"content",data:JSON.parse(e.IntegerContentLess)};if(e.hasOwnProperty("IntegerContentLessOrEqual"))return{type:"IntegerContentLessOrEqual",subType:"content",data:JSON.parse(e.IntegerContentLessOrEqual)};if(e.hasOwnProperty("IntegerContentEquals"))return{type:"IntegerContentEquals",subType:"content",data:JSON.parse(e.IntegerContentEquals)};if(e.hasOwnProperty("IntegerContentNotEquals"))return{type:"IntegerContentNotEquals",subType:"content",data:JSON.parse(e.IntegerContentNotEquals)};if(e.hasOwnProperty("CheckboxContentIsChecked"))return{type:"CheckboxContentIsChecked",subType:"content",data:JSON.parse(e.CheckboxContentIsChecked)};if(e.hasOwnProperty("CheckboxContentIsUnChecked"))return{type:"CheckboxContentIsUnChecked",subType:"content",data:JSON.parse(e.CheckboxContentIsUnChecked)};if(e.hasOwnProperty("DateContentEquals"))return{type:"DateContentEquals",subType:"content",data:JSON.parse(e.DateContentEquals)};if(e.hasOwnProperty("DateContentNotEquals"))return{type:"DateContentNotEquals",subType:"content",data:JSON.parse(e.DateContentNotEquals)};if(e.hasOwnProperty("DateContentBefore"))return{type:"DateContentBefore",subType:"content",data:JSON.parse(e.DateContentBefore)};if(e.hasOwnProperty("DateContentAfter"))return{type:"DateContentAfter",subType:"content",data:JSON.parse(e.DateContentAfter)};if(e.hasOwnProperty("DateContentXDaysBeforeNow"))return{type:"DateContentXDaysBeforeNow",subType:"content",data:JSON.parse(e.DateContentXDaysBeforeNow)};if(e.hasOwnProperty("DateContentXDaysAfterNow"))return{type:"DateContentXDaysAfterNow",subType:"content",data:JSON.parse(e.DateContentXDaysAfterNow)};if(e.hasOwnProperty("DateTimeContentEquals"))return{type:"DateTimeContentEquals",subType:"content",data:JSON.parse(e.DateTimeContentEquals)};if(e.hasOwnProperty("DateTimeContentNotEquals"))return{type:"DateTimeContentNotEquals",subType:"content",data:JSON.parse(e.DateTimeContentNotEquals)};if(e.hasOwnProperty("DateTimeContentBefore"))return{type:"DateTimeContentBefore",subType:"content",data:JSON.parse(e.DateTimeContentBefore)};if(e.hasOwnProperty("DateTimeContentAfter"))return{type:"DateTimeContentAfter",subType:"content",data:JSON.parse(e.DateTimeContentAfter)};if(e.hasOwnProperty("DateTimeContentXDaysBeforeNow"))return{type:"DateTimeContentXDaysBeforeNow",subType:"content",data:JSON.parse(e.DateTimeContentXDaysBeforeNow)};if(e.hasOwnProperty("DateTimeContentXDaysAfterNow"))return{type:"DateTimeContentXDaysAfterNow",subType:"content",data:JSON.parse(e.DateTimeContentXDaysAfterNow)};if(e.hasOwnProperty("TimeContentEquals"))return{type:"TimeContentEquals",subType:"content",data:JSON.parse(e.TimeContentEquals)};if(e.hasOwnProperty("TimeContentNotEquals"))return{type:"TimeContentNotEquals",subType:"content",data:JSON.parse(e.TimeContentNotEquals)};if(e.hasOwnProperty("TimeContentBefore"))return{type:"TimeContentBefore",subType:"content",data:JSON.parse(e.TimeContentBefore)};if(e.hasOwnProperty("TimeContentAfter"))return{type:"TimeContentAfter",subType:"content",data:JSON.parse(e.TimeContentAfter)};throw`Unknown condition type ${b.JSON.stringify(e)}`}!function(e){e.Date="Date",e.Time="Time",e.DateTime="DateTime"}(co||(co={}));class Jo{constructor(){this.token=null}static getInstance(){return Jo.persistence||(Jo.persistence=new Jo),Jo.persistence}init(e){this.token=e}static init(e){this.getInstance().init(e)}saveMultipartData(e,t){return function(e,t,n){const i={method:"POST",body:t,headers:{}};return n&&(i.headers["nw-auth"]=n),fetch(e,i).then((e=>e.text()))}(e,t,this.token)}static saveMultipartData(e,t){return this.getInstance().saveMultipartData(e,t)}}function Ho(e){return new Promise((t=>{window.targetWindow.requestAnimationFrame((()=>{const n=e();window.targetWindow.requestAnimationFrame((()=>{t(n)}))}))}))}function qo(e){return new Promise(((t,n)=>{try{void 0!==window.takeScreenshot?window.takeScreenshot(e).then((n=>{t(),Jo.saveMultipartData(function(e){switch(e.entityKind){case ho.Step:return Fe().toBackend("/rest/step/createScreenshot");case ho.Tip:return Fe().toBackend("/rest/tip/createScreenshot")}}(e),function(e,t){const n=new Blob([t],{type:"image/png"}),i=new FormData;return i.append("file",n),i.append("prefix","fullscreen"),i.append("id",e.entityId.toString()),i}(e,n)).then((t=>{const n=JSON.parse(t);n.data?window.sendIPCMessage("launcher",b.JSON.stringify({operation:"screenshotCreated",data:{objectId:n.data,entityId:e.entityId,entityKind:e.entityKind}})):window.sendIPCMessage("launcher",b.JSON.stringify({operation:"screenshotCreated",data:null}))})).catch((()=>{window.sendIPCMessage("launcher",b.JSON.stringify({operation:"screenshotCreated",data:null}))}))})):n("Function 'takeScreenshot' is missing.")}catch(e){n(e)}}))}function jo(e,t,n,i){Ho((()=>{n.clean()})).then((()=>{qo({entityKind:t,entityId:e}).then((()=>{n.restore(),i()})).catch((e=>{console.log("Unable to create screenshot: Cause: ",e)}))}))}function zo(e,t,n,i,r){var s;i.bubbleFrame?e?(s=i.bubbleFrame,new Promise((e=>{new IntersectionObserver((function(t,n){n.disconnect(),e(1===t[0].intersectionRatio)}),{threshold:[1]}).observe(s)}))).then((e=>{e?jo(t,n,i,r):r()})):jo(t,n,i,r):r()}function $o(e,t,n,i){return new Promise((r=>{Bo(t,$i(e),n.contentRuleSettings,i,r)}))}function Vo(e,t,n,i){return new Promise((r=>{const s={And:t.rule};$o(e,[s],n,i).then((n=>{n&&Di(s)||ki(s)?function(e,t,n,i){const r=Mi(t);r?zi(r,n,((t,n)=>{const s=St.default().calculate(e,t,r);i(s)})):i(null)}(e,s,$i(e),(e=>{r({success:n,scoreResult:e,index:t.index,type_:t.type_})})):r({success:n,scoreResult:null,index:t.index,type_:t.type_})}))}))}function Go(e,t){const n=document.createElement("div");n.innerHTML=e;return n.querySelectorAll("nw-image").forEach((e=>{!function(e,t){const n=document.createElement("figure"),i=e.dataset.nwName||"";n.dataset.nwImage=i;const r=document.createElement("img");r.src=`${t}${t.endsWith("/")?"":"/"}media/${i}`;const s=e.getAttribute("width"),o=e.getAttribute("height");s&&r.setAttribute("width",s);o&&r.setAttribute("height",o);n.appendChild(r),e.replaceWith(n)}(e,t)})),n.innerHTML}function Xo(e){const t=document.createElement("div");t.innerHTML=e;return t.querySelectorAll("figure[data-nw-image]").forEach((e=>{!function(e){const t=e.querySelector("img");if(t){const n=e.dataset.nwImage,i=t.getAttribute("width"),r=t.getAttribute("height");if(n){const t=document.createElement("nw-image");t.dataset.nwName=n,i&&t.setAttribute("width",i),r&&t.setAttribute("height",r),e.replaceWith(t)}}}(e)})),t.innerHTML}!function(e){e.Step="StepEntity",e.Tip="TipEntity"}(ho||(ho={}));class Yo{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,w,y){this._id=e,this.index=t,this.context=n,this.delegate=i,this.editing=r,this.previewing=s,this.kind=o,this.name=a,this.content=l,this.theme=u,this.align=c,this.elementIdent=h,this.elementTexts=d,this.options=p,this.applicationProfile=g,this.visibilityRules=m,this.url=f,this.urlPath=w,this.autoplay=y,this.elementContext=null,this.elementMonitor=null,this.visibilityMonitor=null,this.autoplayMonitor=null,this.iconElementMonitor=null,this.tryToFindTimeout=null,this.eventMap=new xn,this.isSticky=!1,this.evaluating=!1,this.mouseEntered=!1,this.screenshotsEnabled=Fe().getApplicationProfile().screenshotsEnabled,this.takingScreenshot=!1,this.edited=!1,this.areAutoplayRulesValid=!1,this.isAutoplayTriggerable=!1,this.tryToFindBubble=(e,t,n)=>{const i=window.nwApp.querySelector("#"+this.bubbleIdentity);var r;i?(r=i)&&"IFRAME"===r.tagName?t(i):n("Bubble found, but it's not iframe!"+i.tagName):10>e?this.tryToFindTimeout=b.setTimeout((()=>{this.tryToFindBubble(++e,t,n)}),this.applicationProfile.searchRepeatInterval):n()},this.onElementVisibilityChange=(e,t)=>{t&&(this.isSticky||this.previewing)?this.showBubble():this.hideBubble()},this.onElementPositionChange=(e,t)=>{t?this.reposition():this.bubble.updatePosition(this.toBubbleInfo())},this.removeEventListener=(e,t)=>{const n=t+".newired-tip-"+this._id;this.eventMap.removeEventListener(e,n)},this.addEventListener=(e,t,n)=>{const i=t+".newired-tip-"+this._id;this.eventMap.removeEventListener(e,i),this.eventMap.addEventListener(e,i,n)},this.addBubbleEventListener=(e,t,n)=>{const i=t+".newired-tip-bubble-"+this._id;this.eventMap.removeEventListener(e,i),this.eventMap.addEventListener(e,i,n)},this.tryToFindElement=(e,t,n)=>new Promise(((i,r)=>{const s=wt(window.targetWindow,e);s&&!ft(window.targetWindow,s.element)?i(s):t++<n.attempts?this.tryToFindTimeout=b.setTimeout((()=>{i(this.tryToFindElement(e,t,n))}),n.interval):r("Element not found")})),this.onElementLost=e=>{this.deregister(),this.evaluateTip().catch((e=>{this.deregisterWithFailure(`[TipBubble] Element lost for Tip id "${this._id}.${e?` Cause: ${e}`:""}".`)}))},this.dispose=()=>{this.tryToFindTimeout&&b.clearTimeout(this.tryToFindTimeout)},this.evaluateTip=()=>(this.evaluating=!0,this.shouldBeEvaluated()?new Promise(((e,t)=>{b.setTimeout((()=>{this.evaluateVisibility().then((e=>e?this.checkAutoplay():Promise.reject())).then((()=>{this.register(),this.registerVisibilityRulesMonitors(),this.registerAutoplayRulesMonitors()})).then(e).catch(t)}))})):(this.deregister(),Promise.resolve())),this.calcZIndex=e=>{const t=this.options.relativeZIndex||0;return e?$t.getActualZIndex(window.targetWindow,e)+t:t},this.mouseEnterElementHandler=e=>{this.mouseEntered=!0,this.showBubble(),e.stopPropagation(),e.preventDefault()},this.mouseEnterBubbleHandler=e=>{this.mouseEntered=!0,this.showBubble(),e.stopPropagation(),e.preventDefault()},this.mouseLeaveBubbleHandler=e=>{this.mouseEntered=!1,this.hideBubble(),e.stopPropagation(),e.preventDefault()},this.mouseLeaveElementHandler=e=>{this.mouseEntered=!1,this.hideBubble(),e.stopPropagation(),e.preventDefault()},this.focusHandler=e=>{this.showBubble(),e.stopPropagation(),e.preventDefault()},this.blurHandler=e=>{this.hideBubble(),e.stopPropagation(),e.preventDefault()},this.onResized=e=>{this.updateBubblePosition(e)},this.onClickClose=()=>{this.isAutoplayTriggerable=!1,this.hideBubble(),this.isSticky&&this.toggleSticky()},this.toggleSticky=()=>{this.isSticky=!this.isSticky,this.bubble.toggleSticky(this.isSticky),this.isSticky?this.showBubble():(this.onClickClose(),this.bubble.bubbleFrame)},this.elementIdentity=`newired-tip-id-${e||0}`,this.bubbleIdentity=`newired-tip-bubble-id-${e||0}`,this.searchTime=g.searchRepeatInterval*g.searchAttempts,this.bubblePosition=On(),this.bubble=new yi(this.bubbleIdentity,this),this.bubble.setEditorListener(this),this.elementIdent=vi(this.elementIdent,this.elementTexts,n.applicationLanguage)}get id(){return this._id}onRuleChanged(){console.log(`[TipBubble] Tip ${this.id} - Visibility rule changed => starting to re-evaluate.`),this.evaluate()}onAutoplayRuleChanged(){console.log(`[TipBubble] Tip ${this.id} - Autoplay rule changed => evaluate autoplay rules.`),this.checkAutoplay().then((()=>{this.updateUI()}))}onDimensionChanged(e,t){}setContext(e){e.applicationLanguage!==this.context.applicationLanguage&&(this.elementIdent=vi(this.elementIdent,this.elementTexts,e.applicationLanguage)),this.context=e}getTranslatedValue(e){return At(this.context.overlayLanguage,e)}replaceTranslatedValue(e,t){!function(e,t,n){const i=Mt(e,t);if(!i)throw new Ot(e);i.value=n}(this.context.overlayLanguage,e,t)}commitInlineEdit(e,t,n){w.send(b.JSON.stringify({operation:"inlineEditCommit",data:{entityId:this._id,entityKind:ni.TipEntity,property:e,value:t}}),(e=>{if("success"===e.kind){const t=wi(e.data);n(t)}else console.error("Commit inline-edit failed",e)}))}isPreviewing(){return this.previewing}isAutoWidth(){switch(this.options.bubbleSize){case Jn.Auto:return!0;default:return!1}}onTitleChanged(e,t,n){n&&""===e&&(e=this.getPlaceholder()),this.getTranslatedValue(this.name)!==e?this.commitInlineEdit(ii.EntityName,e,(n=>{n.error||(this._id=n.entityId,this.replaceTranslatedValue(this.name,e),this.isAutoWidth()&&this.updateUIAfterInlineEditChange()),this.edited=!0,t(n.error,this.getTranslatedValue(this.name))})):t(null,e)}onContentChanged(e,t){this.getTranslatedValue(this.content)!==e?this.commitInlineEdit(ii.EntityContent,Xo(e),(n=>{if(!n.error){this._id=n.entityId;const t=this.isContentEmpty()||""===e;this.replaceTranslatedValue(this.content,e),(this.isAutoWidth()||t)&&this.updateUIAfterInlineEditChange()}this.edited=!0,t(n.error,this.getTranslatedValue(this.content))})):t(null,e)}onAlignChanged(e,t){this.align!==e?this.commitInlineEdit(ii.EntityAlign,e,(n=>{n.error||(this.align=e,this.updateBubblePosition()),this.edited=!0,t(n.error)})):t(null)}onEditing(){this.editing=Lt.InlineEditing,this.bubble.updatePosition(this.toBubbleInfo())}onEditingOver(e,t){!this.edited||t||this.containsDynamicContent()?(this.editing=Lt.NoEditing,e()):(this.takingScreenshot=!0,this.delegate.createScreenshot(this).then((()=>{this.editing=Lt.NoEditing,this.takingScreenshot=!1,this.mouseEntered||this.hideBubble(),e()}))),this.edited=!1}containsDynamicContent(){return this.isAutoWidth()&&(this.containsMicroApp()||this.containsVideoOrImage())}containsMicroApp(){return-1!=this.getTranslatedValue(this.content).indexOf("<micro-app ")}containsVideoOrImage(){const e=this.getTranslatedValue(this.content);return-1!=e.indexOf("<figure><iframe ")||-1!=e.indexOf("<figure><img ")||-1!=e.indexOf("<figure data-nw-image")}createScreenshot(e,t){this.screenshotsEnabled&&this._id&&this.takingScreenshot?zo(e,this._id,ho.Tip,this.bubble,t):t()}isContentEmpty(){return null==this.content||""==this.getTranslatedValue(this.content)}onEditEnded(e){w.send(b.JSON.stringify({operation:"inlineEditEnded",data:{entityId:this._id,entityKind:ni.TipEntity}}),(t=>{"success"!==t.kind&&console.error("End of inline-edit failed",t),this.editing=Lt.NoEditing,this.bubble.updatePosition(this.toBubbleInfo()),e&&e()}))}getAlign(){return this.align}getTransitionType(){return null}onTransitionChanged(){}getPlaceholder(){return"Tip name"}openEditDialog(){this._id&&(this.editing=Lt.DialogEditing,window.sendIPCMessage("launcher",b.JSON.stringify({operation:"startTipEditDialog",data:this._id})))}showBubble(){this.delegate.onShow(this),this.bubble.show(this.getZIndex())}hideBubble(){this.delegate.onHide(this),this.shouldBeBubbleVisible||this.element===window.targetDocument.activeElement&&this.kind===Pt.TipBubble||this.bubble.hide()}get isTargetElementVisible(){return!!this.elementMonitor&&this.elementMonitor.elementIsVisible||!!this.elementContext&&pn(window.targetWindow,this.elementContext).isVisible}shouldBeAutoPlayed(){return this.areAutoplayRulesValid&&this.isAutoplayTriggerable}get shouldBeBubbleVisible(){return this.isTargetElementVisible&&(this.editing!=Lt.NoEditing||this.previewing||this.isSticky||this.shouldBeAutoPlayed())}get elementPath(){return this.elementContext?this.elementContext.path:null}get element(){return this.elementContext?this.elementContext.element:null}get targetElementPath(){return this.elementPath}get targetElementRect(){return this.element?Kt(window.targetWindow,this.element.getBoundingClientRect()):null}merge(e){this.editing=e.editing,this.previewing=e.previewing,this.name=e.name,this.align=e.align,this.content=e.content,this.elementIdent=e.elementIdent,this.visibilityRules=e.visibilityRules,this.url=e.url,this.options=e.options,this.autoplay=e.autoplay}deregisterElementMonitor(){this.elementMonitor&&(this.elementMonitor.dispose(),this.elementMonitor=null)}registerElementMonitor(){this.elementContext&&!this.elementMonitor&&(this.elementContext.element.setAttribute(this.elementIdentity,""),this.elementMonitor=new In(window.targetWindow,this.elementIdentity,this.index,this.elementContext,this.onElementVisibilityChange,this.onElementPositionChange,this.onElementLost,this.editing==Lt.NoEditing,this.editing==Lt.DialogEditing?["resize"]:["scroll","resize"]))}deregisterVisibilityRulesMonitors(){this.visibilityMonitor&&(this.visibilityMonitor.stop(),this.visibilityMonitor=null)}registerVisibilityRulesMonitors(){this.visibilityMonitor||(this.visibilityMonitor=new Ji(window.targetWindow,this.visibilityRules,(()=>this.onRuleChanged())),this.visibilityMonitor.start())}registerAutoplayRulesMonitors(){this.autoplay&&!this.autoplayMonitor&&(this.autoplayMonitor=new Ji(window.targetWindow,this.autoplay.rules,(()=>this.onAutoplayRuleChanged())),this.autoplayMonitor.start())}deregisterAutoplayRulesMonitors(){this.autoplayMonitor&&(this.autoplayMonitor.stop(),this.autoplayMonitor=null)}findElement(){const e=function(e,t,n){const i=e+1e3*t;return{interval:n.searchRepeatInterval,attempts:i/n.searchRepeatInterval}}(this.searchTime,this.options.extraWait||0,this.applicationProfile);return this.elementIdent.matcherOptions=this.elementIdent.matcherOptions||this.options.matcherOptions,this.tryToFindElement(this.elementIdent,0,e)}deregisterWithFailure(e){this.deregister(),this.delegate.onFail(this,e)}handleEvaluationFailure(){this.editing===Lt.InlineEditing&&this.previewing&&this.elementContext&&this.openEditDialog()}checkAutoplay(){return new Promise((e=>{this.isAutoplayTriggerable=!!this.autoplay&&function(e,t){switch(t){case Dt.Never:return!1;case Dt.OnlyOnce:return 0===(X(`newired.tip.${e}.autoplayCount`)||0);case Dt.Everytime:return!0}}(this.id,this.autoplay.trigger),this.autoplay&&this.isAutoplayTriggerable?Ro(window.targetWindow,this.autoplay.rules,this.applicationProfile,this.context,(t=>{var n;this.areAutoplayRulesValid=t,this.shouldBeAutoPlayed()&&(n=this.id,Y(`newired.tip.${n}.autoplayCount`)),e()})):e()}))}evaluate(){this.evaluateTip().catch((e=>{this.elementContext&&(this.registerVisibilityRulesMonitors(),this.registerAutoplayRulesMonitors()),this.deregisterWithFailure(e),this.handleEvaluationFailure()}))}shouldBeEvaluated(){return this.editing==Lt.DialogEditing||Yo.isOnSiteUrl(this.url,this.urlPath,window.targetWindow.location)&&Nt(this.context.overlayLanguage,this.name)}static isOnSiteUrl(e,t,n){const i=t||"";if(null!=e){return function(e,t){const n=vn(e);return vn(t.protocol+"//"+t.host+t.pathname).startsWith(n)}(e.endsWith(i)?e.substr(0,e.lastIndexOf(i)):e,n)}return!0}evaluateVisibility(){return zt(this,void 0,void 0,(function*(){const e=_i(this.visibilityRules).filter((e=>Pi(e)||Ai(e)||Oi(e)));const t=function(e){return _i(e).filter((e=>Di(e)||ki(e)))}(this.visibilityRules),n=0===e.length,i=0===t.length;if(n&&i)return this.elementContext=yield this.findElement(),!0;const r=Bi(this.visibilityRules),s=Fi(this.visibilityRules),o=yield $o(window.targetWindow,e,this.applicationProfile,this.context);if(r&&!n&&o)return this.elementContext=yield this.findElement(),!0;return!(s&&!n&&!o)&&(this.elementContext=yield this.findElement(),yield $o(window.targetWindow,t,this.applicationProfile,this.context))}))}clean(){this.isSticky=!1,this.mouseEntered=!1,this.elementContext=null,this.bubblePosition=On(),this.evaluating=!1,this.takingScreenshot=!1,this.areAutoplayRulesValid=!1,this.isAutoplayTriggerable=!1}isObsolete(e){let t;return this.elementMonitor&&(t=this.elementMonitor.elementBounds||void 0),ft(window.targetWindow,e,t)}isRegistered(){return null!=this.elementContext&&!this.isObsolete(this.elementContext.element)&&!this.evaluating}isReselecting(){return!this.previewing&&this.editing==Lt.DialogEditing}setBubblePosition(e,t,n,i){this.bubblePosition.bounds=e,this.bubblePosition.isFlipped=n,this.bubblePosition.arrowBounds=t,this.bubblePosition.zIndex=i}registerBubbleEvents(){const e=this.bubble.getFrame();this.addBubbleEventListener(e,"mouseenter",this.mouseEnterBubbleHandler),this.addBubbleEventListener(e,"mouseleave",this.mouseLeaveBubbleHandler)}deregisterBubbleEvents(){this.bubble.bubbleFrame&&this.eventMap.dispose(this.bubble.bubbleFrame)}renderUI(){this.bubble.renderUI(this.toBubbleInfo())}onRendered(){this.registerElementMonitor(),this.registerBubbleEvents(),this.updateBubblePosition(),this.evaluating=!1,this.delegate.onSuccess(this)}onRenderingFailed(e){this.deregisterWithFailure(e)}updateUI(){this.calculateBubbleBoundsInfo(),this.bubble.updateUI(this.toBubbleInfo())}removeUI(){this.deregisterBubbleEvents(),this.bubble.removeUI()}updateBubblePosition(e){this.calculateBubbleBoundsInfo(e),this.bubble.updatePosition(this.toBubbleInfo())}calculateBubbleBoundsInfo(e){if(this.element&&this.elementPath&&this.bubble.bubbleFrame){const t=Mn.calculateBoundsInfo(window.targetWindow,this.element,this.elementPath,e||{width:this.bubble.bubbleFrame.offsetWidth,height:this.bubble.bubbleFrame.offsetHeight},this.align,this.bubble.bubbleFrame,this.documentDimension,!1,!1,0);t&&this.setBubblePosition(t.bounds,t.arrowBounds,t.isFlipped,this.editing===Lt.InlineEditing?n.MAX_ZINDEX:this.calcZIndex(this.element))}}toBubbleInfo(){return{bounds:this.bubblePosition.bounds,arrowBounds:this.bubblePosition.arrowBounds,name:this.getTranslatedValue(this.name),namePlaceholder:this.getPlaceholder(),content:this.getTranslatedValue(this.content),theme:this.theme,align:this.align,isFlipped:this.bubblePosition.isFlipped,visible:this.mouseEntered||this.shouldBeBubbleVisible,bubbleSize:this.options.bubbleSize,zIndex:this.getZIndex(),editing:this.editing,documentDimension:this.documentDimension,targetElementBounds:this.targetElementRect,targetElementPath:this.targetElementPath,inlineEditImmediate:this.editing==Lt.InlineEditing,withCloseButton:this.isSticky||this.shouldBeAutoPlayed()&&this.editing===Lt.NoEditing}}get documentDimension(){return this.elementMonitor?this.elementMonitor.documentDimension:sn(window.targetWindow)}register(){this.renderUI(),this.registerElementEvents()}deregister(e=!1){this.deregisterEvents(),this.removeUI(),this.deregisterElementMonitor(),e&&(this.deregisterVisibilityRulesMonitors(),this.deregisterAutoplayRulesMonitors()),this.dispose(),this.clean()}reposition(){this.tryToFindBubble(0,(()=>{this.updateBubblePosition()}),this.onElementLost)}setOffScreen(e){var t;e&&(null===(t=this.elementMonitor)||void 0===t||t.pause()),this.bubble.setOffScreen()}revertOffScreen(){var e;null===(e=this.elementMonitor)||void 0===e||e.continue(),this.bubble.revertOffScreen()}registerElementEvents(){this.element&&(this.addEventListener(this.element,"mouseenter",this.mouseEnterElementHandler),this.addEventListener(this.element,"mouseleave",this.mouseLeaveElementHandler),this.addEventListener(this.element,"focus",this.focusHandler),this.addEventListener(this.element,"blur",this.blurHandler))}deregisterEvents(){this.element&&this.eventMap.dispose(this.element)}getZIndex(){return this.editing==Lt.InlineEditing?n.MAX_ZINDEX:this.bubblePosition.zIndex+1}updateUIAfterInlineEditChange(){this.calculateBubbleBoundsInfo(),this.bubble.updateUIAfterInlineEditChange(this.toBubbleInfo())}}class Qo{constructor(e,t,i,r,s){this.id=e,this.align=t,this.shape=i,this.size=r,this.color=s,this.element=null,this.top=n.PIXEL_OFFSCREEN,this.left=n.PIXEL_OFFSCREEN,this.createIcon=()=>{const e=document.createElement("nw-icon");return e.id=this.id,e.setAttribute(this.id,""),e.innerHTML=Kn.get(this.shape,this.size,this.color),e}}merge(e){this.align=e.align,this.shape=e.shape,this.size=e.size,this.color=e.color}renderUI(e,t){const n=this.createUI(e);this.element?this.replaceExisting(n,this.element):(this.appendToDOM(n),this.element=n),t(this.element)}removeUI(){if(this.element){const e=this.element.parentNode;e&&(e.removeChild(this.element),this.element=null)}}show(e){this.element&&this.setVisible(this.element,e)}hide(){this.element&&this.setHidden(this.element)}setOffScreen(){this.element&&(this.top=this.element.style.top,this.left=this.element.style.left,this.element.style.left=n.PIXEL_OFFSCREEN,this.element.style.top=n.PIXEL_OFFSCREEN)}revertOffScreen(){this.element&&this.top!==n.PIXEL_OFFSCREEN&&this.left!==n.PIXEL_OFFSCREEN&&(this.element.style.top=this.top,this.element.style.left=this.left)}createUI(e){const t=this.createIcon();return this.updateUI(t,e),t}appendToDOM(e){const t=window.nwApp.querySelector("nw-tips");t&&t.appendChild(e)}replaceExisting(e,t){const n=t.parentNode;n&&(n.replaceChild(e,t),this.element=e)}update(e){this.element&&this.updateUI(this.element,e)}updateUI(e,t){this.setPosition(e,t),t.visible?this.setVisible(e,t.zIndex):this.setHidden(e)}setPosition(e,t){e.style.position="absolute",e.style.top=tt(t.bounds.top),e.style.left=tt(t.bounds.left),e.style.display="block"}setVisible(e,t){e.style.visibility="visible",e.style.zIndex=t.toString()}setHidden(e){e.style.visibility="hidden",e.style.zIndex="-1"}}class Ko extends Yo{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,b,w){super(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,b,w),this.getColorByIndex=(e,t)=>{let n=Kn.defaultColor;return e.forEach((e=>{e.index===t&&(n=e.value)})),n},this.getSizeByIndex=(e,t)=>{let n=Kn.defaultSize;return e.forEach((e=>{e.index===t&&(n=e.value)})),parseInt(n)},this.mouseEnterIconHandler=e=>{this.mouseEntered=!0,this.showBubble(),e.stopPropagation(),e.preventDefault()},this.mouseLeaveIconHandler=e=>{this.mouseEntered=!1,this.hideBubble(),e.stopPropagation(),e.preventDefault()},this.clickIconHandler=e=>(this.toggleSticky(),e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,!1)}setOffScreen(e){var t;e&&(null===(t=this.iconElementMonitor)||void 0===t||t.pause()),super.setOffScreen(e),this.icon.setOffScreen()}revertOffScreen(){var e;this.icon.revertOffScreen(),null===(e=this.iconElementMonitor)||void 0===e||e.continue(),super.revertOffScreen()}registerIconEvents(e){this.addEventListener(e,"mouseenter",this.mouseEnterIconHandler),this.addEventListener(e,"mouseleave",this.mouseLeaveIconHandler),this.addEventListener(e,"click",this.clickIconHandler)}get targetElementPath(){return[]}get targetElementRect(){return this.icon.element?Kt(window.targetWindow,this.icon.element.getBoundingClientRect()):null}}const Zo="[TipIcon]["+window.targetWindow.location.host+"] ";class ea extends Ko{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,w,y,v,E,T,C,S,I,x){super(n,i,e,t,r,s,o,a,l,u,m,f,w,y,v,E,T,C,x),this.context=e,this.iconOffset=h,this.deregisterIconEvents=()=>{this.icon.element&&this.eventMap.dispose(this.icon.element)},this.getDefaultIconPosition=()=>JSON.parse(b.JSON.stringify({bounds:An(),isFlipped:!1})),this.updatePosition=(e=null)=>{try{this.updateIconPosition(e),this.updateBubblePosition()}catch(e){this.onElementLost(e)}},this.updateIconPosition=(e=null)=>{this.calculateIconPosition(e);const t=this.toIconInfo();this.icon.update(t)},this.onElementPositionChange=(e,t)=>{t?this.reposition():(this.icon.update(this.toIconInfo()),this.bubble.updatePosition(this.toBubbleInfo()))},this.updateBubblePosition=e=>{this.calculateBubbleBoundsInfo(e);const t=this.toBubbleInfo();this.bubble.updatePosition(t)},this.calculateBubbleBoundsInfo=(e,t=null)=>{t=t||window.targetDocument.getElementById(this.iconIdentity)||this.icon.element;const n=this.bubble.bubbleFrame||window.targetDocument.getElementById(this.iconIdentity);if(!t||!n)return void this.onElementLost();const i=Mn.calculateBoundsInfo(window.targetWindow,t,[],e||{width:n.offsetWidth,height:n.offsetHeight},this.align,n,this.documentDimension,!0);i&&this.setBubblePosition(i.bounds,i.arrowBounds,i.isFlipped,this.iconPosition.zIndex)},this.onElementVisibilityChange=(e,t)=>{t?this.showIcon():this.hideIcon(),t&&(this.isSticky||this.previewing)?this.showBubble():this.hideBubble()},this.iconIdentity=`newired-tip-icon-id-${n||0}`,this.iconPosition=this.getDefaultIconPosition(),this.icon=new Qo(this.iconIdentity,c,d,this.getSizeByIndex(I,p),this.getColorByIndex(S,g))}get shouldShowIcon(){return this.isTargetElementVisible}merge(e){this.icon.merge(e.icon),this.iconOffset=e.iconOffset,super.merge(e)}toIconInfo(){const e=this.calcZIndex(this.element);return{bounds:this.iconPosition.bounds,isFlipped:this.iconPosition.isFlipped,visible:this.shouldShowIcon,zIndex:e}}register(){this.renderUI()}deregister(e){this.removeUI(),this.deregisterElementMonitor(),e&&(this.deregisterVisibilityRulesMonitors(),this.deregisterAutoplayRulesMonitors()),this.dispose(),this.clean()}clean(){super.clean(),this.iconPosition=this.getDefaultIconPosition()}reposition(){this.shouldShowIcon&&this.tryToFindIcon(this,0,(e=>{this.updatePosition(e)}),this.onElementLost)}updateUI(){this.updateIconPosition(),this.calculateBubbleBoundsInfo(),this.bubble.updateUI(this.toBubbleInfo())}tryToFindIcon(e,t,n,i){const r=window.nwApp.querySelector("#"+e.iconIdentity);var s;r&&((s=r)&&s.nodeType===Node.ELEMENT_NODE)?n(r):10>t?this.tryToFindTimeout=b.setTimeout((function(){e.tryToFindIcon(e,++t,n,i)}),this.applicationProfile.searchRepeatInterval):i()}calculateIconPosition(e=null){if(!(e=e||window.targetDocument.getElementById(this.iconIdentity)||this.icon.element))return void console.error(`${Zo}: icon is not found.`,this.iconIdentity);if(!this.element||!this.elementPath)throw`${Zo}: element or element path is not defined [${this.element}, ${this.elementPath}].`;const t=Mn.calculateBoundsInfo(window.targetWindow,this.element,this.elementPath,{width:this.icon.size,height:this.icon.size},this.icon.align,e,this.documentDimension,!1,!0,this.iconOffset);if(!t)throw`${Zo}: icon position is not calculated.`;this.iconPosition.bounds=t.bounds,this.iconPosition.isFlipped=t.isFlipped,this.iconPosition.zIndex=this.calcZIndex(this.element)}renderUI(){this.icon.renderUI(this.toIconInfo(),(e=>{this.registerIconEvents(e),this.updateIconPosition(e),super.renderUI()}))}removeUI(){this.deregisterIconEvents(),this.icon.removeUI(),super.removeUI()}showIcon(){this.icon.show(this.iconPosition.zIndex)}hideIcon(){this.icon.hide()}}var ta;!function(e){e.TrustElementValue="TrustElementValue",e.DontTrustElementValue="DontTrustElementValue"}(ta||(ta={}));class na{static initMatcherOptions(e,t){return{elementId:this.resolveElementIdMatching(e,t.elementIdHandle),cssSelector:!1,xpathSelector:!1,attributesSelector:!0,textSelector:!!Qe(e),attributesClassSelector:!0}}static resolveElementIdMatching(e,t){const n=e.getAttribute("id");return!!n&&na.resolveIdMatching(t,n)}static resolveIdMatching(e,t){switch(e){case ta.TrustElementValue:return!0;case ta.DontTrustElementValue:return!1;default:if(Array.isArray(e)){const n=na.getExcludeValueRegex(e);if(n)try{const e=new RegExp(n);return!t.match(e)}catch(e){console.warn("Element Id is included, because of invalid regular expression: "+n),console.debug(e)}}}return!0}static getExcludeValueRegex(e){return 0===e.length?null:e.join("|")}}class ia{static evaluateElementIdent(e,t){const n=e.target;if(1!==n.nodeType)return console.warn("Not instance of Element",n),"";let i="{";const r=na.initMatcherOptions(n,t);return i+=ia.evaluateSingleElementIdent(n,r,t.elementClassHandle),i+=ia.evaluatePath(e.iframeContext.getPath(),t.elementClassHandle),i+="}",i}static evaluatePath(e,t){let n=',"path":[';const i=e.length;for(let r=0;r<i;r++){n+="{"+ia.evaluateSingleElementIdent(e[r],mt,t)+"}",r<i-1&&(n+=",")}return n+"]"}static evaluateSingleElementIdent(e,t,n){if(null==e)return"";let i="";try{i=ia.addIdent(i,'"xpath":"'+ia.getXPath(e)+'"')}catch(e){console.error("Identification error: "+e)}try{i=ia.addIdent(i,'"cssSelector":'+JSON.stringify(ia.getCssStructure(e)))}catch(e){console.error("Identification error: "+e)}const r=e.attributes.getNamedItem("id");r&&(i=ia.addIdent(i,'"id":"'+r.value+'"'));const s=e.attributes.getNamedItem("name");s&&(i=ia.addIdent(i,'"name":"'+s.value+'"'));const o=e.attributes.getNamedItem("class");o&&(i=ia.addIdent(i,'"css":"'+ia.removedNewLines(o.value)+'"'));const a=Ye(e);if(a){const t=ia.getTextElement(e,a);i=ia.addIdent(i,'"textElement":'+t)}if(void 0!==e&&e&&e.tagName&&e.attributes){const t=ia.getDescription(e,n);i=ia.addIdent(i,'"elementDescription":'+t)}return i+=', "matcherOptions":'+JSON.stringify(t),i}static addIdent(e,t){return""!==e&&(e+=","),e+t}static getTextIndex(e,t){const n=e.ownerDocument;if(n&&n.defaultView){const i=rt.findElementsWithText(n.defaultView,t);for(let t=0;t<i.length;t++)if(i[t]==e)return t}return null}static getTextElement(e,t){const n=ia.getTextIndex(e,t);let i="{}";return null!==n&&(i=JSON.stringify({textIndex:n.toString(),text:t})),JSON.stringify(i)}static getChildTagIndex(e,t){const n=e.childNodes,i=t.tagName.toLowerCase();let r=0;for(let e=0;e<n.length;e++){const s=n[e];if(s.nodeName.toLowerCase()===i&&r++,s===t)return r}throw"Element is not child given node!"}static skipDocumentFragment(e){return e&&11===e.nodeType?e.host:e}static getXPath(e){let t="",n="";for(e&&3===e.nodeType&&(e=e.parentElement,n="/text()");e&&1===e.nodeType;){const n=e.parentNode;if(n){const i=e.tagName.toLowerCase(),r=this.getChildTagIndex(n,e);let s;s=!("html"===i||"body"===i)&&r>1?"["+r+"]":"",t="/"+i+s+t,e=ia.skipDocumentFragment(n)}else e=null}return t+n}static getCssStructure(e){let t="";for(;e&&1===e.nodeType;){const n=e.tagName.toLowerCase(),i=e.getAttribute("class"),r=i?i.trim().replace(/\s\s*/g,"."):null,s=r&&"html"!==n?"."+r:"",o=e.parentNode;let a="";if(o&&!r){const t=this.getChildTagIndex(o,e);t>1&&(a=":nth-of-type("+t+")")}t=("html"===n?"":">")+n+("html"===n?"":a)+s+t,e=o?ia.skipDocumentFragment(o):null}return t}static removedNewLines(e){return e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"")}static createAttributeInfos(e,t,n){const i=e.name;switch(i){case"class":return ia.splitClassValueToInfos(e.value,this.getClassCategory(n,e.value));default:{const n=function(e,t){return-1===Hi.fromElement(t).hardAttributes.indexOf(e)?et.Soft:et.Hard}(i,t);return[{name:i,value:rt.normalizeAttributeValue(e.value),category:n}]}}}static splitClassValueToInfos(e,t){return rt.decomposeClassAttributeValue(e).map((function(e){return{name:"class",value:e,category:t}}))}static getDescription(e,t){const n=e.tagName.toLowerCase(),i=e.attributes,r=i.length,s=[];for(let n=0;n<r;n++){const r=i[n];this.isAttributeToStore(e,r.name)&&Array.prototype.push.apply(s,this.createAttributeInfos(r,e,t))}const o={tagname:n,hasInnerText:Qe(e),attributes:s};return JSON.stringify(JSON.stringify(o))}static isAttributeToStore(e,t){if("id"===t)return!1;if("newired"===t.substr(0,7).toLowerCase())return!1;if("value"===t){const t=e.tagName.toLowerCase();return"button"===t||"input"===t&&Ke(e)}return!0}static createJson(e,t){return`"${e}":"${escape(t)}"`}static getClassCategory(e,t){switch(e){case ta.TrustElementValue:return et.Hard;case ta.DontTrustElementValue:return et.Soft;default:if(Array.isArray(e)){const n=na.getExcludeValueRegex(e);if(n)try{const e=new RegExp(n);return t.match(e)?et.Soft:et.Hard}catch(e){console.warn("Element Class is included, because of invalid regular expression: "+n),console.debug(e)}}return et.Hard}}}class ra{constructor(e,t,n,i,r){this.id=e,this.align=t,this.shape=n,this.size=i,this.color=r,this._element=null,this.createIcon=()=>{const e=window.targetDocument.createElement("nw-icon");return e.id=this.id,e.setAttribute(this.id,""),e.innerHTML=Kn.get(this.shape,this.size,this.color),ra.applyAlign(this.align,e.style),e},this.removeIcon=()=>{this.removeElement(window.targetDocument.getElementById(this.id))},this.removeIconBlock=()=>{this.removeElement(window.targetDocument.getElementById(this.iconBlockId))}}get element(){return this._element}get wrapperId(){return this.id+"-wrapper"}get iconBlockId(){return this.id+"-block"}createIconBlock(e){const t=window.targetDocument.createElement("DIV");return t.id=this.iconBlockId,t.setAttribute("style","text-align:center;"),t.appendChild(e),t}createWrapper(){const e=window.targetDocument.getElementById(this.wrapperId);if(e)return e;const t=window.targetDocument.createElement("SPAN");return t.id=this.wrapperId,t}render(e,t){if(!e||!e.parentNode)throw`[Tip.IconInserted]  Can not create icon for Tip's element [${e}].`;const n=this.createWrapper(),i=this.createIcon(),r=e,s=e.parentNode;switch(r.muteDomChange=!0,s.muteDomChange=!0,e.parentNode.insertBefore(n,e),this.align.toUpperCase()){case"LEFT":n.appendChild(i),n.appendChild(e);break;case"TOP":n.appendChild(this.createIconBlock(i)),n.appendChild(e);break;case"BOTTOM":n.appendChild(e),n.appendChild(this.createIconBlock(i));break;default:n.appendChild(e),n.appendChild(i)}this._element=i,t(i)}setOffScreen(){this.element&&(this.element.style.display="none")}revertOffScreen(){this.element&&(this.element.style.display="inline")}removeWrapper(){const e=window.targetDocument.getElementById(this.wrapperId);if(e){const t=window.targetDocument.createDocumentFragment();for(;e.firstChild;){const n=e.removeChild(e.firstChild);t.appendChild(n)}e.parentNode&&e.parentNode.replaceChild(t,e)}}removeElement(e){if(e){const t=e.parentNode;t&&t.removeChild(e)}}remove(){this.removeWrapper(),this.removeIconBlock(),this.removeIcon(),this._element=null}}ra.applyAlign=(e,t)=>{switch(e){case"LEFT":t.paddingRight="3px",t.paddingLeft="";break;case"RIGHT":t.paddingRight="",t.paddingLeft="3px";break;default:t.paddingRight="",t.paddingLeft=""}};class sa extends Ko{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,b,w,y,v,E,T,C,S){super(n,i,e,t,r,s,o,a,l,u,g,m,f,b,w,y,v,E,S),this.deregisterIconEvents=()=>{this.icon.element&&this.eventMap.dispose(this.icon.element)},this.deregisterIconElementMonitor=()=>{this.iconElementMonitor&&(this.iconElementMonitor.dispose(),this.iconElementMonitor=null),this.icon.element&&this.icon.element.removeAttribute(this.iconIdentity)},this.deregisterIcon=()=>{this.deregisterIconEvents(),this.deregisterIconElementMonitor(),this.icon.remove()},this.registerIconElementMonitor=e=>{this.iconElementMonitor||(this.iconElementMonitor=new In(window.targetWindow,this.iconIdentity,this.index,{path:[],element:e},this.onIconVisibilityChange,this.onIconPositionChange,this.onIconLost,!0,[]))},this.onIconVisibilityChange=()=>{},this.onIconPositionChange=()=>{},this.onIconLost=()=>{console.debug(`[TipIconInserted] Icon lost for Tip index ${this._id}.`),this.deregister(),this.evaluate()},this.updateBubblePosition=e=>{this.calculateBubbleBoundsInfo(e),this.bubble.updatePosition(this.toBubbleInfo())},this.calculateBubbleBoundsInfo=e=>{const t=this.icon.element||window.targetDocument.getElementById(this.iconIdentity),n=this.bubble.bubbleFrame||window.targetDocument.getElementById(this.iconIdentity);if(!t||!n)return void this.onElementLost();const i=Mn.calculateBoundsInfo(window.targetWindow,t,[],e||{width:n.offsetWidth,height:n.offsetHeight},this.align,n,this.documentDimension,!0);i&&this.setBubblePosition(i.bounds,i.arrowBounds,i.isFlipped,this.calcZIndex(this.element))},this.onElementVisibilityChange=(e,t)=>{t&&(this.isSticky||this.previewing)?this.showBubble():this.hideBubble()},this.iconIdentity=`newired-tip-icon-inserted-id-${n||0}`,this.icon=new ra(this.iconIdentity,c,h,this.getSizeByIndex(C,d),this.getColorByIndex(T,p)),this.elementIdentOrig=m}merge(e){this.icon.align=e.icon.align,this.icon.shape=e.icon.shape,this.icon.size=e.icon.size,this.icon.color=e.icon.color,super.merge(e),this.element&&this.renewElementIdent(this.element)}renderUI(){if(this.element&&!this.icon.element){const e=this.element,t=t=>{this.registerIconEvents(t),this.registerIconElementMonitor(t),this.renewElementIdent(e)};this.icon.render(this.element,t)}}renewElementIdent(e){const t=JSON.parse(`{${ia.evaluateSingleElementIdent(e,this.options.matcherOptions,this.applicationProfile.elementClassHandle)}}`);t.path=this.elementIdent.path,this.elementIdent=t}register(){this.renderUI(),super.renderUI()}deregister(e=!1){this.deregisterElementMonitor(),this.dispose(),this.deregisterIcon(),e&&(this.deregisterVisibilityRulesMonitors(),this.deregisterAutoplayRulesMonitors()),this.removeUI(),this.clean()}clean(){super.clean(),this.elementIdent=this.elementIdentOrig}isRegistered(){return null!==this.icon.element&&!this.evaluating}}function oa(e){return function(e,t,n){const i=function(e){return{translateTexts:!0,editorMetadata:!1,overlayLanguage:e.defaultOverlayLanguage,applicationLanguage:e.defaultApplicationLanguage}}(e),r=ua(function(){const e=P.getValue("overlayLanguage"),t=P.getValue("applicationLanguage"),n={};e&&(n.overlayLanguage=e);t&&(n.applicationLanguage=t);return n}(),ua(t,ua(function(e){const t={};e.overlayLanguage&&(t.overlayLanguage=e.overlayLanguage);e.applicationLanguage&&(t.applicationLanguage=e.applicationLanguage);return t}(e),ua(i,Jt(aa)))));if(n)return ua(n,r);return r}({defaultOverlayLanguage:window.newired._internal.data.getSettings().defaultRuntimeOverlayLanguage,defaultApplicationLanguage:window.newired._internal.data.getSettings().defaultRuntimeApplicationLanguage,overlayLanguage:K(),applicationLanguage:Z()},ca,e)}const aa={translateTexts:!0,editorMetadata:!1,overlayLanguage:"en_US",applicationLanguage:"en_US"},la=["translateTexts","editorMetadata","overlayLanguage","applicationLanguage","customProperties"];function ua(e,t){for(const n in e){const i=e[n];-1!==la.indexOf(n)?t[n]=i:console.debug(`Invalid context property "${n}" with value "${i}". Skipped from merging.`)}return t}let ca={};function ha(e){window.isRunningInEditor?ca.customProperties=e.customProperties:ca=e}function da(e,t,n){return e.guides=e.guides.map((e=>(e.steps=pa(e.steps,t,n),e))),e}function pa(e,t,n){return e=e.map((e=>{const i=Jt(e);return n&&n(i),i.description=function(e,t){return Array.isArray(e)?e.map((e=>(e.value=Go(e.value,t),e))):Go(e,t)}(i.description,t),i}))}function ga(e,t,n,i){return e=e.map((e=>{const r=Jt(e);return n&&n(r),i&&i(r),r.content=function(e,t){return e.map((e=>(e.value=Go(e.value,t),e)))}(r.content,t),r}))}const ma="en_US";function fa(e,t,n){e.setJourneys(da(function(e,t){return e.guides=e.guides.map((e=>(e.name=ba(e.name,e.language),e.description=ba(e.description,e.language),e.steps=e.steps.map((t=>(t.title=ba(t.title,e.language),t.description=ba(t.description,e.language),t))),e.language=ma,e))),e.userTranslations=[{language:"en_US",translations:t}],e}(e.getJourneys(),t),n));const i=e.getTips();return i.tips=ga(i.tips,n),e.setTips(i),e}function ba(e,t){return e.filter((e=>e.language===t)).map((e=>(e.language=ma,e)))}function wa(e){return t=>(t.name=[{language:e,value:t.name}],t.content=[{language:e,value:t.content}],t)}const ya="[Tip.Controller]["+window.targetWindow.location.host+"]";var va;let Ea,Ta;function Ca(e,t){if(Ta=e===Ae.Editor,Ea)throw`${ya} Controller already initialized`;Ea=new xa,Ea&&(console.debug(`${ya} [start] Tips: ${window.newired._internal.data.getTips().tips.length}`),Ea.iconColorPalette=window.newired._internal.data.getTips().iconColorPalette,Ea.iconSizeRange=window.newired._internal.data.getTips().iconSizeRange,Ea.setTips(function(e){const t=e.tips;e.tipRules&&function(e,t){t.forEach((t=>{e.forEach((e=>{t.tipId===e.id&&(e.rules=t.rules)}))}))}(t,e.tipRules);e.tipsAutoplay&&function(e,t){t.forEach((t=>{e.forEach((e=>{t.tipId===e.id&&(e.autoplay=t)}))}))}(t,e.tipsAutoplay);return t}(window.newired._internal.data.getTips()),t),Ea.evaluateTips(t),ka({operation:va.TipActualizeList,data:{}}))}function Sa(e){Ea&&Ea.evaluateTips(e)}!function(e){e.TipActualizeList="tipActualizeList",e.TipActualizeListResult="tipActualizeListResult",e.TipStartPreview="tipStartPreview",e.TipUpdatePreview="tipUpdatePreview",e.TipStopPreview="tipStopPreview",e.TipPreviewable="tipPreviewable",e.ScoreResult="scoreResult",e.CreateScreenshot="createScreenshot",e.ScreenshotCreated="screenshotCreated"}(va||(va={}));const Ia=e=>{Ea&&Ea.replaceTips(e)};class xa{constructor(){this.tips=[],this.iconColorPalette=[],this.iconSizeRange=[],this.messageQueue=[],this.messageQueueTimeout=0,this.registerTimeout=0,this.registerHashChange=()=>{window.targetWindow.addEventListener("hashchange",(()=>{Ea.deregisterTips(),b.setTimeout((()=>{console.debug("Hash changed: going to evaluate tips."),Ea.evaluateTips(oa())}),500)}))},this.evaluateTips=e=>{S(f.EvaluateTipsIncrement,this.tips.length),this.tips.forEach((t=>{e&&t.setContext(e),t.evaluate()}))},this.setAllTipsOffScreen=()=>{this.tips.forEach((e=>{e.isRegistered()&&e.setOffScreen(!1)}))},this.evaluateTipsNotRegistered=()=>{this.tipsInProgress()?(this.registerTimeout&&b.clearTimeout(this.registerTimeout),this.registerTimeout=b.setTimeout((()=>this.evaluateTipsNotRegistered()),20)):this.tips.forEach((e=>{e.isRegistered()||e.isReselecting()||e.evaluate()}))},this.deregisterTips=()=>{this.tips.forEach((e=>{e.deregister(!1)}))},this.sendOnShow=e=>{Ta&&window.sendIPCMessage("launcher",b.JSON.stringify({operation:"tipOnShow",data:{tipId:e.id}}))},this.sendOnHide=e=>{Ta&&window.sendIPCMessage("launcher",b.JSON.stringify({operation:"tipOnHide",data:{tipId:e.id}}))},this.sendTipPreviewable=(e,t)=>{ka({operation:va.TipPreviewable,data:{tipId:e.id,previewable:t}})},this.synchronize=e=>{try{e.forEach((e=>{let t=!1;this.tips.forEach((n=>{e.id===n.id&&(n.merge(e),n.evaluate(),t=!0)})),t||this.addTip(e)}));const t=t=>{return n=e,i=this.tips[t].id,!n.some((e=>e.id===i));var n,i};this.removeTips(t)}catch(e){console.error(e)}},this.actualizeTips=(e,t,n)=>{try{this.iconColorPalette=window.newired._internal.data.getTipsIconColors(),this.iconSizeRange=window.newired._internal.data.getTipsIconSizes();const i=La(oa(),e,t,n,xa.delegates,this.iconColorPalette,this.iconSizeRange);this.synchronize(i)}catch(e){console.error(e)}},this.removeTipAt=e=>{this.tips[e].deregister(!0),this.tips.splice(e,1)},this.removeTips=e=>{let t=this.tips.length;for(;t--;)e(t)&&this.removeTipAt(t)},this.getTipIndexById=e=>{let t=this.tips.length;for(;t--;)if(this.tips[t].id===e)return t;throw`Invalid id of Tip: ${e}`},this.replaceTip=(e,t)=>{const n=this.getTipIndexById(e);console.debug(`${ya} resetTip ${this.tips[n].id}.`),this.tips[n].deregister(!0),this.tips[n]=t},this.previewTips=e=>{for(const t of e){let e=!1;for(const n of this.tips)if(t.id===n.id){this.previewTip(t,n),e=!0;break}e||(b.array.push(this.tips,t),t.evaluate())}},this.shouldResetClass=(e,t)=>e.kind!==t.kind,this.shouldResetPreview=(e,t)=>{if(e.editing!=t.editing)return!0;if(e.visibilityRules!==t.visibilityRules)return!0;if(e instanceof sa&&t instanceof sa){const n=e,i=t;return n.icon.align!==i.icon.align||n.icon.shape!==i.icon.shape||n.icon.size!==i.icon.size||n.icon.color!==i.icon.color||b.JSON.stringify(n.elementIdentOrig)!==b.JSON.stringify(i.elementIdentOrig)}if(b.JSON.stringify(e.elementIdent)!==b.JSON.stringify(t.elementIdent))return!0;if(e instanceof ea&&t instanceof ea){const n=e,i=t;return n.icon.align!==i.icon.align||n.icon.shape!==i.icon.shape||n.icon.size!==i.icon.size||n.icon.color!==i.icon.color}return!1},this.previewTip=(e,t)=>{try{if(this.shouldResetClass(e,t))return this.replaceTip(t.id,e),void e.evaluate();if(this.shouldResetPreview(e,t))return t.deregister(!0),t.merge(e),void t.evaluate();const n=!e.previewing&&t.previewing;t.merge(e),n?t.isReselecting()||t.editing!=Lt.NoEditing&&null===t.id?t.deregister(!0):t.evaluate():t.isRegistered()?t.updateUI():t.evaluate()}catch(e){console.error(`${ya} previewTip failed`,e),t.deregister(!0),xa.delegates.onFail(t,e)}},this.addTip=e=>{b.array.push(this.tips,e),e.evaluate()},this.setTips=(e,t)=>{this.tips=La(t,e,Lt.NoEditing,!1,xa.delegates,this.iconColorPalette,this.iconSizeRange)},this.handlePreview=(e,t,n)=>{try{const i=La(oa(),e,t,n,xa.delegates,this.iconColorPalette,this.iconSizeRange);console.debug(`${ya} Handling preview of ${i.length} Tips. IDs: ${i.map((e=>e.id)).join(", ")} `,i),this.previewTips(i)}catch(e){console.error(e)}},this.enqueueMessage=e=>{b.array.push(this.messageQueue,e),this.messageQueueTimeout||this.triggerMessage()},this.triggerMessage=e=>{this.messageQueueTimeout||((e=e||this.messageQueue.shift())?this.messageQueueTimeout=b.setTimeout((()=>{this.clearMessageQueueTimeout(),e&&!this.tipsInProgress()?(this.processMessage(e),this.messageQueue.length>0&&this.triggerMessage()):this.triggerMessage(e)}),20):this.clearMessageQueueTimeout())},this.clearMessageQueueTimeout=()=>{this.messageQueueTimeout&&(b.clearTimeout(this.messageQueueTimeout),this.messageQueueTimeout=0)},this.processMessage=e=>{try{const t=JSON.parse(e);switch(console.log(`IPC: tips: ${t.operation}`,t.data),t.operation){case va.TipActualizeListResult:this.actualizeTips(ga(t.data,Fe().getSettings().objectStorageUrl,void 0,wa(ma)),Lt.NoEditing,!1);break;case va.TipStartPreview:this.handlePreview(ga(t.data.tips,Fe().getSettings().objectStorageUrl,wa(ma)),t.data.editing,!0);break;case va.TipStopPreview:this.createScreenshotAutomatic(t.data,(()=>{this.handlePreview(ga(t.data.tips,Fe().getSettings().objectStorageUrl,wa(ma)),t.data.editing,!1)}));break;case va.TipUpdatePreview:this.handlePreview(ga(t.data.tips,Fe().getSettings().objectStorageUrl,wa(ma)),t.data.editing,!0);break;case va.CreateScreenshot:this.createScreenshotManual(t.data)}}catch(t){console.log("Error while handling Editor's IPC message: "+e,t)}},this.subscribeIPC(),this.registerHashChange(),Fe().getSettings().tipsDomObserverEnabled&&new jt(window.targetWindow,this),window.targetDocument.addEventListener("microAppBoundsChanged",(e=>{this.tips.forEach((e=>{e.isRegistered()&&e.reposition()}))})),Fe().addChangeListener((()=>{this.tips.forEach((e=>{e.deregister(!0),e.theme=Fe().getSettings().theme,e.applicationProfile=Fe().getApplicationProfile(),e.evaluate()}))}))}getTips(){return this.tips.slice()}domChanged(){this.evaluateTipsNotRegistered()}sendTipScore(e){if(e.editing==Lt.DialogEditing&&e.previewing){const t=St.calculateScore(window.targetWindow,e.element,e.elementIdent);ka({operation:va.ScoreResult,data:{scoreResult:t}})}}replaceTips(e){this.removeTips((()=>!0)),e.forEach((e=>this.addTip(e)))}tipsInProgress(){return this.tips.some((e=>e.evaluating||e.previewing&&e.takingScreenshot))}subscribeIPC(){window.registerIPCMessageListener&&window.registerIPCMessageListener("tips",((e,t)=>{console.log(`${ya}: Got IPC message`,t),this.enqueueMessage(t)}))}createScreenshotAutomatic(e,t){if(e.withScreenshot&&e.tips.length){const n=this.getTipById(e.tips[0].id);n&&!n.containsDynamicContent()?(n.takingScreenshot=!0,this.createScreenshot(n,!0).then((()=>{t(),n.takingScreenshot=!1}))):t()}else t()}createScreenshot(e,t){return new Promise((n=>{this.setAllTipsOffScreenExcept(e.id).then((()=>{e.createScreenshot(t,(()=>{this.revertAllTipsOffScreenExcept(e.id).then((()=>{n(void 0)}))}))}))}))}setAllTipsOffScreenExcept(e){return Ho((()=>{this.tips.forEach((t=>{t.id!==e&&t.isRegistered()&&t.setOffScreen(!0)}))}))}revertAllTipsOffScreenExcept(e){return Ho((()=>{this.tips.forEach((t=>{t.id!==e&&t.isRegistered()&&t.revertOffScreen()}))}))}createScreenshotManual(e){const t=this.getTipById(e.entityId);t&&(t.takingScreenshot=!0,this.createScreenshot(t,!1).then((()=>{t.takingScreenshot=!1})))}getTipById(e){return this.tips.find((t=>t.id===e))}}function La(e,t,n,i,r,s,o){const a=[];let l=0;const u=Fe().getApplicationProfile();return t.forEach((t=>{try{t.rules=i||!t.rules?"[]":t.rules,t.autoplay&&(t.autoplay.rules=i||!t.autoplay.rules?"[]":t.autoplay.rules);const c=JSON.parse(t.element),h=JSON.parse(t.options||"{}");let d;const p=u.useRelativeUrl&&t.url?Tn(t.url,window.targetWindow.location):t.url;d=t.kind===Pt.TipIcon?new ea(e,r,t.id,l,n,i,t.kind,t.name,t.content,t.theme?t.theme:u.theme,t.iconAlign,t.iconOffset,t.iconShape,t.iconSizeIndex,t.iconColorIndex,t.align,c,t.elementTexts,h,u,t.rules,p,t.urlPath,s,o,t.autoplay):t.kind===Pt.TipIconInserted?new sa(e,r,t.id,l,n,i,t.kind,t.name,t.content,t.theme?t.theme:u.theme,t.iconAlign,t.iconShape,t.iconSizeIndex,t.iconColorIndex,t.align,c,t.elementTexts,h,u,t.rules,p,t.urlPath,s,o,t.autoplay):new Yo(t.id,l,e,r,n,i,t.kind,t.name,t.content,t.theme?t.theme:u.theme,t.align,c,t.elementTexts,h,u,t.rules,p,t.urlPath,t.autoplay),b.array.push(a,d),l++}catch(e){console.error(`${ya} Failed to initialize Tip`,t,e)}})),a}function ka(e){Ta&&window.sendIPCMessage("launcher",b.JSON.stringifyPretty(e))}xa.delegates={onSuccess:e=>{Ea.sendTipScore(e),Ea.sendTipPreviewable(e,!0),I(f.EvaluateTipsIncrement)},onFail:(e,t)=>{I(f.EvaluateTipsIncrement),t&&(t.name===xt.MissingTranslation?console.warn(`Skip Tip ${e.id} cause: ${t.message}`):console.debug(`${ya} onFail`,e,t)),Ea.sendTipScore(e),Ea.sendTipPreviewable(e,!1)},onShow:e=>{Ea.sendOnShow(e)},onHide:e=>{Ea.sendOnHide(e)},createScreenshot:e=>Ea.createScreenshot(e,!0)};const Da="[Launcher]["+window.targetWindow.location.host+"]";let Pa,Na,Aa=null;function Oa(e,t){Pa&&Pa.onIPCMessage.send(t)}function Ma(e,t){Pa&&w.receive(t)}function _a(e,t){console.assert(!!window.Elm&&!!window.Elm.Launcher,"Unable to provide Elm Launcher ports. Elm Launcher must be initialized."),Pa||!e?t(Pa):b.setTimeout(_a.safeBind(null,--e,t),300)}function Ra(e,t){Pa&&(Na=t,Pa.onConfirmDialog.send(e))}function Ba(e,t,n,i){Pa&&(Na=i,Pa.onCustomConfirmDialog.send({contentKeys:e,confirmButtonKey:t,cancelButtonKey:n}))}function Fa(){Pa&&Pa.openMenu.send(null)}function Ua(e){ha(e),function(e){Pa&&Pa.updateContext.send(e)}(e),Sa(e)}function Wa(e,t){const n=ne();-1!==n.indexOf(t)?(J("overlayLanguage",t),a(t),e.overlayLanguage=t,Ua(e)):console.error(`Attempt to set invalid user overlay language ${t}. Permitted languages are`,n)}function Ja(e,t){const n=ie();if(-1===n.indexOf(t))return console.error(`Attempt to set invalid user application language ${t}. Permitted languages are`,n),null;J("applicationLanguage",t),e.applicationLanguage=t,Ua(e)}function Ha(t,r,s,o,a){return new Promise(((o,l)=>{const u=window.newired._internal.data,c=window.targetDocument;e(c,c.head,u.deliveryCSS("launcher.css"),void 0,(()=>{e(c,window.nwApp,u.deliveryCSS("launcher.css"),void 0,(()=>{e(c,c.head,u.deliveryCSS("launcher.css",u.getSettings().theme),n.LAUNCHER_THEME_STYLE_ID,(()=>{e(c,window.nwApp,u.deliveryCSS("launcher.css",u.getSettings().theme),n.LAUNCHER_THEME_STYLE_ID,(()=>{const c=i(u.getLauncherScript(),window.targetWindow),h=ne(),d=ie();var p;c?(function(t,i,r,s,o,a,l){const u=function(e,t,n,i,r){const s=Fe();return b.JSON.stringify({config:{shapeType:s.getSettings().launcherShapeType,position:s.getSettings().launcherPosition,title:s.getSettings().launcherTitle},launcherType:e,translationLibrary:s.getTexts(),userTranslationLibrary:s.getJourneys().userTranslations,overlayLanguage:t.overlayLanguage,applicationLanguage:t.applicationLanguage,overlayLanguages:n,applicationLanguages:i,supportedLanguages:s.getJourneys().supportedLanguages,url:window.targetWindow.location.href,launcherVisible:r,numberOfJourneys:s.getJourneys().guides.length})}(r,s,o,a,l),c=t.Launcher.Main.init({node:i,flags:{launcherFlags:u}});return Pa=c.ports,function(t,i,r){return new Promise((s=>{t.initialized.subscribe((function(e){s()})),t.confirmDialogResponse.subscribe((function(e){Na&&Na(e)})),t.sendToEditor.subscribe((function(e){i===Ae.Editor&&window.sendIPCMessage("launcher",e)})),t.launcherCopyToClipboard.subscribe((e=>{try{const t=window.targetDocument,n=t.createElement("input");n.setAttribute("style","position: absolute; left: -1000px; top: -1000px"),n.value=e,t.body.appendChild(n),n.select(),t.execCommand("copy"),t.body.removeChild(n)}catch(e){console.error("Failed to make clipboard copy",e)}})),t.reportLauncherShow.subscribe((()=>{$e(r,"start")})),t.reportLauncherHide.subscribe((()=>{$e(r,"finish")})),t.storeUserName.subscribe((function(e){z("userName",e,L.Never),J("userName",e,L.Never)})),t.storeOverlayLanguage.subscribe((function(e){Wa(oa(),e)})),t.storeApplicationLanguage.subscribe((function(e){Ja(oa(),e)})),t.updateLauncherSiteSettings.subscribe((function(t){const i=window.nwApp.querySelector("#"+n.LAUNCHER_THEME_STYLE_ID),r=()=>{window.nwApp&&(window.nwApp.style.display="none")},s=()=>{window.nwApp&&(window.nwApp.style.display="block")};i&&i.remove(),r();const o=window.newired._internal.data;e(window.targetDocument,window.targetDocument.head,o.deliveryCSS("launcher.css",t.theme),n.LAUNCHER_THEME_STYLE_ID,(i=>{e(window.targetDocument,window.nwApp,o.deliveryCSS("launcher.css",t.theme),n.LAUNCHER_THEME_STYLE_ID,(e=>{s(),e?console.error("CSS link not loaded.",e):za()}))})),window.newired._internal.data.reloadBubbleFrameResources(t.theme,(e=>{e?console.error("Reload bubble frame resources failed",e):Fe().updateSettings(t)}))})),t.sendJourneyFinishFeedback.subscribe((e=>{console.debug(`${Da} [PORT: FINISH_FEEDBACK]`,e),function(e){const t=G();t.journeys.indexOf(e)<0&&(b.array.push(t.journeys,e),P.storeValue("feedback",b.JSON.stringify(t)))}(e.journeyId),Ve(e)})),t.sendJourneyDropOffFeedback.subscribe((e=>{console.debug(`${Da} [PORT: DROP_OFF_FEEDBACK]`,e),Ve(e)})),t.sendStepFeedback.subscribe((function(e){console.debug(`${Da} [PORT: STEP_FEEDBACK]`,e),Ve(e)})),t.getPanelData.subscribe((()=>{window.newired.journeys.getVisibleJourneys(oa({translateTexts:!0})).then((e=>{t.onGetPanelData.send(e)}))})),t.getVisibleJourneys.subscribe((()=>{window.newired.journeys.getVisibleJourneys(oa({translateTexts:!0})).then((e=>{t.onGetVisibleJourneys.send(e)}))})),t.startJourney.subscribe((e=>{window.newired.journeys.start(oa(),e.journeyId,e.stepIndex,e.launchKind).then((t=>{t&&console.info(`${Da} Unable to start Journey ${e.journeyId} from Step ${e.stepIndex}. Cause: ${t}`)}))})),t.stopJourney.subscribe((()=>{window.newired.journeys.stop(0)})),t.setLauncherVisibilityCallback.subscribe((()=>{"function"==typeof Aa&&Aa()}))}))}(Pa,r,Fe().getSettings().siteId).then((()=>{Ti.addSubscriber(window.targetWindow,new qa(Pa)),Fe().addChangeListener((()=>{const e=Fe().getJourneys().guides.length;Pa.onNumberOfJourneysChanged.send(e)}))}))}(c,r,t,s,h,d,a).then(o),za(),p={operation:ja.StateChanged,data:{state:"Ready"}},window.isRunningInEditor&&window.sendIPCMessage("launcher",b.JSON.stringifyPretty(p))):l("Unable to start Launcher")}))}))}))}))}))}class qa{constructor(e){this.elmPorts=e}urlChanged(){this.elmPorts.onUrlChanged.send(window.targetWindow.location.href)}}var ja;function za(){if(window.isRunningInEditor){const e=Fn(Jn.Small),t=Fn(Jn.Medium),n=Fn(Jn.Large),i=Fn(Jn.ExtraLarge);window.sendIPCMessage("launcher",b.JSON.stringify({operation:"bubbleSizes",data:{smallWidth:e.width,smallHeight:e.height,mediumWidth:t.width,mediumHeight:t.height,largeWidth:n.width,largeHeight:n.height,extraLargeWidth:i.width,extraLargeHeight:i.height}}))}}!function(e){e.StateChanged="stateChanged"}(ja||(ja={}));const $a="newired-journey-link";let Va=null;function Ga(e){Va=e}function Xa(){return Va}var Ya;!function(e){e.Play="nw-play",e.Deleted="nw-deleted",e.NotAvailable="nw-notAvailable",e.NotPublished="nw-notPublished"}(Ya||(Ya={}));class Qa extends HTMLElement{constructor(){super()}connectedCallback(){this.render()}getLink(e){if(Va||(Va=Be(window).newired._internal.getJourneyLinks()),Va)for(const t of Va)if(t.id===e)return t;return null}render(){this.reset();const e=this.getLink(Number(this.dataset.journeyId));e?e.deleted?this.deletedLink(e.name):e.available?this.normalLink(e):this.notPublishedLink(e.name):window.isRunningInEditor?this.deletedLink("_permanently_deleted_"):this.notAvailableLink()}reset(){this.onclick=null,this.classList.remove(Ya.Play),this.classList.remove(Ya.Deleted),this.classList.remove(Ya.NotAvailable),this.classList.remove(Ya.NotPublished)}normalLink(e){try{const t=Be(window).newired._internal;this.onclick=t.startJourneyLink.safeBind(this,e)}catch(e){}this.classList.add(Ya.Play),this.textContent=e.name,this.title="Play Journey"+(e.name.length>25?": "+e.name:"")}deletedLink(e){this.classList.add(Ya.Deleted),this.textContent=e,this.title="Linked Journey was deleted!"}notAvailableLink(){this.classList.add(Ya.NotAvailable),this.textContent="Linked Journey is not available",this.title="Linked Journey is not available"}notPublishedLink(e){this.classList.add(Ya.NotPublished),this.textContent=e,this.title="Linked Journey will not be submitted"}}const Ka="nw-message";class Za extends HTMLElement{constructor(e,t){super(),this.message=e,this.onClose=t,this.closeEvent=e=>{this.onClose(),e.preventDefault(),e.stopPropagation(),this.remove()},this.render=()=>{const e=document.createElement("nw-overlay"),t=document.createElement("nw-bubble"),n=document.createElement("nw-close");n.onclick=this.closeEvent;const i=document.createElement("nw-bubble-content");i.innerHTML=this.message,i.classList.add("nw-bubble-content");const r=document.createElement("nw-bubble-footer"),s=document.createElement("nw-button");s.innerHTML=l("dialog_ok"),s.onclick=this.closeEvent,r.appendChild(s),t.appendChild(i),t.appendChild(r),t.appendChild(n),this.appendChild(e),this.appendChild(t)}}connectedCallback(){this.render()}}class el extends HTMLElement{constructor(){super(),this.options=null,this.key=null,this.container=null,this.containerBounds=null,this.observer=null,this.id=`micro-app-${function(e=8){const t=[];for(let n=0;n<e;n++)t.push(Math.floor(100*Math.random())+1);return t.join("")}()}`}static get observedAttributes(){return["key","options"]}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(e,t,n){if("options"===e){if(this.options===n)return;this.options=n,this.updateUI()}else if("key"===e){if(this.key===n)return;this.key=n,this.updateUI()}}updateUI(){if(null!==this.options&&null!==this.key&&this.ownerDocument){if(this.inInlineRemoveMicroAppContentElement(this))return;const e=this.ownerDocument.body.getAttribute("data-nw-theme");window.postMessage({channel:"bubble-frame",operation:"loadMicroApp",parameters:{key:this.key,options:this.options,theme:e,elementId:this.id}},"*"),this.registerObserver(this)}}inInlineRemoveMicroAppContentElement(e){const t=e.parentElement;return null!=t&&("nw-inline-remove-micro-app-content"===t.tagName.toLowerCase()||this.inInlineRemoveMicroAppContentElement(t))}registerObserver(e){this.observer=new MutationObserver(((e,t)=>{for(const t of e)"childList"===t.type&&this.containerBoundsChanged()&&document.dispatchEvent(new CustomEvent("microAppBoundsChanged",{detail:this.key}))})),this.observer.observe(e,{attributes:!1,childList:!0,subtree:!0})}containerBoundsChanged(){if(this.container){const e=this.container.getBoundingClientRect();return null===this.containerBounds?(this.containerBounds=e,!0):this.containerBounds.width!==e.width||this.containerBounds.height!==e.height}return!1}}function tl(e){!function(e){!function(t,n){let i=!1;e.addEventListener(t,(function(){i||(i=!0,e.requestAnimationFrame((function(){e.dispatchEvent(new CustomEvent(n)),i=!1})))}))}("resize","newired-resize")}(e),function(){const e=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){try{if(this.target&&this.target.hasAttribute("newired-tag"))throw new Error("Stopping immediate propagation")}catch(e){return void console.log("overrideStopImmediatePropagation",e)}e.safeApply(this)}}(),function(e){e.document.overridenGetElementsByTagName||(e.document.overridenGetElementsByTagName=e.document.getElementsByTagName,e.document.getElementsByTagName=function(t){return"IFRAME"===t.toUpperCase()?document.querySelectorAll("IFRAME:not([id^=newired])"):e.document.overridenGetElementsByTagName(t)})}(e)}function nl(e){return e.origin+e.pathname}function il(){return window.targetWindow.location.origin+window.targetWindow.location.pathname}function rl(e){const t=function(e){const t=window.newired._internal.data._data._journeys.scripts;if(void 0===t)throw"Script Library not contains any scripts.";if(void 0===t.actions||0===t.actions.length)throw"Script Library not contains any Action scripts.";const n=t.actions.filter((function(t){return t.name===e}));if(1===n.length)return n[0];throw n.length>1?"Script Library contains multiple Action scripts of name '"+e+"'.":"Script Library not contains Action Script of name '"+e+"'."}(e);try{return new Function(t.code)()}catch(e){throw"Action script: '"+t.name+"', code: '"+t.code+"' failed. Cause: "+e}}customElements.get("micro-app")||customElements.define("micro-app",el);class sl{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,w,y,v){this._id=e,this.index=t,this.align=n,this.url=i,this.title=r,this.description=s,this.theme=o,this.transitionType=a,this.spotlight=l,this.options=u,this.searchRetryInterval=c,this.extraWait=h,this.isLast=d,this.isPreview=p,this.editing=g,this.feedback=m,this.endFeedbackEnabled=f,this.skippable=w,this.actions=y,this.journeyDefaultLanguage=v,this.elementMonitor=null,this.timerTimeout=null,this.tryToFindBubbleTimeout=null,this.eventMap=new xn,this.isStarting=!1,this.stepListener=null,this.screenshotsEnabled=Fe().getApplicationProfile().screenshotsEnabled,this.takingScreenshot=!1,this.edited=!1,this.onResized=e=>{this.updateBubblePosition(e)},this.onClickClose=()=>{},this.clear=()=>{this.isStarting=!1},this.addEventListener=(e,t,n)=>{const i=t+".newired-step-bubble-"+this.id;this.eventMap.removeEventListener(e,i),this.eventMap.addEventListener(e,i,n)},this.tryToFindBubble=(e,t,n)=>{const i=window.nwApp.querySelector("#"+this.identity);i?"IFRAME"===i.tagName?t(i):n(this.index):10>e?this.tryToFindBubbleTimeout=b.setTimeout((()=>{this.tryToFindBubble(++e,t,n)}),this.searchRetryInterval):n(this.index)},this.identity=`newired-journey-step-id-${e}`,this.bubble=this.getUI(),this.bubble.setEditorListener(this),this.bubblePosition=On()}containsDynamicContent(){return this.isAutoWidth()&&(this.containsMicroApp()||this.containsVideoOrImage())}containsMicroApp(){return-1!=this.description.indexOf("<micro-app ")}containsVideoOrImage(){return-1!=this.description.indexOf("<figure><iframe ")||-1!=this.description.indexOf("<figure><img ")||-1!=this.description.indexOf("<figure data-nw-image")}unregisterStepTransition(){this.timerTimeout&&b.clearTimeout(this.timerTimeout)}reposition(){this.tryToFindBubble(0,(e=>{this.updateBubblePosition()}),(e=>{this.stepListener&&this.stepListener.onBubbleLost(e)}))}setStepListener(e){this.stepListener=e}get id(){return this._id}renderUI(){try{this.bubble.renderUI(this.toBubbleInfo(this.bubblePosition))}catch(e){this.clear(),this.stepListener&&this.stepListener.onNotStarted(this.index,e)}}onDimensionChanged(e,t){}getAlign(){return this.align}onAlignChanged(e,t){this.align!==e?this.commitInlineEdit(ii.EntityAlign,e,(n=>{n.error||(this.align=e,this.updateBubblePosition()),this.edited=!0,t(n.error)})):t(null)}stop(){this.bubble.removeUI(),this.dispose(),this.clear()}update(){this.bubble.bubbleFrame&&this.updateUI(this.bubble.bubbleFrame)}merge(e){this.description=e.description,this.title=e.title,this.options=e.options,this.spotlight=e.spotlight,this.transitionType=e.transitionType,this.feedback=e.feedback}onRendered(){this.stepListener&&(this.registerStepTransition(),this.registerElementMonitor(),this.updateBubblePosition(),this.isStarting=!1,this.stepListener.onStarted(this.index))}onRenderingFailed(e){this.clear(),this.stepListener&&this.stepListener.onNotStarted(this.index,e)}runTransition(e){const t=this.options.timer;t?(console.debug("Postponing transition for: "+t+" sec."),this.timerTimeout=b.setTimeout(e,1e3*t)):e()}isPreviewing(){return this.isPreview}onEditing(){this.stepListener&&this.stepListener.onPause(this.index)}onEditingOver(e,t){!this.edited||t||this.containsDynamicContent()?e():(this.takingScreenshot=!0,this.createScreenshot(!0,(()=>{this.stepListener&&this.stepListener.onResume(this.index),e(),this.takingScreenshot=!1}))),this.edited=!1}onEditEnded(e){w.send(b.JSON.stringify({operation:"inlineEditEnded",data:{entityId:this._id,entityKind:ni.StepEntity}}),(t=>{"success"!==t.kind&&console.error("End of inline-edit failed",t),this.stepListener&&this.stepListener.onResume(this.index),e&&e()}))}onTitleChanged(e,t,n){n&&""===e&&(e=this.getPlaceholder()),this.title!==e?this.commitInlineEdit(ii.EntityName,e,(n=>{n.error||(this._id=n.entityId,this.title=e,this.isAutoWidth()&&this.updateUIAfterInlineEditChange()),this.edited=!0,t(n.error,this.title)})):t(null,e)}isAutoWidth(){switch(this.options.bubbleSize){case Jn.Auto:return!0;default:return!1}}onContentChanged(e,t){this.description!==e?this.commitInlineEdit(ii.EntityContent,Xo(e),(n=>{if(!n.error){this._id=n.entityId;const t=null==this.description||""===this.description||""===e;this.description=e,(this.isAutoWidth()||t)&&this.updateUIAfterInlineEditChange()}this.edited=!0,t(n.error,this.description)})):t(null,e)}onTransitionChanged(e,t,n){if(this.transitionType!==e){const i=b.JSON.stringify({transitionType:e,timer:t});this.commitInlineEdit(ii.EntityStepTransition,i,(i=>{i.error||(this._id=i.entityId,this.transitionType=e,this.options.timer=t,this.updateUIAfterInlineEditChange()),this.edited=!0,n(i.error,this.transitionType)}))}else n(null,e)}openEditDialog(e){this._id?window.sendIPCMessage("launcher",b.JSON.stringify({operation:"startStepEditDialog",data:{stepId:this._id,resumeEditing:e}})):console.error("Unable to open editDialog due null id")}getTransitionType(){return this.transitionType}getPlaceholder(){return function(e){switch(e){case we.Next:return"Click Next to continue";case we.Click:return"Click Here";case we.ValueChange:return"Select Value";case we.Editing:return"Type Here";case we.Hover:return"Hover Here";case we.Multiple:return"Read Here";case we.Timing:return"Please Wait";case we.PageRefresh:return"Click Here"}}(this.transitionType)}get shouldShowEndButton(){return this.isLast&&this.transitionType===we.Next&&!this.isPreviewing()}get shouldShowNextButton(){return!this.shouldShowEndButton&&this.transitionType===we.Next}get shouldShowEndFeedbackButton(){return this.endFeedbackEnabled&&this.isLast}dispose(){this.deregisterElementMonitor(),this.timerTimeout&&b.clearTimeout(this.timerTimeout),this.tryToFindBubbleTimeout&&b.clearTimeout(this.tryToFindBubbleTimeout)}commitInlineEdit(e,t,n){w.send(b.JSON.stringify({operation:"inlineEditCommit",data:{entityId:this._id,entityKind:ni.StepEntity,property:e,value:t}}),(e=>{if("success"===e.kind){const t=wi(e.data);t.error&&console.error("Commit inline-edit failed",t.error),n(t)}else console.error("Commit inline-edit failed",e)}))}deregisterElementMonitor(){this.elementMonitor&&(this.elementMonitor.dispose(),this.elementMonitor=null)}createScreenshot(e,t){this.screenshotsEnabled&&this.takingScreenshot?zo(e,this._id,ho.Step,this.bubble,t):t()}}function ol(e,t,n,i){const r=t.clientHeight||e.document.documentElement.clientHeight;return Math.ceil(n+i-r/2)}function al(e,t,n,i){const r=t.clientWidth||e.document.documentElement.clientWidth;return Math.ceil(n+i-r/2)}function ll(e,t,n){const i=function(e,t){let n=0,i=0,r=kt.TopCenter;switch(e){case kt.TopCenter:n=t.top,i=t.left;break;case kt.BottomCenter:n=t.bottom,i=t.left;break;case kt.LeftMiddle:n=t.top,i=t.left;break;case kt.RightMiddle:r=kt.LeftMiddle,n=t.top,i=t.right}return{top:n,left:i,align:r}}(n,e.getBoundingClientRect()),r=t.getBoundingClientRect();return{top:i.top-r.top+t.scrollTop,left:i.left-r.left+t.scrollLeft,align:i.align}}function ul(e,t,n,i,r){"contentWindow"in t?function(e,t,n,i){const r=e.contentWindow;r&&r.scrollTo(al(r,e,n,0),ol(r,e,t,i))}(t,n,i,r):"scrollTop"in t&&"scrollLeft"in t&&function(e,t,n,i,r){t.scrollTop=ol(e,t,n,r),t.scrollLeft=al(e,t,i,0)}(e,t,n,i,r)}function cl(e,t,n,i){let r=0,s=0,o=null,a=t.element;for(;o=en(e,a);){const t=ll(a,o,n);n=t.align,r+=t.top,s+=t.left;ul(e,o,r,s,0),a=o}hl(0,e,t,n,i)}function hl(e,t,n,i,r){const s=function(e,t,n){const i=e.document,r=t.getBoundingClientRect(),s=n===kt.BottomCenter?r.bottom:r.top,o=n===kt.RightMiddle?r.right:r.left,a=i.documentElement.clientTop||i.body.clientTop,l=i.documentElement.clientLeft||i.body.clientLeft;return{top:s+Xt(e)-a,left:o+Yt(e)-l}}(t,n.element,i);b.scrollTo(t,function(e,t,n){const i=e.innerWidth||e.document.documentElement.clientWidth;return Math.ceil(t+n-i/2)}(t,s.left,0),function(e,t,n){const i=e.innerHeight||e.document.documentElement.clientHeight;return Math.ceil(t+n-i/2)}(t,s.top,0));!pn(t,n).isVisible&&e<1?b.setTimeout((()=>{hl(++e,t,n,i,r)}),100):r()}class dl extends zn{constructor(){super(...arguments),this.bubble=null}updatePosition(e){this._bubbleFrame&&(this.setPosition(this._bubbleFrame,e),this.setVisibility(this._bubbleFrame,e.visible),this.setArrow(this._bubbleFrame,Pn.getBubbleElement(this._bubbleFrame),e),this.updateInlineEditor(e))}createUI(e,t){const n=super.createUI(e,t);return e.withCloseButton&&this.createCloseButton(n,e.button.close),this.bubble=n,n}hasFooter(e){return e.button.feedback||e.button.feedback||e.button.endWithFeedback||e.button.next||e.button.end}appendFooter(e,t,n){if(this.hasFooter(n)){const i=this.createFooter(e,n);if(i)return void t.appendChild(i)}}createFooter(e,t){const n=e.createElement("nw-bubble-footer"),i=this.createFeedbackButton(t),r=this.createEndFeedbackButton(t),s=this.createNextButton(t),o=this.createEndButton(t);return i&&n.appendChild(i),r&&n.appendChild(r),s&&n.appendChild(s),o&&n.appendChild(o),n}createButton(e,t,n,i,r,s){const o=document.createElement(e);return o.setAttribute("data-role",t),s&&o.setAttribute("disabled",""),o.onclick=e=>(n(),e.stopPropagation(),e.preventDefault(),!1),o.innerHTML=l(i,r),o.tabIndex=1,o}createFeedbackButton(e){return e.button.feedback?this.createButton("nw-link","feedback",e.button.feedback,"player_step_sendFeedback",e.button.journeyDefaultLanguage,!1):null}createEndFeedbackButton(e){if(e.button.endWithFeedback){const t=this.createButton("nw-button","end-with-feedback",e.button.endWithFeedback,"player_step_endWithFeedback",e.button.journeyDefaultLanguage,!1);return t.setAttribute("type","secondary"),t}return null}createNextButton(e){return e.button.next?this.createButton("nw-button","next",e.button.next,"player_step_next",e.button.journeyDefaultLanguage,!1):null}createEndButton(e){return e.button.end?this.createButton("nw-button","end",e.button.end,"player_step_end",e.button.journeyDefaultLanguage,!1):null}setAnimation(e,t,n){const i=n?`NW-BounceTo${r=n,r[0].toUpperCase()+r.toLowerCase().slice(1)}`:"";var r;switch(t){case he.None:e.classList.remove("NW-Animated"),e.classList.remove("NW-FadeIn"),e.classList.remove(i);break;case he.FadeIn:e.classList.add("NW-Animated"),e.classList.add("NW-FadeIn");break;case he.BounceTo:e.classList.add("NW-Animated"),e.classList.add(i)}}registerEditing(e,t,n,i){window.isRunningInEditor&&this.editorListener&&this._bubbleFrame&&this._bubbleFrame.contentDocument&&(this.registerInlineEditor(e,t,this.editorListener,i),this.startInlineEditor(n))}}class pl extends dl{constructor(e,t){super(e,t)}renderUI(e){const t=this.createBubbleFrame(e.theme,(t=>{if(t.contentDocument){const n=this.createUI(e,t.contentDocument);this.appendBubble(t.contentDocument,n),this.registerEditing(t.contentDocument,n,e.inlineEditImmediate,e.bounds),this.resizeMonitorElement=Pn.setResizeMonitor(t,this.UIListener.onResized),this.setAnimation(t,e.animationType,e.align),this.setArrow(t,n,e),this.setPosition(t,e),this.setVisibility(t,e.visible),this.UIListener.onRendered()}else this.UIListener.onRenderingFailed("Unable to render bubble: Missing bubble iframe.")}));this.appendOrReplaceBubbleFrame("nw-steps",t)}updateUI(e){super.updateUI(e,((t,n)=>{this.updatePosition(e),this.setAnimation(t,e.animationType,e.align)}))}show(){this.bubbleFrame&&this.setVisible(this.bubbleFrame)}hide(){this.bubbleFrame&&(this.setHidden(this.bubbleFrame),this.blur(this.bubbleFrame))}createUI(e,t){const n=super.createUI(e,t);return n.appendChild(this.createArrow(t,e)),this.setSize(n,e),n}createContent(e,t){return t.content?super.createContent(e,t):null}addSpecialClasses(e,t){super.addSpecialClasses(e,t),t.content||this.hasFooter(t)||e.classList.add(Hn)}setVisible(e){e.style.visibility="visible",e.style.zIndex=n.MAX_ZINDEX.toString()}setHidden(e){e.style.visibility="hidden",e.style.zIndex="-1"}bubbleSizeToPxWidth(e){switch(e){case Jn.Small:return"280px";case Jn.Medium:return"350px";case Jn.Large:return"440px";case Jn.ExtraLarge:return"560px";case Jn.Auto:case null:return"auto";default:return isNaN(e)?"auto":e+"px"}}bubbleSizeToPxMinWidth(e){switch(e){case Jn.Auto:case null:return"96px";default:return this.bubbleSizeToPxWidth(Jn.Small)}}registerInlineEditor(e,t,n,i){null==this.inlineEditor&&this._bubbleFrame&&this._bubbleFrame.contentDocument&&(this.inlineEditor=new fi(window.targetWindow,{dropPositions:[kt.TopCenter,kt.LeftMiddle,kt.BottomCenter,kt.RightMiddle],transitions:[we.Click,we.Next,we.Editing,we.ValueChange,we.Hover,we.Multiple,we.Timing,we.PageRefresh],resizable:!1},this,n,i))}}class gl extends sl{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f,b,w,y,v,E,T,C,S){super(e,t,a,i,r,s,o,u,c,p,g,l,b,w,y,v,E,T,C,S),this.elementIdent=h,this.elementTexts=d,this.searchTime=m,this.searchExtraTime=f,this.skippable=T,this.elementMonitor=null,this.elementContext=null,this.suppressSearch=!1,this.onMousedownTransiting=!1,this.onElementVisibilityChange=(e,t)=>{t?this.bubble.show():this.bubble.hide(),this.handleSpotlight()},this.startTransition=e=>{this.runTransition((()=>{this.stepListener&&this.stepListener.onTransitionFromStep(this.index,e)}))},this.clear=()=>{this.isStarting=!1,this.elementContext=null,this.bubblePosition=On()},this.elementIdent=vi(this.elementIdent,this.elementTexts,n.applicationLanguage)}get elementPath(){return this.elementContext?this.elementContext.path:null}get element(){return this.elementContext?this.elementContext.element:null}get elementRect(){return this.element?Kt(window.targetWindow,this.element.getBoundingClientRect()):null}play(){this.isStarting=!0,this.dispose(),this.findElement().then((e=>{cl(window.targetWindow,e,this.align,(()=>this.renderUI()))}),(e=>{this.clear(),this.handleElementNotFound(),this.stepListener&&this.stepListener.onNotStarted(e)}))}handleElementNotFound(){this.editing===Lt.InlineEditing&&this.isPreviewing()&&this.openEditDialog(!1)}offscreen(){this.bubble.setOffScreen()}setPosition(){this.bubble.updatePosition(this.toBubbleInfo())}addTransitionListener(e,t,n){const i=e+".newired-step-"+this.index;this.element&&(this.eventMap.removeEventListener(n||this.element,i),this.eventMap.addEventListener(n||this.element,i,t))}removeTransitionListener(e,t){if(this.element){const n=e+".newired-step-"+this.index;this.eventMap.removeEventListener(t||this.element,n)}}dispose(){super.dispose(),this.unregisterStepTransition(),this.suppressSearch=!0}unregisterStepTransition(){super.unregisterStepTransition(),this.element&&this.eventMap.dispose(this.element)}findElement(){return this.suppressSearch=!1,new Promise(((e,t)=>{const n=ml(this.searchTime,this.extraWait,this.searchExtraTime,this.options.extraWait)/this.searchRetryInterval;console.log(`Searching element at step index ${this.index} with max search attempts ${n} and interval ${this.searchRetryInterval} ms.`),this.tryToFindBubbleTimeout=b.setTimeout(this.tryToFindElement.safeBind(this,0,n,e,t),20)}))}toBubbleInfo(){return{bounds:this.bubblePosition.bounds,arrowBounds:this.bubblePosition.arrowBounds,name:this.title,namePlaceholder:this.getPlaceholder(),content:this.description,theme:this.theme,align:this.align,isFlipped:this.bubblePosition.isFlipped,visible:this.shouldBeBubbleVisible,bubbleSize:this.options.bubbleSize,button:{next:this.shouldShowNextButton&&this.stepListener?this.stepListener.onTransitionFromStep.safeBind(this,this.index):void 0,close:this.stepListener?this.stepListener.onBubbleClosed:()=>{},end:this.shouldShowEndButton&&this.stepListener?this.stepListener.endJourney.safeBind(this,!1):void 0,endWithFeedback:this.shouldShowEndFeedbackButton&&this.stepListener?this.stepListener.endJourney.safeBind(this,!0):void 0,feedback:this.feedback&&this.stepListener?this.stepListener.onShowFeedback.safeBind(this,this.id,this.index):void 0,journeyDefaultLanguage:this.journeyDefaultLanguage},animationType:this.options.animationType,editing:this.editing,documentDimension:this.documentDimension,targetElementBounds:this.elementRect,targetElementPath:this.elementPath,inlineEditImmediate:this.editing==Lt.InlineEditing,withCloseButton:!0}}merge(e){super.merge(e),this.align=e.align,this.extraWait=e.extraWait,this.elementIdent=e.elementIdent}updateUI(e){this.calculateBoundsInfo(),this.bubble.updateUI(this.toBubbleInfo()),this.handleSpotlight()}updateUIAfterInlineEditChange(){this.calculateBoundsInfo(),this.bubble.updateUIAfterInlineEditChange(this.toBubbleInfo()),this.handleSpotlight()}updateBubblePosition(e){this.calculateBoundsInfo(e),this.bubble.updatePosition(this.toBubbleInfo()),this.handleSpotlight()}get documentDimension(){return this.elementMonitor?this.elementMonitor.documentDimension:sn(window.targetWindow)}calculateBoundsInfo(e){if(this.element&&this.elementPath&&this.bubble.bubbleFrame){const t=Mn.calculateBoundsInfo(window.targetWindow,this.element,this.elementPath,e||{width:this.bubble.bubbleFrame.offsetWidth,height:this.bubble.bubbleFrame.offsetHeight},this.align,this.bubble.bubbleFrame,this.documentDimension);t&&(this.bubblePosition={bounds:t.bounds,isFlipped:t.isFlipped,arrowBounds:t.arrowBounds,zIndex:n.MAX_ZINDEX})}}handleSpotlight(){this.spotlight&&this.elementMonitor&&this.stepListener&&this.stepListener.renderSpotlight(this.elementMonitor.elementIsVisible?this.element:null)}registerElementMonitor(){this.elementContext&&!this.elementMonitor&&this.stepListener&&(this.elementMonitor=new In(window.targetWindow,this.identity,this.index,this.elementContext,this.onElementVisibilityChange,this.stepListener.onPositionChange,this.stepListener.onElementLost,!this.isPreview,["scroll","resize"]))}startClickTransition(e){["mousedown","mouseup","click"].forEach((e=>this.removeTransitionListener(e))),this.startTransition(new Te(e))}registerClickTransition(){this.addTransitionListener("click",(e=>{this.onMousedownTransiting=!1,this.startClickTransition(e.ctrlKey)})),this.addTransitionListener("mousedown",(()=>{this.onMousedownTransiting=!0})),this.addTransitionListener("mouseup",(e=>{this.onMousedownTransiting&&b.setTimeout((()=>{this.onMousedownTransiting&&(this.onMousedownTransiting=!1,this.startClickTransition(e.ctrlKey))}))}))}registerStepTransition(){if(this.isPreview)return;if(!this.element)return;const e=this.element,t=e.tagName,n="INPUT"==t.toUpperCase(),i="SELECT"==t.toUpperCase();switch(this.transitionType){case we.Next:break;case we.Click:this.registerClickTransition();break;case we.Hover:{const e="mouseover";this.addTransitionListener(e,(()=>{this.removeTransitionListener(e),this.startTransition()}));break}case we.ValueChange:if(n||i){const e="change";this.addTransitionListener(e,(()=>{this.removeTransitionListener(e),this.startTransition()}))}else{const t=e.querySelectorAll("input,select");if(t.length){let e=0;const n=t.length,i="change";for(;e<n;e++){const n=t[e];this.addTransitionListener(i,(()=>{this.removeTransitionListener(i),this.startTransition()}),n)}}else{const e="click";this.addTransitionListener(e,(()=>{this.removeTransitionListener(e),this.startTransition()}))}}break;case we.Editing:{let t=!1;const n="keyup";this.addTransitionListener(n,(()=>{const i=e.value;i&&i.length>0&&!t&&(t=!0,this.removeTransitionListener(n),this.startTransition())}));break}case we.Multiple:case we.Timing:case we.PageRefresh:}}findMostSuitableElement(){return this.elementIdent.matcherOptions=this.elementIdent.matcherOptions||this.options.matcherOptions,wt(window.targetWindow,this.elementIdent)}get isTargetElementVisible(){return!!this.elementMonitor&&this.elementMonitor.elementIsVisible||!!this.elementContext&&pn(window.targetWindow,this.elementContext).isVisible}get shouldBeBubbleVisible(){return this.isTargetElementVisible}tryToFindElement(e,t,n,i){if(this.suppressSearch)return;const r=this.findMostSuitableElement();r?(r.element.setAttribute(this.identity,""),this.elementContext=r,console.debug(`[Journey.Step] Element found for the step index: ${this.index}`,this.elementContext.element),n(this.elementContext)):e++<t?(console.debug(`[Journey.Step] Element not found for the step index: ${this.index}, attempt no.: ${e}.`),this.tryToFindBubbleTimeout=b.setTimeout(this.tryToFindElement.safeBind(this,e,t,n,i),this.searchRetryInterval)):(console.debug(`[Journey.Step]  Element not found for the step index: ${this.index}, max. attempts reached: ${t}.`),i(this.index))}getUI(){return new pl(`newired-journey-step-id-${this.id}`,this)}}function ml(e,t,n,i){return e+1e3*(t?n:0)+1e3*(i||0)}var fl={isIE11:function(){return navigator.userAgent.indexOf("Trident/")>0},isSafari:function(){return navigator.userAgent.indexOf("Safari")>0&&-1===navigator.userAgent.indexOf("Chrome")}};const bl=[];function wl(){return bl.length>0}function yl(){return!window.isRunningInEditor||Be().getEditorUserSettingsValue("autoplayEnabled")}function vl(e){return e.rules&&"[]"!==e.rules&&JSON.parse(e.rules).length>0&&!function(e){const t=JSON.parse(e.options);if(t.hasOwnProperty("playOnce")){if(t.playOnce){const t=`newired.guide.${e.guideId}.playCount`;return(X(t)||0)>0}{const t=`newired.guide.${e.guideId}.stopAutoplay`;return!!X(t)}}return!1}(e)}function El(e,t,n,i,r){console.assert(!wl(),"Journey Autoplay monitors are already registered."),t&&t.forEach((t=>{if(vl(t)){const s=new Ji(e,t.rules,(()=>{(function(e,t,n,i){return new Promise((r=>{yl()&&Ro(e,t.rules,n,i,r)}))})(e,t,n,i).then((e=>{e&&wl()&&(Tl(),r(i,t.guideId))}))}));bl.push({journeyId:t.guideId,monitor:s}),s.start()}}))}function Tl(){let e;for(;e=bl.shift();)e.monitor.stop()}function Cl(e,t,n,i,r){Tl(),El(e,t,n,i,r)}function Sl(e,t,n,i,r,s){const o=function(e,t){const n=function(e){return e.sort(((e,t)=>e.order>t.order?1:-1))}(t),i=[];for(let t=0;t<n.length;t++)for(let r=0;r<e.length;r++)n[t].id==e[r].guideId&&b.array.push(i,e[r]);return i}(t,n),a=Vi(e,o,i);Il(Jt(o),a,i.contentRuleSettings,r,s)}function Il(e,t,n,i,r){const s=e.shift();if(s){const o=JSON.parse(s.rules);vl(s)?Bo(o,t,n,i,(o=>{o?r(s.guideId):Il(e,t,n,i,r)})):Il(e,t,n,i,r)}else r(null)}var xl;!function(e){e[e.Started=0]="Started",e[e.Playing=1]="Playing",e[e.Stopped=2]="Stopped",e[e.Previewing=3]="Previewing"}(xl||(xl={}));class Ll{constructor(e,t,n,i,r,s,o,a,l,u,c,h){this.context=e,this.siteId=t,this.journeyId=n,this.journeyName=i,this.launchKind=r,this.steps=s,this.stepRules=o,this.reportInstanceId=a,this.delegate=l,this.endFeedbackEnabled=u,this.applicationProfile=c,this.currentStepIndex=0,this.journeyInstanceId=bn(),this.state=xl.Started,this.spotlight=null,this.previewTimeout=0,this.onMessageClosedCallback=()=>{this.transitionFromMessage(this.currentStepIndex)},this.onStepPositionChange=(e,t)=>{const n=this.getStepAt(e);t?n.reposition():n.setPosition()},this.onStepElementLost=e=>{const t=this.getStepAt(e);this.delegate.onBusyChanged(!0),t.setStepListener(this.playStepRepeatDelegates),t.play()},this.onStepBubbleLost=e=>{console.error(`Bubble at index ${e} has been lost -> stopping journey`),this.delegate.onBusyChanged(!1),this.stop(null,fe.Error)},this.onStepBubbleLostInPreview=e=>{console.error(`Bubble at index ${e} has been lost -> replaying`);const t=this.getStepAt(e);this.delegate.onBusyChanged(!1),t.play()},this.onStepElementLostInPreview=e=>{this.getStepAt(e).play()},this.getStepAt=e=>(e>this.steps.length-1&&console.error(`[Journey] [getStepAt] Index out of bounds: index ${e}, length ${this.steps.length}.`),this.steps[e]),this.getStepById=e=>{for(const t of this.steps)if(t.id===e)return t;return null},this.onStepNotStarted=(e,t)=>{t&&console.error("Step failed: "+t),this.delegate.onBusyChanged(!1),this.delegate.onStepStopped(be.Error);const n=this.getStepAt(e);n.skippable&&!n.isLast?(n.transitionType!==we.Multiple&&this.stopAllSteps(),this.reportStepAction(be.Success,n),this.stepQuery(++this.currentStepIndex)):(this.reportStepAction(be.Error,n),this.stop(null,fe.Error))},this.handleNonUserTransition=e=>{e.isLast?this.handleEndTransition(e):this.handleNextStepTransition(e)},this.handleEndTransition=e=>{e.transitionType===we.Timing&&e.runTransition((()=>this.transitionFromStep(e.index)))},this.handleNextStepTransition=e=>{const t=e.index+1;switch(e.transitionType){case we.Multiple:e.runTransition((()=>this.stepQuery(t)));break;case we.Timing:e.runTransition((()=>this.transitionFromStep(e.index)));break;case we.PageRefresh:{const e=this.getStepAt(t);J("currentStepIndex",e.index),z("currentStepIndex",e.index),z("currentStepUrl",e.url);break}default:$(["currentStepIndex","currentStepUrl"])}},this.onPause=e=>{this.currentStep.unregisterStepTransition()},this.onResume=e=>{this.currentStepIndex!=e&&(this.steps.forEach((t=>{t.index!=e&&(t.stop(),t.spotlight&&this.removeSpotlight())})),this.currentStepIndex=e),this.currentStep.registerStepTransition(),this.handleNonUserTransition(this.currentStep),this.delegate.onStepStarted(this.journeyId,this.currentStep.id,e)},this.onStepStarted=e=>{this.delegate.onBusyChanged(!1),this.delegate.onStepStarted(this.journeyId,this.currentStep.id,e);const t=this.getStepAt(e);this.reportStepAction(be.Start,t),this.handleNonUserTransition(t)},this.renderSpotlight=e=>{this.spotlight?this.spotlight.resetDimension():this.spotlight=new _t(window.targetWindow),this.spotlight.setTarget(e),this.spotlight.show()},this.removeSpotlight=()=>{this.spotlight&&(this.spotlight.remove(),this.spotlight=null)},this.onStepRepeatStarted=e=>{this.delegate.onBusyChanged(!1)},this.onStepStartedInPreview=()=>{this.delegate.onBusyChanged(!1),this.delegate.onStepStarted(this.journeyId,this.currentStep.id,this.currentStepIndex)},this.onStepBubbleClosed=()=>{this.stop(null,fe.DropOff)},this.onShowFeedback=(e,t)=>{window.newired._internal.dispatchOverlayEvent({operation:"journeys.showStepFeedback",data:{stepId:e,stepIndex:t}})},this.endJourney=e=>{this.transitionFromStep(this.currentStepIndex,void 0,e)},this.shouldResetPreview=(e,t)=>e instanceof gl&&t instanceof gl&&(e.spotlight!=t.spotlight||b.JSON.stringify(e.elementIdent)!==b.JSON.stringify(t.elementIdent)),this.onStepNotStartedInPreview=(e,t)=>{const n=this.getStepAt(e);t&&console.warn("Preview of step failed.",n,t),this.stopAllSteps(),this.delegate.onStepStopped(be.Error)},this.onLocationChanged=e=>{const t=this.currentStep;t.transitionType===we.PageRefresh&&this.transitionFromStep(t.index,e)},this.transitionFromMessage=e=>{const t=this.getStepAt(e);console.debug(`[Journey] [transitionFromMessage] step transition type: ${t.transitionType}.`),this.invokeActions(t.actions,null,Ll.getStepActionAfterMessage(t.actions))},this.updateStepStorage=e=>{wn(window.targetWindow.location,e.url)?J("currentStepIndex",e.index):(z("currentStepIndex",e.index),z("currentStepUrl",e.url),q(["currentJourneyId","currentStepIndex"]))},this.transitionFromStep=(e,t,n=!1)=>{const i=this.getStepAt(e);if(console.debug(`[Journey] [transitionFromStep] step transition type: ${i.transitionType}.`),this.reportStepAction(be.Success,i),i.isLast){this.stopAllSteps();const e=Ll.createStopJourneyAction([],null,n);return void this.invokeActions(i.actions,e)}const r=this.currentStepIndex+1,s=this.getStepAt(r);this.updateStepStorage(s);const o=this.isTransitionToNewTabOrWindow(i,t);this.stopAllSteps(s.spotlight);const a=(e,t)=>{const n=this.getRulesForStep(e.id),i=n?JSON.parse(n.rules):[],r=Ll.createStartStepAction(i,null,e.id);this.invokeActions(t,r)};if(o&&i.transitionType===we.Click){const e=s.url;console.debug(`Step at index ${this.currentStepIndex} is transitioning to another browser's tab or window with url ${e}.`),this.stop(wn(window.targetWindow.location,e)?xe.GLOBAL:xe.DOMAIN)}else s instanceof gl&&t&&(t===Te||t===Ce||t===Se)?b.setTimeout((()=>{s.findElement().then((()=>{a(s,i.actions)}),this.onStepNotStarted)}),500):a(s,i.actions)},this.isTransitionToNewTabOrWindow=(e,t)=>{const n=!!t&&t.ctrlKey,i=this.isNewTabLink(e);return n||i},this.isNewTabLink=e=>{if(e instanceof gl&&e.element)try{const t=e.element,n=t.getAttribute("target");return"a"===t.tagName.toLowerCase()&&null!==n&&"_blank"===n.toLowerCase()}catch(e){return!1}return!1},this.playStepDelegates={onStarted:this.onStepStarted,onNotStarted:this.onStepNotStarted,onBubbleLost:this.onStepBubbleLost,onElementLost:this.onStepElementLost,onPositionChange:this.onStepPositionChange,onTransitionFromStep:this.transitionFromStep,renderSpotlight:this.renderSpotlight,onBubbleClosed:this.onStepBubbleClosed,onShowFeedback:this.onShowFeedback,endJourney:this.endJourney,onPause:this.onPause,onResume:this.onResume},this.playStepRepeatDelegates={onStarted:this.onStepRepeatStarted,onNotStarted:this.onStepNotStarted,onBubbleLost:this.onStepBubbleLost,onElementLost:this.onStepElementLost,onPositionChange:this.onStepPositionChange,onTransitionFromStep:this.transitionFromStep,renderSpotlight:this.renderSpotlight,onBubbleClosed:this.onStepBubbleClosed,onShowFeedback:this.onShowFeedback,endJourney:this.endJourney,onPause:()=>{},onResume:()=>{}},this.previewStepDelegates={onStarted:this.onStepStartedInPreview,onNotStarted:this.onStepNotStartedInPreview,onBubbleLost:this.onStepBubbleLostInPreview,onElementLost:this.onStepElementLostInPreview,onPositionChange:this.onStepPositionChange,onTransitionFromStep:()=>{},renderSpotlight:this.renderSpotlight,onBubbleClosed:()=>{},onShowFeedback:()=>{},endJourney:()=>{},onPause:()=>{},onResume:()=>{}},h||this.reportJourneyAction(fe.Start),this.storeReportData(),J("currentTourId",this.journeyInstanceId),J("currentJourneyId",this.journeyId),z("currentJourneyId",this.journeyId),z("currentTourId",b.JSON.stringify({guideId:this.journeyId,tourId:this.journeyInstanceId}))}start(e){this.delegate.onJourneyStarted(this.journeyId,this.journeyInstanceId,this.journeyName,function(e,t){const n=e.find((e=>e.index==t));return n&&n.url||window.targetWindow.location.href}(this.steps,e),e,this.steps.length,this.siteId,this.launchKind),this.stepQuery(e)}get instanceId(){return this.journeyInstanceId}get id(){return this.journeyId}stepsInProgress(){return this.steps.some((e=>e.isStarting||e.isPreviewing()&&e.takingScreenshot))}storeReportData(){const e=b.JSON.stringify(Dl(this.reportInstanceId,this.journeyName,this.launchKind));J("report",e),z("report",e)}repositionCurrentStep(){this.getStepAt(this.currentStepIndex).reposition()}get isPlaying(){return this.state===xl.Started||this.state===xl.Playing}get isPreviewing(){return this.state===xl.Started||this.state===xl.Previewing}invokeActions(e,t=null,n=0){if(n>e.length-1)return void(t&&this.invokeAction(t));const i=e[n];i&&$o(window.targetWindow,i.rules,this.applicationProfile,oa()).then((r=>{r?this.invokeAction(i):this.invokeActions(e,t,++n)}))}invokeAction(e){if(!e.message||e.messageShown)switch(e.constructor){case ye:{this.stop(null,fe.Success,!1,!1,!0);const t={reportTourId:this.reportInstanceId,guideName:this.journeyName,launchKind:this.launchKind},n=e;this.delegate.onJourneyStartedByAction(this.context,n.journeyId,n.stepId,t);break}case ve:{const t=e;this.stop(null,fe.Success,t.endWithFeedback,t.endStepNotReached);break}case Ee:{const t=e,n=this.getStepById(t.stepId);if(!n){console.error(`Journey does not contain step ID: '${t.stepId}' to start from step's action.`),this.stop(null,fe.Error);break}this.stepQuery(n.index);break}default:throw"Not implemented action type: "+e.constructor}else{e.messageShown=!0;try{!function(e,t){if(!window.nwApp)throw new Error("nw-app is not defined");{const n=new Za(e,t);window.nwApp.appendChild(n)}}(e.message,this.onMessageClosedCallback)}catch(e){console.warn("[Journey]: Unable to show action message. Cause:",e),this.onMessageClosedCallback()}}}stepQuery(e=null){E(f.ShowNextStep),this.currentStepIndex=null===e?this.currentStepIndex:e;const t=this.getStepAt(this.currentStepIndex),n=t.url;this.updateStepStorage(t);const i="true"===H("redirecting");if(n&&i)this.redirect(n);else{if(n&&!wn(window.targetWindow.location,n))return console.debug(`Domain changing at step index ${t.index} with url: ${n}.`),this.stop(xe.DOMAIN),void this.redirect(n);Ll.resetStepActions(t.actions),this.getFirstVisibleStep(this.currentStepIndex,this.applicationProfile,oa(),(e=>{if(null===e){console.log("No next visible step. Going to show end journey message and stop.");const e=Ll.createStopJourneyAction([],null,!1,!0),t=this.currentStep;t.actions.unshift(e),this.invokeActions(t.actions)}else wn(window.targetWindow.location,this.getStepAt(e).url)?this.play(e):this.stepQuery(e)}))}}redirect(e){fl.isIE11()||fl.isSafari()?b.setTimeout((function(){window.targetDocument.defaultView&&window.targetDocument.defaultView.location.assign(e)}),1e3):window.targetDocument.defaultView&&window.targetDocument.defaultView.location.assign(e)}static resetStepActions(e){for(const t of e)t.messageShown=!1}static getStepActionAfterMessage(e){for(let t=0;t<e.length;t++)if(e[t].messageShown)return t}playInPreview(e){console.debug("[Journey] [playInPreview]",e),this.state=xl.Previewing,this.currentStepIndex=e,this.delegate.onBusyChanged(!0);const t=this.currentStep;t.setStepListener(this.previewStepDelegates),t.play()}play(e){console.debug("[Journey] [play]",e),this.state=xl.Playing,this.currentStepIndex=e,this.delegate.onBusyChanged(!0);const t=this.currentStep;t.setStepListener(this.playStepDelegates),t.play()}updatePreview(e){const t=this.getStepAt(e.index),n=this.shouldResetPreview(e,t);t.merge(e),n?(t.stop(),this.removeSpotlight(),t.setStepListener(this.previewStepDelegates),t.play()):this.handlePreview(t)}handlePreview(e){e.isStarting?(this.previewTimeout&&b.clearTimeout(this.previewTimeout),this.previewTimeout=b.setTimeout((()=>this.handlePreview(e)),20)):e.update()}stopAllSteps(e=!1){this.steps.forEach((e=>{e.stop()})),e||this.removeSpotlight()}setAllStepsOffScreen(){this.steps.forEach((e=>{e.offscreen()}))}resizeSpotlight(){this.spotlight&&this.spotlight.resize()}stop(e=null,t=fe.Success,n=!1,i=!1,r=!1){switch(console.debug(`[Journey] [stop] journeyInstanceId ${this.journeyInstanceId} (scope: ${e})`),this.state=xl.Stopped,t){case fe.DropOff:if(this.currentStep.isLast){t=fe.Success;break}this.reportStepAction(be.DropOff,this.currentStep);break}this.stopAllSteps(),null===e&&this.reportJourneyAction(t);const s=Number(H("currentJourneyId"));s!==this.journeyId&&console.error(`[Journey] Journey ID in storage vs local differs (local: ${this.journeyId}, storage: ${s}).`),kl(e),this.askForStoppingAutoplay(t),this.delegate.onJourneyStopped(this.journeyId,this.journeyInstanceId,t,e,this.currentStep.id,this.currentStepIndex,n,i,r),this.currentStepIndex=0,this.journeyInstanceId="NA"}static createStartJourneyAction(e,t,n,i){return new ye(e,t,n,i)}static createStopJourneyAction(e,t,n=!1,i=!1){return new ve(e,t,n,i)}static createStartStepAction(e,t,n){return new Ee(e,t,n)}get currentStep(){return this.steps[this.currentStepIndex]}getRulesForStep(e){const t=this.stepRules.filter((t=>t.stepId===e));return t.length>0?t[0]:null}isStepVisible(e,t,n,i){const r=this.getRulesForStep(e.id);if(r){const s=function(e,t,n,i){const r=1e3*(i||0),s=n.searchAttempts*n.searchRepeatInterval+r;return{targetWindow:e,searchTime:Gi(t)?s+1e3*n.extraWait:s,searchRetryInterval:n.searchRepeatInterval}}(window.targetWindow,[r],t,e.options.extraWait);Bo(JSON.parse(r.rules),s,t.contentRuleSettings,n,(e=>{i(e)}))}else i(!0)}getFirstVisibleStep(e,t,n,i){E(f.FindNextVisibleStep);const r=e=>{const s=e.shift();s?this.isStepVisible(s,t,n,(t=>{t?(T(f.FindNextVisibleStep),i(s.index)):r(e)})):i(null)},s=this.steps.slice(e,this.steps.length);r(s)}reportStepAction(e,t){!function(e){const t=e.step;He({siteId:e.siteId,journeyId:e.journeyId,journeyIdent:e.reportInstanceId,stepId:t.id,stepIdent:e.reportInstanceId+"-"+t.id,title:Je.unescape(""===t.title?t.description:t.title),operation:je(e.eventType),kind:"step"})}(new Xe(this.siteId,this.journeyId,this.journeyInstanceId,this.reportInstanceId,e,t))}reportJourneyAction(e){ze(new Ge(this.siteId,this.journeyId,this.journeyInstanceId,this.reportInstanceId,e,this.journeyName,this.launchKind))}askForStoppingAutoplay(e){if(this.launchKind==me.AutoplayLaunch){const t=X(`newired.guide.${this.journeyId}.playCount`)||0,n=e==fe.Error&&0==this.currentStepIndex;t>1&&!n&&window.newired._internal.showCustomConfirmDialog(["message_journeyAutoplay","message_journeyStopAutoplayQuestion"],"dialog_stopAutoplay","dialog_cancel",(e=>{e&&(function(e,t){const n=JSON.parse(P.getValue("persistence")||"{}");n[e]=t,P.storeValue("persistence",b.JSON.stringify(n))}(`newired.guide.${this.journeyId}.stopAutoplay`,!0),function(e){const t=bl.find((t=>t.journeyId===e));if(t){const e=bl.indexOf(t);e>-1&&bl.splice(e,1),t.monitor.stop()}}(this.journeyId))}))}}}const kl=e=>{e===xe.GLOBAL?(console.debug(`[Journey] Stop Journey (${e}): clean global storage`),$(["currentStepIndex","currentJourneyId","launchKind","currentStepUrl","currentTourId","report"])):e===xe.DOMAIN?(console.debug(`[Journey] Stop Journey (${e}): clean local storage`),q(["currentStepIndex","currentJourneyId","launchKind","currentStepUrl","currentTourId","report"])):e===xe.WINDOW?console.debug(`[Journey] Stop Journey (${e}): keep local and global storage`):(console.debug("[Journey] Stop Journey: clean local and global storage"),q(["currentStepIndex","currentJourneyId","currentStepUrl","currentTourId","report","autoPlayed"]),$(["currentStepIndex","currentJourneyId","currentTourId","currentStepUrl","report"]))},Dl=function(e,t,n){return{tourId:e,guideName:t,launchKind:n}};function Pl(e,t){const n=t.filter((t=>t.name===e));return n.length>0?n[0].value:null}function Nl(){const e=function(){const e=window.targetWindow.location.href.split("?")[1];if(e){const t=e.split("&");if(t.length>0)return t.map((e=>{const t=e.split("=");return{name:t[0],value:t[1]}}))}return[]}(),t=Number(Pl("nw-journeyId",e)),n=Number(Pl("nw-stepId",e));return[t,0==n?null:n]}function Al(e,t,n){return{tourId:e,guideName:t,launchKind:n}}class Ol extends mn{constructor(e,t,n,i){super(),this.targetWindow=e,this.stepIndex=t,this.stepId=n,this.onPositionChange=i,this.resizeListener=e=>{this.recalculate()},this.recalculate=()=>{!this.paused&&this.checkDocumentDimensionChanged()&&this.onPositionChange(this.stepIndex,!0)},this.checkDocumentDimensionChanged=()=>{const e=sn(this.targetWindow),t=this._documentDimension.width!=e.width||this._documentDimension.height!=e.height;return this._documentDimension=e,t},this._documentDimension=sn(e),this.addAndRegisterEventListener("newired-resize",this.resizeListener,window,{passive:!0})}get documentDimension(){return this._documentDimension}}class Ml{static calculateBounds(e,t){let n;if(null===t){const t=Bn(Jn.Medium);n=_l.calculateModalBounds(e,t)}else if("number"==typeof t)n=_l.calculateModalBounds(e,t);else{if("string"!=typeof t)throw new Error("Dimensions width with height for bubble are not implemented.");{const i=Bn(t);n=_l.calculateModalBounds(e,i)}}return(n.width<this.minModalWidth||n.height<this.minModalHeight)&&(n=_l.calculateModalBounds(e,this.minModalWidth)),n}}Ml.minModalWidth=320,Ml.minModalHeight=200;class _l{static calculateModalBounds(e,t){const n=2*t/3,i=(Math.max(e.document.documentElement.clientWidth,e.innerWidth||0)-t)/2,r=Math.round(i),s=Math.round(t);return{type:"ViewportRect",width:s,height:Math.round(n),top:0,left:r,right:s+r,bottom:0}}}class Rl extends dl{constructor(e,t){super(e,t),this.overlay=null,this.htmlClass="nw-modal"}renderUI(e){this.setFixedContainer("nw-steps");const t=this.createBubbleFrame(e.theme,(t=>{if(t.contentDocument){const n=this.createUI(e,t.contentDocument);t.contentDocument.body.appendChild(n),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.width="100%",t.style.height="100%",t.contentDocument.body.style.background="rgba(0,0,0,0.3)",this.registerEditing(t.contentDocument,n,e.inlineEditImmediate,e.bounds),this.setPosition(t,e),this.setVisibility(t,e.visible),e.editing||this.setAnimation(t,he.FadeIn,null),this.UIListener.onRendered()}else this.UIListener.onRenderingFailed("Unable to render bubble: Missing bubble iframe.")}));this.appendOrReplaceBubbleFrame("nw-steps",t)}setFixedContainer(e){const t=window.nwApp.querySelector(e);t&&(t.classList.add("nw-fixed-container"),t.style.zIndex=n.MAX_ZINDEX.toString())}resetContainer(e){const t=window.nwApp.querySelector(e);t&&(t.classList.remove("nw-fixed-container"),t.style.zIndex="")}removeUI(){if(super.removeUI(),this.resetContainer("nw-steps"),this.overlay){const e=this.overlay.parentNode;e&&(e.removeChild(this.overlay),this.overlay=null)}}show(){this.bubbleFrame&&this.setVisible(this.bubbleFrame),this.overlay&&this.setVisible(this.overlay)}hide(){this.bubbleFrame&&(this.setHidden(this.bubbleFrame),this.blur(this.bubbleFrame)),this.overlay&&this.setHidden(this.overlay)}updateUI(e){super.updateUI(e,(t=>{this.setPosition(t,e),this.inlineEditor&&this.inlineEditor.update(e.bounds,e.targetElementBounds,e.targetElementPath,e.align)}))}updateUIAfterInlineEditChange(e,t){return super.updateUIAfterInlineEditChange(e,((n,i)=>{this.setPosition(n,e),this.inlineEditor&&this.inlineEditor.update(e.bounds,e.targetElementBounds,e.targetElementPath,e.align),t&&t(n,i)}))}updatePosition(e){this.bubbleFrame&&(this.setPosition(this.bubbleFrame,e),this.inlineEditor&&this.inlineEditor.update(e.bounds,e.targetElementBounds,e.targetElementPath,e.align))}createContent(e,t){const n=super.createContent(e,t);return n&&n.classList.add(jn),n}trimToMaxWidth(e,t){const n=Wn(t.align),i=rn(window.targetWindow).width-n.left-n.right-this.padding.right-this.padding.left;return e>i?i:e}trimToMaxHeight(e,t){const n=Un(t.align),i=rn(window.targetWindow).height-n.top-n.bottom-this.padding.top-this.padding.bottom;return e>i?i:e}setPosition(e,t){const n=Pn.getBubbleElement(e);n&&(n.style.position="fixed",n.style.top="30%",n.style.left="50%",n.style.transform="translate(-50%, -30%)",n.style.width=tt(this.trimToMaxWidth(t.bounds.width,t)),n.style.height=tt(this.trimToMaxHeight(t.bounds.height,t)),n.style.boxSizing="border-box")}setVisible(e){e.style.visibility="visible"}setHidden(e){e.style.visibility="hidden",e.style.zIndex="-1"}bubbleSizeToPxMinWidth(e){throw new Error("Invalid operation")}bubbleSizeToPxWidth(e){throw new Error("Invalid operation")}registerInlineEditor(e,t,n,i){null==this.inlineEditor&&(this.inlineEditor=new fi(window.targetWindow,{transitions:[we.Next,we.Timing],resizable:!1},this,n,i))}}class Bl extends sl{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m,f){super(e,t,kt.CenterMiddle,n,i,r,s,o,a,l,0,u,c,h,d,p,g,!1,m,f),this.onAlignChanged=e=>{},this.bubblePosition=this.calculateBoundsInfo()}getUI(){return new Rl(`newired-journey-step-id-${this.id}`,this)}play(){this.isStarting=!0;try{this.renderUI()}catch(e){this.stop(),this.clear(),this.stepListener&&this.stepListener.onNotStarted(this.index,e)}}offscreen(){}setPosition(){}registerStepTransition(){this.isPreview||(this.transitionType,we.Timing)}registerElementMonitor(){this.stepListener&&(this.elementMonitor=new Ol(window.targetWindow,this.index,this.id,this.stepListener.onPositionChange))}toBubbleInfo(){return{bounds:this.bubblePosition.bounds,arrowBounds:this.bubblePosition.arrowBounds,name:this.title,namePlaceholder:this.getPlaceholder(),content:this.description,theme:this.theme,align:kt.CenterMiddle,isFlipped:this.bubblePosition.isFlipped,visible:!0,bubbleSize:this.options.bubbleSize,button:{next:this.shouldShowNextButton&&this.stepListener?this.stepListener.onTransitionFromStep.safeBind(this,this.index):void 0,close:this.stepListener?this.stepListener.onBubbleClosed:()=>{},end:this.shouldShowEndButton&&this.stepListener?this.stepListener.endJourney.safeBind(this,!1):void 0,endWithFeedback:this.shouldShowEndFeedbackButton&&this.stepListener?this.stepListener.endJourney.safeBind(this,!0):void 0,feedback:this.feedback&&this.stepListener?this.stepListener.onShowFeedback.safeBind(this,this.id,this.index):void 0,journeyDefaultLanguage:this.journeyDefaultLanguage},targetElementBounds:null,targetElementPath:null,animationType:he.FadeIn,editing:this.editing,documentDimension:null,inlineEditImmediate:this.editing==Lt.InlineEditing,withCloseButton:!0}}updateUI(e){this.bubblePosition=this.calculateBoundsInfo();const t=this.toBubbleInfo();this.bubble.updateUI(t)}updateUIAfterInlineEditChange(){this.bubblePosition=this.calculateBoundsInfo();const e=this.toBubbleInfo();this.bubble.updateUIAfterInlineEditChange(e)}updateBubblePosition(){return this.bubblePosition=this.calculateBoundsInfo(),this.bubble.updatePosition(this.toBubbleInfo())}calculateBoundsInfo(){return{isFlipped:!1,bounds:Ml.calculateBounds(window.targetWindow,this.options.bubbleSize),arrowBounds:null,zIndex:n.MAX_ZINDEX}}}function Fl(e,t,n,i){const r=function(e,t){const n={top:null,left:null,right:null,bottom:null};switch(e){case kt.TopCenter:case kt.BottomCenter:case kt.LeftMiddle:case kt.RightMiddle:throw new Error("Not implemented");case kt.TopRight:n.left=null,n.right=t.x,n.top=t.y,n.bottom=null;break;case kt.TopLeft:n.left=t.x,n.right=null,n.top=t.y,n.bottom=null;break;case kt.BottomRight:n.left=null,n.right=t.x,n.top=null,n.bottom=t.y;break;case kt.BottomLeft:n.left=t.x,n.right=null,n.top=null,n.bottom=t.y}return n}(n,i),s=Rn(e);return{type:"ViewportRect",top:r.top,bottom:r.bottom,left:r.left,right:r.right,width:s.width<310?310:s.width,height:s.height<200?200:s.height}}function Ul(e){switch(e){case kt.TopCenter:case kt.BottomCenter:case kt.LeftMiddle:case kt.RightMiddle:throw new Error("Not implemented");case kt.TopRight:return"nw-position-top-right";case kt.TopLeft:return"nw-position-top-left";case kt.BottomRight:return"nw-position-bottom-right";case kt.BottomLeft:return"nw-position-bottom-left"}return"nw-position-bottom-right"}class Wl extends dl{constructor(e,t){super(e,t),this.htmlClass="nw-panel"}renderUI(e){const t=this.createBubbleFrame(e.theme,(t=>{if(t.contentDocument){const n=this.createUI(e,t.contentDocument);t.classList.add("nw-panel-frame"),this.appendBubble(t.contentDocument,n),this.setAnimation(t,e.animationType,e.align),this.setPosition(t,e),this.setVisibility(t,e.visible),this.registerEditing(t.contentDocument,n,e.inlineEditImmediate,e.bounds),this.UIListener.onRendered()}else this.UIListener.onRenderingFailed("Unable to render bubble: Missing bubble iframe.")}));this.appendOrReplaceBubbleFrame("nw-steps",t)}updateUI(e){return super.updateUI(e,((t,n)=>{this.updatePosition(e),this.setSize(n,e),this.setAnimation(t,e.animationType,e.align)}))}show(){this.bubbleFrame&&this.setVisible(this.bubbleFrame)}hide(){this.bubbleFrame&&(this.setHidden(this.bubbleFrame),this.blur(this.bubbleFrame))}updateUIAfterInlineEditChange(e,t){return super.updateUIAfterInlineEditChange(e,((n,i)=>{this.setPosition(n,e),this.inlineEditor&&this.inlineEditor.update(e.bounds,e.targetElementBounds,e.targetElementPath,e.align),t&&t(n,i)}))}createUI(e,t){const n=super.createUI(e,t);return this.setSize(n,e),n}createContent(e,t){const n=e.createElement(qn);return n.className=qn,n.classList.add(jn),t.content&&(n.innerHTML=Je.sanitize(t.content)),n}setVisible(e){e.style.visibility="visible",e.style.zIndex=n.MAX_ZINDEX.toString()}setHidden(e){e.style.visibility="hidden",e.style.zIndex="-1"}bubbleSizeToPxWidth(e){throw new Error("Invalid operation")}bubbleSizeToPxHeight(e){throw new Error("Invalid operation")}bubbleSizeToPxMinWidth(e){throw new Error("Invalid operation")}static trimToMaxWidth(e,t){const n=Wn(t.align),i=rn(window.targetWindow).width-n.left-n.right;return e>i?i:e}static trimToMaxHeight(e,t){const n=Un(t.align),i=rn(window.targetWindow).height-n.top-n.bottom;return e>i?i:e}setPosition(e,t){e.style.position="fixed",e.classList.remove(Ul(kt.TopRight),Ul(kt.TopLeft),Ul(kt.BottomRight),Ul(kt.BottomLeft)),e.classList.add(Ul(t.align)),e.style.left=tt(t.bounds.left),e.style.right=tt(t.bounds.right),e.style.top=tt(t.bounds.top),e.style.bottom=tt(t.bounds.bottom),e.style.width=tt(t.bounds.width+this.padding.left+this.padding.right),e.style.height=tt(t.bounds.height+this.padding.top+this.padding.bottom),e.style.maxWidth=tt(Wl.trimToMaxWidth(t.bounds.width+this.padding.left+this.padding.right,t)),e.style.maxHeight=tt(Wl.trimToMaxHeight(t.bounds.height+this.padding.top+this.padding.bottom,t));const n=Pn.getBubbleElement(e);n&&this.setSize(n,t)}setSize(e,t){const n=Wl.trimToMaxWidth(t.bounds.width+this.padding.left+this.padding.right,t),i=Wl.trimToMaxHeight(t.bounds.height+this.padding.top+this.padding.bottom,t);e.style.maxWidth=tt(n-this.padding.left-this.padding.right),e.style.maxHeight=tt(i-this.padding.top-this.padding.bottom),e.style.width=tt(t.bounds.width),e.style.height=tt(t.bounds.height)}registerInlineEditor(e,t,n,i){null==this.inlineEditor&&this._bubbleFrame&&this._bubbleFrame.contentDocument&&(this.inlineEditor=new fi(window.targetWindow,{dropPositions:[kt.TopLeft,kt.TopRight,kt.BottomLeft,kt.BottomRight],transitions:[we.Next,we.Multiple,we.Timing,we.PageRefresh],resizable:!0},this,n,i))}inlineEdit(){return null!=this.inlineEditor}}class Jl extends sl{constructor(e,t,n,i,r,s,o,a,l,u,c,h,d,p,g,m){super(e,t,o,n,i,r,s,a,!1,l,0,!1,u,c,h,d,p,!1,g,m),this.elementMonitor=null,this.defaultOffsetToViewport={x:0,y:0};const f=Rn(this.options.bubbleSize);this.bubblePosition=On(),this.bubblePosition.bounds.width=f.width,this.bubblePosition.bounds.height=f.height}calculateBoundsInfo(e){return{isFlipped:!1,bounds:Fl(e,this.bubble.getPadding(),this.getAlign(),this.defaultOffsetToViewport),arrowBounds:null,zIndex:n.MAX_ZINDEX}}onDimensionChanged(e,t){this.commitInlineEdit(ii.EntityDimension,b.JSON.stringify(e),(n=>{n.error||this.updateBubblePosition(e),this.edited=!0,t(n.error,e)}))}getAlign(){return this.align}offscreen(){}play(){this.isStarting=!0;try{this.renderUI()}catch(e){this.stop(),this.clear(),this.stepListener&&this.stepListener.onNotStarted(this.index,e)}}registerStepTransition(){if(!this.isPreview)switch(this.transitionType){case we.Next:case we.Multiple:case we.Timing:case we.PageRefresh:break;case we.Click:case we.Hover:case we.ValueChange:case we.Editing:throw new Error(`Not implemented transition ${this.transitionType}`)}}merge(e){super.merge(e),this.align=e.align}setPosition(){}getPlaceholder(){return"Title"}toBubbleInfo(){return{bounds:this.bubblePosition.bounds,arrowBounds:this.bubblePosition.arrowBounds,name:this.title,namePlaceholder:this.getPlaceholder(),content:this.description,theme:this.theme,align:this.align,isFlipped:this.bubblePosition.isFlipped,visible:!0,bubbleSize:this.bubblePosition.bounds,button:{next:this.shouldShowNextButton&&this.stepListener?this.stepListener.onTransitionFromStep.safeBind(this,this.index):void 0,close:this.stepListener?this.stepListener.onBubbleClosed:()=>{},end:this.shouldShowEndButton&&this.stepListener?this.stepListener.endJourney.safeBind(this,!1):void 0,endWithFeedback:this.shouldShowEndFeedbackButton&&this.stepListener?this.stepListener.endJourney.safeBind(this,!0):void 0,feedback:this.feedback&&this.stepListener?this.stepListener.onShowFeedback.safeBind(this,this.id,this.index):void 0,journeyDefaultLanguage:this.journeyDefaultLanguage},targetElementBounds:this.bubblePosition.bounds,targetElementPath:[],animationType:he.FadeIn,editing:this.editing,documentDimension:null,inlineEditImmediate:this.editing==Lt.InlineEditing,withCloseButton:!0}}registerElementMonitor(){this.stepListener&&(this.elementMonitor=new Ol(window.targetWindow,this.index,this.id,this.stepListener.onPositionChange))}updateBubblePosition(e){this.bubblePosition=this.calculateBoundsInfo(e||this.bubblePosition.bounds),this.bubble.updatePosition(this.toBubbleInfo())}updateUI(e){this.bubblePosition=this.calculateBoundsInfo(this.options.bubbleSize),this.bubble.updateUI(this.toBubbleInfo())}updateUIAfterInlineEditChange(){this.bubblePosition=this.calculateBoundsInfo(this.bubblePosition.bounds),this.bubble.updateUIAfterInlineEditChange(this.toBubbleInfo())}getUI(){return new Wl(`newired-journey-step-id-${this.id}`,this)}}function Hl(){$l&&Cl(window.targetWindow,Fe().getJourneysAutoplay(),Fe().getApplicationProfile(),oa(),$l.autoplayJourney)}var ql;let jl;!function(e){e.PlayStart="playStart",e.PlayStop="playStop",e.PlayStarted="playStarted",e.PlayStopped="playStopped",e.StepShown="stepShown",e.JourneyPlayerStartedWithoutPlay="journeyPlayerStartedWithoutPlay",e.ScoreResult="scoreResult",e.PlayPreview="playPreview",e.UpdatePreview="updatePreview",e.StopPreview="stopPreview",e.JourneysChanged="journeysChanged",e.InspectRule="inspectRule",e.InspectRuleResult="inspectRuleResult",e.CreateScreenshot="createScreenshot",e.ScreenshotCreated="screenshotCreated"}(ql||(ql={}));const zl="[Journey.Controller]["+window.targetWindow.location.host+"]";let $l;const Vl=(e,t)=>{if(jl=e===Ae.Editor,$l)throw"JourneyController already initialized";$l=new Gl;const[n,i]=Nl();if(n)console.log(`${zl} (start) Link to Journey (journeyId: ${n}, stepId: ${i}`),$l.startJourneyByLink(oa(),n,i);else if(t.journeyId){const e=t.journeyId,n=t.stepIndex||0,i=function(e){if(null===e)return Al(null,null,null);try{const t=JSON.parse(e);return t.reportTourId=t.tourId,t}catch(t){return console.error("Invalid report data: "+e,t),Al(null,null,null)}}(t.report);t.redirected&&!t.autoPlayed?function(e,t,n,i,r,s){const o=Vi(e,n,i),a=n.filter((e=>e.guideId===t)).map((e=>JSON.parse(e.rules)))[0];a?Bo(a,o,i.contentRuleSettings,r,s):s(!0)}(window.targetWindow,e,window.newired._internal.data.getJourneys().guideRules,Fe().getApplicationProfile(),oa(),(t=>{t?(console.log(`${zl} (start) Continue Journey: ${e}`),$l.continueStoredJourney(oa(),e,n,i.launchKind,i.reportTourId)):(console.log(`${zl} (start) Journey (id: ${e}) canceled due visibility rules.`),$l.initializedNothingToPlay(!0,["message_journeyNotAvailable"]))})):(console.log(`${zl} (start) Continue Journey: ${e}`),$l.continueStoredJourney(oa(),e,n,i.launchKind,i.reportTourId))}else console.log(`${zl} (start) Going to evaluate autoplay rules ...`),$l.evaluateJourneysAutoplay().catch((()=>{$l.initializedNothingToPlay(!1)}))};class Gl{constructor(){this.feedbackOnFinish=de.Never,this.feedbackOnDropOff=!1,this.userName=null,this.checkJourneyInterval=null,this.onFirstStepStarted=null,this.urlPathChangedContext={hash:window.targetWindow.location.hash,pathname:window.targetWindow.location.pathname},this.disabled=!1,this.messageQueue=[],this.messageQueueTimeout=0,this.urlPathChanged=()=>{const e=window.targetWindow.location,t=this.urlPathChangedContext.pathname;""===e.hash&&t!=e.pathname&&(this.urlPathChangedContext.pathname=e.pathname,this.isJourneyActive&&this.journey.onLocationChanged(Se))},this.enqueueMessage=e=>{b.array.push(this.messageQueue,e),this.messageQueueTimeout||this.triggerMessage()},this.triggerMessage=e=>{this.messageQueueTimeout||((e=e||this.messageQueue.shift())?this.messageQueueTimeout=b.setTimeout((()=>{this.clearMessageQueueTimeout(),e&&!this.stepsInProgress()?(this.processMessage(e),this.messageQueue.length>0&&this.triggerMessage()):this.triggerMessage(e)}),20):this.clearMessageQueueTimeout())},this.clearMessageQueueTimeout=()=>{this.messageQueueTimeout&&(b.clearTimeout(this.messageQueueTimeout),this.messageQueueTimeout=0)},this.processMessage=e=>{try{const t=JSON.parse(e);switch(console.log(`IPC: journeys: ${t.operation}`,t.data),t.operation){case ql.PlayStart:this.playJourney(oa(),t.data.guideId,t.data.stepIndex,me.UserLaunch,null).catch((e=>{console.log(`${zl}: Unable to start Journey ${t.data.guideId}. Cause: ${e}`)}));break;case ql.PlayStop:this.stopJourney();break;case ql.PlayPreview:this.startPreview(t.data.guide,t.data.steps,t.data.editing,t.data.stepIndex);break;case ql.UpdatePreview:this.updatePreview(t.data.guide,t.data.steps,t.data.editing,t.data.stepIndex);break;case ql.StopPreview:this.journey&&this.createScreenshotAutomatic(t.data,this.journey.currentStep,(()=>{this.stopPreview()}));break;case ql.JourneysChanged:window.newired._internal.data.reloadEditorData().then((()=>{Cl(window.targetWindow,Fe().getJourneysAutoplay(),Fe().getApplicationProfile(),oa(),this.autoplayJourney),Ga(window.newired._internal.data.getJourneyLinks())}),(e=>{console.log(`${zl} Reloading of data (caused by the Editor changes) failed: ${e}`)}));break;case ql.InspectRule:Vo(window.targetWindow,t.data,Fe().getApplicationProfile(),oa()).then((e=>{Kl({operation:ql.InspectRuleResult,data:e})}));break;case ql.CreateScreenshot:this.createScreenshotManual(t.data)}}catch(t){console.log("Error while handling Editor's IPC message: "+e,t)}},this.playJourneyDelegate={onJourneyStarted:(e,t,n,i,r,s,o,a)=>{$l.startCheckJourneyInterval(t);try{window.newired._internal.dispatchOverlayEvent({operation:"journeys.journeyStarted",data:{journeyId:e,journeyName:n,journeyInstanceId:t,startUrl:i,stepIndex:r,stepCount:s,siteId:o,launchKind:a,userName:this.userName}})}catch(e){console.warn("Failed to dispatch Overlay event",e)}Kl({operation:ql.PlayStarted,data:{guideId:e,stepIndex:r}})},onJourneyStopped:(e,t,n,i,r,s,o,a,l)=>{El(window.targetWindow,Fe().getJourneysAutoplay(),Fe().getApplicationProfile(),oa(),this.autoplayJourney),$l.clearCheckJourneyInterval(t);let u=null;switch(n){case fe.Success:jl&&a&&Gl.Message.showJourneyInfo("message_journeyEnded"),!l&&null===i&&(o||$l.feedbackOnFinish===de.Mandatory&&!Yl(e)||$l.feedbackOnFinish===de.Mandatory&&jl)&&(u=pe.FeedbackFinish);break;case fe.Error:jl&&Gl.Message.showJourneyError(e,r),this.onFirstStepStarted&&this.onFirstStepStarted();break;case fe.DropOff:$l.feedbackOnDropOff&&!jl&&(u=pe.FeedbackDropOff)}window.newired._internal.dispatchOverlayEvent({operation:"journeys.journeyStopped",data:{showDialog:u}}),Kl({operation:ql.PlayStopped,data:{guideId:e}})},onStepStarted:(e,t,n)=>{this.onFirstStepStarted&&this.onFirstStepStarted(),T(f.ShowNextStep),window.newired._internal.dispatchOverlayEvent({operation:"journeys.journeyStepStarted",data:{journeyId:e,stepIndex:n}}),Kl({operation:ql.StepShown,data:{guideId:e,stepIndex:n}})},onStepStopped:e=>{},onBusyChanged:e=>{window.newired._internal.dispatchOverlayEvent({operation:"journeys.busy",data:{isBusy:e}})},onJourneyStartedByAction:(e,t,n,i)=>{n?$l.playJourneyFromStepId(e,t,n,i.launchKind,i.reportTourId).catch((e=>{console.debug(`${zl} Unable to run Journey by Action ${t} from step with id ${n}. Cause: ${e}`)})):$l.playJourney(e,t,0,i.launchKind,i.reportTourId).catch((e=>{console.debug(`${zl} Unable to run Journey by Action ${t}. Cause: ${e}`)}))}},this.registerHashChange(),Sn.getInstance(window.targetWindow).addMethod(this.urlPathChanged),this.registerMicroAppBoundsChangeListener(),this.subscribeIPC(),Fe().addChangeListener((()=>{this.isJourneyActive&&this.stopJourney()}))}get isJourneyActive(){return this.isJourneyPlaying||this.isJourneyPreviewing}get isJourneyPlaying(){return this.journey&&this.journey.isPlaying}get isJourneyPreviewing(){return this.journey&&this.journey.isPreviewing}get runningJourneyId(){return this.isJourneyPlaying?this.journey.id:null}stepsInProgress(){return this.isJourneyActive&&this.journey.stepsInProgress()}subscribeIPC(){window.registerIPCMessageListener&&window.registerIPCMessageListener("journeys",((e,t)=>{this.enqueueMessage(t)}))}createScreenshotAutomatic(e,t,n){e.withScreenshot&&!t.containsDynamicContent()?(t.takingScreenshot=!0,t.createScreenshot(!0,(()=>{n(),t.takingScreenshot=!1}))):n()}createScreenshotManual(e){if(jl&&this.isJourneyActive){const t=this.journey.getStepById(e.entityId);t&&(t.takingScreenshot=!0,t.createScreenshot(!1,(()=>{t.takingScreenshot=!1})))}}stopPreview(){this.isJourneyPreviewing&&this.journey.stop()}startPreview(e,t,n,i){const r=Xl(oa(),pa(t,Fe().getSettings().objectStorageUrl),!0,n,!1,e.language);this.journey=new Ll(oa(),0,e.id,"Preview",me.UserLaunch,r,[],"NA",this.previewJourneyDelegate(),!1,Fe().getApplicationProfile(),!1),window.newired._internal.dispatchOverlayEvent({operation:"journeys.journeyPreview",data:{journeyId:e.id,journeyName:"Preview",journeyInstanceId:this.journey.instanceId,startUrl:null,stepIndex:0,stepCount:1,siteId:0,launchKind:me.UserLaunch}}),this.journey.playInPreview(i)}updatePreview(e,t,n,i){const r=Xl(oa(),pa(t,Fe().getSettings().objectStorageUrl),!0,n,!1,e.language).find((e=>e.index===i));this.isJourneyPreviewing?this.journey&&r&&this.journey.updatePreview(r):this.startPreview(e,t,n,i)}registerMicroAppBoundsChangeListener(){window.targetDocument.addEventListener("microAppBoundsChanged",(()=>{this.isJourneyActive&&this.journey.repositionCurrentStep()}))}registerHashChange(){window.targetWindow.addEventListener("hashchange",(e=>{if(this.disabled)return;/nw-journeyId|nw-stepId/.test(window.targetWindow.location.href)&&(this.isJourneyActive&&this.journey.stop(),window.targetDocument.defaultView&&window.targetDocument.defaultView.location.reload());const t="true"===H("redirecting");if(t&&J("redirecting",!1),this.isJourneyActive)if(t){const e=()=>b.setTimeout((()=>{console.debug("Hash changed after redirect: going to query the current journey's step.",this.journey.currentStep),this.journey.stepQuery()}),500);"complete"===window.targetDocument.readyState?e():window.targetDocument.addEventListener("DOMContentLoaded",e)}else this.journey.onLocationChanged(Ce);else $l.evaluateJourneysAutoplay()}))}shouldBeJourneyEnded(e){const t=()=>{console.info(zl+"Same journey started in different window. Ending tour and resetting launcher..."),this.journey.stop(xe.WINDOW)},n=H("currentTourId");if(null!==n){const o=Number(H("currentJourneyId"));i="currentTourId",r=function(i,r,s){if(i||!s)return void(e!==n&&(console.debug(`${zl} Running journey instance ID vs local storage differs (instance: ${e}, local storage: ${n}).`),t()));const a=function(e){try{return JSON.parse(e)}catch(e){return null}}(s);a.guideId==o&&a.tourId!=e&&(console.debug(`${zl} Running journey instance ID vs global storage differs for the same journey ID: ${o} (instance: ${e}, global storage: ${a.tourId}).`),t())},V()?j(r):R.requestValue(i,r,s)}var i,r,s}startCheckJourneyInterval(e){console.debug(`Set 'Journey-end' interval with instance ID: ${e}.`),this.checkJourneyInterval=b.setInterval((()=>{this.shouldBeJourneyEnded(e)}),500)}clearCheckJourneyInterval(e){null!==this.checkJourneyInterval&&(console.debug(`Clearing 'Journey-end' interval with instance ID: ${e}} [${this.checkJourneyInterval}]`),b.clearInterval(this.checkJourneyInterval),this.checkJourneyInterval=null)}disableJourneys(){this.journey&&this.journey.stop(null,fe.DropOff),this.disabled=!0}enableJourneys(){this.disabled=!1}isJourneysEnabled(){return!this.disabled}playJourneyFromStepId(e,t,n,i,r){const s=window.newired._internal.data.getStepById(n);return s?this.playJourney(e,t,s.order,i,r):Promise.reject(`Step with id ${n} not found.`)}playJourney(e,t,n,i,r,s=!1){return this.disabled?Promise.reject("Unable to start Journey. Cause: Journeys are disabled"):(this.stopPreview(),Gl.Message.close(),window.newired._internal.data.getJourney(t).then((o=>{const a=window.newired._internal.data.getRulesForJourneySteps(t);if(o&&o.steps){if(!function(e,t){return void 0!==e.find((e=>e.language==t))}(o.name,e.overlayLanguage))return Promise.reject(`Journey has no translation for ${e.overlayLanguage}`);const l=At(e.overlayLanguage,o.name),u=o.siteId||0;if(0==o.steps.length)return ze(new Ge(o.siteId||0,o.id,"",r||bn(),fe.Error,l,i)),Gl.Message.showEmptyJourneyInfo(t),Promise.reject("Journey has no steps");const c=o.steps.map((t=>function(e,t){const n=Jt(e);return n.title=At(t,e.title),n.description=At(t,e.description),n.actions=function(e,t){return t.map((t=>{const n=Jt(t);return n.message&&(n.message=At(e,t.message)),n}))}(t,e.actions),n}(t,e.overlayLanguage))),h=o.feedbackOnFinish===de.Optional||o.feedbackOnFinish===de.Mandatory&&!Yl(o.id);this.feedbackOnFinish=o.feedbackOnFinish,this.feedbackOnDropOff=o.feedbackOnDropOff;const d=Xl(e,c,!1,Lt.NoEditing,h,e.overlayLanguage);return new Promise(((o,c)=>{Ql((h=>{this.userName=h,s||Y(`newired.guide.${t}.playCount`);try{this.journey=new Ll(e,u,t,l,i,d,a,r||bn(),this.playJourneyDelegate,!1,Fe().getApplicationProfile(),s),function(e,t){const n=t[e];if(n){if(n.url){const e=function(e,t,n){const i=new URL(t),r=new URL(e).searchParams.get(n),s=nl(i)===nl(new URL(e));return i.href!==e&&i.searchParams.has(n)&&s&&r&&i.searchParams.set(n,r),i}(window.targetWindow.location.href,n.url,"unsessionId");return nl(e)===il()}return!0}throw new Error(`Step with index ${e} does not exists.`)}(n,d)||J("redirecting",!0);let h=!1;const p=Fe().getSettings(),g=setTimeout((()=>{h||(h=!0,this.onFirstStepStarted=null,c("Journey not started"))}),ml(p.searchRepeatInterval*p.searchAttempts,!0,p.extraWait,2));this.onFirstStepStarted=()=>{clearTimeout(g),h||(h=!0,this.onFirstStepStarted=null,o("Journey started"))},this.journey.start(n)}catch(e){console.info(`Failed to play Journey ${t} from step ${n}. Cause: `,e),this.journey&&this.journey.stop(),c(`Failed to play Journey ${t} from step ${n} due: ${e.toString()}`)}}))}))}return Promise.reject(`No data for journeyId: ${t}`)})))}stopJourney(){this.journey&&this.journey.stop(null,fe.DropOff)}previewJourneyDelegate(){return{onJourneyStarted:(e,t,n,i,r,s,o,a)=>{},onJourneyStopped:(e,t,n,i,r,s,o,a,l)=>{window.newired._internal.dispatchOverlayEvent({operation:"journeys.journeyStopped",data:{showDialog:null}})},onStepStarted:(e,t)=>{const n=$l.journey.currentStep;if(n instanceof gl){const e=St.calculateScore(window.targetWindow,n.element,n.elementIdent);Kl({operation:ql.ScoreResult,data:{scoreResult:e}})}},onStepStopped:e=>{if(e===be.Error){const e=$l.journey.currentStep;if(e instanceof gl){const t=St.calculateScore(window.targetWindow,e.element,e.elementIdent);Kl({operation:ql.ScoreResult,data:{scoreResult:t}})}}},onBusyChanged:()=>{},onJourneyStartedByAction:()=>{}}}startJourneyByLink(e,t,n){n?$l.playJourneyFromStepId(e,t,n,me.LinkLaunch,null).catch((e=>{console.debug(`${zl} Unable to start Journey by link. Cause: ${e}`),jl&&Gl.Message.showJourneyInfo("message_journeyStepNotAvailable"),this.initializedNothingToPlay(!1)})):$l.playJourney(e,t,0,me.LinkLaunch,null).catch((e=>{console.debug(`${zl} Unable to start Journey by link. Cause: ${e}`),jl&&Gl.Message.showJourneyInfo("message_journeyNotAvailable"),this.initializedNothingToPlay(!1)}))}continueStoredJourney(e,t,n,i,r){this.playJourney(e,t,n,i,r,!0).catch((e=>{console.debug(`${zl} Unable continue Journey. Cause: ${e}`)}))}evaluateJourneysAutoplay(){return $l.checkJourneyToAutoplay().then((e=>$l.autoplayJourney(oa(),e)))}checkJourneyToAutoplay(){return new Promise(((e,t)=>{yl()?(E(f.EvaluateAutoplayRules),Sl(window.targetWindow,Fe().getJourneysAutoplay(),Fe().getJourneys().guides,Fe().getApplicationProfile(),oa(),(n=>{T(f.EvaluateAutoplayRules),T(f.LoadLauncher),n?e(n):t("No Journey found to autoplay")}))):(T(f.EvaluateAutoplayRules),T(f.LoadLauncher),t("Autoplay not allowed"))}))}autoplayJourney(e,t){return new Promise(((n,i)=>{$l.isJourneyActive?i(`${zl} Journey ${t} can not autoplay. Cause: A Journey plays already.`):$l.playJourney(e,t,0,me.AutoplayLaunch,null).then((()=>{J("autoPlayed",!0),n()})).catch((e=>{Hl(),i(`${zl} Journey ${t} autoplay canceled. Cause: ${e}`)}))}))}initializedNothingToPlay(e,t){e&&Kl({operation:ql.JourneyPlayerStartedWithoutPlay,data:{}}),window.newired._internal.dispatchOverlayEvent({operation:"journeys.initialized",data:{}}),t&&Gl.Message.showJourneyStartError(t),El(window.targetWindow,Fe().getJourneysAutoplay(),Fe().getApplicationProfile(),oa(),this.autoplayJourney)}setAllStepsOffScreen(){this.isJourneyActive&&this.journey.setAllStepsOffScreen()}resizeSpotlight(){this.isJourneyActive&&this.journey.resizeSpotlight()}startJourneyByJourneyLink(e){window.newired._internal.data.getJourney(e.id).then((t=>{if(jl){const t=e.startUrl?nl(new URL(e.startUrl)):null;null==t||t==il()?$l.playJourney(oa(),e.id,0,me.JourneyLinkLaunch,null).catch((e=>{console.debug(`${zl} Unable to start Journey by Journey-Link. Cause: ${e}`)})):window.newired._internal.showConfirmDialog("message_journeyPlayRedirectQuestion",(t=>{t&&$l.playJourney(oa(),e.id,0,me.JourneyLinkLaunch,null).catch((e=>console.debug(`${zl} Unable to start Journey by Journey-Link. Cause: ${e}`)))}))}else $l.playJourney(oa(),e.id,0,me.JourneyLinkLaunch,null).catch((e=>{console.debug(`${zl} Unable to start Journey by Journey-Link. Cause: ${e}`)}))}),(e=>{Gl.Message.showJourneyStartError(["message_journeyNotAvailable"])}))}}function Xl(e,t,n,i,r,s){const o=Fe().getSettings(),a=[];let l=0;return t.forEach((u=>{try{const c=JSON.parse(u.options),h=l===t.length-1,d=!(u.playRuleKind===we.Next||u.playRuleKind===we.Timing),p=n||d?[]:function(e){const t=[];return e.forEach((e=>{let n;const i=_i(e.rules||"[]"),r=JSON.parse(e.parameters||"[]");switch(e.type){case ge.PlayJourney:{if(2!==r.length)throw"Invalid parameters for step action: "+ge.PlayJourney;const t=Number(r[1])||null;n=Ll.createStartJourneyAction(i,e.message,Number(r[0]),t);break}case ge.StopJourney:n=Ll.createStopJourneyAction(i,e.message);break;case ge.JumpToStep:if(1!==r.length)throw"Invalid parameters for step action: "+ge.JumpToStep;n=Ll.createStartStepAction(i,e.message,Number(r[0]));break;default:throw"StepActionType not implemented: "+e.type}b.array.push(t,n)})),t}(u.actions),g=o.useRelativeUrl&&u.url?Tn(u.url,window.targetWindow.location):u.url;if("Panel"===c.stepType){const e=new Jl(u.id,l,g,u.title,u.description,o.theme,u.align,u.playRuleKind,c,h,n,i,u.feedback,r,p,s);b.array.push(a,e)}else if("Modal"===c.stepType){const e=new Bl(u.id,l,g,u.title,u.description,o.theme,u.playRuleKind,u.spotlight,c,u.extraWait,h,n,i,u.feedback,r,p,s);b.array.push(a,e)}else{const t=new gl(u.id,l,e,g,u.title,u.description,o.theme,u.align,u.extraWait,u.playRuleKind,u.spotlight,JSON.parse(u.element),u.elementTexts,JSON.parse(u.options||"{}"),o.searchRepeatInterval,o.searchRepeatInterval*o.searchAttempts,o.extraWait,h,n,i,u.feedback,r,u.skippable,p,s);b.array.push(a,t)}}catch(e){console.error(`Preparation Step for play failed at index: ${l}: `,e)}l++})),a}function Yl(e){return G().journeys.indexOf(e)>-1}Gl.Message={showJourneyError(e,t){window.newired._internal.dispatchOverlayEvent({operation:"messages.showJourneyError",data:{journeyId:e,stepId:t}})},showJourneyStartError(e){window.newired._internal.dispatchOverlayEvent({operation:"messages.showJourneyStartError",data:e})},showJourneyInfo(e){window.newired._internal.dispatchOverlayEvent({operation:"messages.showJourneyInfo",data:e})},showEmptyJourneyInfo(e){window.newired._internal.dispatchOverlayEvent({operation:"messages.showEmptyJourneyInfo",data:{journeyId:e}})},close(){window.newired._internal.dispatchOverlayEvent({operation:"messages.closeMessage",data:null})}};const Ql=e=>{!function(e,t){const n=e;V()?t(e,P.getValue(e)):R.requestValue(e,(function(e,i,r){t(n,!e&&r?r:P.getValue(n))}))}("userName",(function(t,n){try{null===n&&(n=rl("getUserName"))}catch(e){console.warn("Script getUserName failed.",e),n=null}e(null==n?null:n.toString())}))};function Kl(e){jl&&window.sendIPCMessage("launcher",b.JSON.stringifyPretty(e))}function Zl(e){$l.isJourneyActive&&$l.stopJourney(),$l.startJourneyByJourneyLink(e)}var eu;!function(e){e.Default="default",e.Performance="performance"}(eu||(eu={}));class tu{constructor(e,t){this.channel=e,this.messageWindow=t,this.DEFAULT_REQUEST_TIMEOUT=2e4,this.REQUEST_TIMEOUT_INTERVAL=500,this.idSequence=0,this.requests={},this.requestTimeoutWatcher=null,this.handleMessage=e=>{try{this.isValidResponse(e.data)&&this.handleResponse(e.data.message)}catch(t){console.debug(`Unable to handle queue response (channel: ${this.channel})`,e,t)}}}listen(){this.setRequestTimeoutWatcher(),this.messageWindow.addEventListener("message",this.handleMessage)}disconnect(){this.cleanRequestTimeoutWatcher(),this.messageWindow.removeEventListener("message",this.handleMessage)}send(e,t,n={timeout:this.DEFAULT_REQUEST_TIMEOUT}){const i=this.nextRequestId();this.requests[i]={id:i,callback:t,timestamp:(new Date).getTime(),timeout:n.timeout,data:e},this.messageWindow.postMessage({channel:this.channel,message:{requestId:i,data:e}},"*")}isValidResponse(e){return e.channel===this.channel&&e.message&&e.message.hasOwnProperty("requestId")&&e.message.hasOwnProperty("data")&&e.message.data.hasOwnProperty("status")}handleResponse(e){const t=e,n=this.requests[t.requestId];if(n)switch(delete this.requests[t.requestId],t.data.status){case tu.STATUS_SUCCESS:n.callback({status:"success",result:t.data.result});break;case tu.STATUS_ERROR:n.callback({status:"error",cause:t.data.cause})}}cleanRequestTimeoutWatcher(){this.requestTimeoutWatcher&&window.clearInterval(this.requestTimeoutWatcher)}setRequestTimeoutWatcher(){this.requestTimeoutWatcher=window.setInterval((()=>{this.removeExpiredRequests()}),this.REQUEST_TIMEOUT_INTERVAL)}removeExpiredRequests(){const e=(e,t)=>void 0!==e&&e.timestamp&&t-e.timestamp>e.timeout,t=(new Date).getTime();for(const n in this.requests)if(this.requests.hasOwnProperty(n)){const i=this.requests[n];e(i,t)&&(delete this.requests[n],i.callback({status:"timeout"}))}}nextRequestId(){return this.idSequence===Number.MAX_VALUE&&(this.idSequence=0),this.idSequence++}}let nu;function iu(e,t){return new Promise(((n,i)=>{nu.send({operation:"isFacadeReady",parameters:{data:t}},(r=>{switch(r.status){case tu.STATUS_TIMEOUT:e<=0?i("Max no. of attempts to sync with Facade has been reached."):iu(--e,t).then(n).catch(i);break;case tu.STATUS_ERROR:i(r);break;case tu.STATUS_SUCCESS:n(r.result)}}),{timeout:100})}))}function ru(){return nu=new tu("newired-to-facade-request",window.targetWindow),nu.listen(),iu(10,su()).then((e=>(console.debug("Sync. done for Overlay API <=> API Facade."),ha(e),e))).catch((e=>(console.error("Newired Overlay API Facade is not available. Cause:",e),oa())))}function su(){return{languages:{defaultRuntimeOverlayLanguage:window.newired._internal.data.getSettings().defaultRuntimeOverlayLanguage,defaultRuntimeApplicationLanguage:window.newired._internal.data.getSettings().defaultRuntimeApplicationLanguage,browserOverlayLanguage:K(),browserApplicationLanguage:Z(),overlayLanguages:ne(),applicationLanguages:ie()}}}tu.STATUS_SUCCESS="success",tu.STATUS_ERROR="error",tu.STATUS_TIMEOUT="timeout";class ou{constructor(e,t,n){this.channel=e,this.messageWindow=t,this.responseCallback=n,this.handleMessage=e=>{if(this.isValidApiRequest(e.data)){const t=e.data.message;try{this.responseCallback(t.data,(e=>{this.sendResponse(t.requestId,e)}),(e=>{this.sendError(t.requestId,e)}))}catch(t){console.error(`Error while processing response (channel: ${this.channel}).`,e.data,t)}}}}listen(){this.messageWindow.addEventListener("message",this.handleMessage)}disconnect(){this.messageWindow.removeEventListener("message",this.handleMessage)}isValidApiRequest(e){try{return e&&e.channel&&e.channel===this.channel&&e.message&&e.message.data&&e.message.data.operation}catch(e){return!1}}sendResponse(e,t){this.messageWindow.postMessage({channel:this.channel,message:{requestId:e,data:{status:"success",result:t}}},"*")}sendError(e,t){this.messageWindow.postMessage({channel:this.channel,message:{requestId:e,data:{status:"error",cause:t}}},"*")}}function au(){new ou("newired-api-request",window.targetWindow,((e,t,n)=>{switch(e.operation){case"isReady":t({languages:{defaultRuntimeOverlayLanguage:window.newired._internal.data.getSettings().defaultRuntimeOverlayLanguage,defaultRuntimeApplicationLanguage:window.newired._internal.data.getSettings().defaultRuntimeApplicationLanguage,browserOverlayLanguage:K(),browserApplicationLanguage:Z(),overlayLanguages:ne(),applicationLanguages:ie()}});break;case"isOverlayEnabled":t(window.newired.isOverlayEnabled());break;case"enableOverlay":t(window.newired.enableOverlay());break;case"disableOverlay":t(window.newired.disableOverlay());break;case"isLauncherPanelVisible":t(window.newired.isLauncherPanelVisible());break;case"showLauncherPanel":t(window.newired.showLauncherPanel());break;case"hideLauncherPanel":t(window.newired.hideLauncherPanel());break;case"isLauncherVisible":t(window.newired.isLauncherVisible());break;case"setLauncherVisibility":window.newired.setLauncherVisibility(e.parameters.flag).then((e=>t(e))).catch((e=>n(e)));break;case"getOverlayLanguages":t(K());break;case"getApplicationLanguages":t(ie());break;case"setUserOverlayLanguage":t(Wa(e.parameters.context,e.parameters.language));break;case"setUserApplicationLanguage":t(Ja(e.parameters.context,e.parameters.language));break;case"journeys.getRunningJourney":t(window.newired.journeys.getRunningJourney(e.parameters.context));break;case"journeys.getJourneys":window.newired.journeys.getJourneys(e.parameters.context).then((e=>t(e))).catch((e=>n(e)));break;case"journeys.getVisibleJourneys":window.newired.journeys.getVisibleJourneys(e.parameters.context).then((e=>t(e))).catch((e=>n(e)));break;case"journeys.getJourneysByName":t(window.newired.journeys.getJourneysByName(e.parameters.context,e.parameters.name));break;case"journeys.getJourneyById":t(window.newired.journeys.getJourneyById(e.parameters.context,e.parameters.id));break;case"journeys.start":window.newired.journeys.start(e.parameters.context,e.parameters.id,e.parameters.stepIndex).then((e=>t(e))).catch((e=>n(e)));break;case"journeys.stop":t(window.newired.journeys.stop(e.parameters.id))}})).listen()}const lu="[Loader]["+window.targetWindow.location.host+"]";function uu(e){tl(window.targetWindow),hu(),v(e.profile===eu.Performance),E(f.LoadLauncher);const t=e.urlMap||[];window.newired._internal.data.initialize(e.backend,e.deliveryPath,t,e.objectStorage,(t=>{t?(console.error(`${lu} Overlay resources load failed.`,t),T(f.LoadLauncher)):pu(Ae.Snippet,e.launcherVisible)}))}function cu(e){if(window.newired=window.newired||{},window.newired.root=!0,function(){if(window.Elm&&window.Elm.Launcher)return console.debug(`${lu} Elm Launcher already inserted into the page.`),_a(10,(function(e){e?e.onStoppedInitialization.send(null):console.error(`${lu} Elm Launcher port not initialized.`)})),!0;return!1}())return;tl(window.targetWindow),hu(),v(e.profile===eu.Performance),E(f.LoadLauncher);window.newired._internal.data.initialize(e,(t=>{try{t?console.error(`${lu} Newired Overlay initialization failed.`,t):null!=e.editor&&pu(Ae.Editor,e.launcherVisible)}catch(e){console.error(`${lu} Newired Overlay initialization failed.`,e)}}))}function hu(){customElements.get("micro-app")||customElements.define("micro-app",el),customElements.get($a)||customElements.define($a,Qa),customElements.get(Ka)||customElements.define(Ka,Za)}let du=sn(window.targetWindow);function pu(e,t){e===Ae.Editor&&(window.registerIPCMessageListener("launcher",Oa),window.registerIPCMessageListener("ipc-request",Ma)),Fe().getSettings().frontendHtmlSanitize&&function(e=Oe.CAJA,t){We=e;try{switch(We){case Oe.NONE:console.log("Usage of HTML sanitizer is disabled by configuration.");break;case Oe.CAJA:{const e="html-css-sanitizer-minified.js";Me(t?`${t}/${e}`:Fe().deliveryResource(e)).then((e=>{Function(e)()}),(e=>{console.warn("CAJA HTML Sanitizer not initialized!",e)}));break}default:throw new Error("Not implemented")}}catch(t){console.warn(`Error injecting HTML Sanitizer ${e}.`,t),We=Oe.NONE}}(),function(e,t=!1){U?console.debug(`${_} Already initialized`):(F=t,console.debug(`${_}Initialize (running in editor: ${F})`,e),R=new A(e.crossDomainStorageUrl),M(window)?Q.registerListeners():console.debug(`${_}Not running inside IFrame. Cross-domain stub creation skipped.`),U=!0)}({crossDomainStorageUrl:Fe().deliveryResource("cross-domain.html"),domains:[]},e===Ae.Editor),au(),ru().then((n=>{E(f.LoadStoredState),function(e){const t={journeyId:gu(H("currentJourneyId")),stepIndex:gu(H("currentStepIndex")),stepUrl:null,redirected:"true"===H("redirecting"),autoPlayed:"true"===H("autoPlayed"),report:H("report"),persistence:H("persistence"),overlayLanguage:H("overlayLanguage"),applicationLanguage:H("applicationLanguage")};W("redirecting")||W("currentStepIndex")?(n="redirecting",P.removeValue(n)):q(["currentStepIndex","currentJourneyId"]),function(e){!function(e,t,n){V()?j(t):R.requestValues(e,t,n)}(["currentJourneyId","currentStepIndex","currentStepUrl","report","overlayLanguage","applicationLanguage"],(function(t,n,i){t?(console.warn(`${lu} getGlobalStore: ${t}`),e({journeyId:null,stepIndex:null,stepUrl:null,report:null,overlayLanguage:null,applicationLanguage:null})):e({journeyId:gu((i=i||{}).currentJourneyId),stepIndex:gu(i.currentStepIndex),stepUrl:i.currentStepUrl,report:i.report,overlayLanguage:i.overlayLanguage,applicationLanguage:i.applicationLanguage})}))}((function(n){if(function(e){const t=null!==e.journeyId&&null!==e.stepIndex&&null!==e.stepUrl;return console.debug(`${lu} Is global storage valid: ${t}`,e),t}(n)&&wn(window.targetWindow.location,n.stepUrl)){const i={journeyId:mu(n).journeyId,stepIndex:n.stepIndex,stepUrl:n.stepUrl,redirected:!1,autoPlayed:!1,persistence:t.persistence,report:n.report,overlayLanguage:n.overlayLanguage,applicationLanguage:n.applicationLanguage};console.debug(`${lu} Accept values from global storage.`,i),e(i)}else{const n=mu(t),i={journeyId:n.journeyId,stepIndex:t.stepIndex,stepUrl:null,redirected:n.redirected,autoPlayed:t.autoPlayed,persistence:t.persistence,report:t.report,overlayLanguage:t.overlayLanguage,applicationLanguage:t.applicationLanguage};console.debug(`${lu} Accept values from local storage.`,i),e(i)}}));var n}((function(i){T(f.LoadStoredState);const a=window.newired._internal.data;var l,u;l=a.getTexts(),u=n.overlayLanguage,r=u,s=l,o=!0;const c=function(){if("FRAMESET"===window.targetDocument.body.tagName)return console.error("Pages with frameset are not supported to run Newired Overlay"),window.sendIPCMessage("launcher",b.JSON.stringify({operation:"stateChanged",data:{state:"Error",message:"Can not operate on page with frames."}})),null;return window.nwApp.insertAdjacentHTML("afterbegin",'\n        <nw-dimmer id="newired-dimmer"></nw-dimmer>\n        <nw-align-editor id="newired-align-editor"></nw-align-editor>\n        <nw-tips id="newired-tips"></nw-tips>\n        <nw-steps id="newired-steps"></nw-steps>\n        <nw-launcher id="newired-launcher"></nw-launcher>'),window.nwApp.querySelector("nw-launcher")}();c&&Ha(e,c,n,i.persistence,t).then((()=>{Ga(window.newired._internal.data.getJourneyLinks()),window.targetWindow.addEventListener("newired-resize",(function(){(function(){const e=sn(window.targetWindow),t=du.width!=e.width||du.height!=e.height;return du=e,t})()&&(Ea&&Ea.setAllTipsOffScreen(),$l&&$l.setAllStepsOffScreen(),Ea&&Ea.evaluateTipsNotRegistered(),$l&&$l.resizeSpotlight())})),function(e,t){try{E(f.JourneyPlayerStart),Vl(e,t),T(f.JourneyPlayerStart)}catch(e){console.error(`${lu} Journeys initialization failed`,e)}}(e,i),function(e,t){try{E(f.EvaluateTips),Ca(e,t),T(f.EvaluateTips)}catch(e){console.error(`${lu} Tips initialization failed`,e)}}(e,n),nu.send({operation:"onOverlayReady"},(()=>{}))})).catch((e=>{console.error(`${lu} Unable to start Overlay. Cause: ${e}`)}))}))}))}const gu=e=>e?Number(e):null;function mu(e){const t=null===e.stepIndex||null===e.journeyId;return{journeyId:t?null:e.journeyId,redirected:!t&&e.redirected}}class fu{load(e,t,n,i){try{fu.fetchMicroAppDescription(t).then((r=>{try{const s=JSON.parse(r);s?s.enabled?this.loadRuntimeFiles(e,s).then((r=>zt(this,void 0,void 0,(function*(){const r="microapps/"+t+"/runtime/css/index.css";yield this.appendRuntimeStyle(e,Fe().deliveryResource(r),`${t}:index.css`);const o="microapps/"+t+"/runtime/themes/"+n+"/css/index.css";yield this.appendRuntimeStyle(e,Fe().deliveryResource(o),`${t}:${n}/index.css`),i(s,[])}))),(e=>{i(s,[e])})):i(s,[]):i(null,["Unable to parse MicroApp description"])}catch(e){console.warn(`Unable to load MicroApp ${t}, responseText: ${r}`,e),i(null,["Unable to load MicroApp"])}}),(e=>{i(null,[e])}))}catch(e){console.warn(`Unable to load MicroApp ${t}. Failed to load description file.`,e),i(null,[`Unable to load MicroApp ${t}. Failed to load description file. Cause: ${e}`])}}static fetchMicroAppDescription(e){const t=Fe().deliveryResource("microapps/"+e+"/desc.json");return console.log("Going to fetch MicroApp desc.json from: "+t),Me(t)}loadRuntimeFiles(e,t){const n=new Array;return t.runtime.forEach((i=>{const r=fu.getRuntimePath(t);".js"===i.substring(i.lastIndexOf(".js"))?b.array.push(n,r+i):".css"===i.substring(i.lastIndexOf(".css"))&&this.appendRuntimeStyle(e,r+i,`${t.key}:${i}`)})),new Promise(((e,t)=>{this.injectRuntimeScripts(n,(n=>{n.length>0?t(n):e([])}))}))}joinRuntimeScripts(e,t,n=""){const i=e.shift();i?Me(i).then((r=>{this.joinRuntimeScripts(e,t,`${n}\n// -------- ${i} --------------------------------------------\n${r}`)})):t(n)}injectRuntimeScripts(e,t){this.joinRuntimeScripts(e,(e=>{try{new Function(e)()}catch(e){console.error("MicroApp collected scripts: ",e)}t([])}))}appendRuntimeStyle(e,t,n){return zt(this,void 0,void 0,(function*(){return fetch(t).then((e=>{if(!e.ok)throw new Error(`Unable to get CSS: ${t}`);return e.text()})).then((t=>{fu.injectStyle(e,t,n)}))}))}static injectStyle(e,t,n){const i=e.createElement("style");i.insertAdjacentText("afterbegin",t),n&&(i.id=n),e.head.appendChild(i)}static getRuntimePath(e){return Fe().deliveryResource("microapps/"+e.key+"/runtime/")}}const bu=(e,t,n,i)=>{const r=function(e){return document.getElementById(e)}(i);if(null==r)return void console.warn(`Unable to initialize MicroApp ${e}. Cause: MicroApp element ${i} not found.`);const s=r.ownerDocument;wu.loadMicroApp(s,e,n,((n,i)=>{const s=function(e){let t=e.querySelector(".micro-app-container");t||(t=e.ownerDocument.createElement("div"),t.setAttribute("class","micro-app-container"),e.appendChild(t),function(e){const t=document.createElement("style");t.className="micro-app-placeholder-style",t.innerText="micro-app span.placeholder {display: none;}",e.appendChild(t)}(e));return t}(r);if(0===i.length&&null!==n)if(n.enabled)try{if(null!==t){const n=decodeURI(t),i=function(e){return wu.pluginRegistry.get("microapp",e)}(e);i?i.init(s,n):console.error(`Unable to initialize MicroApp ${e}.`)}}catch(t){console.info(`Unable to initialized MicroApp ${e}. Cause:`,t)}else console.info(`Disabled MicroApp ${e}. Cause:`,i),function(e){if(!e.getElementsByClassName("newired-microapp-disabled")[0]){const t=document.createElement("div");t.className="newired-microapp-disabled",t.innerText="We're sorry, there's nothing to show",e.appendChild(t)}}(s);else console.error(`Unable to initialize MicroApp ${e}. Cause:`,i),function(e){if(!e.getElementsByClassName("newired-microapp-not-available")[0]){const t=document.createElement("div");t.className="newired-microapp-not-available",t.innerText="Ups, something is missing",e.appendChild(t)}}(s)}))};class wu{static loadMicroApp(e,t,n,i){const r=this.microAppDescriptions[t];r?i(r.description,[]):this.microAppLoader.load(e,t,n,((e,n)=>{console.log(`MicroApps ${t} resources loaded.`,e),this.microAppDescriptions[t]={description:e},i(e,n)}))}}function yu(e){return new Promise(((t,n)=>function(e,t){const n={method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}};return fetch(e,n).then((e=>e.json()))}(Fe().toBackend("/rest/mail/send"),e).then((e=>{e.success?t():n(e.message)})).catch((e=>n(e)))))}wu.microAppLoader=new fu,wu.microAppDescriptions={},wu.microAppObjects={},wu.pluginRegistry={add:function(e,t,n){void 0===wu.microAppObjects[t]&&(console.log(`Register Plugin [${e}] '${t}'`,n),wu.microAppObjects[t]=n)},get:function(e,t){return wu.microAppObjects[t]},microApps:function(){return wu.microAppObjects}};class vu{constructor(e,t,n,i){this._journeys=e,this._journeyLinks=t,this._tips=n,this._texts=i}static empty(){return new vu({guides:[],guideRules:[],stepRules:[],autoplayRules:[],scripts:{predicates:[],actions:[],custom:[]},userTranslations:[],defaultLanguage:null,supportedLanguages:[]},[],{tips:[],tipRules:[],tipsAutoplay:[],iconColorPalette:[],iconSizeRange:[]},[])}setJourneys(e){this._journeys=Jt(e)}setJourneyLinks(e){this._journeyLinks=Jt(e)}setTips(e){this._tips=Jt(e)}setTexts(e){this._texts=Jt(e)}getRulesForJourney(e){return Jt(this._journeys.guideRules.find((t=>t.guideId==e))||null)}getRulesForJourneySteps(e){const t=this._journeys.guides.find((t=>t.id==e));if(t){const e=t.steps.map((e=>e.id));return Jt(this._journeys.stepRules.filter((t=>-1!=e.indexOf(t.stepId)))||null)}return[]}getJourneysAutoplay(){return Jt(this._journeys.autoplayRules)}getJourney(e){return Jt(this._journeys.guides.find((t=>t.id==e))||null)}getJourneys(){return Jt(this._journeys)}getJourneyLinks(){return this._journeyLinks}getStepById(e){for(const t of this._journeys.guides){const n=t.steps.find((t=>t.id==e));if(n)return n}return null}getTips(){return Jt(this._tips)}getTexts(){return Jt(this._texts)}getTipsIconSizes(){return Jt(this._tips.iconSizeRange)}getTipsIconColors(){return Jt(this._tips.iconColorPalette)}}var Eu,Tu,Cu;!function(e){e.Triangle="TRIANGLE",e.Rectangular="RECTANGULAR"}(Eu||(Eu={})),function(e){e.Tips="Tips",e.Journeys="Journeys"}(Tu||(Tu={})),function(e){e.BottomLeft="BOTTOM_LEFT",e.BottomRight="BOTTOM_RIGHT"}(Cu||(Cu={}));const Su={withGroupSeparator:!1,decimalSeparator:".",dateTimeFormat:"yyyy-MM-dd HH:mm",dateFormat:"yyyy-MM-dd",timeFormat:"HH:mm"};function Iu(){return{siteId:0,backend:"",licensedFeatures:[],launcherTitle:"Help?",launcherPosition:Cu.BottomLeft,launcherShapeType:Eu.Triangle,theme:"default",collectorEnabled:!0,defaultRuntimeOverlayLanguage:"en_US",defaultRuntimeApplicationLanguage:"en_US",frontendHtmlSanitize:!0,stepUrlAutoFill:!0,tipsDomObserverEnabled:!0,useRelativeUrl:!1,searchRepeatInterval:500,searchAttempts:3,elementClassHandle:ta.TrustElementValue,elementIdHandle:ta.TrustElementValue,extraWait:0,screenshotsEnabled:!0,screenshotsCreationDelay:100,contentRuleSettings:Su,objectStorageUrl:""}}function xu(e){const t=e.contentRuleSettings.decimalSeparator;"."!==t&&","!==t&&console.warn(`Invalid decimal separator "${t}" in configured Content Rule settings. Accepted separator is point or comma only. Evaluation of decimal numbers for Content Rules might not work properly!`)}function Lu(e){return e.endsWith("/")?e.substr(0,e.length-1):e}const ku={stepTransitionSettings:{timerDefaults:{click:0,input:2,valueChange:0,hover:0,multiple:0,timing:5}}};class Du{constructor(){this._changeListeners=[],this._journeyLocks=[],this._editorId=null,this._token=null,this._data=vu.empty(),this._elmLauncher="",this._bubbleCSS="",this._bubbleThemeCSS="",this._pluginBundleScript="",this._inlineEditorCSS="",this._feedbackTexts={},this._settings=Iu(),this._editorServer="",this._backend="",this._deliveryPath="",this._objectStorage="",this._journeysSettings=ku}getLockedJourneyIds(){return this._journeyLocks.filter((e=>e.editorId!==this._editorId)).map((e=>e.journeyId))}syncJourneyLocks(e){this._journeyLocks.filter((t=>t.journeyId===e.journeyId))?e.locked||(this._journeyLocks=this._journeyLocks.filter((t=>t.journeyId!==e.journeyId))):e.locked&&this._journeyLocks.push(e)}initialize(e,t){var n;if(null==e.editor)return void t("Unable to initialize EditorDataAccess due missing Editor options.");this._journeysSettings=null===(n=e.editor)||void 0===n?void 0:n.journeysSettings,this._editorServer=e.editor.editorServer,this._backend=Lu(e.backend||""),this._deliveryPath=e.deliveryPath,this._objectStorage=Lu(e.objectStorage||""),this._token=e.editor.token,Jo.init(this._token);const i=e.editor.site;this._feedbackTexts=i.feedbackTexts,Promise.all([Me(this.deliveryCSS("bubble.css")),Me(this.deliveryResource("plugins.bundle.js")),Me(this.deliveryCSS("inline-editor.css")),_e(this.deliveryResource("json/translations.json")),Me(this.deliveryResource("elm-launcher.js")),_e(this.toBackend(`/rest/launcher/get?id=${i.id}`),this._token),_e(this.toBackend("/rest/app/settings"),this._token),_e(this.toBackend(`/rest/guides/data?siteId=${i.id}`),this._token),_e(this.toBackend("/rest/journeyLock/list"),this._token),_e(this.toBackend("/rest/auth/editorCheck"),this._token),_e(this.toBackend("/rest/license/list"),this._token),_e(this.toBackend(`/rest/guide/journeyLinks?siteId=${i.id}`),this._token)]).then((e=>{try{const n={bubbleCSS:e[0],pluginBundleScript:e[1],inlineEditorCSS:e[2],texts:e[3],elmLauncher:e[4],launcherConfig:e[5],settings:e[6],journeysData:e[7],journeyLocks:e[8],auth:e[9],licensedFeatures:e[10],journeyLinks:e[11]};return xu(n.settings),this._settings=function(e,t,n){const i=Iu();return i.siteId=t.id,i.backend=e,i.licensedFeatures=n.licensedFeatures,i.launcherTitle=n.launcherConfig.title,i.launcherPosition=n.launcherConfig.position,i.theme=t.theme,i.defaultRuntimeOverlayLanguage="en_US",i.defaultRuntimeApplicationLanguage="en_US",i.frontendHtmlSanitize=n.settings.frontendHtmlSanitize,i.stepUrlAutoFill=t.options.stepUrlAutoFill,i.tipsDomObserverEnabled=t.options.tipsDomObserverEnabled||i.tipsDomObserverEnabled,i.searchRepeatInterval=t.options.searchRepeatInterval||i.searchRepeatInterval,i.searchAttempts=t.options.searchAttempts||i.searchAttempts,i.elementClassHandle=t.options.elementClassHandle||i.elementClassHandle,i.elementIdHandle=t.options.elementIdHandle||i.elementIdHandle,i.screenshotsEnabled=n.settings.screenshotsEnabled,i.screenshotsCreationDelay=n.settings.screenshotsCreationDelay,i.useRelativeUrl=t.useRelativeUrl,i.contentRuleSettings=n.settings.contentRuleSettings,i.objectStorageUrl=n.settings.objectStorageUrl||`${e}${e.endsWith("/")?"storage":"/storage"}`,i}(this._backend,i,n),this._bubbleCSS=Ue(n.bubbleCSS,"bubble-fallback"),this._pluginBundleScript=n.pluginBundleScript,this._inlineEditorCSS=Ue(n.inlineEditorCSS,"inline-editor"),this._journeyLocks=n.journeyLocks,this._editorId=n.auth.editorId,this._elmLauncher=n.elmLauncher,this._data.setJourneys(n.journeysData),this._data.setJourneyLinks(n.journeyLinks),this._data.setTexts(n.texts),fa(this._data,this._feedbackTexts,this._settings.objectStorageUrl),Me(this.deliveryCSS("bubble.css",i.theme)).then((e=>{this._bubbleThemeCSS=Ue(e,"bubble-"+i.theme,i.theme),t()}),(e=>{console.warn(`Theme not loaded ${i.theme}.`,e),t()}))}catch(e){t(e)}})).catch((e=>{t("error: "+b.JSON.stringifyPretty(e))}))}deliveryCSS(e,t){return this.isLocalResource(e)&&!t?this._editorServer+"/"+e:this._deliveryPath+(t?"themes/"+t+"/":"")+"css/"+e}deliveryResource(e){return this.isLocalResource(e)?this._editorServer+e:this._deliveryPath+e}editorResource(e){return this._editorServer+e}getJourneysSettings(){return Jt(this._journeysSettings)}toBackend(e){return this._backend+e}isLocalResource(e){return!0===Be(window).isRunningInEditor&&null!==this._editorServer&&(e.endsWith(".js")||e.endsWith(".html")||e.endsWith("translations.json")||e.endsWith("bubble.css")||e.endsWith("inline-editor.css"))}getSettings(){return this._settings}getApplicationProfile(){return{extraWait:this._settings.extraWait,searchRepeatInterval:this._settings.searchRepeatInterval,searchAttempts:this._settings.searchAttempts,elementIdHandle:this._settings.elementIdHandle,elementClassHandle:this._settings.elementClassHandle,tipsDomObserverEnabled:this._settings.tipsDomObserverEnabled,useRelativeUrl:this._settings.useRelativeUrl,theme:this._settings.theme,screenshotsEnabled:this._settings.screenshotsEnabled,screenshotsCreationDelay:this._settings.screenshotsCreationDelay,contentRuleSettings:this._settings.contentRuleSettings}}getRulesForJourney(e){return this._data.getRulesForJourney(e)}getRulesForJourneySteps(e){return this._data.getRulesForJourneySteps(e)}getJourneysAutoplay(){return this._data.getJourneysAutoplay()}getJourney(e){return this.reloadEditorData().then((()=>this._data.getJourney(e)))}getJourneys(){return this._data.getJourneys()}getJourneyLinks(){return this._data.getJourneyLinks()}getStepById(e){return this._data.getStepById(e)}getTips(){return this._data.getTips()}getTipsIconSizes(){return[{index:1,value:"8"},{index:2,value:"12"},{index:3,value:"16"},{index:4,value:"20"},{index:5,value:"24"},{index:6,value:"32"},{index:7,value:"40"}]}getTipsIconColors(){return[{index:1,value:"#F6402C"},{index:2,value:"#EB1460"},{index:3,value:"#9C1AB1"},{index:4,value:"#6633B9"},{index:5,value:"#3D4DB7"},{index:6,value:"#1093F5"},{index:7,value:"#00BBD5"},{index:8,value:"#46AF4A"},{index:9,value:"#CCDD1E"},{index:10,value:"#FFEC16"},{index:11,value:"#FFC100"},{index:12,value:"#FF9800"},{index:13,value:"#111111"},{index:14,value:"#FFFFFF"}]}getTexts(){return this._data.getTexts()}reloadBubbleFrameResources(e,t){return Me(this.deliveryCSS("bubble.css",e)).then((n=>{this._bubbleThemeCSS=Ue(n,"bubblle-"+e,e),t()}),(e=>{t(e)}))}getLauncherScript(){return this._elmLauncher}appendBubbleFrameResources(e){e.head.insertAdjacentHTML("afterbegin",this._bubbleThemeCSS),e.head.insertAdjacentHTML("afterbegin",this._bubbleCSS);const t=e.createElement("script");t.id="plugin-bundle",t.insertAdjacentText("afterbegin",this._pluginBundleScript),e.body.appendChild(t)}appendInlineEditorResources(e){e.head.insertAdjacentHTML("afterbegin",this._inlineEditorCSS)}addChangeListener(e){b.array.push(this._changeListeners,e)}notifyListeners(){this._changeListeners.forEach((e=>{e()}))}reloadEditorData(){const e=Fe().getSettings().siteId;return Promise.all([_e(Fe().toBackend(`/rest/guides/data?siteId=${e}`),this._token),_e(Fe().toBackend(`/rest/guide/journeyLinks?siteId=${e}`),this._token)]).then((e=>{this._data.setJourneys(e[0]),this._data.setJourneyLinks(e[1]),fa(this._data,this._feedbackTexts,this._settings.objectStorageUrl),nu.send({operation:"setData",parameters:su()},(e=>{}))}),(e=>(console.error("Unable to reload data.",e),e)))}updateSettings(e){this._settings.extraWait=e.extraWait,e.defaultRuntimeApplicationLanguage&&(this._settings.defaultRuntimeApplicationLanguage=e.defaultRuntimeApplicationLanguage),e.defaultRuntimeOverlayLanguage&&(this._settings.defaultRuntimeOverlayLanguage=e.defaultRuntimeOverlayLanguage),e.searchAttempts&&(this._settings.searchAttempts=e.searchAttempts),e.searchRepeatInterval&&(this._settings.searchRepeatInterval=e.searchRepeatInterval),this._settings.stepUrlAutoFill=e.stepUrlAutoFill,this._settings.elementClassHandle=e.elementClassHandle,this._settings.elementIdHandle=e.elementIdHandle,this._settings.tipsDomObserverEnabled=e.tipsDomObserverEnabled,this._settings.theme=e.theme,this._settings.useRelativeUrl=e.useRelativeUrl,this.notifyListeners()}}function Pu(e){return t=>{const n=(i=e,r=t.urlId,i.filter((e=>e.id==r))[0]);var i,r,s;if(n){const e=Lu(n.url);t.url=e+"/"+((s=t.urlPath||"").startsWith("/")?s.substr(1):s)}}}class Nu{constructor(){this._data=vu.empty(),this._elmLauncher="",this._bubbleCSS="",this._bubbleThemeCSS="",this._pluginBundleScript="",this._settings=Iu(),this._deliveryPath=""}getLockedJourneyIds(){throw new Error("Invalid operation. Attempt to getLockedJourneysIds in runtime.")}syncJourneyLocks(){throw new Error("Invalid operation. Attempt to syncJourneyLocks in runtime.")}reloadEditorData(){throw new Error("Invalid operation. Attempt to reloadEditorData in runtime.")}initialize(e,t,n,i,r){this._deliveryPath=t,E(f.LoadData);const s=e=>{T(f.LoadData),r(e)};Promise.all([Me(this.deliveryCSS("bubble.css")),Me(this.deliveryResource("plugins.bundle.js")),_e(this.deliveryResource("config.json")),_e(this.deliveryResource("journeys.json")),_e(this.deliveryResource("tips.json")),_e(this.deliveryResource("translations.json")),Me(this.deliveryResource("elm-launcher.js"))]).then((t=>{try{const o={bubbleCSS:t[0],pluginBundleScript:t[1],config:t[2],journeys:t[3],tips:t[4],texts:t[5],elmLauncher:t[6]};xu(o.config),this._settings=function(e,t,n){const i=Iu();if(i.siteId=e.siteId,i.backend=t,i.licensedFeatures=e.licensedFeatures,i.launcherTitle=e.handleTitle,i.launcherPosition=e.position,i.theme=e.theme,i.defaultRuntimeOverlayLanguage=e.defaultRuntimeOverlayLanguage,i.defaultRuntimeApplicationLanguage=e.defaultRuntimeApplicationLanguage,i.frontendHtmlSanitize=e.frontendHtmlSanitize,i.stepUrlAutoFill=!0,e.options){const t=JSON.parse(e.options);i.tipsDomObserverEnabled=t.tipsDomObserverEnabled||i.tipsDomObserverEnabled,i.useRelativeUrl=e.useRelativeUrl||i.useRelativeUrl,i.searchRepeatInterval=t.searchRepeatInterval||i.searchRepeatInterval,i.searchAttempts=t.searchAttempts||i.searchAttempts,i.elementClassHandle=t.elementClassHandle||i.elementClassHandle,i.elementIdHandle=t.elementIdHandle||i.elementIdHandle}return i.contentRuleSettings=e.contentRuleSettings,i.objectStorageUrl=n||e.objectStorageUrl||`${t}${t.endsWith("/")?"storage":"/storage"}`,i}(o.config,Lu(e||""),Lu(i||"")),this._bubbleCSS=Ue(o.bubbleCSS,"bubble-fallback"),this._pluginBundleScript=o.pluginBundleScript,this._elmLauncher=o.elmLauncher,this._data.setJourneys(o.journeys),this._data.setTips(o.tips),this._data.setTexts(o.texts),function(e,t,n){e.setJourneys(da(e.getJourneys(),n,Pu(t)));const i=e.getTips();i.tips=ga(i.tips,n,Pu(t)),e.setTips(i)}(this._data,n,this._settings.objectStorageUrl);Me(this.deliveryCSS("bubble.css",this._settings.theme)).then((e=>{T(f.LoadData),this._bubbleThemeCSS=Ue(e,"bubble-"+this._settings.theme,this._settings.theme),r()}),(e=>{console.warn(`Theme not loaded ${this._settings.theme}.`,e),s(null)}))}catch(e){s(e)}}),(e=>{s(e)}))}addChangeListener(e){}updateSettings(e){console.error("Attempt to get update settings. This is available only in the Editor.")}deliveryCSS(e,t){return this._deliveryPath+(t?"themes/"+t+"/":"")+"css/"+e}deliveryResource(e){return this._deliveryPath+e}getJourneysSettings(){return console.error("Attempt to get JourneysSettings that are available only in the Editor."),{stepTransitionSettings:{timerDefaults:{click:0,input:2,valueChange:0,hover:0,multiple:0,timing:5}}}}editorResource(e){return console.error(`Attempt to get Editor resource from RuntimeDataAccess: ${e}`),""}toBackend(e){return this._settings.backend+e}getSettings(){return Jt(this._settings)}getApplicationProfile(){return{extraWait:this._settings.extraWait,searchRepeatInterval:this._settings.searchRepeatInterval,searchAttempts:this._settings.searchAttempts,elementIdHandle:this._settings.elementIdHandle,elementClassHandle:this._settings.elementClassHandle,tipsDomObserverEnabled:this._settings.tipsDomObserverEnabled,useRelativeUrl:this._settings.useRelativeUrl,theme:this._settings.theme,screenshotsEnabled:!1,screenshotsCreationDelay:0,contentRuleSettings:this._settings.contentRuleSettings}}reloadBubbleFrameResources(e,t){return Me(this.deliveryCSS("bubble.css",e)).then((n=>{this._bubbleThemeCSS=Ue(n,"bubble-"+e,e),t()}),(e=>{t(e)}))}getRulesForJourney(e){return this._data.getRulesForJourney(e)}getRulesForJourneySteps(e){return this._data.getRulesForJourneySteps(e)}getJourneysAutoplay(){return this._data.getJourneysAutoplay()}getJourney(e){return Promise.resolve(this._data.getJourney(e))}getJourneys(){return this._data.getJourneys()}getJourneyLinks(){return this.getJourneys().guides.map((e=>({id:e.id,name:At(e.language,e.name),startUrl:Au(e),available:!0,deleted:!1})))}getStepById(e){return this._data.getStepById(e)}getTips(){return this._data.getTips()}getTipsIconSizes(){return this._data.getTipsIconSizes()}getTipsIconColors(){return this._data.getTipsIconColors()}getTexts(){return this._data.getTexts()}getLauncherScript(){return this._elmLauncher}appendBubbleFrameResources(e){if(e.head.insertAdjacentHTML("afterbegin",this._bubbleThemeCSS),e.head.insertAdjacentHTML("afterbegin",this._bubbleCSS),"browser-snippet"===window.environment){const t=e.createElement("script");t.insertAdjacentText("afterbegin",this._pluginBundleScript),e.body.appendChild(t)}}appendInlineEditorResources(e){}}function Au(e){const t=e.steps.find((e=>0==e.order));return t?t.url:null}function Ou(e){const t={};return e.forEach((e=>{t[e.language]=e.value})),t}class Mu{getVisibleJourneys(e){return function(e){if($l){const t=window.newired._internal.data.getJourneys(),n=t.guides,i=t.guideRules;return function(e,t,n,i){return new Promise(((r,s)=>{t.reduce(((t,r)=>t.then((t=>new Promise(((s,o)=>{$o(e,_i(r.rules),n,i).then((e=>{s(e?t.concat(r):t)}))}))))),Promise.resolve([])).then((e=>{r(e)}))}))}(window.targetWindow,i,Fe().getApplicationProfile(),e).then((e=>{const t=e.map((e=>e.guideId));return n.filter((e=>-1!==t.indexOf(e.id)))})).then((t=>_u(e,function(e,t){return t.filter((t=>Nt(e.overlayLanguage,t.name)))}(e,t))))}return Promise.reject([])}(e)}getJourneysByName(e,t){return Ru(e).filter(function(e){return t=>{for(const n in t.nameTranslations)if(t.nameTranslations[n]===e)return!0;return!1}}(t))}getJourneyById(e,t){return Ru(e).filter((e=>e.id===t))[0]||null}getRunningJourney(e){return $l.runningJourneyId?this.getJourneyById(e,$l.runningJourneyId):null}getJourneys(e){return function(e){const t=window.newired._internal.data.getJourneys().guides;return Promise.resolve(_u(e,t))}(e)}start(e,t,n=0,i=me.APILaunch){return $l.runningJourneyId?Promise.reject(`There is already started Journey with ID ${t}.`):$l.playJourney(e,t,n,i,null,!1)}stop(e){$l.stopJourney()}}function _u(e,t){return t.map((t=>function(e,t){const n={id:t.id,order:t.order,nameTranslations:Ou(t.name)};return e.translateTexts&&n.nameTranslations[e.overlayLanguage]&&(n.name=n.nameTranslations[e.overlayLanguage]),e.editorMetadata&&(n.locked=-1!==window.newired._internal.data.getLockedJourneyIds().indexOf(n.id)),n}(e,t)))}function Ru(e){return _u(e,window.newired._internal.data.getJourneys().guides)}function Bu(e){switch(e.operation){case"journeys.journeyStarted":i=e.data,Pa&&Pa.onJourneyStarted.send(i);break;case"journeys.journeyStepStarted":!function(e){Pa&&Pa.onJourneyStepStarted.send(e)}(e.data);break;case"journeys.journeyStopped":!function(e){Pa&&Pa.onJourneyStopped.send(e)}(e.data);break;case"journeys.busy":!function(e){Pa&&Pa.onJourneyBusyChange.send(e.isBusy)}(e.data);break;case"journeys.initialized":Pa&&Pa.onJourneysInitialized.send(null);break;case"journeys.journeyPreview":!function(e){Pa&&Pa.onJourneyPreview.send(e)}(e.data);break;case"journeys.showStepFeedback":!function(e){Pa&&Pa.showStepFeedback.send(e)}(e.data);break;case"messages.showJourneyError":!function(e){Pa&&Pa.showMessageJourneyError.send(e)}(e.data);break;case"messages.showJourneyStartError":n=e.data,Pa&&Pa.showMessageJourneyStartError.send(n);break;case"messages.showJourneyInfo":t=e.data,Pa&&Pa.showMessageJourneyInfo.send(t);break;case"messages.showEmptyJourneyInfo":!function(e){Pa&&Pa.showMessageEmptyJourneyInfo.send(e)}(e.data);break;case"messages.closeMessage":Pa&&Pa.closeMessage.send(null)}var t,n,i}class Fu extends Error{constructor(){super("Not implemented yet. Planned in future releases.")}}window.isRunningInEditor=window.isRunningInEditor||!1,window.newired=new class extends class{constructor(){this._internal={initialize:window.isRunningInEditor?cu:uu,pluginRegistry:wu.pluginRegistry,sendEmail:yu,JSON:b.JSON,startJourneyLink:Zl,getJourneyLinks:Xa,Tips:{evaluateAll:Sa,replaceAll:Ia},data:window.isRunningInEditor?new Du:new Nu,openMenu:Fa,cleanStorage:()=>{!V()&&R&&R.clean(),P.clean(),Hl()},root:!0,dispatchOverlayEvent:Bu,showConfirmDialog:Ra,showCustomConfirmDialog:Ba,performance:{measureStart:E,measureEnd:T,measureIncrementsStart:S,measureIncrement:I,getMeasurement:x},loadMicroApp:bu},this.journeys=new Mu,this.root=!0}initialize(){throw new Fu}disableOverlay(){Ea&&Ea.deregisterTips(),$l&&$l.disableJourneys(),Pa&&Pa.onLauncherDisabled.send(null)}enableOverlay(){Ea&&Ea.evaluateTips(),$l&&$l.enableJourneys(),Pa&&Pa.onLauncherEnabled.send(null)}isOverlayEnabled(){return!!$l&&$l.isJourneysEnabled()}showLauncherPanel(){Fa()}hideLauncherPanel(){Pa&&Pa.closeMenu.send(null)}isLauncherPanelVisible(){return function(){const e=window.nwApp.querySelector("nw-launcher#newired-launcher");return!!e&&e.classList.contains("newired-launcher-menu-opened")}()}isLauncherVisible(){return function(){const e=window.nwApp.querySelector("nw-handle#newired-handle");return!!e&&!e.classList.contains("newired-handle-hidden")}()}setLauncherVisibility(e){return function(e){if("boolean"!=typeof e)throw Error("Expected boolean value")}(e),function(e){return new Promise(((t,n)=>{Pa?(Aa=()=>{t(!0)},Pa.setLauncherVisibility.send(e)):n(!1)}))}(e)}}{}}();