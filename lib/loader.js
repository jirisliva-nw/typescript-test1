!function(e){"use strict";function n(e,n){return new Promise(((i,o)=>function(e){const n=t(e,"storage.bundle.js");return new Promise(((t,i)=>r(n).then((n=>{new Function(n).call();const o=e.deliveryPath+"cross-domain.html";Newired.Storage.init({crossDomainStorageUrl:o,domains:[]}),Newired.Storage.getGlobalValue("site_preview_version",(function(e,n,o){if(Newired.Storage.dispose(),e)console.log("[loader]: Reading from Local Storage failed.",e),i();else if(o){const e=JSON.parse(o);console.log(`[loader]: Got preview from Local Storage: ${JSON.stringify(e,null,"  ")}`),!function(e){return e.siteUrls.find((e=>-1!==location.href.indexOf(e)))}(e)?(console.log(`Preview does NOT match page URL: ${location.href}`),i()):(console.log(`Preview match page URL: ${location.href}`),t(e))}else console.log("[loader]: Preview not found."),i()}))})).catch((()=>{console.log(`[loader]: Unable to fetch Storage bundle file: ${n}`),i()}))))}(e).then((n=>{e.deliveryPath=n.contentDeliveryUrl+"/"+n.siteId+"/"+n.versionId+"/",i(e)})).catch((t=>{e.testVersion?(e.deliveryPath=e.deliveryPath+e.testVersion+"/",i(e)):n.liveVersion?(e.deliveryPath=e.deliveryPath+n.liveVersion+"/",i(e)):o(t)}))))}function t(e,n){return e.deliveryPath+n+"?"+(new Date).getTime()}async function i(e){return await function(e,n){const i=t(e,n);return fetch(i).then((e=>{if(!e.ok)throw new Error(`File missing: ${i}`);return!0})).catch((()=>!1))}(e,"api.bundle.js")?"isolated":"legacy-version"}function o(e){return new Promise(((o,r)=>{(function(e){return fetch(t(e,"metadata.json")).then((e=>{if(!e.ok)throw new Error("No metadata.json");return e.json()}))})(e).then((async t=>n(e,t).then((async e=>{o({versionType:await i(e),options:e})})))).catch((()=>{r("Please check your Site on Portal if there is content marked as LIVE or PREVIEW.\nNo published context yet.")}))}))}function r(e){return fetch(e).then((n=>{if(!n.ok)throw new Error(`Unable to get requested file ${e}`);return n.text()}))}function a(e){!function(e,n){const t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=n,t.onerror=function(n){console.error(`Loading of script failed: "${e}"`,n)},document.head.appendChild(t)}(t(e,"launcher.bundle.js"),(function(){var n;!function(e){const n=document.createElement("script");n.type="text/javascript",n.insertAdjacentText("afterbegin",e),document.body.appendChild(n)}(`\n                    if (window.newired && window.newired._internal) {\n                        window.newired._internal.initialize(${JSON.stringify(e)})\n                    } else {\n                        window.Newired.Launcher.initialize(${JSON.stringify(e)})\n                    }\n                `),n={kind:"legacyOverlayLoaded"},"function"==typeof window.notifyWebExtension&&window.notifyWebExtension(n)}))}function c(n){return void 0===n.launcherVisible&&(n.launcherVisible=!0),void 0===n.profile&&(n.profile="default"),void 0===n.backend&&(n.backend=null),void 0===n.objectStorage&&(n.objectStorage=null),n.deliveryPath=function(n){if(n.deliveryPath)return n.deliveryPath;return e.src.substring(0,e.src.lastIndexOf("/")+1)}(n),n}window.newired={initialize:function(e,n){(function(e){return!(!window.isRunningInEditor||"editor"===e.source||(console.log("[loader]: Launching inside Editor => Overlay initialization stopped."),0))})(e)||o(e=c(e)).then((e=>{switch(console.log(`[loader]: Resolved Startup Options: ${JSON.stringify(e,null,"  ")}`),e.versionType){case"legacy-version":a(e.options);break;case"isolated":!function(e){r(t(e,"init.js")).then((n=>{new Function(n).call(),window.newired.init(e)}))}(e.options)}})).catch((e=>{console.warn("\n===================================================================================\n\n  Unable to load Newired Overlay\n\n  "+e+"\n\n===================================================================================")}))}}}(document.currentScript);